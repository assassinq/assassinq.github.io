<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>攻防世界-MOBILE-新手练习区 | AssassinQ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="reandroid">
  
  
  
  
  <meta name="description" content="持续更新。">
<meta name="keywords" content="re,android">
<meta property="og:type" content="article">
<meta property="og:title" content="攻防世界-MOBILE-新手练习区">
<meta property="og:url" content="qianfei11.coding.me/2020/02/20/[TODO]攻防世界-MOBILE-新手练习区/index.html">
<meta property="og:site_name" content="AssassinQ">
<meta property="og:description" content="持续更新。">
<meta property="og:locale" content="default">
<meta property="og:image" content="/pics/攻防世界-MOBILE-新手练习区/1.png">
<meta property="og:image" content="/pics/攻防世界-MOBILE-新手练习区/2.png">
<meta property="og:updated_time" content="2020-03-15T09:07:03.243Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="攻防世界-MOBILE-新手练习区">
<meta name="twitter:description" content="持续更新。">
<meta name="twitter:image" content="/pics/攻防世界-MOBILE-新手练习区/1.png">
  
    <link rel="alternate" href="/atom.xml" title="AssassinQ" type="application/atom+xml">
  
  <link rel="icon" href="/css/images/favicon.ico">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">

  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Oswald%3A300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css">
  <link rel="stylesheet" href="/css/fashion.css">
  <link rel="stylesheet" href="/css/glyphs.css"><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>
</html>


  <body data-spy="scroll" data-target="#toc" data-offset="50">


  
  
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="site-header-image">
    <img id="originBg" width="100%" alt="Hike News" src>
  </div>

  <div id="header-blur" class="site-header-image blur" style="position: absolute; top:0; height: 207px; min-height: 207px; min-width: 100%;">
    <img id="blurBg" width="100%" style="top: 96%" alt="Hike News" src>
  </div>

  <script>
        var imgUrls = "css/images/pose01.jpg".split(",");
        var random = Math.floor((Math.random() * imgUrls.length ));
        if (imgUrls[random].startsWith('http') || imgUrls[random].indexOf('://') >= 0) {
          document.getElementById("originBg").src=imgUrls[random];
          document.getElementById("blurBg").src=imgUrls[random];
        } else {
          document.getElementById("originBg").src='/' + imgUrls[random];
          document.getElementById("blurBg").src='/' + imgUrls[random];
        }
    </script>




<header id="allheader" class="site-header" role="banner" style="width: 100%; position: absolute; top:0; background: rgba(255,255,255,.8);">
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/" title="AssassinQ" rel="home"> AssassinQ </a>
            
          </h1>
          
          
            <div class="site-description">ZJGSU-IS-17</div>
          
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>

            <div class="clearfix sf-menu">
              <ul id="main-nav" class="menu sf-js-enabled sf-arrows" style="touch-action: pan-y;">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class href="/">Home</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class href="/archives">Archives</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class href="/tags">Tags</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class href="/about">About</a> </li>
                    
              </ul>
            </div>
          </nav>

      </div>
  </div>
</header>


  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-[TODO]攻防世界-MOBILE-新手练习区" style="width: 66%; float:left;" class="article article-type-post" itemscope itemprop="blogPost">
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      攻防世界-MOBILE-新手练习区
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2020/02/20/[TODO]攻防世界-MOBILE-新手练习区/" class="article-date">
	  <time datetime="2020-02-20T11:51:47.000Z" itemprop="datePublished">February 20, 2020</time>
	</a>

       
      

	  |
	  15.5k words
	  |
	  89 minute(s) to read
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>持续更新。</p>
<a id="more"></a>
<h1 id="app1"><a href="#app1" class="headerlink" title="app1"></a>app1</h1><p>将 apk 拖入 jadx 进行反编译，查看入口点 MainActivity 代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.yaphetshan.tencentgreat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.pm.PackageInfo;</span><br><span class="line"><span class="keyword">import</span> android.content.pm.PackageManager.NameNotFoundException;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.v4.view.accessibility.AccessibilityNodeInfoCompat;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.View.OnClickListener;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    Button btn;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> String pName = BuildConfig.APPLICATION_ID;</span><br><span class="line">    EditText text;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView((<span class="keyword">int</span>) R.layout.activity_main);</span><br><span class="line">        <span class="keyword">this</span>.btn = (Button) findViewById(R.id.checBtn);</span><br><span class="line">        <span class="keyword">this</span>.text = (EditText) findViewById(R.id.input);</span><br><span class="line">        <span class="keyword">this</span>.btn.setOnClickListener(<span class="keyword">new</span> OnClickListener() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    String inputString = MainActivity.<span class="keyword">this</span>.text.getText().toString();</span><br><span class="line">                    PackageInfo pinfo = MainActivity.<span class="keyword">this</span>.getPackageManager().getPackageInfo(BuildConfig.APPLICATION_ID, AccessibilityNodeInfoCompat.ACTION_COPY);</span><br><span class="line">                    String versionCode = pinfo.versionName; <span class="comment">// 获取包信息中的versionName</span></span><br><span class="line">                    <span class="keyword">int</span> versionName = pinfo.versionCode; <span class="comment">// 获取包信息中的versionCode</span></span><br><span class="line">                    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">while</span> (i &lt; inputString.length() &amp;&amp; i &lt; versionCode.length()) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (inputString.charAt(i) != (versionCode.charAt(i) ^ versionName)) &#123; <span class="comment">// 将versionCode中的每一字节和versionName异或并和输入比较</span></span><br><span class="line">                            Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">"\u518d\u63a5\u518d\u5389\uff0c\u52a0\u6cb9~"</span>, <span class="number">1</span>).show(); <span class="comment">// 再接再厉，加油~</span></span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        i++;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (inputString.length() == versionCode.length()) &#123; <span class="comment">// 判断输入的长度和versionCode是否相同</span></span><br><span class="line">                        Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">"\u606d\u559c\u5f00\u542f\u95ef\u5173\u4e4b\u95e8\uff01"</span>, <span class="number">1</span>).show(); <span class="comment">// 恭喜开启闯关之门！</span></span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (NameNotFoundException e) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">                Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">"\u5e74\u8f7b\u4eba\u4e0d\u8981\u800d\u5c0f\u806a\u660e\u5662"</span>, <span class="number">1</span>).show(); <span class="comment">// 年轻人不要耍小聪明噢</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码中可以判断出是将 versionCode 和 versionName 进行异或然后和输入比较，具体信息可以在 AndroidManifest.xml 中找到：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span> <span class="attr">android:versionCode</span>=<span class="string">"15"</span> <span class="attr">android:versionName</span>=<span class="string">"X&lt;cP[?PHNB&lt;P?aj"</span> <span class="attr">package</span>=<span class="string">"com.example.yaphetshan.tencentgreat"</span> <span class="attr">platformBuildVersionCode</span>=<span class="string">"25"</span> <span class="attr">platformBuildVersionName</span>=<span class="string">"7.1.1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-sdk</span> <span class="attr">android:minSdkVersion</span>=<span class="string">"19"</span> <span class="attr">android:targetSdkVersion</span>=<span class="string">"25"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.INTERNET"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta-data</span> <span class="attr">android:name</span>=<span class="string">"android.support.VERSION"</span> <span class="attr">android:value</span>=<span class="string">"25.3.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span> <span class="attr">android:theme</span>=<span class="string">"@style/AppTheme"</span> <span class="attr">android:label</span>=<span class="string">"@string/app_name"</span> <span class="attr">android:icon</span>=<span class="string">"@mipmap/ic_launcher"</span> <span class="attr">android:debuggable</span>=<span class="string">"true"</span> <span class="attr">android:allowBackup</span>=<span class="string">"true"</span> <span class="attr">android:supportsRtl</span>=<span class="string">"true"</span> <span class="attr">android:roundIcon</span>=<span class="string">"@mipmap/ic_launcher_round"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">"com.example.yaphetshan.tencentgreat.MainActivity"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.MAIN"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.LAUNCHER"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>编写脚本来得到 flag：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line">versionCode = <span class="number">15</span></span><br><span class="line">versionName = <span class="string">"X&lt;cP[?PHNB&lt;P?aj"</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> versionName:</span><br><span class="line">    flag += chr(ord(c) ^ versionCode)</span><br><span class="line"><span class="keyword">print</span> flag</span><br><span class="line"><span class="comment"># W3l_T0_GAM3_0ne</span></span><br></pre></td></tr></table></figure>
<h1 id="app2"><a href="#app2" class="headerlink" title="app2"></a>app2</h1><p>先使用 jadx 反编译，查看入口点的代码，在两个输入框中输入字符串后会去调用 SecondActivity：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tencent.testvuln;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.annotation.SuppressLint;</span><br><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.content.SharedPreferences.Editor;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.os.Handler;</span><br><span class="line"><span class="keyword">import</span> android.support.v4.BuildConfig;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.Menu;</span><br><span class="line"><span class="keyword">import</span> android.view.MenuItem;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.View.OnClickListener;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"><span class="keyword">import</span> com.tencent.testvuln.c.SignatureTool;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressLint</span>(&#123;<span class="string">"ShowToast"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> <span class="keyword">implements</span> <span class="title">OnClickListener</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Button a;</span><br><span class="line">    <span class="keyword">private</span> Handler b = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> EditText c;</span><br><span class="line">    <span class="keyword">private</span> EditText d;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle bundle)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(bundle);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        <span class="keyword">this</span>.a = (Button) findViewById(R.id.button1);</span><br><span class="line">        <span class="keyword">this</span>.a.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">this</span>.c = (EditText) findViewById(R.id.editText1);</span><br><span class="line">        <span class="keyword">this</span>.d = (EditText) findViewById(R.id.editText2);</span><br><span class="line">        Editor edit = getSharedPreferences(<span class="string">"test"</span>, <span class="number">0</span>).edit();</span><br><span class="line">        edit.putLong(<span class="string">"ili"</span>, System.currentTimeMillis());</span><br><span class="line">        edit.commit();</span><br><span class="line">        Log.d(<span class="string">"hashcode"</span>, SignatureTool.getSignature(<span class="keyword">this</span>) + BuildConfig.VERSION_NAME);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> </span>&#123;</span><br><span class="line">        getMenuInflater().inflate(R.menu.main, menu);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onOptionsItemSelected</span><span class="params">(MenuItem menuItem)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (menuItem.getItemId() == R.id.action_settings) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onOptionsItemSelected(menuItem);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (view.getId()) &#123;</span><br><span class="line">            <span class="keyword">case</span> R.id.button1:</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.c.getText().length() == <span class="number">0</span> || <span class="keyword">this</span>.d.getText().length() == <span class="number">0</span>) &#123;</span><br><span class="line">                    Toast.makeText(<span class="keyword">this</span>, <span class="string">"\u4e0d\u80fd\u4e3a\u7a7a"</span>, <span class="number">1</span>).show(); <span class="comment">// 不能为空</span></span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                String obj = <span class="keyword">this</span>.c.getText().toString(); <span class="comment">// 获取第一个输入框中的字符串</span></span><br><span class="line">                String obj2 = <span class="keyword">this</span>.d.getText().toString(); <span class="comment">// 获取第二个输入框中的字符串</span></span><br><span class="line">                Log.e(<span class="string">"test"</span>, obj + <span class="string">" test2 = "</span> + obj2);</span><br><span class="line">                Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, SecondActivity.class); <span class="comment">// 设置Intent跳转到SecondActivity</span></span><br><span class="line">                intent.putExtra(<span class="string">"ili"</span>, obj); <span class="comment">// 设置变量ili的值为obj的值</span></span><br><span class="line">                intent.putExtra(<span class="string">"lil"</span>, obj2); <span class="comment">// 设置变量lil的值为obj2的值</span></span><br><span class="line">                startActivity(intent); <span class="comment">// 调用SecondActivity</span></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来看看 SecondActivity，将输入的字符串拼接起来，经过 Encryto.doRawData 的操作后和一串 base64 进行比较：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tencent.testvuln;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.BroadcastReceiver;</span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.content.SharedPreferences.Editor;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.Menu;</span><br><span class="line"><span class="keyword">import</span> android.view.MenuItem;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"><span class="keyword">import</span> com.tencent.testvuln.c.Encryto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondActivity</span> <span class="keyword">extends</span> <span class="title">a</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> BroadcastReceiver c = <span class="keyword">new</span> BroadcastReceiver(<span class="keyword">this</span>) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="comment">/* synthetic */</span> SecondActivity a;</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">this</span>.a = r1;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line">            Toast.makeText(context, <span class="string">"myReceiver receive"</span>, <span class="number">0</span>).show();</span><br><span class="line">            <span class="keyword">if</span> (!context.getPackageName().equals(intent.getAction())) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle bundle)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(bundle);</span><br><span class="line">        setContentView(R.layout.activity_main2);</span><br><span class="line">        Intent intent = getIntent();</span><br><span class="line">        String stringExtra = intent.getStringExtra(<span class="string">"ili"</span>); <span class="comment">// obj</span></span><br><span class="line">        String stringExtra2 = intent.getStringExtra(<span class="string">"lil"</span>); <span class="comment">// obj2</span></span><br><span class="line">        <span class="keyword">if</span> (Encryto.doRawData(<span class="keyword">this</span>, stringExtra + stringExtra2).equals(<span class="string">"VEIzd/V2UPYNdn/bxH3Xig=="</span>)) &#123; <span class="comment">// 判断obj+obj2经过Encryto.doRawData后是否等于指定字符串</span></span><br><span class="line">            intent.setAction(<span class="string">"android.test.action.MoniterInstallService"</span>);</span><br><span class="line">            intent.setClass(<span class="keyword">this</span>, MoniterInstallService.class);</span><br><span class="line">            intent.putExtra(<span class="string">"company"</span>, <span class="string">"tencent"</span>);</span><br><span class="line">            intent.putExtra(<span class="string">"name"</span>, <span class="string">"hacker"</span>);</span><br><span class="line">            intent.putExtra(<span class="string">"age"</span>, <span class="number">18</span>);</span><br><span class="line">            startActivity(intent);</span><br><span class="line">            startService(intent);</span><br><span class="line">        &#125;</span><br><span class="line">        Editor edit = getSharedPreferences(<span class="string">"test"</span>, <span class="number">0</span>).edit();</span><br><span class="line">        edit.putString(<span class="string">"ilil"</span>, stringExtra);</span><br><span class="line">        edit.putString(<span class="string">"lili"</span>, stringExtra2);</span><br><span class="line">        edit.commit();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> </span>&#123;</span><br><span class="line">        getMenuInflater().inflate(R.menu.main, menu);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onOptionsItemSelected</span><span class="params">(MenuItem menuItem)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (menuItem.getItemId() == R.id.action_settings) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onOptionsItemSelected(menuItem);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后我找到了 Encryto.doRawData 函数的位置。可以看到这里的所有函数都是在 Native 层实现的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tencent.testvuln.c;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Encryto</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">int</span> <span class="title">checkSignature</span><span class="params">(Object obj)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> String <span class="title">decode</span><span class="params">(Object obj, String str)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> String <span class="title">doRawData</span><span class="params">(Object obj, String str)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> String <span class="title">encode</span><span class="params">(Object obj, String str)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">HelloLoad</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">"JNIEncrypt"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用 IDA 打开 libJNIEncrypt.so，然后定位到 JNI_OnLoad，并找到被动态注册的函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.data:00006008 off_6008        DCD aChecksignature_0   ; DATA XREF: register_ndk_load+22↑o</span><br><span class="line">.data:00006008                                         ; .text:off_221C↑o</span><br><span class="line">.data:00006008                                         ; &quot;checkSignature&quot;</span><br><span class="line">.data:0000600C                 DCD aLjavaLangObjec     ; &quot;(Ljava/lang/Object;)I&quot;</span><br><span class="line">.data:00006010                 DCD check+1</span><br><span class="line">.data:00006014                 DCD aDecode_0           ; &quot;decode&quot;</span><br><span class="line">.data:00006018                 DCD aLjavaLangObjec_0   ; &quot;(Ljava/lang/Object;Ljava/lang/String;)L&quot;...</span><br><span class="line">.data:0000601C                 DCD decode+1</span><br><span class="line">.data:00006020                 DCD aEncode_0           ; &quot;encode&quot;</span><br><span class="line">.data:00006024                 DCD aLjavaLangObjec_0   ; &quot;(Ljava/lang/Object;Ljava/lang/String;)L&quot;...</span><br><span class="line">.data:00006028                 DCD encode+1</span><br><span class="line">.data:0000602C                 DCD aDorawdata_0        ; &quot;doRawData&quot;</span><br><span class="line">.data:00006030                 DCD aLjavaLangObjec_0   ; &quot;(Ljava/lang/Object;Ljava/lang/String;)L&quot;...</span><br><span class="line">.data:00006034                 DCD doRawData+1</span><br><span class="line">.data:00006034 ; .data         ends</span><br></pre></td></tr></table></figure>
<p>看一下其中的 doRawData 函数，发现其中调用了一个 j_AES_128_ECB_PKCS5Padding_Encrypt 函数，可以大概推断出经过了 AES-128 的加密，且加密模式用了 ECB，Padding 用了 PKCS5：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">fastcall <span class="title">doRawData</span><span class="params">(_JNIEnv *env, <span class="keyword">int</span> a2, <span class="keyword">int</span> a3, <span class="keyword">char</span> *<span class="built_in">string</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _JNIEnv *v4; <span class="comment">// r4</span></span><br><span class="line">  <span class="keyword">char</span> *v5; <span class="comment">// r9</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *utf_string; <span class="comment">// r6</span></span><br><span class="line">  <span class="keyword">int</span> ciphertext; <span class="comment">// r8</span></span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// r0</span></span><br><span class="line">  jstring (__cdecl *v9)(JNIEnv *, <span class="keyword">const</span> jchar *, jsize); <span class="comment">// r6</span></span><br><span class="line">  <span class="keyword">char</span> *v10; <span class="comment">// r5</span></span><br><span class="line">  <span class="keyword">size_t</span> v11; <span class="comment">// r2</span></span><br><span class="line">  <span class="keyword">int</span> key; <span class="comment">// [sp+0h] [bp-28h]</span></span><br><span class="line">  <span class="keyword">int</span> v13; <span class="comment">// [sp+18h] [bp-10h]</span></span><br><span class="line"></span><br><span class="line">  v4 = env;</span><br><span class="line">  v5 = <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">if</span> ( j_checkSignature((<span class="keyword">int</span>)env, a2, a3) == <span class="number">1</span></span><br><span class="line">    &amp;&amp; (<span class="built_in">strcpy</span>((<span class="keyword">char</span> *)&amp;key, <span class="string">"thisisatestkey=="</span>),</span><br><span class="line">        utf_string = (<span class="keyword">const</span> <span class="keyword">char</span> *)((<span class="keyword">int</span> (__fastcall *)(_JNIEnv *, <span class="keyword">char</span> *, _DWORD))v4-&gt;functions-&gt;GetStringUTFChars)(</span><br><span class="line">                                     v4,</span><br><span class="line">                                     v5,</span><br><span class="line">                                     <span class="number">0</span>),</span><br><span class="line">        ciphertext = j_AES_128_ECB_PKCS5Padding_Encrypt(utf_string, (<span class="keyword">int</span>)&amp;key),</span><br><span class="line">        ((<span class="keyword">void</span> (__fastcall *)(_JNIEnv *, <span class="keyword">char</span> *, <span class="keyword">const</span> <span class="keyword">char</span> *))v4-&gt;functions-&gt;ReleaseStringUTFChars)(v4, v5, utf_string),</span><br><span class="line">        result = ((<span class="keyword">int</span> (__fastcall *)(_JNIEnv *, <span class="keyword">int</span>))v4-&gt;functions-&gt;NewStringUTF)(v4, ciphertext),</span><br><span class="line">        _stack_chk_guard == v13) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v9 = v4-&gt;functions-&gt;NewString;</span><br><span class="line">    v10 = UNSIGNATURE[<span class="number">0</span>];</span><br><span class="line">    v11 = <span class="built_in">strlen</span>(UNSIGNATURE[<span class="number">0</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( _stack_chk_guard != v13 );</span><br><span class="line">  result = ((<span class="keyword">int</span> (__fastcall *)(_JNIEnv *, <span class="keyword">char</span> *, <span class="keyword">size_t</span>))v9)(v4, v10, v11);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后进去看到加密完成之后进行了 base64 加密在返回密文：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">fastcall <span class="title">AES_128_ECB_PKCS5Padding_Encrypt</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *a1, <span class="keyword">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// r9</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *v3; <span class="comment">// r10</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v4; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v5; <span class="comment">// r5</span></span><br><span class="line">  _BYTE *v6; <span class="comment">// r11</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v7; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *v8; <span class="comment">// r1</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v9; <span class="comment">// r8</span></span><br><span class="line">  <span class="keyword">char</span> *v10; <span class="comment">// r10</span></span><br><span class="line">  <span class="keyword">int</span> v11; <span class="comment">// r5</span></span><br><span class="line">  _BYTE *v12; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v13; <span class="comment">// r2</span></span><br><span class="line">  <span class="keyword">char</span> v14; <span class="comment">// r6</span></span><br><span class="line">  <span class="keyword">int</span> v15; <span class="comment">// r6</span></span><br><span class="line">  <span class="keyword">int</span> v16; <span class="comment">// r4</span></span><br><span class="line">  <span class="keyword">int</span> v17; <span class="comment">// r5</span></span><br><span class="line"></span><br><span class="line">  v2 = a2;</span><br><span class="line">  v3 = a1;</span><br><span class="line">  v4 = <span class="built_in">strlen</span>(a1);</span><br><span class="line">  v5 = v4;</span><br><span class="line">  <span class="keyword">if</span> ( v4 &lt;= <span class="number">15</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 = <span class="built_in">malloc</span>(<span class="number">0x10</span>u);</span><br><span class="line">    v7 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v8 = &amp;byte_3BB0[<span class="number">16</span> - v5];</span><br><span class="line">      <span class="keyword">if</span> ( v7 &lt; v5 )</span><br><span class="line">        v8 = &amp;v3[v7];</span><br><span class="line">      v6[v7++] = *v8;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v7 != <span class="number">16</span> );</span><br><span class="line">    v9 = <span class="number">16</span>;</span><br><span class="line">    v10 = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x10</span>u);</span><br><span class="line">    v11 = <span class="number">1</span>;</span><br><span class="line">LABEL_18:</span><br><span class="line">    v15 = <span class="number">0</span>;</span><br><span class="line">    v16 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      j_AES128_ECB_encrypt(&amp;v6[v15], v2, &amp;v10[v15]);</span><br><span class="line">      ++v16;</span><br><span class="line">      v15 += <span class="number">16</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v16 &lt; v11 );</span><br><span class="line">    <span class="keyword">goto</span> LABEL_22;</span><br><span class="line">  &#125;</span><br><span class="line">  v9 = (v4 + <span class="number">16</span>) &amp; <span class="number">0xFFFFFFF0</span>;</span><br><span class="line">  v12 = <span class="built_in">malloc</span>(v9);</span><br><span class="line">  v6 = v12;</span><br><span class="line">  <span class="keyword">if</span> ( v9 &lt;= <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v10 = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>((v5 + <span class="number">16</span>) &amp; <span class="number">0xFFFFFFF0</span>);</span><br><span class="line">    <span class="keyword">goto</span> LABEL_22;</span><br><span class="line">  &#125;</span><br><span class="line">  v13 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v13 &gt;= v5 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( !(v5 &amp; <span class="number">0xF</span>) )</span><br><span class="line">      &#123;</span><br><span class="line">        v12[v13] = <span class="number">16</span>;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_15;</span><br><span class="line">      &#125;</span><br><span class="line">      v14 = byte_3BB0[v9 - v5];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v14 = v3[v13];</span><br><span class="line">    &#125;</span><br><span class="line">    v12[v13] = v14;</span><br><span class="line">LABEL_15:</span><br><span class="line">    ++v13;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v9 != v13 );</span><br><span class="line">  v10 = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>((v5 + <span class="number">16</span>) &amp; <span class="number">0xFFFFFFF0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v9 &gt;= <span class="number">16</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v11 = v9 / <span class="number">16</span>;</span><br><span class="line">    <span class="keyword">goto</span> LABEL_18;</span><br><span class="line">  &#125;</span><br><span class="line">LABEL_22:</span><br><span class="line">  v17 = j_b64_encode((<span class="keyword">int</span>)v10, v9);</span><br><span class="line">  <span class="built_in">free</span>(v6);</span><br><span class="line">  <span class="built_in">free</span>(v10);</span><br><span class="line">  <span class="keyword">return</span> v17;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用 Python 脚本解密得到明文：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">key = <span class="string">'thisisatestkey=='</span></span><br><span class="line">aes = AES.new(key, AES.MODE_ECB)</span><br><span class="line"></span><br><span class="line">ciphertext = <span class="string">'VEIzd/V2UPYNdn/bxH3Xig=='</span>.decode(<span class="string">'base64'</span>)</span><br><span class="line"><span class="keyword">print</span> aes.decrypt(ciphertext)</span><br><span class="line"><span class="comment"># aimagetencent</span></span><br></pre></td></tr></table></figure>
<p>尝试提交这串字符串提示错误，再尝试用这字符串登录也没得到什么结果，那么继续往下分析。发现其中调用了多次 Intent，还设置了 IntentFilter，看的眼花缭乱都没找到 flag 在哪里。再去尝试一下交叉引用，看看哪些类调用了 Encryto 类，发现了 FileDataActivity 类中调用了 decode 方法，在 IDA 中可以发现 decode 和 doRawData 的功能一模一样：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tencent.testvuln;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"><span class="keyword">import</span> com.tencent.testvuln.c.Encryto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileDataActivity</span> <span class="keyword">extends</span> <span class="title">a</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> TextView c;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle bundle)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(bundle);</span><br><span class="line">        setContentView(R.layout.activity_main3);</span><br><span class="line">        <span class="keyword">this</span>.c = (TextView) findViewById(R.id.textView1);</span><br><span class="line">        <span class="keyword">this</span>.c.setText(Encryto.decode(<span class="keyword">this</span>, <span class="string">"9YuQ2dk8CSaCe7DTAmaqAA=="</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后用这里的密文解密得到了 flag：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">ciphertext2 = <span class="string">'9YuQ2dk8CSaCe7DTAmaqAA=='</span>.decode(<span class="string">'base64'</span>)</span><br><span class="line"><span class="keyword">print</span> aes.decrypt(ciphertext2)</span><br><span class="line"><span class="comment"># Cas3_0f_A_CAK3</span></span><br></pre></td></tr></table></figure>
<h1 id="app3"><a href="#app3" class="headerlink" title="app3"></a>app3</h1><p>拿到文件用 file 没有识别出来，xxd 看一下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ xxd app3.ab | head</span><br><span class="line">00000000: 414e 4452 4f49 4420 4241 434b 5550 0a32  ANDROID BACKUP.2</span><br><span class="line">00000010: 0a31 0a6e 6f6e 650a 78da e47a e55f 936f  .1.none.x..z._.o</span><br><span class="line">00000020: fcaf 8a74 8e1e 0d1b 5d63 0361 303a 4797  ...t....]c.a0:G.</span><br><span class="line">00000030: 8422 3d06 8ab4 c248 a507 a373 3046 2328  .<span class="string">"=....H...s0F#(</span></span><br><span class="line"><span class="string">00000040: 2a65 a088 d20c 4623 8222 4883 a252 5202  *e....F#."</span>H..RR.</span><br><span class="line">00000050: 9e7d 7fe7 75fe 80f3 e43c 39d7 93fb 75bf  .&#125;..u....&lt;9...u.</span><br><span class="line">00000060: b6dd d775 7de2 1df7 2e8f a0a0 5045 afc0  ...u&#125;.......PE..</span><br><span class="line">00000070: bb0a a808 8fbb 41fe 2805 8c47 902f 2a2c  ......A.(..G./*,</span><br><span class="line">00000080: d4d7 2340 210c 15e0 850a 080b 47f9 53be  ..<span class="comment">#@!.......G.S.</span></span><br><span class="line">00000090: 8052 f450 f4f4 0845 2978 04dd b9f4 7f37  .R.P...E)x.....7</span><br></pre></td></tr></table></figure>
<p>搜了一下发现是安卓备份文件，可以用 Android Backup Extractor 来解压：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar abe.jar unpack app3.ab app3.tar <span class="string">""</span></span><br><span class="line">0% 1% 2% 3% 4% 5% 6% 7% 8% 9% 10% 11% 12% 13% 14% 15% 16% 17% 18% 19% 20% 21% 22% 23% 24% 25% 26% 27% 28% 29% 30% 31% 32% 33% 34% 35% 36% 37% 38% 39% 40% 41% 42% 43% 44% 45% 46% 47% 48% 49% 50% 51% 52% 53% 54% 55% 56% 57% 58% 59% 60% 61% 62% 63% 64% 65% 66% 67% 68% 69% 70% 71% 72% 73% 74% 75% 76% 77% 78% 79% 80% 81% 82% 83% 84% 85% 86% 87% 88% 89% 90% 91% 92% 93% 94% 95% 96% 97% 98% 99% 100%</span><br><span class="line">9097216 bytes written to /Users/assassinq/Downloads/app3.tar.</span><br></pre></td></tr></table></figure>
<p>在解压得到的 tar 包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ x app3.tar</span><br><span class="line">x apps/com.example.yaphetshan.tencentwelcome/a/base.apk</span><br><span class="line">x apps/com.example.yaphetshan.tencentwelcome/db/Demo.db</span><br><span class="line">x apps/com.example.yaphetshan.tencentwelcome/Encryto.db</span><br><span class="line">x apps/com.example.yaphetshan.tencentwelcome/_manifest</span><br></pre></td></tr></table></figure>
<p>生成的文件中，两个 db 都是被加密了的 sqlite 数据库。先来用 jadx 看看 base.apk，可以看到 <code>a()</code> 函数通过一些操作计算出一个密码，来获得一个数据库的接口。详细分析我记录在了注释中，其他的分析再看之后的函数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.yaphetshan.tencentwelcome;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.ContentValues;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.content.SharedPreferences.Editor;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.View.OnClickListener;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> com.example.yaphetshan.tencentwelcome.a.a;</span><br><span class="line"><span class="keyword">import</span> net.sqlcipher.database.SQLiteDatabase;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> <span class="keyword">implements</span> <span class="title">OnClickListener</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> SQLiteDatabase a;</span><br><span class="line">    <span class="keyword">private</span> a b;</span><br><span class="line">    <span class="keyword">private</span> Button c;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle bundle)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(bundle);</span><br><span class="line">        setContentView((<span class="keyword">int</span>) R.layout.activity_main);</span><br><span class="line">        <span class="keyword">this</span>.c = (Button) findViewById(R.id.add_data);</span><br><span class="line">        <span class="keyword">this</span>.c.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        Editor edit = getSharedPreferences(<span class="string">"test"</span>, <span class="number">0</span>).edit();</span><br><span class="line">        edit.putString(<span class="string">"Is_Encroty"</span>, <span class="string">"1"</span>); <span class="comment">// Is_Encroty="1"</span></span><br><span class="line">        edit.putString(<span class="string">"Encryto"</span>, <span class="string">"SqlCipher"</span>); <span class="comment">// Encryto="SqlCipher"</span></span><br><span class="line">        edit.putString(<span class="string">"ver_sion"</span>, <span class="string">"3_4_0"</span>); <span class="comment">// ver_sion="3_4_0"</span></span><br><span class="line">        edit.apply();</span><br><span class="line">        a();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">a</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SQLiteDatabase.loadLibs(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">this</span>.b = <span class="keyword">new</span> a(<span class="keyword">this</span>, <span class="string">"Demo.db"</span>, <span class="keyword">null</span>, <span class="number">1</span>); <span class="comment">// 打开Demo.db</span></span><br><span class="line">        ContentValues contentValues = <span class="keyword">new</span> ContentValues();</span><br><span class="line">        contentValues.put(<span class="string">"name"</span>, <span class="string">"Stranger"</span>); <span class="comment">// name="Stanger"</span></span><br><span class="line">        contentValues.put(<span class="string">"password"</span>, Integer.valueOf(<span class="number">123456</span>)); <span class="comment">// password=123456</span></span><br><span class="line">        a aVar = <span class="keyword">new</span> a();</span><br><span class="line">        String a = aVar.a(contentValues.getAsString(<span class="string">"name"</span>), contentValues.getAsString(<span class="string">"password"</span>)); <span class="comment">// a = name[:4] + password[:4]</span></span><br><span class="line">        <span class="keyword">this</span>.a = <span class="keyword">this</span>.b.getWritableDatabase(aVar.a(a + aVar.b(a, contentValues.getAsString(<span class="string">"password"</span>))).substring(<span class="number">0</span>, <span class="number">7</span>)); <span class="comment">// 将SHA1(a+MD5(a)+"yaphetshan")[:7]作为密码，获取指定数据库接口</span></span><br><span class="line">        <span class="keyword">this</span>.a.insert(<span class="string">"TencentMicrMsg"</span>, <span class="keyword">null</span>, contentValues); <span class="comment">// 将数据contentValues插入表TencentMicrMsg</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (view == <span class="keyword">this</span>.c) &#123;</span><br><span class="line">            Intent intent = <span class="keyword">new</span> Intent();</span><br><span class="line">            intent.putExtra(<span class="string">"name"</span>, <span class="string">"name"</span>);</span><br><span class="line">            intent.putExtra(<span class="string">"password"</span>, <span class="string">"pass"</span>);</span><br><span class="line">            intent.setClass(<span class="keyword">this</span>, AnotherActivity.class);</span><br><span class="line">            startActivity(intent);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在同一包下的 a 类中，看到了数据库 TencentMicrMsg 的结构，其中有一个 F_l_a_g 字段，可以判断是 flag：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.yaphetshan.tencentwelcome;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> net.sqlcipher.database.SQLiteDatabase;</span><br><span class="line"><span class="keyword">import</span> net.sqlcipher.database.SQLiteDatabase.CursorFactory;</span><br><span class="line"><span class="keyword">import</span> net.sqlcipher.database.SQLiteOpenHelper;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* compiled from: DatabaseManager */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">a</span> <span class="keyword">extends</span> <span class="title">SQLiteOpenHelper</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">a</span><span class="params">(Context context, String str, CursorFactory cursorFactory, <span class="keyword">int</span> i)</span> </span>&#123; <span class="comment">// 打开指定数据库</span></span><br><span class="line">        <span class="keyword">super</span>(context, str, cursorFactory, i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(SQLiteDatabase sQLiteDatabase)</span> </span>&#123;</span><br><span class="line">        sQLiteDatabase.execSQL(<span class="string">"create table TencentMicrMsg(name text,password integer,F_l_a_g text)"</span>); <span class="comment">// 表TencentMicrMsg中三个字段分别是text、integer和text</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onUpgrade</span><span class="params">(SQLiteDatabase sQLiteDatabase, <span class="keyword">int</span> i, <span class="keyword">int</span> i2)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在包 a 下的 a 类，其中两个函数可以根据 b 类的函数分析得到功能：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.yaphetshan.tencentwelcome.a;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* compiled from: Cipher */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">a</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String a = <span class="string">"yaphetshan"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">a</span><span class="params">(String str, String str2)</span> </span>&#123;</span><br><span class="line">        String substring = str.substring(<span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">        <span class="keyword">return</span> substring + str2.substring(<span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">b</span><span class="params">(String str, String str2)</span> </span>&#123; <span class="comment">// 返回MD5十六进制字符串</span></span><br><span class="line">        b bVar = <span class="keyword">new</span> b();</span><br><span class="line">        <span class="keyword">return</span> b.a(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">a</span><span class="params">(String str)</span> </span>&#123; <span class="comment">// 返回SHA1(str+"yaphetshan")的十六进制字符串</span></span><br><span class="line">        b bVar = <span class="keyword">new</span> b();</span><br><span class="line">        <span class="keyword">return</span> b.b(str + <span class="keyword">this</span>.a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>包 a 下的 b 类，根据 MessageDigest 创建的实例可以分别判断出是获取 MD5 和 SHA-1 的十六进制摘要：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.yaphetshan.tencentwelcome.a;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* compiled from: SHA1Manager */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">b</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String <span class="title">a</span><span class="params">(String str)</span> </span>&#123; <span class="comment">// 获取MD5十六进制字符串</span></span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">char</span>[] cArr = <span class="keyword">new</span> <span class="keyword">char</span>[]&#123;<span class="string">'0'</span>, <span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>, <span class="string">'5'</span>, <span class="string">'6'</span>, <span class="string">'7'</span>, <span class="string">'8'</span>, <span class="string">'9'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>&#125;;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">byte</span>[] bytes = str.getBytes();</span><br><span class="line">            MessageDigest instance = MessageDigest.getInstance(<span class="string">"MD5"</span>);</span><br><span class="line">            instance.update(bytes);</span><br><span class="line">            <span class="keyword">byte</span>[] digest = instance.digest(); <span class="comment">// 获取MD5哈希摘要</span></span><br><span class="line">            <span class="keyword">int</span> length = digest.length;</span><br><span class="line">            <span class="keyword">char</span>[] cArr2 = <span class="keyword">new</span> <span class="keyword">char</span>[(length * <span class="number">2</span>)];</span><br><span class="line">            <span class="keyword">int</span> i2 = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> (i &lt; length) &#123;</span><br><span class="line">                <span class="keyword">byte</span> b = digest[i];</span><br><span class="line">                <span class="keyword">int</span> i3 = i2 + <span class="number">1</span>;</span><br><span class="line">                cArr2[i2] = cArr[(b &gt;&gt;&gt; <span class="number">4</span>) &amp; <span class="number">15</span>];</span><br><span class="line">                i2 = i3 + <span class="number">1</span>;</span><br><span class="line">                cArr2[i3] = cArr[b &amp; <span class="number">15</span>];</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> String(cArr2);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String <span class="title">b</span><span class="params">(String str)</span> </span>&#123; <span class="comment">// 获取SHA1十六进制字符串</span></span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">char</span>[] cArr = <span class="keyword">new</span> <span class="keyword">char</span>[]&#123;<span class="string">'0'</span>, <span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>, <span class="string">'5'</span>, <span class="string">'6'</span>, <span class="string">'7'</span>, <span class="string">'8'</span>, <span class="string">'9'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>&#125;;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">byte</span>[] bytes = str.getBytes();</span><br><span class="line">            MessageDigest instance = MessageDigest.getInstance(<span class="string">"SHA-1"</span>);</span><br><span class="line">            instance.update(bytes);</span><br><span class="line">            <span class="keyword">byte</span>[] digest = instance.digest(); <span class="comment">// 获取SHA1哈希摘要</span></span><br><span class="line">            <span class="keyword">int</span> length = digest.length;</span><br><span class="line">            <span class="keyword">char</span>[] cArr2 = <span class="keyword">new</span> <span class="keyword">char</span>[(length * <span class="number">2</span>)];</span><br><span class="line">            <span class="keyword">int</span> i2 = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> (i &lt; length) &#123;</span><br><span class="line">                <span class="keyword">byte</span> b = digest[i];</span><br><span class="line">                <span class="keyword">int</span> i3 = i2 + <span class="number">1</span>;</span><br><span class="line">                cArr2[i2] = cArr[(b &gt;&gt;&gt; <span class="number">4</span>) &amp; <span class="number">15</span>];</span><br><span class="line">                i2 = i3 + <span class="number">1</span>;</span><br><span class="line">                cArr2[i3] = cArr[b &amp; <span class="number">15</span>];</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> String(cArr2);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么根据上面的分析可以正向地得到密码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">md5hash = <span class="keyword">lambda</span> m: hashlib.md5(m).hexdigest()</span><br><span class="line">sha1hash = <span class="keyword">lambda</span> m: hashlib.sha1(m).hexdigest()</span><br><span class="line"></span><br><span class="line">name = <span class="string">"Stranger"</span></span><br><span class="line">password = <span class="string">"123456"</span></span><br><span class="line">a = name[:<span class="number">4</span>] + password[:<span class="number">4</span>]</span><br><span class="line">database = sha1hash(a + md5hash(a) + <span class="string">"yaphetshan"</span>)[:<span class="number">7</span>]</span><br><span class="line"><span class="keyword">print</span> database</span><br><span class="line"><span class="comment"># ae56f99</span></span><br></pre></td></tr></table></figure>
<p>打开 Decypt.db 库，查看表中数据：</p>
<p><img src="/pics/攻防世界-MOBILE-新手练习区/1.png" alt="表中的F_l_a_g字段"></p>
<p>将字段中的字符串解 base64：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">"VGN0ZntIM2xsMF9Eb19ZMHVfTG92M19UZW5jM250IX0="</span> | base64 -D</span><br><span class="line">Tctf&#123;H3ll0_Do_Y0u_Lov3_Tenc3nt!&#125;</span><br></pre></td></tr></table></figure>
<h1 id="easy-apk"><a href="#easy-apk" class="headerlink" title="easy-apk"></a>easy-apk</h1><p>把 apk 拖进 jadx，反编译查看入口事件代码，判断出对输入进行了 Base64 加密：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.testjava.jack.pingan1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.View.OnClickListener;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView((<span class="keyword">int</span>) R.layout.activity_main);</span><br><span class="line">        ((Button) findViewById(R.id.button)).setOnClickListener(<span class="keyword">new</span> OnClickListener() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">new</span> Base64New().Base64Encode(((EditText) MainActivity.<span class="keyword">this</span>.findViewById(R.id.editText)).getText().toString().getBytes()).equals(<span class="string">"5rFf7E2K6rqN7Hpiyush7E6S5fJg6rsi5NBf6NGT5rs="</span>)) &#123;</span><br><span class="line">                    Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">"\u9a8c\u8bc1\u901a\u8fc7!"</span>, <span class="number">1</span>).show(); <span class="comment">// 验证通过!</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">"\u9a8c\u8bc1\u5931\u8d25!"</span>, <span class="number">1</span>).show(); <span class="comment">// 验证失败!</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再看看 Base64New 类中代码，发现是一个换表的 base64：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.testjava.jack.pingan1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.support.v4.view.accessibility.AccessibilityNodeInfoCompat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Base64New</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span>[] Base64ByteToStr = <span class="keyword">new</span> <span class="keyword">char</span>[]&#123;<span class="string">'v'</span>, <span class="string">'w'</span>, <span class="string">'x'</span>, <span class="string">'r'</span>, <span class="string">'s'</span>, <span class="string">'t'</span>, <span class="string">'u'</span>, <span class="string">'o'</span>, <span class="string">'p'</span>, <span class="string">'q'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>, <span class="string">'5'</span>, <span class="string">'6'</span>, <span class="string">'7'</span>, <span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>, <span class="string">'F'</span>, <span class="string">'G'</span>, <span class="string">'H'</span>, <span class="string">'I'</span>, <span class="string">'J'</span>, <span class="string">'y'</span>, <span class="string">'z'</span>, <span class="string">'0'</span>, <span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'P'</span>, <span class="string">'Q'</span>, <span class="string">'R'</span>, <span class="string">'S'</span>, <span class="string">'T'</span>, <span class="string">'K'</span>, <span class="string">'L'</span>, <span class="string">'M'</span>, <span class="string">'N'</span>, <span class="string">'O'</span>, <span class="string">'Z'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'U'</span>, <span class="string">'V'</span>, <span class="string">'W'</span>, <span class="string">'X'</span>, <span class="string">'Y'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>, <span class="string">'g'</span>, <span class="string">'h'</span>, <span class="string">'i'</span>, <span class="string">'j'</span>, <span class="string">'k'</span>, <span class="string">'l'</span>, <span class="string">'m'</span>, <span class="string">'n'</span>, <span class="string">'8'</span>, <span class="string">'9'</span>, <span class="string">'+'</span>, <span class="string">'/'</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RANGE = <span class="number">255</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] StrToBase64Byte = <span class="keyword">new</span> <span class="keyword">byte</span>[AccessibilityNodeInfoCompat.ACTION_CLEAR_ACCESSIBILITY_FOCUS];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">Base64Encode</span><span class="params">(<span class="keyword">byte</span>[] bytes)</span> </span>&#123;</span><br><span class="line">        StringBuilder res = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= bytes.length - <span class="number">1</span>; i += <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> k;</span><br><span class="line">            <span class="keyword">byte</span>[] enBytes = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">4</span>];</span><br><span class="line">            <span class="keyword">byte</span> tmp = (<span class="keyword">byte</span>) <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt;= <span class="number">2</span>; k++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (i + k &lt;= bytes.length - <span class="number">1</span>) &#123;</span><br><span class="line">                    enBytes[k] = (<span class="keyword">byte</span>) (((bytes[i + k] &amp; RANGE) &gt;&gt;&gt; ((k * <span class="number">2</span>) + <span class="number">2</span>)) | tmp);</span><br><span class="line">                    tmp = (<span class="keyword">byte</span>) ((((bytes[i + k] &amp; RANGE) &lt;&lt; (((<span class="number">2</span> - k) * <span class="number">2</span>) + <span class="number">2</span>)) &amp; RANGE) &gt;&gt;&gt; <span class="number">2</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    enBytes[k] = tmp;</span><br><span class="line">                    tmp = (<span class="keyword">byte</span>) <span class="number">64</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            enBytes[<span class="number">3</span>] = tmp;</span><br><span class="line">            <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt;= <span class="number">3</span>; k++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (enBytes[k] &lt;= (<span class="keyword">byte</span>) <span class="number">63</span>) &#123;</span><br><span class="line">                    res.append(Base64ByteToStr[enBytes[k]]);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    res.append(<span class="string">'='</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>直接改表解码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- encoding=utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> utils <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">base64_charset = <span class="string">'vwxrstuopq34567ABCDEFGHIJyz012PQRSTKLMNOZabcdUVWXYefghijklmn89+/='</span></span><br><span class="line"></span><br><span class="line">ciphertext = <span class="string">'5rFf7E2K6rqN7Hpiyush7E6S5fJg6rsi5NBf6NGT5rs='</span></span><br><span class="line">plaintext = decipher(ciphertext)</span><br><span class="line"><span class="keyword">print</span> plaintext</span><br><span class="line"><span class="comment"># 05397c42f9b6da593a3644162d36eb01</span></span><br></pre></td></tr></table></figure>
<h1 id="easyjava"><a href="#easyjava" class="headerlink" title="easyjava"></a>easyjava</h1><p>jadx 反编译，MainActivity 中看到主要是 <code>b()</code> 函数判断了 flag 的格式，下面主要是把 a 和 b 两个类的构造函数理清：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.a.easyjava;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.c;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.View.OnClickListener;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"><span class="keyword">import</span> java.util.Timer;</span><br><span class="line"><span class="keyword">import</span> java.util.TimerTask;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">c</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">char</span> <span class="title">a</span><span class="params">(String str, b bVar, a aVar)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> aVar.a(bVar.a(str));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Boolean <span class="title">b</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (!str.startsWith(<span class="string">"flag&#123;"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> Boolean.valueOf(<span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!str.endsWith(<span class="string">"&#125;"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> Boolean.valueOf(<span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        String substring = str.substring(<span class="number">5</span>, str.length() - <span class="number">1</span>);</span><br><span class="line">        b bVar = <span class="keyword">new</span> b(Integer.valueOf(<span class="number">2</span>));</span><br><span class="line">        a aVar = <span class="keyword">new</span> a(Integer.valueOf(<span class="number">3</span>));</span><br><span class="line">        StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">int</span> i2 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; substring.length()) &#123;</span><br><span class="line">            stringBuilder.append(a(substring.charAt(i) + <span class="string">""</span>, bVar, aVar));</span><br><span class="line">            Integer valueOf = Integer.valueOf(bVar.b().intValue() / <span class="number">25</span>); <span class="comment">// 将bVar中d的值除以25并赋值给valueOf</span></span><br><span class="line">            <span class="keyword">if</span> (valueOf.intValue() &gt; i2 &amp;&amp; valueOf.intValue() &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">                i2++;</span><br><span class="line">            &#125;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Boolean.valueOf(stringBuilder.toString().equals(<span class="string">"wigwrkaugala"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle bundle)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(bundle);</span><br><span class="line">        setContentView((<span class="keyword">int</span>) R.layout.activity_main);</span><br><span class="line">        findViewById(R.id.button).setOnClickListener(<span class="keyword">new</span> OnClickListener(<span class="keyword">this</span>) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="comment">/* synthetic */</span> MainActivity b;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (MainActivity.b(((EditText) ((MainActivity) <span class="keyword">this</span>).findViewById(R.id.edit)).getText().toString()).booleanValue()) &#123;</span><br><span class="line">                    Toast.makeText(<span class="keyword">this</span>, <span class="string">"You are right!"</span>, <span class="number">1</span>).show();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                Toast.makeText(<span class="keyword">this</span>, <span class="string">"You are wrong! Bye~"</span>, <span class="number">1</span>).show();</span><br><span class="line">                <span class="keyword">new</span> Timer().schedule(<span class="keyword">new</span> TimerTask(<span class="keyword">this</span>) &#123;</span><br><span class="line">                    <span class="keyword">final</span> <span class="comment">/* synthetic */</span> AnonymousClass1 a;</span><br><span class="line"></span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">this</span>.a = r1;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        System.exit(<span class="number">1</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="number">2000</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>a 类的构造函数，是对数组 c 的重新排列。然后在 <code>a()</code> 函数中对输入的数字和下标进行转换：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.a.easyjava;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">a</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ArrayList&lt;Integer&gt; a = <span class="keyword">new</span> ArrayList();</span><br><span class="line">    <span class="keyword">static</span> String b = <span class="string">"abcdefghijklmnopqrstuvwxyz"</span>;</span><br><span class="line">    <span class="keyword">static</span> Integer d = Integer.valueOf(<span class="number">0</span>);</span><br><span class="line">    Integer[] c = <span class="keyword">new</span> Integer[]&#123;Integer.valueOf(<span class="number">7</span>), Integer.valueOf(<span class="number">14</span>), Integer.valueOf(<span class="number">16</span>), Integer.valueOf(<span class="number">21</span>), Integer.valueOf(<span class="number">4</span>), Integer.valueOf(<span class="number">24</span>), Integer.valueOf(<span class="number">25</span>), Integer.valueOf(<span class="number">20</span>), Integer.valueOf(<span class="number">5</span>), Integer.valueOf(<span class="number">15</span>), Integer.valueOf(<span class="number">9</span>), Integer.valueOf(<span class="number">17</span>), Integer.valueOf(<span class="number">6</span>), Integer.valueOf(<span class="number">13</span>), Integer.valueOf(<span class="number">3</span>), Integer.valueOf(<span class="number">18</span>), Integer.valueOf(<span class="number">12</span>), Integer.valueOf(<span class="number">10</span>), Integer.valueOf(<span class="number">19</span>), Integer.valueOf(<span class="number">0</span>), Integer.valueOf(<span class="number">22</span>), Integer.valueOf(<span class="number">2</span>), Integer.valueOf(<span class="number">11</span>), Integer.valueOf(<span class="number">23</span>), Integer.valueOf(<span class="number">1</span>), Integer.valueOf(<span class="number">8</span>)&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">a</span><span class="params">(Integer num)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> intValue;</span><br><span class="line">        <span class="keyword">for</span> (intValue = num.intValue(); intValue &lt; <span class="keyword">this</span>.c.length; intValue++) &#123;</span><br><span class="line">            a.add(<span class="keyword">this</span>.c[intValue]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (intValue = <span class="number">0</span>; intValue &lt; num.intValue(); intValue++) &#123;</span><br><span class="line">            a.add(<span class="keyword">this</span>.c[intValue]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">a</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Integer num = d;</span><br><span class="line">        d = Integer.valueOf(d.intValue() + <span class="number">1</span>); <span class="comment">// 将d加一</span></span><br><span class="line">        <span class="keyword">if</span> (d.intValue() == <span class="number">25</span>) &#123; <span class="comment">// 判断d是否等于25</span></span><br><span class="line">            <span class="keyword">int</span> intValue = ((Integer) a.get(<span class="number">0</span>)).intValue();</span><br><span class="line">            a.remove(<span class="number">0</span>);</span><br><span class="line">            a.add(Integer.valueOf(intValue)); <span class="comment">// 将a的第一个元素添加到最后一位</span></span><br><span class="line">            d = Integer.valueOf(<span class="number">0</span>); <span class="comment">// 将d设置成0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">char</span> <span class="title">a</span><span class="params">(Integer num)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        Integer valueOf = Integer.valueOf(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (num.intValue() == -<span class="number">10</span>) &#123; <span class="comment">// 判断num是否为-10</span></span><br><span class="line">            a();</span><br><span class="line">            <span class="keyword">return</span> <span class="string">" "</span>.charAt(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; a.size() - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (a.get(i) == num) &#123;</span><br><span class="line">                valueOf = Integer.valueOf(i); <span class="comment">// 获取a中等于num的元素，并将valueOf设置成其下标i</span></span><br><span class="line">            &#125;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        a();</span><br><span class="line">        <span class="keyword">return</span> b.charAt(valueOf.intValue()); <span class="comment">// 返回下标对应的b中的字符</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>b 类中同理，也是对下标的一个转换：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.a.easyjava;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">b</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ArrayList&lt;Integer&gt; a = <span class="keyword">new</span> ArrayList();</span><br><span class="line">    <span class="keyword">static</span> String b = <span class="string">"abcdefghijklmnopqrstuvwxyz"</span>;</span><br><span class="line">    <span class="keyword">static</span> Integer d = Integer.valueOf(<span class="number">0</span>);</span><br><span class="line">    Integer[] c = <span class="keyword">new</span> Integer[]&#123;Integer.valueOf(<span class="number">8</span>), Integer.valueOf(<span class="number">25</span>), Integer.valueOf(<span class="number">17</span>), Integer.valueOf(<span class="number">23</span>), Integer.valueOf(<span class="number">7</span>), Integer.valueOf(<span class="number">22</span>), Integer.valueOf(<span class="number">1</span>), Integer.valueOf(<span class="number">16</span>), Integer.valueOf(<span class="number">6</span>), Integer.valueOf(<span class="number">9</span>), Integer.valueOf(<span class="number">21</span>), Integer.valueOf(<span class="number">0</span>), Integer.valueOf(<span class="number">15</span>), Integer.valueOf(<span class="number">5</span>), Integer.valueOf(<span class="number">10</span>), Integer.valueOf(<span class="number">18</span>), Integer.valueOf(<span class="number">2</span>), Integer.valueOf(<span class="number">24</span>), Integer.valueOf(<span class="number">4</span>), Integer.valueOf(<span class="number">11</span>), Integer.valueOf(<span class="number">3</span>), Integer.valueOf(<span class="number">14</span>), Integer.valueOf(<span class="number">19</span>), Integer.valueOf(<span class="number">12</span>), Integer.valueOf(<span class="number">20</span>), Integer.valueOf(<span class="number">13</span>)&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">b</span><span class="params">(Integer num)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> intValue;</span><br><span class="line">        <span class="keyword">for</span> (intValue = num.intValue(); intValue &lt; <span class="keyword">this</span>.c.length; intValue++) &#123;</span><br><span class="line">            a.add(<span class="keyword">this</span>.c[intValue]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (intValue = <span class="number">0</span>; intValue &lt; num.intValue(); intValue++) &#123;</span><br><span class="line">            a.add(<span class="keyword">this</span>.c[intValue]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">a</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> intValue = ((Integer) a.get(<span class="number">0</span>)).intValue();</span><br><span class="line">        a.remove(<span class="number">0</span>);</span><br><span class="line">        a.add(Integer.valueOf(intValue)); <span class="comment">// 将a的第一个元素添加到最后一位</span></span><br><span class="line">        b += <span class="string">""</span> + b.charAt(<span class="number">0</span>);</span><br><span class="line">        b = b.substring(<span class="number">1</span>, <span class="number">27</span>); <span class="comment">// 将b的第一个元素添加到最后一位</span></span><br><span class="line">        Integer num = d;</span><br><span class="line">        d = Integer.valueOf(d.intValue() + <span class="number">1</span>); <span class="comment">// 将d加一</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">a</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        Integer valueOf = Integer.valueOf(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (b.contains(str.toLowerCase())) &#123; <span class="comment">// 判断字符串是否在“abcdefghijklmnopqrstuvwxyz”中</span></span><br><span class="line">            Integer valueOf2 = Integer.valueOf(b.indexOf(str)); <span class="comment">// str在b中的起始下标</span></span><br><span class="line">            <span class="keyword">while</span> (i &lt; a.size() - <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (a.get(i) == valueOf2) &#123; <span class="comment">// 获取a中与valueOf2相等的值，并设置valueOf为其下标i</span></span><br><span class="line">                    valueOf = Integer.valueOf(i);</span><br><span class="line">                &#125;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            valueOf = str.contains(<span class="string">" "</span>) ? Integer.valueOf(-<span class="number">10</span>) : Integer.valueOf(-<span class="number">1</span>); <span class="comment">// 判断字符串中是否有空格，如果有valueOf设置成-10，反之设置成-1</span></span><br><span class="line">        &#125;</span><br><span class="line">        a();</span><br><span class="line">        <span class="keyword">return</span> valueOf;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">b</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> d;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中有很多条件判断不可能发生，实际的算法逻辑没有反编译出的代码这么复杂。逆向实现脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line">bArray = [<span class="number">17</span>, <span class="number">23</span>, <span class="number">7</span>, <span class="number">22</span>, <span class="number">1</span>, <span class="number">16</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">21</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">18</span>, <span class="number">2</span>, <span class="number">24</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">19</span>, <span class="number">12</span>, <span class="number">20</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">25</span>]</span><br><span class="line">aArray = [<span class="number">21</span>, <span class="number">4</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">20</span>, <span class="number">5</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">17</span>, <span class="number">6</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">18</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">19</span>, <span class="number">0</span>, <span class="number">22</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">23</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">14</span>, <span class="number">16</span>]</span><br><span class="line"></span><br><span class="line">ciphertext = <span class="string">'wigwrkaugala'</span></span><br><span class="line">table = <span class="string">'abcdefghijklmnopqrstuvwxyz'</span></span><br><span class="line">valueOfArray = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(ciphertext)):</span><br><span class="line">    valueOfArray.append(table.index(ciphertext[i]))</span><br><span class="line"><span class="keyword">print</span> valueOfArray</span><br><span class="line"></span><br><span class="line">numArray = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(valueOfArray)):</span><br><span class="line">    numArray.append(aArray[valueOfArray[i]])</span><br><span class="line"><span class="keyword">print</span> numArray</span><br><span class="line"></span><br><span class="line">prefix = <span class="string">'flag&#123;'</span></span><br><span class="line">suffix = <span class="string">'&#125;'</span></span><br><span class="line">substring = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(numArray)):</span><br><span class="line">    ch = table[bArray[numArray[i]]]</span><br><span class="line">    substring += ch</span><br><span class="line">    bArray.append(bArray[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">del</span> bArray[<span class="number">0</span>]</span><br><span class="line">    table = (table + table[<span class="number">0</span>])[<span class="number">1</span>:<span class="number">27</span>]</span><br><span class="line">flag = prefix + substring + suffix</span><br><span class="line"><span class="keyword">print</span> flag</span><br></pre></td></tr></table></figure>
<h1 id="easyjni"><a href="#easyjni" class="headerlink" title="easyjni"></a>easyjni</h1><p>反编译，其中调用了 a 函数，其中调用了 a 类中的 a 函数和在 libnative.so 实现的 ncheck 函数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.a.easyjni;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.c;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.View.OnClickListener;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">c</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">"native"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">a</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> ncheck(<span class="keyword">new</span> a().a(str.getBytes()));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">native</span> <span class="keyword">boolean</span> <span class="title">ncheck</span><span class="params">(String str)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle bundle)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(bundle);</span><br><span class="line">        setContentView((<span class="keyword">int</span>) R.layout.activity_main);</span><br><span class="line">        findViewById(R.id.button).setOnClickListener(<span class="keyword">new</span> OnClickListener(<span class="keyword">this</span>) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="comment">/* synthetic */</span> MainActivity b;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.b.a(((EditText) ((MainActivity) <span class="keyword">this</span>).findViewById(R.id.edit)).getText().toString())) &#123;</span><br><span class="line">                    Toast.makeText(<span class="keyword">this</span>, <span class="string">"You are right!"</span>, <span class="number">1</span>).show();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    Toast.makeText(<span class="keyword">this</span>, <span class="string">"You are wrong! Bye~"</span>, <span class="number">1</span>).show();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>a 类里的 a 函数很容易发现是个换表 base64：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.a.easyjni;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">a</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span>[] a = <span class="keyword">new</span> <span class="keyword">char</span>[]&#123;<span class="string">'i'</span>, <span class="string">'5'</span>, <span class="string">'j'</span>, <span class="string">'L'</span>, <span class="string">'W'</span>, <span class="string">'7'</span>, <span class="string">'S'</span>, <span class="string">'0'</span>, <span class="string">'G'</span>, <span class="string">'X'</span>, <span class="string">'6'</span>, <span class="string">'u'</span>, <span class="string">'f'</span>, <span class="string">'1'</span>, <span class="string">'c'</span>, <span class="string">'v'</span>, <span class="string">'3'</span>, <span class="string">'n'</span>, <span class="string">'y'</span>, <span class="string">'4'</span>, <span class="string">'q'</span>, <span class="string">'8'</span>, <span class="string">'e'</span>, <span class="string">'s'</span>, <span class="string">'2'</span>, <span class="string">'Q'</span>, <span class="string">'+'</span>, <span class="string">'b'</span>, <span class="string">'d'</span>, <span class="string">'k'</span>, <span class="string">'Y'</span>, <span class="string">'g'</span>, <span class="string">'K'</span>, <span class="string">'O'</span>, <span class="string">'I'</span>, <span class="string">'T'</span>, <span class="string">'/'</span>, <span class="string">'t'</span>, <span class="string">'A'</span>, <span class="string">'x'</span>, <span class="string">'U'</span>, <span class="string">'r'</span>, <span class="string">'F'</span>, <span class="string">'l'</span>, <span class="string">'V'</span>, <span class="string">'P'</span>, <span class="string">'z'</span>, <span class="string">'h'</span>, <span class="string">'m'</span>, <span class="string">'o'</span>, <span class="string">'w'</span>, <span class="string">'9'</span>, <span class="string">'B'</span>, <span class="string">'H'</span>, <span class="string">'C'</span>, <span class="string">'M'</span>, <span class="string">'D'</span>, <span class="string">'p'</span>, <span class="string">'E'</span>, <span class="string">'a'</span>, <span class="string">'J'</span>, <span class="string">'R'</span>, <span class="string">'Z'</span>, <span class="string">'N'</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">a</span><span class="params">(<span class="keyword">byte</span>[] bArr)</span> </span>&#123;</span><br><span class="line">        StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= bArr.length - <span class="number">1</span>; i += <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="keyword">byte</span>[] bArr2 = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">4</span>];</span><br><span class="line">            <span class="keyword">byte</span> b = (<span class="keyword">byte</span>) <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i2 = <span class="number">0</span>; i2 &lt;= <span class="number">2</span>; i2++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (i + i2 &lt;= bArr.length - <span class="number">1</span>) &#123;</span><br><span class="line">                    bArr2[i2] = (<span class="keyword">byte</span>) (b | ((bArr[i + i2] &amp; <span class="number">255</span>) &gt;&gt;&gt; ((i2 * <span class="number">2</span>) + <span class="number">2</span>)));</span><br><span class="line">                    b = (<span class="keyword">byte</span>) ((((bArr[i + i2] &amp; <span class="number">255</span>) &lt;&lt; (((<span class="number">2</span> - i2) * <span class="number">2</span>) + <span class="number">2</span>)) &amp; <span class="number">255</span>) &gt;&gt;&gt; <span class="number">2</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    bArr2[i2] = b;</span><br><span class="line">                    b = (<span class="keyword">byte</span>) <span class="number">64</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            bArr2[<span class="number">3</span>] = b;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i3 = <span class="number">0</span>; i3 &lt;= <span class="number">3</span>; i3++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (bArr2[i3] &lt;= (<span class="keyword">byte</span>) <span class="number">63</span>) &#123;</span><br><span class="line">                    stringBuilder.append(a[bArr2[i3]]);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    stringBuilder.append(<span class="string">'='</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> stringBuilder.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查看 native 层 ncheck 函数，是静态注册的。理一下发现是个简单的置换：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">signed</span> <span class="keyword">int</span> __<span class="function">fastcall <span class="title">Java_com_a_easyjni_MainActivity_ncheck</span><span class="params">(_JNIEnv *a1, <span class="keyword">int</span> a2, jstring a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// r8</span></span><br><span class="line">  _JNIEnv *env; <span class="comment">// r5</span></span><br><span class="line">  jstring str; <span class="comment">// r8</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *utf_string; <span class="comment">// r6</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">char</span> *v8; <span class="comment">// r2</span></span><br><span class="line">  <span class="keyword">char</span> v9; <span class="comment">// r1</span></span><br><span class="line">  <span class="keyword">int</span> j; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">bool</span> v11; <span class="comment">// nf</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v12; <span class="comment">// vf</span></span><br><span class="line">  <span class="keyword">int</span> v13; <span class="comment">// r1</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> result; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">char</span> s1[<span class="number">32</span>]; <span class="comment">// [sp+3h] [bp-35h]</span></span><br><span class="line">  <span class="keyword">char</span> tmp; <span class="comment">// [sp+23h] [bp-15h]</span></span><br><span class="line">  <span class="keyword">int</span> v17; <span class="comment">// [sp+28h] [bp-10h]</span></span><br><span class="line"></span><br><span class="line">  v17 = v3;</span><br><span class="line">  env = a1;</span><br><span class="line">  str = a3;</span><br><span class="line">  utf_string = a1-&gt;functions-&gt;GetStringUTFChars(&amp;a1-&gt;functions, a3, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>(utf_string) == <span class="number">32</span> )               <span class="comment">// len(str) == 32</span></span><br><span class="line">  &#123;</span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v8 = &amp;s1[i];</span><br><span class="line">      s1[i] = utf_string[i + <span class="number">16</span>];               <span class="comment">// s1[i] = str[i + 16]</span></span><br><span class="line">      v9 = utf_string[i++];</span><br><span class="line">      v8[<span class="number">16</span>] = v9;                              <span class="comment">// s1[i + 16] = str[i]</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( i != <span class="number">16</span> );</span><br><span class="line">    env-&gt;functions-&gt;ReleaseStringUTFChars(&amp;env-&gt;functions, str, utf_string);</span><br><span class="line">    j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v12 = __OFSUB__(j, <span class="number">30</span>);</span><br><span class="line">      v11 = j - <span class="number">30</span> &lt; <span class="number">0</span>;</span><br><span class="line">      tmp = s1[j];</span><br><span class="line">      s1[j] = s1[j + <span class="number">1</span>];</span><br><span class="line">      s1[j + <span class="number">1</span>] = tmp;                          <span class="comment">// s1[j], s1[j + 1] = s1[j + 1], s1[j]</span></span><br><span class="line">      j += <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v11 ^ v12 );                        <span class="comment">// while j &lt;= 30</span></span><br><span class="line">    v13 = <span class="built_in">memcmp</span>(s1, <span class="string">"MbT3sQgX039i3g==AQOoMQFPskB1Bsc7"</span>, <span class="number">0x20</span>u);</span><br><span class="line">    result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( !v13 )</span><br><span class="line">      result = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    env-&gt;functions-&gt;ReleaseStringUTFChars(&amp;env-&gt;functions, str, utf_string);</span><br><span class="line">    result = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>逆向把位置颠倒的字符串倒回去，再用改表的 base64 解码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">base64_charset = <span class="string">'i5jLW7S0GX6uf1cv3ny4q8es2Q+bdkYgKOIT/tAxUrFlVPzhmow9BHCMDpEaJRZN='</span></span><br><span class="line"></span><br><span class="line">ciphertext = <span class="string">'MbT3sQgX039i3g==AQOoMQFPskB1Bsc7'</span></span><br><span class="line">ciphertext = [ord(c) <span class="keyword">for</span> c <span class="keyword">in</span> ciphertext]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(ciphertext) / <span class="number">2</span>):</span><br><span class="line">    ciphertext[<span class="number">2</span> * i], ciphertext[<span class="number">2</span> * i + <span class="number">1</span>] = ciphertext[<span class="number">2</span> * i + <span class="number">1</span>], ciphertext[<span class="number">2</span> * i]</span><br><span class="line"><span class="keyword">print</span> ciphertext</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(ciphertext) / <span class="number">2</span>):</span><br><span class="line">    ciphertext[i], ciphertext[i + <span class="number">16</span>] = ciphertext[i + <span class="number">16</span>], ciphertext[i]</span><br><span class="line"><span class="keyword">print</span> ciphertext</span><br><span class="line"></span><br><span class="line">ciphertext = <span class="string">''</span>.join([chr(c) <span class="keyword">for</span> c <span class="keyword">in</span> ciphertext])</span><br><span class="line"><span class="keyword">print</span> ciphertext</span><br><span class="line"><span class="comment"># QAoOQMPFks1BsB7cbM3TQsXg30i9g3==</span></span><br><span class="line">plaintext = decipher(ciphertext)</span><br><span class="line"><span class="keyword">print</span> plaintext</span><br><span class="line"><span class="comment"># flag&#123;just_ANot#er_@p3&#125;</span></span><br></pre></td></tr></table></figure>
<h1 id="easy-so"><a href="#easy-so" class="headerlink" title="easy-so"></a>easy-so</h1><p>用 jadx 反编译后，看到调用了 cyberpeace 类中的 CheckString 函数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.testjava.jack.pingan2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.View.OnClickListener;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView((<span class="keyword">int</span>) R.layout.activity_main);</span><br><span class="line">        ((Button) findViewById(R.id.button)).setOnClickListener(<span class="keyword">new</span> OnClickListener() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (cyberpeace.CheckString(((EditText) MainActivity.<span class="keyword">this</span>.findViewById(R.id.editText)).getText().toString()) == <span class="number">1</span>) &#123;</span><br><span class="line">                    Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">"\u9a8c\u8bc1\u901a\u8fc7!"</span>, <span class="number">1</span>).show(); <span class="comment">// 验证通过!</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">"\u9a8c\u8bc1\u5931\u8d25!"</span>, <span class="number">1</span>).show(); <span class="comment">// 验证失败!</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看到函数在 Native 层实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.testjava.jack.pingan2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">cyberpeace</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">int</span> <span class="title">CheckString</span><span class="params">(String str)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">"cyberpeace"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现是静态实现的函数，其中将输入调用了 TestDec，并将结果和指定字符串比较：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">signed</span> <span class="keyword">int</span> __<span class="function">fastcall <span class="title">Java_com_testjava_jack_pingan2_cyberpeace_CheckString</span><span class="params">(_JNIEnv *a1, <span class="keyword">int</span> a2, jstring *str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v3; <span class="comment">// r8</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *str_1; <span class="comment">// r9</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// r6</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *v6; <span class="comment">// r5</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v7; <span class="comment">// r1</span></span><br><span class="line"></span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  str_1 = a1-&gt;functions-&gt;GetStringUTFChars(&amp;a1-&gt;functions, str, <span class="number">0</span>);</span><br><span class="line">  v5 = <span class="built_in">strlen</span>(str_1);</span><br><span class="line">  v6 = (<span class="keyword">const</span> <span class="keyword">char</span> *)<span class="built_in">malloc</span>(v5 + <span class="number">1</span>);</span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v5 != <span class="number">-1</span> )</span><br><span class="line">    v7 = <span class="number">1</span>;</span><br><span class="line">  _aeabi_memclr(&amp;v6[v5], v7);</span><br><span class="line">  _aeabi_memcpy((<span class="keyword">int</span>)v6, (<span class="keyword">int</span>)str_1, v5);</span><br><span class="line">  j_TestDec((<span class="keyword">int</span>)v6);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(v6, <span class="string">"f72c5a36569418a20907b55be5bf95ad"</span>) )</span><br><span class="line">    v3 = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看一下 TestDec 发现和之前一样，也是一组简单置换：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">size_t</span> __<span class="function">fastcall <span class="title">TestDec</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *str; <span class="comment">// r4</span></span><br><span class="line">  <span class="keyword">size_t</span> i; <span class="comment">// r5</span></span><br><span class="line">  <span class="keyword">char</span> *v3; <span class="comment">// r1</span></span><br><span class="line">  <span class="keyword">char</span> v4; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">size_t</span> result; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">int</span> j; <span class="comment">// r5</span></span><br><span class="line">  <span class="keyword">char</span> *v7; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">char</span> v8; <span class="comment">// r1</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v9; <span class="comment">// r1</span></span><br><span class="line"></span><br><span class="line">  str = (<span class="keyword">char</span> *)a1;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>(a1) &gt;= <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v3 = &amp;str[i];</span><br><span class="line">      v4 = str[i];</span><br><span class="line">      str[i] = str[i + <span class="number">16</span>];</span><br><span class="line">      ++i;</span><br><span class="line">      v3[<span class="number">16</span>] = v4;                              <span class="comment">// str[i], str[i + 16] = str[i + 16], str[i]</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( i &lt; <span class="built_in">strlen</span>(str) &gt;&gt; <span class="number">1</span> );</span><br><span class="line">  &#125;</span><br><span class="line">  result = (<span class="keyword">unsigned</span> __int8)*str;</span><br><span class="line">  <span class="keyword">if</span> ( !*str )</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  *str = str[<span class="number">1</span>];</span><br><span class="line">  str[<span class="number">1</span>] = result;                              <span class="comment">// str[0], str[1] = str[1], str[0]</span></span><br><span class="line">  result = <span class="built_in">strlen</span>(str);</span><br><span class="line">  <span class="keyword">if</span> ( result &lt; <span class="number">3</span> )</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  j = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v7 = &amp;str[j];</span><br><span class="line">    v8 = str[j + <span class="number">2</span>];</span><br><span class="line">    v7[<span class="number">2</span>] = str[j + <span class="number">3</span>];</span><br><span class="line">    v7[<span class="number">3</span>] = v8;                                 <span class="comment">// str[j + 2], str[j + 3] = str[j + 3], str[j + 2]</span></span><br><span class="line">    result = <span class="built_in">strlen</span>(str);</span><br><span class="line">    v9 = j + <span class="number">4</span>;</span><br><span class="line">    j += <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v9 &lt; result );</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>照样学样逆一下就好了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line">ciphertext = <span class="string">'f72c5a36569418a20907b55be5bf95ad'</span></span><br><span class="line">ciphertext = [ord(c) <span class="keyword">for</span> c <span class="keyword">in</span> ciphertext]</span><br><span class="line">ciphertext[<span class="number">0</span>], ciphertext[<span class="number">1</span>] = ciphertext[<span class="number">1</span>], ciphertext[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(ciphertext) / <span class="number">2</span> - <span class="number">1</span>):</span><br><span class="line">    ciphertext[<span class="number">2</span> * i + <span class="number">2</span>], ciphertext[<span class="number">2</span> * i + <span class="number">3</span>] = ciphertext[<span class="number">2</span> * i + <span class="number">3</span>], ciphertext[<span class="number">2</span> * i + <span class="number">2</span>]</span><br><span class="line"><span class="keyword">print</span> ciphertext</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(ciphertext) / <span class="number">2</span>):</span><br><span class="line">    ciphertext[i], ciphertext[i + <span class="number">16</span>] = ciphertext[i + <span class="number">16</span>], ciphertext[i]</span><br><span class="line"><span class="keyword">print</span> ciphertext</span><br><span class="line"></span><br><span class="line">plaintext = <span class="string">''</span>.join([chr(c) <span class="keyword">for</span> c <span class="keyword">in</span> ciphertext])</span><br><span class="line"><span class="keyword">print</span> plaintext</span><br><span class="line"><span class="comment"># 90705bb55efb59da7fc2a5636549812a</span></span><br></pre></td></tr></table></figure>
<h1 id="Ph0en1x-100"><a href="#Ph0en1x-100" class="headerlink" title="Ph0en1x-100"></a>Ph0en1x-100</h1><p>MainActivity 中，encrypt 和 getFlag 函数在 Native 层实现，getSecret 函数返回某种哈希摘要的十六进制字符串。输入经过 encrypt 函数操作后的值与 getFlag 的值相等：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ph0en1x.android_crackme;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.v4.view.MotionEventCompat;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    EditText etFlag;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">encrypt</span><span class="params">(String str)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">getFlag</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">"phcm"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView((<span class="keyword">int</span>) R.layout.activity_main);</span><br><span class="line">        <span class="keyword">this</span>.etFlag = (EditText) findViewById(R.id.flag_edit);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onGoClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (getSecret(getFlag()).equals(getSecret(encrypt(<span class="keyword">this</span>.etFlag.getText().toString())))) &#123;</span><br><span class="line">            Toast.makeText(<span class="keyword">this</span>, <span class="string">"Success"</span>, <span class="number">1</span>).show();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Toast.makeText(<span class="keyword">this</span>, <span class="string">"Failed"</span>, <span class="number">1</span>).show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSecret</span><span class="params">(String string)</span> </span>&#123; <span class="comment">// 获取某种哈希摘要的十六进制字符串</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">byte</span>[] hash = MessageDigest.getInstance(encrypt(<span class="string">"KE3TLNE6M43EK4GM34LKMLETG"</span>).substring(<span class="number">5</span>, <span class="number">8</span>)).digest(string.getBytes(<span class="string">"UTF-8"</span>));</span><br><span class="line">            <span class="keyword">if</span> (hash != <span class="keyword">null</span>) &#123;</span><br><span class="line">                StringBuilder hex = <span class="keyword">new</span> StringBuilder(hash.length * <span class="number">2</span>);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">byte</span> b : hash) &#123;</span><br><span class="line">                    <span class="keyword">if</span> ((b &amp; MotionEventCompat.ACTION_MASK) &lt; <span class="number">16</span>) &#123;</span><br><span class="line">                        hex.append(<span class="string">"0"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    hex.append(Integer.toHexString(b &amp; MotionEventCompat.ACTION_MASK));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> hex.toString();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e2) &#123;</span><br><span class="line">            e2.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 IDA 中看到静态注册的 encrypt 函数，对字符串的每个值进行了减一操作：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">jstring __<span class="function">fastcall <span class="title">Java_com_ph0en1x_android_1crackme_MainActivity_encrypt</span><span class="params">(_JNIEnv *a1, <span class="keyword">int</span> a2, jstring a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _JNIEnv *v3; <span class="comment">// r6</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *v4; <span class="comment">// r4</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *i; <span class="comment">// r5</span></span><br><span class="line"></span><br><span class="line">  v3 = a1;</span><br><span class="line">  v4 = a1-&gt;functions-&gt;GetStringUTFChars(&amp;a1-&gt;functions, a3, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = v4; i - v4 &lt; <span class="built_in">strlen</span>(v4); ++i )</span><br><span class="line">    --*i;</span><br><span class="line">  <span class="keyword">return</span> v3-&gt;functions-&gt;NewStringUTF(&amp;v3-&gt;functions, v4);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>反向加一，得到指定的哈希摘要是 MD5：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">md5hash = <span class="keyword">lambda</span> m: hashlib.md5(m).hexdigest()</span><br><span class="line"></span><br><span class="line">secret_digest = <span class="string">'KE3TLNE6M43EK4GM34LKMLETG'</span></span><br><span class="line">digest_type = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(secret_digest)):</span><br><span class="line">    digest_type += chr(ord(secret_digest[i]) - <span class="number">1</span>)</span><br><span class="line">digest_type = digest_type[<span class="number">5</span>:<span class="number">8</span>]</span><br><span class="line"><span class="keyword">print</span> digest_type</span><br><span class="line"><span class="comment"># MD5</span></span><br></pre></td></tr></table></figure>
<p>接下来看 getFlag 函数，读取内存中 data 的值，在循环中对相邻两个值进行相减并加 1，然后和 key 值异或，最后返回字符串：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">jstring __<span class="function">fastcall <span class="title">Java_com_ph0en1x_android_1crackme_MainActivity_getFlag</span><span class="params">(_JNIEnv *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *v1; <span class="comment">// r4</span></span><br><span class="line">  _JNIEnv *v2; <span class="comment">// r7</span></span><br><span class="line">  <span class="keyword">char</span> *v3; <span class="comment">// r3</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// r1</span></span><br><span class="line">  <span class="keyword">char</span> *v6; <span class="comment">// r2</span></span><br><span class="line">  <span class="keyword">char</span> *v7; <span class="comment">// r3</span></span><br><span class="line">  <span class="keyword">int</span> v8; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// r1</span></span><br><span class="line">  <span class="keyword">int</span> v10; <span class="comment">// r4</span></span><br><span class="line">  <span class="keyword">int</span> v11; <span class="comment">// r0</span></span><br><span class="line">  __int16 v12; <span class="comment">// r3</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> l1; <span class="comment">// r8</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> l2; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">char</span> *v15; <span class="comment">// r9</span></span><br><span class="line">  <span class="keyword">char</span> a; <span class="comment">// r3</span></span><br><span class="line">  <span class="keyword">char</span> b; <span class="comment">// t1</span></span><br><span class="line">  <span class="keyword">int</span> idx; <span class="comment">// r1</span></span><br><span class="line">  <span class="keyword">char</span> s; <span class="comment">// [sp+4h] [bp-5Ch]</span></span><br><span class="line">  <span class="keyword">char</span> data_1[<span class="number">40</span>]; <span class="comment">// [sp+14h] [bp-4Ch]</span></span><br><span class="line">  <span class="keyword">char</span> v22; <span class="comment">// [sp+40h] [bp-20h]</span></span><br><span class="line"></span><br><span class="line">  v1 = data_1;</span><br><span class="line">  v2 = a1;</span><br><span class="line">  v3 = (<span class="keyword">char</span> *)&amp;data;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v4 = *(_DWORD *)v3;                         <span class="comment">// low 4 bytes</span></span><br><span class="line">    v3 += <span class="number">8</span>;</span><br><span class="line">    v5 = *((_DWORD *)v3 - <span class="number">1</span>);                   <span class="comment">// high 4 bytes</span></span><br><span class="line">    *(_DWORD *)v1 = v4;</span><br><span class="line">    *((_DWORD *)v1 + <span class="number">1</span>) = v5;</span><br><span class="line">    v1 += <span class="number">8</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v3 != <span class="string">"Hello Ph0en1x"</span> );</span><br><span class="line">  v6 = &amp;s;</span><br><span class="line">  v7 = <span class="string">"Hello Ph0en1x"</span>;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v8 = *(_DWORD *)v7;</span><br><span class="line">    v7 += <span class="number">8</span>;</span><br><span class="line">    v9 = *((_DWORD *)v7 - <span class="number">1</span>);</span><br><span class="line">    *(_DWORD *)v6 = v8;</span><br><span class="line">    *((_DWORD *)v6 + <span class="number">1</span>) = v9;</span><br><span class="line">    v10 = (<span class="keyword">int</span>)(v6 + <span class="number">8</span>);</span><br><span class="line">    v6 += <span class="number">8</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v7 != <span class="string">"0en1x"</span> );</span><br><span class="line">  v11 = *(_DWORD *)v7;</span><br><span class="line">  v12 = *((_WORD *)v7 + <span class="number">2</span>);</span><br><span class="line">  *(_DWORD *)v10 = v11;</span><br><span class="line">  *(_WORD *)(v10 + <span class="number">4</span>) = v12;</span><br><span class="line">  l1 = <span class="built_in">strlen</span>(&amp;s);                              <span class="comment">// len('Hello Ph0en1x')</span></span><br><span class="line">  l2 = <span class="built_in">strlen</span>(data_1) - <span class="number">1</span>;                      <span class="comment">// len(data) - 1</span></span><br><span class="line">  v15 = &amp;data_1[l2];</span><br><span class="line">  <span class="keyword">while</span> ( l2 &gt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    a = *v15 + <span class="number">1</span>;</span><br><span class="line">    *v15 = a;                                   <span class="comment">// data[l2] = data[l2] + 1</span></span><br><span class="line">    b = *(v15-- - <span class="number">1</span>);                           <span class="comment">// data[l2 - 1]</span></span><br><span class="line">    idx = l2-- % l1;                            <span class="comment">// l2 % l1</span></span><br><span class="line">    v15[<span class="number">1</span>] = ((a - b) ^ *(&amp;v22 + idx - <span class="number">60</span>)) - <span class="number">1</span>;<span class="comment">// data[l2] = ((data[l2 + 1] - data[l2 - 1]) ^ s[idx]) - 1</span></span><br><span class="line">  &#125;</span><br><span class="line">  data_1[<span class="number">0</span>] = (data_1[<span class="number">0</span>] ^ <span class="number">0x48</span>) - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> v2-&gt;functions-&gt;NewStringUTF(&amp;v2-&gt;functions, data_1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因为涉及到了异或和减法的操作，需要注意到及时和 0xFF 与一下，不然结果会出错。脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">data = [<span class="number">0x2E</span>, <span class="number">0x36</span>, <span class="number">0x42</span>, <span class="number">0x4C</span>, <span class="number">0x5F</span>, <span class="number">0xBF</span>, <span class="number">0xE0</span>, <span class="number">0x3A</span>, <span class="number">0xA8</span>, <span class="number">0xC3</span>, <span class="number">0x20</span>, <span class="number">0x63</span>, <span class="number">0x89</span>, <span class="number">0xB7</span>, <span class="number">0xC0</span>, <span class="number">0x1C</span>, <span class="number">0x1D</span>, <span class="number">0x44</span>, <span class="number">0xC2</span>, <span class="number">0x28</span>, <span class="number">0x7F</span>, <span class="number">0xED</span>, <span class="number">0x02</span>, <span class="number">0x0E</span>, <span class="number">0x5D</span>, <span class="number">0x66</span>, <span class="number">0x8F</span>, <span class="number">0x98</span>, <span class="number">0xB5</span>, <span class="number">0xB7</span>, <span class="number">0xD0</span>, <span class="number">0x16</span>, <span class="number">0x4D</span>, <span class="number">0x83</span>, <span class="number">0xF8</span>, <span class="number">0xFB</span>, <span class="number">0x01</span>, <span class="number">0x43</span>, <span class="number">0x47</span>]</span><br><span class="line">key = <span class="string">'Hello Ph0en1x'</span></span><br><span class="line">l1 = len(key)</span><br><span class="line">l2 = len(data)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(l2 - <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>):</span><br><span class="line">    data[i] = (((data[i] + <span class="number">1</span> - data[i - <span class="number">1</span>]) ^ ord(key[i % l1])) &amp; <span class="number">0xFF</span>) - <span class="number">1</span></span><br><span class="line">data[<span class="number">0</span>] = (data[<span class="number">0</span>] ^ <span class="number">0x48</span>) - <span class="number">1</span></span><br><span class="line">flag = <span class="string">''</span>.join([chr(c + <span class="number">1</span>) <span class="keyword">for</span> c <span class="keyword">in</span> data])</span><br><span class="line"><span class="keyword">print</span> flag</span><br><span class="line"><span class="comment"># flag&#123;Ar3_y0u_go1nG_70_scarborough_Fair&#125;</span></span><br></pre></td></tr></table></figure>
<h1 id="RememberOther"><a href="#RememberOther" class="headerlink" title="RememberOther"></a>RememberOther</h1><p>这道题简直出的莫名其妙，发现如果用户名和密码都为空会返回 True，并且会弹出 strings.xml 中指向的 successed 字符串：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.droider.crackme0201;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.v4.view.MotionEventCompat;</span><br><span class="line"><span class="keyword">import</span> android.view.Menu;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.View.OnClickListener;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Button btn_register;</span><br><span class="line">    <span class="keyword">private</span> EditText edit_sn;</span><br><span class="line">    <span class="keyword">private</span> EditText edit_userName;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        setTitle(R.string.unregister);</span><br><span class="line">        <span class="keyword">this</span>.edit_userName = (EditText) findViewById(R.id.edit_username);</span><br><span class="line">        <span class="keyword">this</span>.edit_sn = (EditText) findViewById(R.id.edit_sn);</span><br><span class="line">        <span class="keyword">this</span>.btn_register = (Button) findViewById(R.id.button_register);</span><br><span class="line">        <span class="keyword">this</span>.btn_register.setOnClickListener(<span class="keyword">new</span> OnClickListener() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (MainActivity.<span class="keyword">this</span>.checkSN(MainActivity.<span class="keyword">this</span>.edit_userName.getText().toString().trim(), MainActivity.<span class="keyword">this</span>.edit_sn.getText().toString().trim())) &#123;</span><br><span class="line">                    Toast.makeText(MainActivity.<span class="keyword">this</span>, R.string.successed, <span class="number">0</span>).show();</span><br><span class="line">                    MainActivity.<span class="keyword">this</span>.btn_register.setEnabled(<span class="keyword">false</span>);</span><br><span class="line">                    MainActivity.<span class="keyword">this</span>.setTitle(R.string.registered);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                Toast.makeText(MainActivity.<span class="keyword">this</span>, R.string.unsuccessed, <span class="number">0</span>).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> </span>&#123;</span><br><span class="line">        getMenuInflater().inflate(R.menu.activity_main, menu);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">checkSN</span><span class="params">(String userName, String sn)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (userName.length() == <span class="number">0</span> &amp;&amp; sn.length() == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (userName == <span class="keyword">null</span> || userName.length() == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (sn == <span class="keyword">null</span> || sn.length() != <span class="number">16</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            MessageDigest digest = MessageDigest.getInstance(<span class="string">"MD5"</span>);</span><br><span class="line">            digest.reset();</span><br><span class="line">            digest.update(userName.getBytes());</span><br><span class="line">            String hexstr = toHexString(digest.digest(), BuildConfig.FLAVOR);</span><br><span class="line">            StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; hexstr.length(); i += <span class="number">2</span>) &#123;</span><br><span class="line">                sb.append(hexstr.charAt(i));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (sb.toString().equalsIgnoreCase(sn)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">toHexString</span><span class="params">(<span class="keyword">byte</span>[] bytes, String separator)</span> </span>&#123;</span><br><span class="line">        StringBuilder hexString = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">byte</span> b : bytes) &#123;</span><br><span class="line">            String hex = Integer.toHexString(b &amp; MotionEventCompat.ACTION_MASK);</span><br><span class="line">            <span class="keyword">if</span> (hex.length() == <span class="number">1</span>) &#123;</span><br><span class="line">                hexString.append(<span class="string">'0'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            hexString.append(hex).append(separator);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> hexString.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在资源中找到指定的字符串：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"app_name"</span>&gt;</span>Crackme0201<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"hint_sn"</span>&gt;</span>请输入16位的注册码<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"hint_username"</span>&gt;</span>请输入用户名<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"info"</span>&gt;</span>Xman Android<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"menu_settings"</span>&gt;</span>Settings<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"register"</span>&gt;</span>注 册<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"registered"</span>&gt;</span>程序已注册<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"sn"</span>&gt;</span>注册码：<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"successed"</span>&gt;</span>md5:b3241668ecbeb19921fdac5ac1aafa69<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"title_activity_main"</span>&gt;</span>Crackme<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"unregister"</span>&gt;</span>程序未注册<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"unsuccessed"</span>&gt;</span>无效用户名或注册码<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"username"</span>&gt;</span>用户名：<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>搜一下 MD5，得到原字符串为 <code>YOU_KNOW_</code>。但结果不对，网上找到别人的 wp，说另一半要结合 word 中的提示，出题人说他不懂安卓，那么我们就懂了，flag 就是 <code>YOU_KNOW_ANDROID</code>。</p>
<h1 id="黑客精神"><a href="#黑客精神" class="headerlink" title="黑客精神"></a>黑客精神</h1><p>这题相比前面的题目开始复杂起来了。在 MainActivity 中，看到一开始对一个 m 的值进行了判断。然后接下来在 onClick 中新建了一个 MyApp 实例，如果 m 为 0 就调用 doRegister 函数，其中跳转到 RegActivity。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gdufs.xman;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"><span class="keyword">import</span> android.app.AlertDialog.Builder;</span><br><span class="line"><span class="keyword">import</span> android.content.ComponentName;</span><br><span class="line"><span class="keyword">import</span> android.content.DialogInterface;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.os.Process;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.Menu;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.View.OnClickListener;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String workString;</span><br><span class="line">    <span class="keyword">private</span> Button btn1;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        String str2;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        String str1 = <span class="string">"Xman"</span>;</span><br><span class="line">        Log.d(<span class="string">"com.gdufs.xman m="</span>, str1);</span><br><span class="line">        MyApp myApp = (MyApp) getApplication();</span><br><span class="line">        <span class="keyword">int</span> m = MyApp.m;</span><br><span class="line">        <span class="keyword">if</span> (m == <span class="number">0</span>) &#123;</span><br><span class="line">            str2 = <span class="string">"\u672a\u6ce8\u518c"</span>; <span class="comment">// 未注册</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (m == <span class="number">1</span>) &#123;</span><br><span class="line">            str2 = <span class="string">"\u5df2\u6ce8\u518c"</span>; <span class="comment">// 已注册</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            str2 = <span class="string">"\u5df2\u6df7\u4e71"</span>; <span class="comment">// 已混乱</span></span><br><span class="line">        &#125;</span><br><span class="line">        setTitle(str1 + str2);</span><br><span class="line">        <span class="keyword">this</span>.btn1 = (Button) findViewById(R.id.button1);</span><br><span class="line">        <span class="keyword">this</span>.btn1.setOnClickListener(<span class="keyword">new</span> OnClickListener() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                MyApp myApp = (MyApp) MainActivity.<span class="keyword">this</span>.getApplication();</span><br><span class="line">                <span class="keyword">if</span> (MyApp.m == <span class="number">0</span>) &#123;</span><br><span class="line">                    MainActivity.<span class="keyword">this</span>.doRegister();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                ((MyApp) MainActivity.<span class="keyword">this</span>.getApplication()).work();</span><br><span class="line">                Toast.makeText(MainActivity.<span class="keyword">this</span>.getApplicationContext(), MainActivity.workString, <span class="number">0</span>).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doRegister</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Builder(<span class="keyword">this</span>).setTitle(<span class="string">"\u6ce8\u518c"</span>).setMessage(<span class="string">"Flag\u5c31\u5728\u524d\u65b9\uff01"</span>).setPositiveButton(<span class="string">"\u6ce8\u518c"</span>, <span class="keyword">new</span> DialogInterface.OnClickListener() &#123; <span class="comment">// Title =&gt; 注册 | Message =&gt; Flag就在前方！ | PositiveButton =&gt; 注册</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialog, <span class="keyword">int</span> which)</span> </span>&#123;</span><br><span class="line">                Intent intent = <span class="keyword">new</span> Intent();</span><br><span class="line">                intent.setComponent(<span class="keyword">new</span> ComponentName(BuildConfig.APPLICATION_ID, <span class="string">"com.gdufs.xman.RegActivity"</span>));</span><br><span class="line">                MainActivity.<span class="keyword">this</span>.startActivity(intent); <span class="comment">// 跳转到RegActivity</span></span><br><span class="line">                MainActivity.<span class="keyword">this</span>.finish();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).setNegativeButton(<span class="string">"\u4e0d\u73a9\u4e86"</span>, <span class="keyword">new</span> DialogInterface.OnClickListener() &#123; <span class="comment">// NagetiveButton =&gt; 不玩了</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialog, <span class="keyword">int</span> which)</span> </span>&#123;</span><br><span class="line">                Process.killProcess(Process.myPid());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">work</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        workString = str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> </span>&#123;</span><br><span class="line">        getMenuInflater().inflate(R.menu.menu_main, menu);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后看一下 MyApp 类中，发现分别有三个函数在 Native 层实现。其中 onCreate 中调用了 initSN 函数。SN 猜测是 Serial Number 即序列号：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gdufs.xman;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Application;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> m = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">initSN</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">saveSN</span><span class="params">(String str)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">work</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">"myjni"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        initSN();</span><br><span class="line">        Log.d(<span class="string">"com.gdufs.xman m="</span>, String.valueOf(m));</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>RegActivity 中获取输入的字符串，并作为 SN 传入 saveSN 函数。然后 App 将会把自己的进程杀死：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gdufs.xman;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"><span class="keyword">import</span> android.app.AlertDialog.Builder;</span><br><span class="line"><span class="keyword">import</span> android.content.DialogInterface;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.os.Process;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.View.OnClickListener;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RegActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Button btn_reg;</span><br><span class="line">    <span class="keyword">private</span> EditText edit_sn;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_reg);</span><br><span class="line">        <span class="keyword">this</span>.btn_reg = (Button) findViewById(R.id.button1);</span><br><span class="line">        <span class="keyword">this</span>.edit_sn = (EditText) findViewById(R.id.editText1);</span><br><span class="line">        <span class="keyword">this</span>.btn_reg.setOnClickListener(<span class="keyword">new</span> OnClickListener() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                String sn = RegActivity.<span class="keyword">this</span>.edit_sn.getText().toString().trim();</span><br><span class="line">                <span class="keyword">if</span> (sn == <span class="keyword">null</span> || sn.length() == <span class="number">0</span>) &#123;</span><br><span class="line">                    Toast.makeText(RegActivity.<span class="keyword">this</span>, <span class="string">"\u60a8\u7684\u8f93\u5165\u4e3a\u7a7a"</span>, <span class="number">0</span>).show(); <span class="comment">// 您的输入为空</span></span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                ((MyApp) RegActivity.<span class="keyword">this</span>.getApplication()).saveSN(sn);</span><br><span class="line">                <span class="keyword">new</span> Builder(RegActivity.<span class="keyword">this</span>).setTitle(<span class="string">"\u56de\u590d"</span>).setMessage(<span class="string">"\u60a8\u7684\u6ce8\u518c\u7801\u5df2\u4fdd\u5b58"</span>).setPositiveButton(<span class="string">"\u597d\u5427"</span>, <span class="keyword">new</span> DialogInterface.OnClickListener() &#123; <span class="comment">// Title =&gt; 回复 | Message =&gt; 您的注册码已保存 | PositiveButton =&gt; 好吧</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialog, <span class="keyword">int</span> which)</span> </span>&#123;</span><br><span class="line">                        Process.killProcess(Process.myPid());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么基本上就是求出正确的 SN 了。在 Native 查看，发现函数在 JNI_OnLoad 中动态注册：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">signed</span> <span class="keyword">int</span> __<span class="function">fastcall <span class="title">JNI_OnLoad</span><span class="params">(_JavaVM *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ( a1-&gt;functions-&gt;GetEnv(&amp;a1-&gt;functions, (<span class="keyword">void</span> **)&amp;g_env, <span class="number">65542</span>) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  _android_log_print(<span class="number">2</span>, <span class="string">"com.gdufs.xman"</span>, <span class="string">"JNI_OnLoad()"</span>);</span><br><span class="line">  native_class = (<span class="keyword">int</span>)g_env-&gt;functions-&gt;FindClass(&amp;g_env-&gt;functions, <span class="string">"com/gdufs/xman/MyApp"</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !g_env-&gt;functions-&gt;RegisterNatives(&amp;g_env-&gt;functions, (jclass)native_class, (<span class="keyword">const</span> JNINativeMethod *)gMethods, <span class="number">3</span>) )<span class="comment">// register 3 methods</span></span><br><span class="line">  &#123;</span><br><span class="line">    _android_log_print(<span class="number">2</span>, <span class="string">"com.gdufs.xman"</span>, <span class="string">"RegisterNatives() --&gt; nativeMethod() ok"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">65542</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  _android_log_print(<span class="number">6</span>, <span class="string">"com.gdufs.xman"</span>, <span class="string">"RegisterNatives() --&gt; nativeMethod() failed"</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>先来看 initSN，其中读取 <code>/sdcard/reg.dat</code> 中的内容并和 <code>EoPAoY62@ElRD</code> 进行比较：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> __<span class="function">fastcall <span class="title">initSN</span><span class="params">(_JNIEnv *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _JNIEnv *env; <span class="comment">// r6</span></span><br><span class="line">  FILE *f; <span class="comment">// r0</span></span><br><span class="line">  FILE *f_1; <span class="comment">// r4</span></span><br><span class="line">  _JNIEnv *env_1; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// r1</span></span><br><span class="line">  <span class="keyword">int</span> len; <span class="comment">// r7</span></span><br><span class="line">  <span class="keyword">char</span> *data; <span class="comment">// r5</span></span><br><span class="line">  _JNIEnv *env_2; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// r1</span></span><br><span class="line"></span><br><span class="line">  env = a1;</span><br><span class="line">  f = fopen(<span class="string">"/sdcard/reg.dat"</span>, <span class="string">"r+"</span>);</span><br><span class="line">  f_1 = f;</span><br><span class="line">  <span class="keyword">if</span> ( !f )                                     <span class="comment">// read file error</span></span><br><span class="line">  &#123;</span><br><span class="line">    env_1 = env;</span><br><span class="line">    v5 = (<span class="keyword">int</span>)f_1;</span><br><span class="line">LABEL_5:</span><br><span class="line">    setValue(env_1, v5);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  fseek(f, <span class="number">0</span>, <span class="number">2</span>);                               <span class="comment">// seek to file end ( SEEK_END )</span></span><br><span class="line">  len = ftell(f_1);</span><br><span class="line">  data = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(len + <span class="number">1</span>);               <span class="comment">// malloc error</span></span><br><span class="line">  <span class="keyword">if</span> ( !data )</span><br><span class="line">  &#123;</span><br><span class="line">    fclose(f_1);</span><br><span class="line">    env_1 = env;</span><br><span class="line">    v5 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">goto</span> LABEL_5;</span><br><span class="line">  &#125;</span><br><span class="line">  fseek(f_1, <span class="number">0</span>, <span class="number">0</span>);                             <span class="comment">// seek to file start ( SEEK_SET )</span></span><br><span class="line">  fread(data, len, <span class="number">1u</span>, f_1);</span><br><span class="line">  data[len] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(data, <span class="string">"EoPAoY62@ElRD"</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    env_2 = env;</span><br><span class="line">    v9 = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    env_2 = env;</span><br><span class="line">    v9 = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  setValue(env_2, v9);</span><br><span class="line">  j_fclose(f_1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中看到有一个 setValue 函数，将 m 的值设为指定的值：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> __<span class="function">fastcall <span class="title">setValue</span><span class="params">(_JNIEnv *a1, <span class="keyword">int</span> val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> val_1; <span class="comment">// r7</span></span><br><span class="line">  _JNIEnv *v3; <span class="comment">// r4</span></span><br><span class="line">  jclass v4; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">void</span> *v5; <span class="comment">// r5</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">jfieldID</span> *<span class="title">v6</span>;</span> <span class="comment">// r0</span></span><br><span class="line"></span><br><span class="line">  val_1 = val;</span><br><span class="line">  v3 = a1;</span><br><span class="line">  v4 = a1-&gt;functions-&gt;FindClass(&amp;a1-&gt;functions, <span class="string">"com/gdufs/xman/MyApp"</span>);</span><br><span class="line">  v5 = v4;</span><br><span class="line">  v6 = v3-&gt;functions-&gt;GetStaticFieldID(&amp;v3-&gt;functions, v4, <span class="string">"m"</span>, <span class="string">"I"</span>);</span><br><span class="line">  v3-&gt;functions-&gt;SetStaticIntField(&amp;v3-&gt;functions, v5, v6, val_1);<span class="comment">// set m = val</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来看 saveSN，这里做一个循环，将 reg.dat 中的字符串取出来并和 key 进行异或：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">fastcall <span class="title">saveSN</span><span class="params">(_JNIEnv *a1, <span class="keyword">int</span> a2, jstring a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _JNIEnv *env; <span class="comment">// r6</span></span><br><span class="line">  jstring str; <span class="comment">// r9</span></span><br><span class="line">  FILE *v5; <span class="comment">// r7</span></span><br><span class="line">  <span class="keyword">int</span> *v7; <span class="comment">// r4</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *v8; <span class="comment">// r3</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">int</span> v10; <span class="comment">// r1</span></span><br><span class="line">  _WORD *v11; <span class="comment">// r5</span></span><br><span class="line">  JNIEnv *v12; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// r4</span></span><br><span class="line">  <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">JNINativeInterface</span> *<span class="title">v14</span>;</span> <span class="comment">// r3</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> j; <span class="comment">// r6</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *utf_string; <span class="comment">// r9</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *data; <span class="comment">// r5</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> len; <span class="comment">// r10</span></span><br><span class="line">  <span class="keyword">char</span> val; <span class="comment">// r2</span></span><br><span class="line">  <span class="keyword">char</span> tmp; <span class="comment">// r3</span></span><br><span class="line">  <span class="keyword">int</span> v21; <span class="comment">// [sp+0h] [bp-38h]</span></span><br><span class="line">  <span class="keyword">int</span> v22; <span class="comment">// [sp+14h] [bp-24h]</span></span><br><span class="line">  <span class="keyword">char</span> v23; <span class="comment">// [sp+18h] [bp-20h]</span></span><br><span class="line"></span><br><span class="line">  env = a1;</span><br><span class="line">  str = a3;</span><br><span class="line">  f = fopen(<span class="string">"/sdcard/reg.dat"</span>, <span class="string">"w+"</span>);</span><br><span class="line">  <span class="keyword">if</span> ( f )</span><br><span class="line">  &#123;</span><br><span class="line">    v7 = &amp;v21;</span><br><span class="line">    v8 = <span class="string">"W3_arE_whO_we_ARE"</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v9 = *(_DWORD *)v8;</span><br><span class="line">      v8 += <span class="number">8</span>;</span><br><span class="line">      v10 = *((_DWORD *)v8 - <span class="number">1</span>);</span><br><span class="line">      *v7 = v9;</span><br><span class="line">      v7[<span class="number">1</span>] = v10;</span><br><span class="line">      v11 = v7 + <span class="number">2</span>;</span><br><span class="line">      v7 += <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v8 != <span class="string">"E"</span> );</span><br><span class="line">    v12 = &amp;env-&gt;functions;</span><br><span class="line">    i = <span class="number">2016</span>;</span><br><span class="line">    *v11 = *(_WORD *)v8;</span><br><span class="line">    v14 = env-&gt;functions;</span><br><span class="line">    j = <span class="number">0</span>;</span><br><span class="line">    utf_string = v14-&gt;GetStringUTFChars(v12, str, <span class="number">0</span>);</span><br><span class="line">    data = utf_string;</span><br><span class="line">    len = <span class="built_in">strlen</span>(utf_string);</span><br><span class="line">    <span class="keyword">while</span> ( j &lt; len )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( j % <span class="number">3</span> == <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        i = (i + <span class="number">5</span>) % <span class="number">16</span>;</span><br><span class="line">        val = *(&amp;v23 + i - <span class="number">23</span>);                 <span class="comment">// &amp;v23 - 32 = &amp;"3_arE_whO_we_ARE"</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> ( j % <span class="number">3</span> == <span class="number">2</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        i = (i + <span class="number">7</span>) % <span class="number">15</span>;</span><br><span class="line">        val = *(&amp;v23 + i - <span class="number">22</span>);                 <span class="comment">// &amp;v23 - 22 = &amp;"_arE_whO_we_ARE"</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        i = (i + <span class="number">3</span>) % <span class="number">13</span>;</span><br><span class="line">        val = *(&amp;v23 + i - <span class="number">21</span>);                 <span class="comment">// &amp;v23 - 21 = &amp;"arE_whO_we_ARE"</span></span><br><span class="line">      &#125;</span><br><span class="line">      tmp = *data;</span><br><span class="line">      ++j;</span><br><span class="line">      *((_BYTE *)++data - <span class="number">1</span>) = tmp ^ val;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">fputs</span>(utf_string, f);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( v22 == _stack_chk_guard )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> j___android_log_print(<span class="number">3</span>, <span class="string">"com.gdufs.xman"</span>, &amp;unk_2DCA);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> j_fclose(f);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>work 函数中初始化了 SN，获取了 m 的值，并最后调用 callWork：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> __<span class="function">fastcall <span class="title">work</span><span class="params">(_JNIEnv *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _JNIEnv *env; <span class="comment">// r4</span></span><br><span class="line">  jint m; <span class="comment">// r0</span></span><br><span class="line">  _JNIEnv *env_1; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">void</span> *v4; <span class="comment">// r1</span></span><br><span class="line">  <span class="keyword">bool</span> v5; <span class="comment">// zf</span></span><br><span class="line"></span><br><span class="line">  env = a1;</span><br><span class="line">  initSN(a1);</span><br><span class="line">  m = getValue(env);</span><br><span class="line">  <span class="keyword">if</span> ( m )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = m == <span class="number">1</span>;</span><br><span class="line">    env_1 = env;</span><br><span class="line">    <span class="keyword">if</span> ( v5 )</span><br><span class="line">      v4 = &amp;unk_2E6B;                           <span class="comment">// [0xE8, 0xBE, 0x93, 0xE5, 0x85, 0xA5, 0xE5, 0x8D, 0xB3, 0xE6, 0x98, 0xAF, 0x66, 0x6C, 0x61, 0x67, 0x2C, 0xE6, 0xA0, 0xBC, 0xE5, 0xBC, 0x8F, 0xE4, 0xB8, 0xBA, 0x78, 0x6D, 0x61, 0x6E, 0x7B, 0xE2, 0x80, 0xA6, 0xE2, 0x80, 0xA6, 0x7D, 0xEF, 0xBC, 0x81]</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v4 = &amp;unk_2E95;                           <span class="comment">// [0xE7, 0x8A, 0xB6, 0xE6, 0x80, 0x81, 0xE4, 0xB8, 0x8D, 0xE5, 0xA4, 0xAA, 0xE5, 0xAF, 0xB9, 0xE3, 0x80, 0x82, 0xE3, 0x80, 0x82]</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    env_1 = env;</span><br><span class="line">    v4 = &amp;unk_2E5B;                             <span class="comment">// [0xE8, 0xBF, 0x98, 0xE4, 0xB8, 0x8D, 0xE8, 0xA1, 0x8C, 0xE5, 0x91, 0xA2, 0xEF, 0xBC, 0x81]</span></span><br><span class="line">  &#125;</span><br><span class="line">  callWork(env_1, (<span class="keyword">int</span>)v4);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中 getValue 就是获取 m 的值：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">jint __<span class="function">fastcall <span class="title">getValue</span><span class="params">(_JNIEnv *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _JNIEnv *v1; <span class="comment">// r4</span></span><br><span class="line">  jclass v2; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">void</span> *v3; <span class="comment">// r5</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">jfieldID</span> *<span class="title">v4</span>;</span> <span class="comment">// r0</span></span><br><span class="line"></span><br><span class="line">  v1 = a1;</span><br><span class="line">  v2 = a1-&gt;functions-&gt;FindClass(&amp;a1-&gt;functions, <span class="string">"com/gdufs/xman/MyApp"</span>);</span><br><span class="line">  v3 = v2;</span><br><span class="line">  v4 = v1-&gt;functions-&gt;GetStaticFieldID(&amp;v1-&gt;functions, v2, <span class="string">"m"</span>, <span class="string">"I"</span>);</span><br><span class="line">  <span class="keyword">return</span> v1-&gt;functions-&gt;GetStaticIntField(&amp;v1-&gt;functions, v3, v4);<span class="comment">// get m's value</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>callWork 中就是调用了 work 函数，这样看来是个死循环：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> __<span class="function">fastcall <span class="title">callWork</span><span class="params">(_JNIEnv *a1, <span class="keyword">void</span> *a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *v2; <span class="comment">// r8</span></span><br><span class="line">  _JNIEnv *env; <span class="comment">// r4</span></span><br><span class="line">  jclass v4; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">void</span> *v5; <span class="comment">// r5</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">jmethodID</span> *<span class="title">v6</span>;</span> <span class="comment">// r0</span></span><br><span class="line">  jobject v7; <span class="comment">// r7</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">jmethodID</span> *<span class="title">v8</span>;</span> <span class="comment">// r5</span></span><br><span class="line">  <span class="keyword">void</span> (*v9)(JNIEnv *, jobject, jmethodID, ...); <span class="comment">// r6</span></span><br><span class="line">  jstring v10; <span class="comment">// r0</span></span><br><span class="line"></span><br><span class="line">  v2 = (<span class="keyword">const</span> <span class="keyword">char</span> *)a2;</span><br><span class="line">  env = a1;</span><br><span class="line">  v4 = a1-&gt;functions-&gt;FindClass(&amp;a1-&gt;functions, <span class="string">"com/gdufs/xman/MainActivity"</span>);</span><br><span class="line">  v5 = v4;</span><br><span class="line">  v6 = env-&gt;functions-&gt;GetMethodID(&amp;env-&gt;functions, v4, <span class="string">"&lt;init&gt;"</span>, <span class="string">"()V"</span>);</span><br><span class="line">  v7 = env-&gt;functions-&gt;NewObject(&amp;env-&gt;functions, v5, v6);</span><br><span class="line">  v8 = env-&gt;functions-&gt;GetMethodID(&amp;env-&gt;functions, v5, <span class="string">"work"</span>, <span class="string">"(Ljava/lang/String;)V"</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v8 )</span><br><span class="line">  &#123;</span><br><span class="line">    v9 = env-&gt;functions-&gt;CallVoidMethod;</span><br><span class="line">    v10 = env-&gt;functions-&gt;NewStringUTF(&amp;env-&gt;functions, v2);</span><br><span class="line">    v9(&amp;env-&gt;functions, v7, v8, v10);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 saveSN 中其实就是实际的算法，逆一下实现解 SN 脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line">ciphertext = <span class="string">'EoPAoY62@ElRD'</span></span><br><span class="line">key = <span class="string">'W3_arE_whO_we_ARE'</span></span><br><span class="line">i = <span class="number">2016</span></span><br><span class="line">j = <span class="number">0</span></span><br><span class="line">l = len(ciphertext)</span><br><span class="line">result = <span class="string">''</span></span><br><span class="line"><span class="keyword">while</span> j &lt; l:</span><br><span class="line">    <span class="keyword">if</span> j % <span class="number">3</span> == <span class="number">1</span>:</span><br><span class="line">        i = (i + <span class="number">5</span>) % <span class="number">16</span></span><br><span class="line">        val = ord(key[i + <span class="number">1</span>])</span><br><span class="line">    <span class="keyword">elif</span> j % <span class="number">3</span> ==<span class="number">2</span>:</span><br><span class="line">        i = (i + <span class="number">7</span>) % <span class="number">15</span></span><br><span class="line">        val = ord(key[i + <span class="number">2</span>])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        i = (i + <span class="number">3</span>) % <span class="number">13</span></span><br><span class="line">        val = ord(key[i + <span class="number">3</span>])</span><br><span class="line">    result += chr(ord(ciphertext[j]) ^ val)</span><br><span class="line">    j += <span class="number">1</span></span><br><span class="line"><span class="keyword">print</span> result</span><br></pre></td></tr></table></figure>
<h1 id="easy-dex"><a href="#easy-dex" class="headerlink" title="easy-dex"></a>easy-dex</h1><p>首先查看 AndroidManifest.xml，发现启动 Activity 为 <code>android.app.NativeActivity</code>，是在 Native 层实现的安卓 Activity：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">android:versionCode</span>=<span class="string">"1"</span> <span class="attr">android:versionName</span>=<span class="string">"1.0"</span> <span class="attr">package</span>=<span class="string">"com.a.sample.findmydex"</span> <span class="attr">platformBuildVersionCode</span>=<span class="string">"24"</span> <span class="attr">platformBuildVersionName</span>=<span class="string">"7.0"</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">uses-sdk</span> <span class="attr">android:minSdkVersion</span>=<span class="string">"19"</span> <span class="attr">android:targetSdkVersion</span>=<span class="string">"24"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">application</span> <span class="attr">android:allowBackup</span>=<span class="string">"false"</span> <span class="attr">android:fullBackupContent</span>=<span class="string">"false"</span> <span class="attr">android:hasCode</span>=<span class="string">"false"</span> <span class="attr">android:icon</span>=<span class="string">"@mipmap/ic_launcher"</span> <span class="attr">android:label</span>=<span class="string">"@string/app_name"</span> <span class="attr">android:theme</span>=<span class="string">"@style/AppTheme"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:configChanges</span>=<span class="string">"0xa0"</span> <span class="attr">android:label</span>=<span class="string">"@string/app_name"</span> <span class="attr">android:name</span>=<span class="string">"android.app.NativeActivity"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">meta-data</span> <span class="attr">android:name</span>=<span class="string">"android.app.lib_name"</span> <span class="attr">android:value</span>=<span class="string">"native"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.MAIN"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.LAUNCHER"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">"com.a.sample.findmydex.MainActivity"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"com.a.sample.findmydex.MAIN"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>看了一下 Java 只有一个类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Placeholder</span> </span>&#123;</span><br><span class="line">    Placeholder() &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>先查看 NativeActivity 中的 onCreate 函数，其中在 pthread_create 里的第三个参数是对应的 MainActivity 的入口点，即 android_app_entry：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">fastcall <span class="title">ANativeActivity_onCreate</span><span class="params">(_DWORD *a1, <span class="keyword">int</span> a2, <span class="keyword">size_t</span> a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _DWORD *v3; <span class="comment">// r8</span></span><br><span class="line">  <span class="keyword">int</span> savedState; <span class="comment">// r10</span></span><br><span class="line">  <span class="keyword">size_t</span> savedStateSize; <span class="comment">// r9</span></span><br><span class="line">  <span class="keyword">int</span> activity; <span class="comment">// r0</span></span><br><span class="line">  __int64 v7; <span class="comment">// r2</span></span><br><span class="line">  <span class="keyword">char</span> *v8; <span class="comment">// r5</span></span><br><span class="line">  <span class="keyword">void</span> *v9; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">int</span> *v10; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">char</span> *v11; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">pthread_attr_t</span> attr; <span class="comment">// [sp+4h] [bp-30h]</span></span><br><span class="line"></span><br><span class="line">  v3 = a1;</span><br><span class="line">  savedState = a2;</span><br><span class="line">  savedStateSize = a3;</span><br><span class="line">  activity = *a1;</span><br><span class="line">  *(_DWORD *)(activity + <span class="number">20</span>) = sub_3000;</span><br><span class="line">  *(_DWORD *)activity = sub_305A;</span><br><span class="line">  *(_DWORD *)(activity + <span class="number">4</span>) = sub_3062;</span><br><span class="line">  *(_DWORD *)(activity + <span class="number">8</span>) = sub_306A;</span><br><span class="line">  *(_DWORD *)(activity + <span class="number">12</span>) = sub_30BE;</span><br><span class="line">  HIDWORD(v7) = sub_30EE;</span><br><span class="line">  *(_DWORD *)(activity + <span class="number">16</span>) = sub_30C6;</span><br><span class="line">  LODWORD(v7) = sub_30DE;</span><br><span class="line">  *(_DWORD *)(activity + <span class="number">56</span>) = sub_30CE;</span><br><span class="line">  *(_DWORD *)(activity + <span class="number">60</span>) = sub_30D6;</span><br><span class="line">  *(_QWORD *)(activity + <span class="number">24</span>) = v7;</span><br><span class="line">  *(_DWORD *)(activity + <span class="number">40</span>) = sub_30F4;</span><br><span class="line">  *(_DWORD *)(activity + <span class="number">44</span>) = sub_30FC;</span><br><span class="line">  *(_DWORD *)(activity + <span class="number">48</span>) = sub_3102;</span><br><span class="line">  v8 = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x94</span>u);</span><br><span class="line">  _aeabi_memclr4();</span><br><span class="line">  *((_DWORD *)v8 + <span class="number">3</span>) = v3;</span><br><span class="line">  pthread_mutex_init((<span class="keyword">pthread_mutex_t</span> *)(v8 + <span class="number">64</span>), <span class="number">0</span>);</span><br><span class="line">  pthread_cond_init((<span class="keyword">pthread_cond_t</span> *)(v8 + <span class="number">68</span>), <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( savedState )</span><br><span class="line">  &#123;</span><br><span class="line">    v9 = <span class="built_in">malloc</span>(savedStateSize);</span><br><span class="line">    *((_DWORD *)v8 + <span class="number">5</span>) = v9;</span><br><span class="line">    *((_DWORD *)v8 + <span class="number">6</span>) = savedStateSize;</span><br><span class="line">    _aeabi_memcpy(v9, savedState, savedStateSize);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( pipe(&amp;attr.__align + <span class="number">6</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    v10 = (<span class="keyword">int</span> *)_errno();</span><br><span class="line">    v11 = strerror(*v10);</span><br><span class="line">    _android_log_print(<span class="number">6</span>, <span class="string">"threaded_app"</span>, <span class="string">"could not create pipe: %s"</span>, v11);</span><br><span class="line">    v8 = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    *((_QWORD *)v8 + <span class="number">9</span>) = *((_QWORD *)&amp;attr.__align + <span class="number">3</span>);</span><br><span class="line">    pthread_attr_init(&amp;attr);</span><br><span class="line">    pthread_attr_setdetachstate(&amp;attr, <span class="number">1</span>);</span><br><span class="line">    pthread_create((<span class="keyword">pthread_t</span> *)v8 + <span class="number">20</span>, &amp;attr, (<span class="keyword">void</span> *(*)(<span class="keyword">void</span> *))android_app_entry, v8);</span><br><span class="line">    pthread_mutex_lock((<span class="keyword">pthread_mutex_t</span> *)(v8 + <span class="number">64</span>));</span><br><span class="line">    <span class="keyword">while</span> ( !*((_DWORD *)v8 + <span class="number">27</span>) )</span><br><span class="line">      pthread_cond_wait((<span class="keyword">pthread_cond_t</span> *)(v8 + <span class="number">68</span>), (<span class="keyword">pthread_mutex_t</span> *)(v8 + <span class="number">64</span>));</span><br><span class="line">    pthread_mutex_unlock((<span class="keyword">pthread_mutex_t</span> *)(v8 + <span class="number">64</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  v3[<span class="number">7</span>] = v8;</span><br><span class="line">  <span class="keyword">return</span> _stack_chk_guard - *(&amp;attr.__align + <span class="number">8</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 android_app_entry 中，在 android_app_destroy 上面可以找到对应的 MainActivity 函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">fastcall <span class="title">android_app_entry</span><span class="params">(<span class="keyword">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// r4</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// r1</span></span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// r5</span></span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">char</span> v5; <span class="comment">// [sp+8h] [bp-14h]</span></span><br><span class="line">  <span class="keyword">char</span> v6; <span class="comment">// [sp+Ah] [bp-12h]</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [sp+Ch] [bp-10h]</span></span><br><span class="line"></span><br><span class="line">  v1 = a1;</span><br><span class="line">  *(_DWORD *)(a1 + <span class="number">16</span>) = AConfiguration_new();</span><br><span class="line">  v2 = *(_DWORD *)(*(_DWORD *)(v1 + <span class="number">12</span>) + <span class="number">32</span>);</span><br><span class="line">  AConfiguration_fromAssetManager();</span><br><span class="line">  AConfiguration_getLanguage(*(_DWORD *)(v1 + <span class="number">16</span>), &amp;v6);</span><br><span class="line">  AConfiguration_getCountry(*(_DWORD *)(v1 + <span class="number">16</span>), &amp;v5);</span><br><span class="line">  *(_DWORD *)(v1 + <span class="number">84</span>) = <span class="number">1</span>;</span><br><span class="line">  *(_DWORD *)(v1 + <span class="number">88</span>) = v1;</span><br><span class="line">  *(_DWORD *)(v1 + <span class="number">92</span>) = sub_3344;</span><br><span class="line">  *(_DWORD *)(v1 + <span class="number">96</span>) = <span class="number">2</span>;</span><br><span class="line">  *(_DWORD *)(v1 + <span class="number">100</span>) = v1;</span><br><span class="line">  *(_DWORD *)(v1 + <span class="number">104</span>) = sub_3370;</span><br><span class="line">  v3 = ALooper_prepare(<span class="number">1</span>);</span><br><span class="line">  ALooper_addFd(v3, *(_DWORD *)(v1 + <span class="number">72</span>), <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, v1 + <span class="number">84</span>);</span><br><span class="line">  *(_DWORD *)(v1 + <span class="number">28</span>) = v3;</span><br><span class="line">  pthread_mutex_lock((<span class="keyword">pthread_mutex_t</span> *)(v1 + <span class="number">64</span>));</span><br><span class="line">  *(_DWORD *)(v1 + <span class="number">108</span>) = <span class="number">1</span>;</span><br><span class="line">  pthread_cond_broadcast((<span class="keyword">pthread_cond_t</span> *)(v1 + <span class="number">68</span>));</span><br><span class="line">  pthread_mutex_unlock((<span class="keyword">pthread_mutex_t</span> *)(v1 + <span class="number">64</span>));</span><br><span class="line">  j_android_main(v1);</span><br><span class="line">  android_app_destroy(v1);</span><br><span class="line">  pthread_mutex_lock((<span class="keyword">pthread_mutex_t</span> *)(v1 + <span class="number">64</span>));</span><br><span class="line">  <span class="keyword">if</span> ( *(_DWORD *)(v1 + <span class="number">32</span>) )</span><br><span class="line">    AInputQueue_detachLooper();</span><br><span class="line">  AConfiguration_delete(*(_DWORD *)(v1 + <span class="number">16</span>));</span><br><span class="line">  *(_DWORD *)(v1 + <span class="number">116</span>) = <span class="number">1</span>;</span><br><span class="line">  pthread_cond_broadcast((<span class="keyword">pthread_cond_t</span> *)(v1 + <span class="number">68</span>));</span><br><span class="line">  pthread_mutex_unlock((<span class="keyword">pthread_mutex_t</span> *)(v1 + <span class="number">64</span>));</span><br><span class="line">  result = _stack_chk_guard - v7;</span><br><span class="line">  <span class="keyword">if</span> ( _stack_chk_guard == v7 )</span><br><span class="line">    result = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>进入 MainActivity 之后，一开始有一段异或的数据：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">*(_DWORD *)filename = <span class="number">0x9D888DC6</span>;</span><br><span class="line">*(_DWORD *)&amp;filename[<span class="number">4</span>] = <span class="number">0x888DC688</span>;</span><br><span class="line">*(_DWORD *)&amp;filename[<span class="number">8</span>] = <span class="number">0x8AC6889D</span>;</span><br><span class="line">*(_DWORD *)&amp;filename[<span class="number">12</span>] = <span class="number">0x88C78486</span>;</span><br><span class="line">*(_DWORD *)&amp;filename[<span class="number">16</span>] = <span class="number">0x84889AC7</span>;</span><br><span class="line">*(_DWORD *)&amp;filename[<span class="number">20</span>] = <span class="number">0xC78C8599</span>;</span><br><span class="line">*(_DWORD *)&amp;filename[<span class="number">24</span>] = <span class="number">0x8D87808F</span>;</span><br><span class="line">*(_DWORD *)&amp;filename[<span class="number">28</span>] = <span class="number">0x8C8D9084</span>;</span><br><span class="line">*(_DWORD *)&amp;filename[<span class="number">32</span>] = <span class="number">0x808FC691</span>;</span><br><span class="line">*(_DWORD *)&amp;filename[<span class="number">36</span>] = <span class="number">0xC69A8C85</span>;</span><br><span class="line">*(_DWORD *)&amp;filename[<span class="number">40</span>] = <span class="number">0x9A88858A</span>;</span><br><span class="line">*(_DWORD *)&amp;filename[<span class="number">44</span>] = <span class="number">0xC79A8C9A</span>;</span><br><span class="line">*(_DWORD *)&amp;filename[<span class="number">48</span>] = <span class="number">0xE9918C8D</span>;</span><br><span class="line">filename[<span class="number">52</span>] = <span class="number">0</span>;</span><br><span class="line">*(_DWORD *)name = <span class="number">0x9D888DC6</span>;</span><br><span class="line">*(_DWORD *)&amp;name[<span class="number">4</span>] = <span class="number">0x888DC688</span>;</span><br><span class="line">*(_DWORD *)&amp;name[<span class="number">8</span>] = <span class="number">0x8AC6889D</span>;</span><br><span class="line">*(_DWORD *)&amp;name[<span class="number">12</span>] = <span class="number">0x88C78486</span>;</span><br><span class="line">*(_DWORD *)&amp;name[<span class="number">16</span>] = <span class="number">0x84889AC7</span>;</span><br><span class="line">*(_DWORD *)&amp;name[<span class="number">20</span>] = <span class="number">0xC78C8599</span>;</span><br><span class="line">*(_DWORD *)&amp;name[<span class="number">24</span>] = <span class="number">0x8D87808F</span>;</span><br><span class="line">*(_DWORD *)&amp;name[<span class="number">28</span>] = <span class="number">0x8C8D9084</span>;</span><br><span class="line">*(_DWORD *)&amp;name[<span class="number">32</span>] = <span class="number">0x808FC691</span>;</span><br><span class="line">*(_DWORD *)&amp;name[<span class="number">36</span>] = <span class="number">0xC69A8C85</span>;</span><br><span class="line">*(_DWORD *)&amp;name[<span class="number">40</span>] = <span class="number">0x918C8D86</span>;</span><br><span class="line">name[<span class="number">46</span>] = <span class="number">0</span>;</span><br><span class="line">i = <span class="number">1</span>;</span><br><span class="line">*(_WORD *)&amp;name[<span class="number">44</span>] = <span class="number">0xE9C6</span>u;</span><br><span class="line">filename[<span class="number">0</span>] = <span class="number">47</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">  filename[i] ^= <span class="number">0xE9</span>u;                       <span class="comment">// filename = '/data/data/com.a.sample.findmydex/files/classes.dex'</span></span><br><span class="line">  ++i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> ( i != <span class="number">53</span> );</span><br><span class="line">j = <span class="number">1</span>;</span><br><span class="line">name[<span class="number">0</span>] = <span class="number">47</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">  name[j] ^= <span class="number">0xE9</span>u;                           <span class="comment">// name = '/data/data/com.a.sample.findmydex/files/odex/'</span></span><br><span class="line">  ++j;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> ( j != <span class="number">47</span> );</span><br></pre></td></tr></table></figure>
<p>解密一下，可以发现是生成目标 dex 文件和 odex 的路径：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">word2bytes</span><span class="params">(w)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> [w &amp; <span class="number">0xFF</span>, (w &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>, (w &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>, w &gt;&gt; <span class="number">24</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bytes2word</span><span class="params">(bs)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> bs[<span class="number">0</span>] | bs[<span class="number">1</span>] &lt;&lt; <span class="number">8</span> | bs[<span class="number">2</span>] &lt;&lt; <span class="number">16</span> | bs[<span class="number">3</span>] &lt;&lt; <span class="number">24</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">words2byte</span><span class="params">(ws)</span>:</span></span><br><span class="line">    result = []</span><br><span class="line">    <span class="keyword">for</span> w <span class="keyword">in</span> ws:</span><br><span class="line">        temp = word2bytes(w)</span><br><span class="line">        <span class="keyword">for</span> b <span class="keyword">in</span> temp:</span><br><span class="line">            result.append(b)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bytes2words</span><span class="params">(bs)</span>:</span></span><br><span class="line">    result = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(bs) / <span class="number">4</span>):</span><br><span class="line">        temp = bytes2word(bs[<span class="number">4</span>*i:<span class="number">4</span>*i+<span class="number">4</span>])</span><br><span class="line">        result.append(temp)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">filename = [<span class="number">0x9D888DC6</span>, <span class="number">0x888DC688</span>, <span class="number">0x8AC6889D</span>, <span class="number">0x88C78486</span>, <span class="number">0x84889AC7</span>, <span class="number">0xC78C8599</span>, <span class="number">0x8D87808F</span>, <span class="number">0x8C8D9084</span>, <span class="number">0x808FC691</span>, <span class="number">0xC69A8C85</span>, <span class="number">0x9A88858A</span>, <span class="number">0xC79A8C9A</span>, <span class="number">0xE9918C8D</span>]</span><br><span class="line">name = [<span class="number">0x9D888DC6</span>, <span class="number">0x888DC688</span>, <span class="number">0x8AC6889D</span>, <span class="number">0x88C78486</span>, <span class="number">0x84889AC7</span>, <span class="number">0xC78C8599</span>, <span class="number">0x8D87808F</span>, <span class="number">0x8C8D9084</span>, <span class="number">0x808FC691</span>, <span class="number">0xC69A8C85</span>, <span class="number">0x918C8D86</span>, <span class="number">0x0000E9C6</span>]</span><br><span class="line">filename = words2byte(filename)</span><br><span class="line">name = words2byte(name)</span><br><span class="line">filename = chr(<span class="number">47</span>) + <span class="string">''</span>.join(list(map(<span class="keyword">lambda</span> c: chr(c ^ <span class="number">0xE9</span>), filename[<span class="number">1</span>:])))</span><br><span class="line">name = chr(<span class="number">47</span>) + <span class="string">''</span>.join(list(map(<span class="keyword">lambda</span> c: chr(c ^ <span class="number">0xE9</span>), name[<span class="number">1</span>:])))</span><br><span class="line"><span class="keyword">print</span> filename</span><br><span class="line"><span class="comment"># /data/data/com.a.sample.findmydex/files/classes.dex</span></span><br><span class="line"><span class="keyword">print</span> name</span><br><span class="line"><span class="comment"># /data/data/com.a.sample.findmydex/files/odex/</span></span><br></pre></td></tr></table></figure>
<p>然后接下来，可以看到一些涉及到 OpenGL 库的函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">  _android_log_print(<span class="number">4</span>, <span class="string">"FindMyDex"</span>, <span class="string">"Can you shake your phone 100 times in 10 seconds?"</span>);</span><br><span class="line">  v10 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v12 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> ( !v30 )</span><br><span class="line">        v12 = <span class="number">-1</span>;</span><br><span class="line">      v13 = ALooper_pollAll(v12, <span class="number">0</span>, &amp;v25, &amp;v24);<span class="comment">// get time</span></span><br><span class="line">      <span class="keyword">if</span> ( v13 &gt;= <span class="number">0</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v30 )</span><br><span class="line">      &#123;</span><br><span class="line">        v11 = v31 + <span class="number">0.01</span>;</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="keyword">float</span>)(v31 + <span class="number">0.01</span>) &gt; <span class="number">1.0</span> )</span><br><span class="line">          v11 = <span class="number">0.0</span>;</span><br><span class="line">        v31 = v11;</span><br><span class="line">        sub_2C14((<span class="keyword">int</span>)&amp;v26);                    <span class="comment">// OpenGL</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> __<span class="function">fastcall <span class="title">sub_2C14</span><span class="params">(<span class="keyword">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// r4</span></span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// r0</span></span><br><span class="line"></span><br><span class="line">  v1 = a1;</span><br><span class="line">  result = *(_DWORD *)(a1 + <span class="number">20</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !result )</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  glClearColor(</span><br><span class="line">    (<span class="keyword">float</span>)*(<span class="keyword">signed</span> <span class="keyword">int</span> *)(v1 + <span class="number">44</span>) / (<span class="keyword">float</span>)*(<span class="keyword">signed</span> <span class="keyword">int</span> *)(v1 + <span class="number">32</span>),<span class="comment">// red</span></span><br><span class="line">    *(GLclampf *)(v1 + <span class="number">40</span>),                     <span class="comment">// green</span></span><br><span class="line">    (<span class="keyword">float</span>)*(<span class="keyword">signed</span> <span class="keyword">int</span> *)(v1 + <span class="number">48</span>) / (<span class="keyword">float</span>)*(<span class="keyword">signed</span> <span class="keyword">int</span> *)(v1 + <span class="number">36</span>),<span class="comment">// blue</span></span><br><span class="line">    <span class="number">1.0</span>);</span><br><span class="line">  glClear(<span class="number">0x4000</span>u);</span><br><span class="line">  result = j_eglSwapBuffers(*(_QWORD *)(v1 + <span class="number">20</span>), *(_QWORD *)(v1 + <span class="number">20</span>) &gt;&gt; <span class="number">32</span>);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这部分不去仔细看，可以直接根据 log 来判断程序的流程，可以判断出是要求在 10 秒内摇 100 次手机。在 <code>(times - 1) &lt;= 88</code> 处可以看到开始对数据进行解压缩处理。在后面 <code>times == 100</code>，可以判断是达到了 100 次后，开始对将数据输出到文件中：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">  _android_log_print(<span class="number">4</span>, <span class="string">"FindMyDex"</span>, <span class="string">"Can you shake your phone 100 times in 10 seconds?"</span>);</span><br><span class="line">...</span><br><span class="line">            _android_log_print(<span class="number">4</span>, <span class="string">"FindMyDex"</span>, <span class="string">"Oh yeah~ You Got it~ %d times to go~"</span>, <span class="number">99</span> - v10);</span><br><span class="line">...</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(times - <span class="number">1</span>) &lt;= <span class="number">88</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v10 = times;</span><br><span class="line">          v15 = times / <span class="number">10</span>;</span><br><span class="line">          <span class="keyword">if</span> ( times % <span class="number">10</span> == <span class="number">9</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            v16 = size_1;</span><br><span class="line">            v17 = (<span class="keyword">signed</span> <span class="keyword">int</span>)size_1 / <span class="number">10</span>;</span><br><span class="line">            v18 = (v15 + <span class="number">1</span>) * ((<span class="keyword">signed</span> <span class="keyword">int</span>)size_1 / <span class="number">10</span>);</span><br><span class="line">            <span class="keyword">if</span> ( (<span class="keyword">signed</span> <span class="keyword">int</span>)size_1 / <span class="number">10</span> * v15 &lt; v18 )</span><br><span class="line">            &#123;</span><br><span class="line">              v19 = &amp;data[v17 * v15];</span><br><span class="line">              <span class="keyword">do</span></span><br><span class="line">              &#123;</span><br><span class="line">                --v17;</span><br><span class="line">                *v19++ ^= times;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">while</span> ( v17 );</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> ( times == <span class="number">89</span> )</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="keyword">while</span> ( v18 &lt; (<span class="keyword">signed</span> <span class="keyword">int</span>)v16 )</span><br><span class="line">                data[v18++] ^= <span class="number">0x59</span>u;</span><br><span class="line">            &#125;</span><br><span class="line">            v10 = times + <span class="number">1</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( times == <span class="number">100</span> )                     <span class="comment">// reach the target</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( (<span class="keyword">signed</span> <span class="keyword">int</span>)(time(<span class="number">0</span>) - v6) &gt; <span class="number">9</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            _android_log_print(<span class="number">4</span>, <span class="string">"FindMyDex"</span>, <span class="string">"OH~ You are too slow. Please try again"</span>);</span><br><span class="line">            _aeabi_memcpy(data, &amp;data_1, size_1);</span><br><span class="line">            v10 = <span class="number">0</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          &#123;</span><br><span class="line">            v20 = v6;</span><br><span class="line">            <span class="keyword">if</span> ( uncompress(dest, &amp;destLen, data, (uLong)size_1) )<span class="comment">// uncompress data</span></span><br><span class="line">              _android_log_print(<span class="number">5</span>, <span class="string">"FindMyDex"</span>, <span class="string">"Dangerous operation detected."</span>);</span><br><span class="line">            v21 = open(filename, <span class="number">577</span>, <span class="number">511</span>);</span><br><span class="line">            <span class="keyword">if</span> ( !v21 )</span><br><span class="line">              _android_log_print(<span class="number">5</span>, <span class="string">"FindMyDex"</span>, <span class="string">"Something wrong with the permission."</span>);</span><br><span class="line">            write(v21, dest, destLen);</span><br><span class="line">            close(v21);</span><br><span class="line">            <span class="built_in">free</span>(dest);</span><br><span class="line">            <span class="built_in">free</span>(data);</span><br><span class="line">            <span class="keyword">if</span> ( access(name, <span class="number">0</span>) &amp;&amp; mkdir(name, <span class="number">0x1FF</span>u) )</span><br><span class="line">              _android_log_print(<span class="number">5</span>, <span class="string">"FindMyDex"</span>, <span class="string">"Something wrong with the permission.."</span>);</span><br><span class="line">            sub_2368((<span class="keyword">int</span>)v1);</span><br><span class="line">            remove(filename);</span><br><span class="line">            _android_log_print(<span class="number">4</span>, <span class="string">"FindMyDex"</span>, <span class="string">"Congratulations!! You made it!"</span>);</span><br><span class="line">            sub_2250(v1);</span><br><span class="line">            v10 = <span class="number">0x80000000</span>;</span><br><span class="line">            v6 = v20;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>用 IDC 脚本把数据 dump 下来：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> fp, start, end, len, b;</span><br><span class="line">    fp = fopen(<span class="string">"dump.data"</span>, <span class="string">"wb"</span>);</span><br><span class="line">    start = <span class="number">0x7004</span>;</span><br><span class="line">    len = <span class="number">0x3CA10</span>;</span><br><span class="line">    end = start + len;</span><br><span class="line">    <span class="keyword">for</span> (b = start; b &lt; end; b++) &#123;</span><br><span class="line">        fputc(Byte(b), fp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后实现一下对 dex 文件的解压缩过程：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'dump.data'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.read()</span><br><span class="line">data = [ord(c) <span class="keyword">for</span> c <span class="keyword">in</span> data]</span><br><span class="line">size = <span class="number">0x3CA10</span></span><br><span class="line"><span class="keyword">for</span> times <span class="keyword">in</span> range(<span class="number">90</span>):</span><br><span class="line">    v15 = times / <span class="number">10</span></span><br><span class="line">    <span class="keyword">if</span> times % <span class="number">10</span> == <span class="number">9</span>:</span><br><span class="line">        v16 = size</span><br><span class="line">        v17 = size / <span class="number">10</span></span><br><span class="line">        v18 = (v15 + <span class="number">1</span>) * (size / <span class="number">10</span>)</span><br><span class="line">        <span class="keyword">if</span> size / <span class="number">10</span> * v15 &lt; v18:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(v17):</span><br><span class="line">                data[v17 * v15 + i] ^= times</span><br><span class="line">        <span class="keyword">if</span> times == <span class="number">89</span>:</span><br><span class="line">            <span class="keyword">while</span> v18 - v16 &lt; <span class="number">0</span>:</span><br><span class="line">                data[v18] ^= <span class="number">0x59</span></span><br><span class="line">                v18 += <span class="number">1</span></span><br><span class="line">data = <span class="string">''</span>.join([chr(c) <span class="keyword">for</span> c <span class="keyword">in</span> data])</span><br><span class="line">data = zlib.decompress(data)</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'dump.dex'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> data:</span><br><span class="line">        f.write(c)</span><br></pre></td></tr></table></figure>
<p>接下来用 JEB 对 dex 文件进行分析。首先在 MainActivity 中，变量 m 是密文，onCreate 中调用了 a 类。函数 b 则是一个加密函数，其中涉及到了 b 类中函数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.a.sample.findmydex;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.a.u;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">u</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] m;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        MainActivity.m = <span class="keyword">new</span> <span class="keyword">byte</span>[]&#123;-<span class="number">120</span>, <span class="number">77</span>, -<span class="number">14</span>, -<span class="number">38</span>, <span class="number">17</span>, <span class="number">5</span>, -<span class="number">42</span>, <span class="number">44</span>, -<span class="number">32</span>, <span class="number">109</span>, <span class="number">85</span>, <span class="number">0x1F</span>, <span class="number">24</span>, -<span class="number">91</span>, -<span class="number">112</span>, -<span class="number">83</span>, <span class="number">0x40</span>, -<span class="number">83</span>, -<span class="number">128</span>, <span class="number">84</span>, <span class="number">5</span>, -<span class="number">94</span>, -<span class="number">98</span>, -<span class="number">30</span>, <span class="number">18</span>, <span class="number">70</span>, -<span class="number">26</span>, <span class="number">71</span>, <span class="number">5</span>, -<span class="number">99</span>, -<span class="number">62</span>, -<span class="number">58</span>, <span class="number">0x75</span>, <span class="number">29</span>, -<span class="number">44</span>, <span class="number">6</span>, <span class="number">0x70</span>, -<span class="number">4</span>, <span class="number">81</span>, <span class="number">84</span>, <span class="number">9</span>, <span class="number">22</span>, -<span class="number">51</span>, <span class="number">0x5F</span>, -<span class="number">34</span>, <span class="number">12</span>, <span class="number">0x2F</span>, <span class="number">77</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MainActivity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">byte</span>[] a(String arg1, String arg2) &#123;</span><br><span class="line">        <span class="keyword">return</span> MainActivity.b(arg1, arg2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] b(String arg7, String arg8) &#123;</span><br><span class="line">        <span class="keyword">byte</span>[] v0_1;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            BufferedInputStream v2 = <span class="keyword">new</span> BufferedInputStream(<span class="keyword">new</span> ByteArrayInputStream(arg7.getBytes()));</span><br><span class="line">            <span class="keyword">byte</span>[] v1 = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">16</span>];</span><br><span class="line">            ArrayList v3 = <span class="keyword">new</span> ArrayList();</span><br><span class="line">            Object v4 = b.a(arg8.getBytes()); <span class="comment">// 处理密钥</span></span><br><span class="line">            <span class="keyword">while</span>(v2.read(v1, <span class="number">0</span>, <span class="number">16</span>) != -<span class="number">1</span>) &#123; <span class="comment">// 循环加密，采用ECB模式</span></span><br><span class="line">                v3.add(b.a(v1, <span class="number">0</span>, v4));</span><br><span class="line">                v1 = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">16</span>];</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ByteBuffer v2_1 = ByteBuffer.allocate(v3.size() * <span class="number">16</span>); <span class="comment">// 转换成字节数组</span></span><br><span class="line">            Object[] v3_1 = v3.toArray();</span><br><span class="line">            <span class="keyword">int</span> v4_1 = v3_1.length;</span><br><span class="line">            <span class="keyword">int</span> v1_1;</span><br><span class="line">            <span class="keyword">for</span>(v1_1 = <span class="number">0</span>; v1_1 &lt; v4_1; ++v1_1) &#123;</span><br><span class="line">                v2_1.put(v3_1[v1_1]);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            v0_1 = v2_1.array();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(Exception v0) &#123;</span><br><span class="line">            v0_1 = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> v0_1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">byte</span>[] i() &#123; <span class="comment">// Cipheretxt</span></span><br><span class="line">        <span class="keyword">return</span> MainActivity.m;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle arg4)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(arg4);</span><br><span class="line">        <span class="keyword">this</span>.setContentView(<span class="number">0x7F04001A</span>); <span class="comment">// activity_main</span></span><br><span class="line">        <span class="keyword">this</span>.findViewById(<span class="number">0x7F0B0055</span>).setOnClickListener(<span class="keyword">new</span> a(<span class="keyword">this</span>, <span class="keyword">this</span>.findViewById(<span class="number">0x7F0B0054</span>), ((Context)<span class="keyword">this</span>))); <span class="comment">// button | edit_text</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>类 a 中设置了一个监听按钮的事件，并将输入和指定的字符串作为参数传入 MainActivity 的函数 a。并与密文进行比较：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.a.sample.findmydex;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.view.View$OnClickListener;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">a</span> <span class="keyword">implements</span> <span class="title">View</span>$<span class="title">OnClickListener</span> </span>&#123;</span><br><span class="line">    a(MainActivity arg1, EditText arg2, Context arg3) &#123;</span><br><span class="line">        <span class="keyword">this</span>.c = arg1;</span><br><span class="line">        <span class="keyword">this</span>.a = arg2;</span><br><span class="line">        <span class="keyword">this</span>.b = arg3;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View arg5)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(Arrays.equals(MainActivity.a(<span class="keyword">this</span>.a.getText().toString(), <span class="keyword">this</span>.c.getString(<span class="number">0x7F060023</span>)), MainActivity.i())) &#123; <span class="comment">// I have a male fish and a female fish.</span></span><br><span class="line">            Toast.makeText(<span class="keyword">this</span>.b, <span class="keyword">this</span>.c.getString(<span class="number">0x7F060025</span>), <span class="number">1</span>).show(); <span class="comment">// Yes! You got me! :)</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            Toast.makeText(<span class="keyword">this</span>.b, <span class="keyword">this</span>.c.getString(<span class="number">0x7F060022</span>), <span class="number">1</span>).show(); <span class="comment">// NO~ You don't get me~ T_T</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>b 类的 a 函数主要将数组的长度补齐成 8 的倍数，并调用 b 函数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">a</span><span class="params">(<span class="keyword">byte</span>[] arg5)</span> </span>&#123; <span class="comment">// 补齐块</span></span><br><span class="line">    Object v0_3;</span><br><span class="line">    <span class="keyword">int</span> v1 = <span class="number">0x20</span>;</span><br><span class="line">    <span class="keyword">int</span> v0 = <span class="number">0</span>;</span><br><span class="line">    Class v2 = b.class;</span><br><span class="line">    __monitor_enter(v2);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(arg5.length &gt; v1 || arg5.length % <span class="number">8</span> != <span class="number">0</span>) &#123; <span class="comment">// 长度大于32或不是8的倍数</span></span><br><span class="line">            <span class="keyword">if</span>(arg5.length &lt;= v1) &#123;</span><br><span class="line">                v1 = arg5.length;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>((v1 &amp; <span class="number">7</span>) &gt; <span class="number">0</span>) &#123; <span class="comment">// 判断数组长度是否是8的倍数，不是的话补齐</span></span><br><span class="line">                v0 = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">byte</span>[] v0_2 = <span class="keyword">new</span> <span class="keyword">byte</span>[v0 * <span class="number">8</span> + v1];</span><br><span class="line">            System.arraycopy(arg5, <span class="number">0</span>, v0_2, <span class="number">0</span>, v1);</span><br><span class="line">            arg5 = v0_2;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        v0_3 = b.b(arg5);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span>(Throwable v0_1) &#123;</span><br><span class="line">        __monitor_exit(v2);</span><br><span class="line">        <span class="keyword">throw</span> v0_1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    __monitor_exit(v2);</span><br><span class="line">    <span class="keyword">return</span> v0_3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>b 类中的 b 函数是一个处理密钥的函数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Object <span class="title">b</span><span class="params">(<span class="keyword">byte</span>[] arg19)</span> </span>&#123; <span class="comment">// 处理密钥</span></span><br><span class="line">    Object[] v1_2;</span><br><span class="line">    <span class="keyword">int</span>[] v13;</span><br><span class="line">    <span class="keyword">int</span> v10_1;</span><br><span class="line">    <span class="keyword">int</span> v9_1;</span><br><span class="line">    <span class="keyword">int</span> v8_1;</span><br><span class="line">    <span class="keyword">int</span>[] v11_1;</span><br><span class="line">    <span class="keyword">int</span> v12;</span><br><span class="line">    <span class="keyword">int</span> v3;</span><br><span class="line">    <span class="keyword">int</span> v1_1;</span><br><span class="line">    <span class="keyword">int</span> v5;</span><br><span class="line">    <span class="keyword">int</span> v4;</span><br><span class="line">    Class v6 = b.class;</span><br><span class="line">    __monitor_enter(v6);</span><br><span class="line">    <span class="keyword">if</span>(arg19 != <span class="keyword">null</span>) &#123;</span><br><span class="line">        goto label_10;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> InvalidKeyException(<span class="string">"Empty key"</span>);</span><br><span class="line">    label_10:</span><br><span class="line">        v4 = arg19.length;</span><br><span class="line">        <span class="keyword">if</span>(v4 != <span class="number">8</span> &amp;&amp; v4 != <span class="number">16</span> &amp;&amp; v4 != <span class="number">24</span> &amp;&amp; v4 != <span class="number">0x20</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> InvalidKeyException(<span class="string">"Incorrect key length"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> v7 = v4 / <span class="number">8</span>;</span><br><span class="line">        v5 = <span class="number">40</span>;</span><br><span class="line">        <span class="keyword">int</span>[] v8 = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">4</span>];</span><br><span class="line">        <span class="keyword">int</span>[] v9 = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">4</span>];</span><br><span class="line">        <span class="keyword">int</span>[] v10 = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">4</span>];</span><br><span class="line">        v1_1 = <span class="number">0</span>;</span><br><span class="line">        v3 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> v2;</span><br><span class="line">        <span class="keyword">for</span>(v2 = v7 - <span class="number">1</span>; v3 &lt; <span class="number">4</span>; --v2) &#123;</span><br><span class="line">            <span class="keyword">if</span>(v1_1 &gt;= v4) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> v11 = v1_1 + <span class="number">1</span>;</span><br><span class="line">            v12 = v11 + <span class="number">1</span>;</span><br><span class="line">            v1_1 = arg19[v1_1] &amp; <span class="number">0xFF</span> | (arg19[v11] &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">8</span>;</span><br><span class="line">            v11 = v12 + <span class="number">1</span>;</span><br><span class="line">            v1_1 |= (arg19[v12] &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">16</span>;</span><br><span class="line">            v12 = v11 + <span class="number">1</span>;</span><br><span class="line">            v8[v3] = v1_1 | (arg19[v11] &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">24</span>;</span><br><span class="line">            v1_1 = v12 + <span class="number">1</span>;</span><br><span class="line">            v11 = arg19[v12] &amp; <span class="number">0xFF</span>;</span><br><span class="line">            v12 = v1_1 + <span class="number">1</span>;</span><br><span class="line">            v1_1 = (arg19[v1_1] &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">8</span> | v11;</span><br><span class="line">            v11 = v12 + <span class="number">1</span>;</span><br><span class="line">            v12 = (arg19[v12] &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">16</span> | v1_1;</span><br><span class="line">            v1_1 = v11 + <span class="number">1</span>;</span><br><span class="line">            v9[v3] = (arg19[v11] &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">24</span> | v12;</span><br><span class="line">            v10[v2] = b.a(v8[v3], v9[v3]);</span><br><span class="line">            ++v3;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        v11_1 = <span class="keyword">new</span> <span class="keyword">int</span>[v5];</span><br><span class="line">        v1_1 = <span class="number">0</span>;</span><br><span class="line">        v2 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(v2 &lt; <span class="number">20</span>) &#123;</span><br><span class="line">            v3 = b.a(v7, v1_1, v8);</span><br><span class="line">            v4 = b.a(v7, <span class="number">0x1010101</span> + v1_1, v9);</span><br><span class="line">            v4 = v4 &gt;&gt;&gt; <span class="number">24</span> | v4 &lt;&lt; <span class="number">8</span>;</span><br><span class="line">            v3 += v4;</span><br><span class="line">            v11_1[v2 * <span class="number">2</span>] = v3;</span><br><span class="line">            v3 += v4;</span><br><span class="line">            v11_1[v2 * <span class="number">2</span> + <span class="number">1</span>] = v3 &gt;&gt;&gt; <span class="number">23</span> | v3 &lt;&lt; <span class="number">9</span>;</span><br><span class="line">            ++v2;</span><br><span class="line">            v1_1 += <span class="number">0x2020202</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        v8_1 = v10[<span class="number">0</span>];</span><br><span class="line">        v9_1 = v10[<span class="number">1</span>];</span><br><span class="line">        v12 = v10[<span class="number">2</span>];</span><br><span class="line">        v10_1 = v10[<span class="number">3</span>];</span><br><span class="line">        v13 = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">0x400</span>];</span><br><span class="line">        v2 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">        label_120:</span><br><span class="line">            <span class="keyword">if</span>(v2 &gt;= <span class="number">0x100</span>) &#123;</span><br><span class="line">                goto label_324;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">switch</span>(v7 &amp; <span class="number">3</span>) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">0</span>: &#123;</span><br><span class="line">                    goto label_183;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>: &#123;</span><br><span class="line">                    goto label_126;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>: &#123;</span><br><span class="line">                    goto label_332;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">3</span>: &#123;</span><br><span class="line">                    goto label_337;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            goto label_124;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span>(Throwable v1) &#123;</span><br><span class="line">        goto label_8;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">label_337:</span><br><span class="line">    v1_1 = v2;</span><br><span class="line">    v3 = v2;</span><br><span class="line">    v4 = v2;</span><br><span class="line">    v5 = v2;</span><br><span class="line">    goto label_211;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">    label_183:</span><br><span class="line">        v5 = b.a[<span class="number">1</span>][v2] &amp; <span class="number">0xFF</span> ^ b.e(v10_1);</span><br><span class="line">        v4 = b.a[<span class="number">0</span>][v2] &amp; <span class="number">0xFF</span> ^ b.f(v10_1);</span><br><span class="line">        v3 = b.g(v10_1) ^ b.a[<span class="number">0</span>][v2] &amp; <span class="number">0xFF</span>;</span><br><span class="line">        v1_1 = b.a[<span class="number">1</span>][v2] &amp; <span class="number">0xFF</span> ^ b.h(v10_1);</span><br><span class="line">    label_211:</span><br><span class="line">        v5 = b.a[<span class="number">1</span>][v5] &amp; <span class="number">0xFF</span> ^ b.e(v12);</span><br><span class="line">        v4 = b.a[<span class="number">1</span>][v4] &amp; <span class="number">0xFF</span> ^ b.f(v12);</span><br><span class="line">        v3 = b.a[<span class="number">0</span>][v3] &amp; <span class="number">0xFF</span> ^ b.g(v12);</span><br><span class="line">        v1_1 = b.a[<span class="number">0</span>][v1_1] &amp; <span class="number">0xFF</span> ^ b.h(v12);</span><br><span class="line">        goto label_239;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span>(Throwable v1) &#123;</span><br><span class="line">        goto label_8;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">label_332:</span><br><span class="line">    v1_1 = v2;</span><br><span class="line">    v3 = v2;</span><br><span class="line">    v4 = v2;</span><br><span class="line">    v5 = v2;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">    label_239:</span><br><span class="line">        v13[v2 * <span class="number">2</span>] = b.b[<span class="number">0</span>][b.a[<span class="number">0</span>][b.a[<span class="number">0</span>][v5] &amp; <span class="number">0xFF</span> ^ b.e(v9_1)] &amp; <span class="number">0xFF</span> ^ b.e(v8_1)];</span><br><span class="line">        v13[v2 * <span class="number">2</span> + <span class="number">1</span>] = b.b[<span class="number">1</span>][b.a[<span class="number">0</span>][b.a[<span class="number">1</span>][v4] &amp; <span class="number">0xFF</span> ^ b.f(v9_1)] &amp; <span class="number">0xFF</span> ^ b.f(v8_1)];</span><br><span class="line">        v13[v2 * <span class="number">2</span> + <span class="number">0x200</span>] = b.b[<span class="number">2</span>][b.a[<span class="number">1</span>][b.a[<span class="number">0</span>][v3] &amp; <span class="number">0xFF</span> ^ b.g(v9_1)] &amp; <span class="number">0xFF</span> ^ b.g(v8_1)];</span><br><span class="line">        v13[v2 * <span class="number">2</span> + <span class="number">0x201</span>] = b.b[<span class="number">3</span>][b.a[<span class="number">1</span>][b.a[<span class="number">1</span>][v1_1] &amp; <span class="number">0xFF</span> ^ b.h(v9_1)] &amp; <span class="number">0xFF</span> ^ b.h(v8_1)];</span><br><span class="line">        goto label_124;</span><br><span class="line">    label_126:</span><br><span class="line">        v13[v2 * <span class="number">2</span>] = b.b[<span class="number">0</span>][b.a[<span class="number">0</span>][v2] &amp; <span class="number">0xFF</span> ^ b.e(v8_1)];</span><br><span class="line">        v13[v2 * <span class="number">2</span> + <span class="number">1</span>] = b.b[<span class="number">1</span>][b.a[<span class="number">0</span>][v2] &amp; <span class="number">0xFF</span> ^ b.f(v8_1)];</span><br><span class="line">        v13[v2 * <span class="number">2</span> + <span class="number">0x200</span>] = b.b[<span class="number">2</span>][b.a[<span class="number">1</span>][v2] &amp; <span class="number">0xFF</span> ^ b.g(v8_1)];</span><br><span class="line">        v13[v2 * <span class="number">2</span> + <span class="number">0x201</span>] = b.b[<span class="number">3</span>][b.a[<span class="number">1</span>][v2] &amp; <span class="number">0xFF</span> ^ b.h(v8_1)];</span><br><span class="line">    label_124:</span><br><span class="line">        ++v2;</span><br><span class="line">        goto label_120;</span><br><span class="line">    label_324:</span><br><span class="line">        v1_2 = <span class="keyword">new</span> Object[]&#123;v13, v11_1&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span>(Throwable v1) &#123;</span><br><span class="line">        goto label_8;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    __monitor_exit(v6);</span><br><span class="line">    <span class="keyword">return</span> v1_2;</span><br><span class="line">label_8:</span><br><span class="line">    __monitor_exit(v6);</span><br><span class="line">    <span class="keyword">throw</span> v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个 a 函数判断传入的字节数组、、密钥都不为空，并调用 b 函数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] a(<span class="keyword">byte</span>[] arg1, <span class="keyword">int</span> arg2, Object arg3) &#123;</span><br><span class="line">    <span class="keyword">byte</span>[] v0 = arg1 == <span class="keyword">null</span> || arg3 == <span class="keyword">null</span> || arg2 &lt; <span class="number">0</span> ? <span class="keyword">null</span> : b.b(arg1, arg2, arg3);</span><br><span class="line">    <span class="keyword">return</span> v0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>b 函数应该就是对数据的加密过程，明显是个 16 次轮函数的分组密码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] b(<span class="keyword">byte</span>[] arg12, <span class="keyword">int</span> arg13, Object arg14) &#123;</span><br><span class="line">    <span class="keyword">int</span>[] v0 = arg14[<span class="number">0</span>];</span><br><span class="line">    Object v1 = arg14[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">int</span> v2 = arg13 + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> v4 = v2 + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> v3 = v4 + <span class="number">1</span>;</span><br><span class="line">    v2 = (arg12[v2] &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">8</span> | arg12[arg13] &amp; <span class="number">0xFF</span> | (arg12[v4] &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">16</span>;</span><br><span class="line">    v4 = v3 + <span class="number">1</span>;</span><br><span class="line">    v2 |= (arg12[v3] &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">24</span>;</span><br><span class="line">    v3 = v4 + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> v5 = v3 + <span class="number">1</span>;</span><br><span class="line">    v3 = (arg12[v3] &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">8</span> | arg12[v4] &amp; <span class="number">0xFF</span>;</span><br><span class="line">    v4 = v5 + <span class="number">1</span>;</span><br><span class="line">    v3 |= (arg12[v5] &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">16</span>;</span><br><span class="line">    v5 = v4 + <span class="number">1</span>;</span><br><span class="line">    v3 |= (arg12[v4] &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">24</span>;</span><br><span class="line">    v4 = v5 + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> v6 = v4 + <span class="number">1</span>;</span><br><span class="line">    v4 = (arg12[v4] &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">8</span> | arg12[v5] &amp; <span class="number">0xFF</span>;</span><br><span class="line">    v5 = v6 + <span class="number">1</span>;</span><br><span class="line">    v4 |= (arg12[v6] &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">16</span>;</span><br><span class="line">    v6 = v5 + <span class="number">1</span>;</span><br><span class="line">    v4 |= (arg12[v5] &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">24</span>;</span><br><span class="line">    v5 = v6 + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> v7 = v5 + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> v8 = (arg12[v5] &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">8</span> | arg12[v6] &amp; <span class="number">0xFF</span> | (arg12[v7] &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">16</span> | (arg12[v7 + <span class="number">1</span>] &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">24</span>;</span><br><span class="line">    v7 = v2 ^ v1[<span class="number">0</span>];</span><br><span class="line">    v6 = v3 ^ v1[<span class="number">1</span>];</span><br><span class="line">    v5 = v4 ^ v1[<span class="number">2</span>];</span><br><span class="line">    v4 = v8 ^ v1[<span class="number">3</span>];</span><br><span class="line">    v3 = <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">for</span>(v2 = <span class="number">0</span>; v2 &lt; <span class="number">16</span>; v2 += <span class="number">2</span>) &#123;</span><br><span class="line">        v8 = b.a(v0, v7, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">int</span> v9 = b.a(v0, v6, <span class="number">3</span>);</span><br><span class="line">        <span class="keyword">int</span> v11 = v3 + <span class="number">1</span>;</span><br><span class="line">        v3 = v1[v3] + (v8 + v9) ^ v5;</span><br><span class="line">        v5 = v3 &gt;&gt;&gt; <span class="number">1</span> | v3 &lt;&lt; <span class="number">0x1F</span>;</span><br><span class="line">        v3 = v4 &lt;&lt; <span class="number">1</span> | v4 &gt;&gt;&gt; <span class="number">0x1F</span>;</span><br><span class="line">        v4 = v9 * <span class="number">2</span> + v8;</span><br><span class="line">        v8 = v11 + <span class="number">1</span>;</span><br><span class="line">        v4 = v4 + v1[v11] ^ v3;</span><br><span class="line">        v3 = b.a(v0, v5, <span class="number">0</span>);</span><br><span class="line">        v9 = b.a(v0, v4, <span class="number">3</span>);</span><br><span class="line">        v11 = v8 + <span class="number">1</span>;</span><br><span class="line">        v7 ^= v1[v8] + (v3 + v9);</span><br><span class="line">        v7 = v7 &lt;&lt; <span class="number">0x1F</span> | v7 &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">        v8 = v9 * <span class="number">2</span> + v3;</span><br><span class="line">        v3 = v11 + <span class="number">1</span>;</span><br><span class="line">        v6 = (v6 &gt;&gt;&gt; <span class="number">0x1F</span> | v6 &lt;&lt; <span class="number">1</span>) ^ v8 + v1[v11];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> v0_1 = v1[<span class="number">4</span>] ^ v5;</span><br><span class="line">    v2 = v1[<span class="number">5</span>] ^ v4;</span><br><span class="line">    v3 = v1[<span class="number">6</span>] ^ v7;</span><br><span class="line">    <span class="keyword">int</span> v1_1 = v1[<span class="number">7</span>] ^ v6;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">byte</span>[]&#123;((<span class="keyword">byte</span>)v0_1), ((<span class="keyword">byte</span>)(v0_1 &gt;&gt;&gt; <span class="number">8</span>)), ((<span class="keyword">byte</span>)(v0_1 &gt;&gt;&gt; <span class="number">16</span>)), ((<span class="keyword">byte</span>)(v0_1 &gt;&gt;&gt; <span class="number">24</span>)), ((<span class="keyword">byte</span>)v2), ((<span class="keyword">byte</span>)(v2 &gt;&gt;&gt; <span class="number">8</span>)), ((<span class="keyword">byte</span>)(v2 &gt;&gt;&gt; <span class="number">16</span>)), ((<span class="keyword">byte</span>)(v2 &gt;&gt;&gt; <span class="number">24</span>)), ((<span class="keyword">byte</span>)v3), ((<span class="keyword">byte</span>)(v3 &gt;&gt;&gt; <span class="number">8</span>)), ((<span class="keyword">byte</span>)(v3 &gt;&gt;&gt; <span class="number">16</span>)), ((<span class="keyword">byte</span>)(v3 &gt;&gt;&gt; <span class="number">24</span>)), ((<span class="keyword">byte</span>)v1_1), ((<span class="keyword">byte</span>)(v1_1 &gt;&gt;&gt; <span class="number">8</span>)), ((<span class="keyword">byte</span>)(v1_1 &gt;&gt;&gt; <span class="number">16</span>)), ((<span class="keyword">byte</span>)(v1_1 &gt;&gt;&gt; <span class="number">24</span>))&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>分组密码可以去找一下特征，看到了 b 类的头上定义了两个数据，转成 16 进制之后拿去搜一下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">v0[<span class="number">0</span>] = <span class="keyword">new</span> <span class="keyword">byte</span>[]&#123;-<span class="number">87</span>, <span class="number">103</span>, -<span class="number">77</span>, -<span class="number">24</span>, <span class="number">4</span>, -<span class="number">3</span>, -<span class="number">93</span>, <span class="number">0x76</span>, -<span class="number">102</span>, -<span class="number">110</span>, -<span class="number">128</span>, <span class="number">120</span>, -<span class="number">28</span>, -<span class="number">35</span>, -<span class="number">47</span>, <span class="number">56</span>, <span class="number">13</span>, -<span class="number">58</span>, <span class="number">53</span>, -<span class="number">104</span>, <span class="number">24</span>, -<span class="number">9</span>, -<span class="number">20</span>, <span class="number">108</span>, <span class="number">67</span>, <span class="number">0x75</span>, <span class="number">55</span>, <span class="number">38</span>, -<span class="number">6</span>, <span class="number">19</span>, -<span class="number">108</span>, <span class="number">72</span>, -<span class="number">14</span>, -<span class="number">48</span>, -<span class="number">117</span>, <span class="number">0x30</span>, -<span class="number">124</span>, <span class="number">84</span>, -<span class="number">33</span>, <span class="number">35</span>, <span class="number">25</span>, <span class="number">91</span>, <span class="number">61</span>, <span class="number">89</span>, -<span class="number">13</span>, -<span class="number">82</span>, -<span class="number">94</span>, -<span class="number">126</span>, <span class="number">99</span>, <span class="number">1</span>, -<span class="number">125</span>, <span class="number">46</span>, -<span class="number">39</span>, <span class="number">81</span>, -<span class="number">101</span>, <span class="number">0x7C</span>, -<span class="number">90</span>, -<span class="number">21</span>, -<span class="number">91</span>, -<span class="number">66</span>, <span class="number">22</span>, <span class="number">12</span>, -<span class="number">29</span>, <span class="number">97</span>, -<span class="number">64</span>, -<span class="number">116</span>, <span class="number">58</span>, -<span class="number">11</span>, <span class="number">0x73</span>, <span class="number">44</span>, <span class="number">37</span>, <span class="number">11</span>, -<span class="number">69</span>, <span class="number">78</span>, -<span class="number">119</span>, <span class="number">107</span>, <span class="number">83</span>, <span class="number">106</span>, -<span class="number">76</span>, -<span class="number">15</span>, -<span class="number">31</span>, -<span class="number">26</span>, -<span class="number">67</span>, <span class="number">69</span>, -<span class="number">30</span>, -<span class="number">12</span>, -<span class="number">74</span>, <span class="number">102</span>, -<span class="number">52</span>, -<span class="number">107</span>, <span class="number">3</span>, <span class="number">86</span>, -<span class="number">44</span>, <span class="number">28</span>, <span class="number">30</span>, -<span class="number">41</span>, -<span class="number">5</span>, -<span class="number">61</span>, -<span class="number">114</span>, -<span class="number">75</span>, -<span class="number">23</span>, -<span class="number">49</span>, -<span class="number">65</span>, -<span class="number">70</span>, -<span class="number">22</span>, <span class="number">0x77</span>, <span class="number">57</span>, -<span class="number">81</span>, <span class="number">51</span>, -<span class="number">55</span>, <span class="number">98</span>, <span class="number">0x71</span>, -<span class="number">127</span>, <span class="number">0x79</span>, <span class="number">9</span>, -<span class="number">83</span>, <span class="number">36</span>, -<span class="number">51</span>, -<span class="number">7</span>, -<span class="number">40</span>, -<span class="number">27</span>, -<span class="number">59</span>, -<span class="number">71</span>, <span class="number">77</span>, <span class="number">68</span>, <span class="number">8</span>, -<span class="number">122</span>, -<span class="number">25</span>, -<span class="number">95</span>, <span class="number">29</span>, -<span class="number">86</span>, -<span class="number">19</span>, <span class="number">6</span>, <span class="number">0x70</span>, -<span class="number">78</span>, -<span class="number">46</span>, <span class="number">65</span>, <span class="number">0x7B</span>, -<span class="number">96</span>, <span class="number">17</span>, <span class="number">49</span>, -<span class="number">62</span>, <span class="number">39</span>, -<span class="number">112</span>, <span class="number">0x20</span>, -<span class="number">10</span>, <span class="number">0x60</span>, -<span class="number">1</span>, -<span class="number">106</span>, <span class="number">92</span>, -<span class="number">79</span>, -<span class="number">85</span>, -<span class="number">98</span>, -<span class="number">100</span>, <span class="number">82</span>, <span class="number">27</span>, <span class="number">0x5F</span>, -<span class="number">109</span>, <span class="number">10</span>, -<span class="number">17</span>, -<span class="number">111</span>, -<span class="number">123</span>, <span class="number">73</span>, -<span class="number">18</span>, <span class="number">45</span>, <span class="number">0x4F</span>, -<span class="number">113</span>, <span class="number">59</span>, <span class="number">71</span>, -<span class="number">121</span>, <span class="number">109</span>, <span class="number">70</span>, -<span class="number">42</span>, <span class="number">62</span>, <span class="number">105</span>, <span class="number">100</span>, <span class="number">42</span>, -<span class="number">50</span>, -<span class="number">53</span>, <span class="number">0x2F</span>, -<span class="number">4</span>, -<span class="number">105</span>, <span class="number">5</span>, <span class="number">0x7A</span>, -<span class="number">84</span>, <span class="number">0x7F</span>, -<span class="number">43</span>, <span class="number">26</span>, <span class="number">75</span>, <span class="number">14</span>, -<span class="number">89</span>, <span class="number">90</span>, <span class="number">40</span>, <span class="number">20</span>, <span class="number">0x3F</span>, <span class="number">41</span>, -<span class="number">120</span>, <span class="number">60</span>, <span class="number">76</span>, <span class="number">2</span>, -<span class="number">72</span>, -<span class="number">38</span>, -<span class="number">80</span>, <span class="number">23</span>, <span class="number">85</span>, <span class="number">0x1F</span>, -<span class="number">118</span>, <span class="number">0x7D</span>, <span class="number">87</span>, -<span class="number">57</span>, -<span class="number">115</span>, <span class="number">0x74</span>, -<span class="number">73</span>, -<span class="number">60</span>, -<span class="number">97</span>, <span class="number">0x72</span>, <span class="number">0x7E</span>, <span class="number">21</span>, <span class="number">34</span>, <span class="number">18</span>, <span class="number">88</span>, <span class="number">7</span>, -<span class="number">103</span>, <span class="number">52</span>, <span class="number">110</span>, <span class="number">80</span>, -<span class="number">34</span>, <span class="number">104</span>, <span class="number">101</span>, -<span class="number">68</span>, -<span class="number">37</span>, -<span class="number">8</span>, -<span class="number">56</span>, -<span class="number">88</span>, <span class="number">43</span>, <span class="number">0x40</span>, -<span class="number">36</span>, -<span class="number">2</span>, <span class="number">50</span>, -<span class="number">92</span>, -<span class="number">54</span>, <span class="number">16</span>, <span class="number">33</span>, -<span class="number">16</span>, -<span class="number">45</span>, <span class="number">93</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">0x6F</span>, -<span class="number">99</span>, <span class="number">54</span>, <span class="number">66</span>, <span class="number">74</span>, <span class="number">94</span>, -<span class="number">63</span>, -<span class="number">32</span>&#125;; <span class="comment">// 0xA9, 0x67, 0xB3, 0xE8, 0x04, 0xFD, 0xA3, 0x76, 0x9A, 0x92, 0x80, 0x78, 0xE4, 0xDD, 0xD1, 0x38, 0x0D, 0xC6, 0x35, 0x98, 0x18, 0xF7, 0xEC, 0x6C, 0x43, 0x75, 0x37, 0x26, 0xFA, 0x13, 0x94, 0x48, 0xF2, 0xD0, 0x8B, 0x30, 0x84, 0x54, 0xDF, 0x23, 0x19, 0x5B, 0x3D, 0x59, 0xF3, 0xAE, 0xA2, 0x82, 0x63, 0x01, 0x83, 0x2E, 0xD9, 0x51, 0x9B, 0x7C, 0xA6, 0xEB, 0xA5, 0xBE, 0x16, 0x0C, 0xE3, 0x61, 0xC0, 0x8C, 0x3A, 0xF5, 0x73, 0x2C, 0x25, 0x0B, 0xBB, 0x4E, 0x89, 0x6B, 0x53, 0x6A, 0xB4, 0xF1, 0xE1, 0xE6, 0xBD, 0x45, 0xE2, 0xF4, 0xB6, 0x66, 0xCC, 0x95, 0x03, 0x56, 0xD4, 0x1C, 0x1E, 0xD7, 0xFB, 0xC3, 0x8E, 0xB5, 0xE9, 0xCF, 0xBF, 0xBA, 0xEA, 0x77, 0x39, 0xAF, 0x33, 0xC9, 0x62, 0x71, 0x81, 0x79, 0x09, 0xAD, 0x24, 0xCD, 0xF9, 0xD8, 0xE5, 0xC5, 0xB9, 0x4D, 0x44, 0x08, 0x86, 0xE7, 0xA1, 0x1D, 0xAA, 0xED, 0x06, 0x70, 0xB2, 0xD2, 0x41, 0x7B, 0xA0, 0x11, 0x31, 0xC2, 0x27, 0x90, 0x20, 0xF6, 0x60, 0xFF, 0x96, 0x5C, 0xB1, 0xAB, 0x9E, 0x9C, 0x52, 0x1B, 0x5F, 0x93, 0x0A, 0xEF, 0x91, 0x85, 0x49, 0xEE, 0x2D, 0x4F, 0x8F, 0x3B, 0x47, 0x87, 0x6D, 0x46, 0xD6, 0x3E, 0x69, 0x64, 0x2A, 0xCE, 0xCB, 0x2F, 0xFC, 0x97, 0x05, 0x7A, 0xAC, 0x7F, 0xD5, 0x1A, 0x4B, 0x0E, 0xA7, 0x5A, 0x28, 0x14, 0x3F, 0x29, 0x88, 0x3C, 0x4C, 0x02, 0xB8, 0xDA, 0xB0, 0x17, 0x55, 0x1F, 0x8A, 0x7D, 0x57, 0xC7, 0x8D, 0x74, 0xB7, 0xC4, 0x9F, 0x72, 0x7E, 0x15, 0x22, 0x12, 0x58, 0x07, 0x99, 0x34, 0x6E, 0x50, 0xDE, 0x68, 0x65, 0xBC, 0xDB, 0xF8, 0xC8, 0xA8, 0x2B, 0x40, 0xDC, 0xFE, 0x32, 0xA4, 0xCA, 0x10, 0x21, 0xF0, 0xD3, 0x5D, 0x0F, 0x00, 0x6F, 0x9D, 0x36, 0x42, 0x4A, 0x5E, 0xC1, 0xE0</span></span><br><span class="line">v0[<span class="number">1</span>] = <span class="keyword">new</span> <span class="keyword">byte</span>[]&#123;<span class="number">0x75</span>, -<span class="number">13</span>, -<span class="number">58</span>, -<span class="number">12</span>, -<span class="number">37</span>, <span class="number">0x7B</span>, -<span class="number">5</span>, -<span class="number">56</span>, <span class="number">74</span>, -<span class="number">45</span>, -<span class="number">26</span>, <span class="number">107</span>, <span class="number">69</span>, <span class="number">0x7D</span>, -<span class="number">24</span>, <span class="number">75</span>, -<span class="number">42</span>, <span class="number">50</span>, -<span class="number">40</span>, -<span class="number">3</span>, <span class="number">55</span>, <span class="number">0x71</span>, -<span class="number">15</span>, -<span class="number">31</span>, <span class="number">0x30</span>, <span class="number">15</span>, -<span class="number">8</span>, <span class="number">27</span>, -<span class="number">121</span>, -<span class="number">6</span>, <span class="number">6</span>, <span class="number">0x3F</span>, <span class="number">94</span>, -<span class="number">70</span>, -<span class="number">82</span>, <span class="number">91</span>, -<span class="number">118</span>, <span class="number">0</span>, -<span class="number">68</span>, -<span class="number">99</span>, <span class="number">109</span>, -<span class="number">63</span>, -<span class="number">79</span>, <span class="number">14</span>, -<span class="number">128</span>, <span class="number">93</span>, -<span class="number">46</span>, -<span class="number">43</span>, -<span class="number">96</span>, -<span class="number">124</span>, <span class="number">7</span>, <span class="number">20</span>, -<span class="number">75</span>, -<span class="number">112</span>, <span class="number">44</span>, -<span class="number">93</span>, -<span class="number">78</span>, <span class="number">0x73</span>, <span class="number">76</span>, <span class="number">84</span>, -<span class="number">110</span>, <span class="number">0x74</span>, <span class="number">54</span>, <span class="number">81</span>, <span class="number">56</span>, -<span class="number">80</span>, -<span class="number">67</span>, <span class="number">90</span>, -<span class="number">4</span>, <span class="number">0x60</span>, <span class="number">98</span>, -<span class="number">106</span>, <span class="number">108</span>, <span class="number">66</span>, -<span class="number">9</span>, <span class="number">16</span>, <span class="number">0x7C</span>, <span class="number">40</span>, <span class="number">39</span>, -<span class="number">116</span>, <span class="number">19</span>, -<span class="number">107</span>, -<span class="number">100</span>, -<span class="number">57</span>, <span class="number">36</span>, <span class="number">70</span>, <span class="number">59</span>, <span class="number">0x70</span>, -<span class="number">54</span>, -<span class="number">29</span>, -<span class="number">123</span>, -<span class="number">53</span>, <span class="number">17</span>, -<span class="number">48</span>, -<span class="number">109</span>, -<span class="number">72</span>, -<span class="number">90</span>, -<span class="number">125</span>, <span class="number">0x20</span>, -<span class="number">1</span>, -<span class="number">97</span>, <span class="number">0x77</span>, -<span class="number">61</span>, -<span class="number">52</span>, <span class="number">3</span>, <span class="number">0x6F</span>, <span class="number">8</span>, -<span class="number">65</span>, <span class="number">0x40</span>, -<span class="number">25</span>, <span class="number">43</span>, -<span class="number">30</span>, <span class="number">0x79</span>, <span class="number">12</span>, -<span class="number">86</span>, -<span class="number">126</span>, <span class="number">65</span>, <span class="number">58</span>, -<span class="number">22</span>, -<span class="number">71</span>, -<span class="number">28</span>, -<span class="number">102</span>, -<span class="number">92</span>, -<span class="number">105</span>, <span class="number">0x7E</span>, -<span class="number">38</span>, <span class="number">0x7A</span>, <span class="number">23</span>, <span class="number">102</span>, -<span class="number">108</span>, -<span class="number">95</span>, <span class="number">29</span>, <span class="number">61</span>, -<span class="number">16</span>, -<span class="number">34</span>, -<span class="number">77</span>, <span class="number">11</span>, <span class="number">0x72</span>, -<span class="number">89</span>, <span class="number">28</span>, -<span class="number">17</span>, -<span class="number">47</span>, <span class="number">83</span>, <span class="number">62</span>, -<span class="number">113</span>, <span class="number">51</span>, <span class="number">38</span>, <span class="number">0x5F</span>, -<span class="number">20</span>, <span class="number">0x76</span>, <span class="number">42</span>, <span class="number">73</span>, -<span class="number">127</span>, -<span class="number">120</span>, -<span class="number">18</span>, <span class="number">33</span>, -<span class="number">60</span>, <span class="number">26</span>, -<span class="number">21</span>, -<span class="number">39</span>, -<span class="number">59</span>, <span class="number">57</span>, -<span class="number">103</span>, -<span class="number">51</span>, -<span class="number">83</span>, <span class="number">49</span>, -<span class="number">117</span>, <span class="number">1</span>, <span class="number">24</span>, <span class="number">35</span>, -<span class="number">35</span>, <span class="number">0x1F</span>, <span class="number">78</span>, <span class="number">45</span>, -<span class="number">7</span>, <span class="number">72</span>, <span class="number">0x4F</span>, -<span class="number">14</span>, <span class="number">101</span>, -<span class="number">114</span>, <span class="number">120</span>, <span class="number">92</span>, <span class="number">88</span>, <span class="number">25</span>, -<span class="number">115</span>, -<span class="number">27</span>, -<span class="number">104</span>, <span class="number">87</span>, <span class="number">103</span>, <span class="number">0x7F</span>, <span class="number">5</span>, <span class="number">100</span>, -<span class="number">81</span>, <span class="number">99</span>, -<span class="number">74</span>, -<span class="number">2</span>, -<span class="number">11</span>, -<span class="number">73</span>, <span class="number">60</span>, -<span class="number">91</span>, -<span class="number">50</span>, -<span class="number">23</span>, <span class="number">104</span>, <span class="number">68</span>, -<span class="number">32</span>, <span class="number">77</span>, <span class="number">67</span>, <span class="number">105</span>, <span class="number">41</span>, <span class="number">46</span>, -<span class="number">84</span>, <span class="number">21</span>, <span class="number">89</span>, -<span class="number">88</span>, <span class="number">10</span>, -<span class="number">98</span>, <span class="number">110</span>, <span class="number">71</span>, -<span class="number">33</span>, <span class="number">52</span>, <span class="number">53</span>, <span class="number">106</span>, -<span class="number">49</span>, -<span class="number">36</span>, <span class="number">34</span>, -<span class="number">55</span>, -<span class="number">64</span>, -<span class="number">101</span>, -<span class="number">119</span>, -<span class="number">44</span>, -<span class="number">19</span>, -<span class="number">85</span>, <span class="number">18</span>, -<span class="number">94</span>, <span class="number">13</span>, <span class="number">82</span>, -<span class="number">69</span>, <span class="number">2</span>, <span class="number">0x2F</span>, -<span class="number">87</span>, -<span class="number">41</span>, <span class="number">97</span>, <span class="number">30</span>, -<span class="number">76</span>, <span class="number">80</span>, <span class="number">4</span>, -<span class="number">10</span>, -<span class="number">62</span>, <span class="number">22</span>, <span class="number">37</span>, -<span class="number">122</span>, <span class="number">86</span>, <span class="number">85</span>, <span class="number">9</span>, -<span class="number">66</span>, -<span class="number">111</span>&#125;; <span class="comment">// 0x75, 0xF3, 0xC6, 0xF4, 0xDB, 0x7B, 0xFB, 0xC8, 0x4A, 0xD3, 0xE6, 0x6B, 0x45, 0x7D, 0xE8, 0x4B, 0xD6, 0x32, 0xD8, 0xFD, 0x37, 0x71, 0xF1, 0xE1, 0x30, 0x0F, 0xF8, 0x1B, 0x87, 0xFA, 0x06, 0x3F, 0x5E, 0xBA, 0xAE, 0x5B, 0x8A, 0x00, 0xBC, 0x9D, 0x6D, 0xC1, 0xB1, 0x0E, 0x80, 0x5D, 0xD2, 0xD5, 0xA0, 0x84, 0x07, 0x14, 0xB5, 0x90, 0x2C, 0xA3, 0xB2, 0x73, 0x4C, 0x54, 0x92, 0x74, 0x36, 0x51, 0x38, 0xB0, 0xBD, 0x5A, 0xFC, 0x60, 0x62, 0x96, 0x6C, 0x42, 0xF7, 0x10, 0x7C, 0x28, 0x27, 0x8C, 0x13, 0x95, 0x9C, 0xC7, 0x24, 0x46, 0x3B, 0x70, 0xCA, 0xE3, 0x85, 0xCB, 0x11, 0xD0, 0x93, 0xB8, 0xA6, 0x83, 0x20, 0xFF, 0x9F, 0x77, 0xC3, 0xCC, 0x03, 0x6F, 0x08, 0xBF, 0x40, 0xE7, 0x2B, 0xE2, 0x79, 0x0C, 0xAA, 0x82, 0x41, 0x3A, 0xEA, 0xB9, 0xE4, 0x9A, 0xA4, 0x97, 0x7E, 0xDA, 0x7A, 0x17, 0x66, 0x94, 0xA1, 0x1D, 0x3D, 0xF0, 0xDE, 0xB3, 0x0B, 0x72, 0xA7, 0x1C, 0xEF, 0xD1, 0x53, 0x3E, 0x8F, 0x33, 0x26, 0x5F, 0xEC, 0x76, 0x2A, 0x49, 0x81, 0x88, 0xEE, 0x21, 0xC4, 0x1A, 0xEB, 0xD9, 0xC5, 0x39, 0x99, 0xCD, 0xAD, 0x31, 0x8B, 0x01, 0x18, 0x23, 0xDD, 0x1F, 0x4E, 0x2D, 0xF9, 0x48, 0x4F, 0xF2, 0x65, 0x8E, 0x78, 0x5C, 0x58, 0x19, 0x8D, 0xE5, 0x98, 0x57, 0x67, 0x7F, 0x05, 0x64, 0xAF, 0x63, 0xB6, 0xFE, 0xF5, 0xB7, 0x3C, 0xA5, 0xCE, 0xE9, 0x68, 0x44, 0xE0, 0x4D, 0x43, 0x69, 0x29, 0x2E, 0xAC, 0x15, 0x59, 0xA8, 0x0A, 0x9E, 0x6E, 0x47, 0xDF, 0x34, 0x35, 0x6A, 0xCF, 0xDC, 0x22, 0xC9, 0xC0, 0x9B, 0x89, 0xD4, 0xED, 0xAB, 0x12, 0xA2, 0x0D, 0x52, 0xBB, 0x02, 0x2F, 0xA9, 0xD7, 0x61, 0x1E, 0xB4, 0x50, 0x04, 0xF6, 0xC2, 0x16, 0x25, 0x86, 0x56, 0x55, 0x09, 0xBE, 0x91</span></span><br></pre></td></tr></table></figure>
<p>发现是 twofish 算法：</p>
<p><img src="/pics/攻防世界-MOBILE-新手练习区/2.png" alt="搜索结果"></p>
<p>上面的一些资源可以在 Resources/values/public.xml 中找到 ID 对应的字符串名：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="tag">&lt;<span class="name">public</span> <span class="attr">id</span>=<span class="string">"0x7f04001a"</span> <span class="attr">name</span>=<span class="string">"activity_main"</span> <span class="attr">type</span>=<span class="string">"layout"</span> /&gt;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="tag">&lt;<span class="name">public</span> <span class="attr">id</span>=<span class="string">"0x7f060022"</span> <span class="attr">name</span>=<span class="string">"no"</span> <span class="attr">type</span>=<span class="string">"string"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">public</span> <span class="attr">id</span>=<span class="string">"0x7f060023"</span> <span class="attr">name</span>=<span class="string">"two_fish"</span> <span class="attr">type</span>=<span class="string">"string"</span> /&gt;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="tag">&lt;<span class="name">public</span> <span class="attr">id</span>=<span class="string">"0x7f060025"</span> <span class="attr">name</span>=<span class="string">"yes"</span> <span class="attr">type</span>=<span class="string">"string"</span> /&gt;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="tag">&lt;<span class="name">public</span> <span class="attr">id</span>=<span class="string">"0x7f0b0054"</span> <span class="attr">name</span>=<span class="string">"edit_text"</span> <span class="attr">type</span>=<span class="string">"id"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">public</span> <span class="attr">id</span>=<span class="string">"0x7f0b0055"</span> <span class="attr">name</span>=<span class="string">"button"</span> <span class="attr">type</span>=<span class="string">"id"</span> /&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>可以在 Resources/values/strings.xml 中找到对应的字符串：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"no"</span>&gt;</span></span><br><span class="line">    NO~ You don't get me~ T_T<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"two_fish"</span>&gt;</span></span><br><span class="line">    I have a male fish and a female fish.<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"what_else"</span>&gt;</span></span><br><span class="line">    What else?<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"yes"</span>&gt;</span></span><br><span class="line">    Yes! You got me! :)<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>最后找个库实现一下解密：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> twofish <span class="keyword">import</span> Twofish</span><br><span class="line"></span><br><span class="line">ciphertext = [<span class="number">0x88</span>, <span class="number">0x4D</span>, <span class="number">0xF2</span>, <span class="number">0xDA</span>, <span class="number">0x11</span>, <span class="number">0x05</span>, <span class="number">0xD6</span>, <span class="number">0x2C</span>, <span class="number">0xE0</span>, <span class="number">0x6D</span>, <span class="number">0x55</span>, <span class="number">0x1F</span>, <span class="number">0x18</span>, <span class="number">0xA5</span>, <span class="number">0x90</span>, <span class="number">0xAD</span>, <span class="number">0x40</span>, <span class="number">0xAD</span>, <span class="number">0x80</span>, <span class="number">0x54</span>, <span class="number">0x05</span>, <span class="number">0xA2</span>, <span class="number">0x9E</span>, <span class="number">0xE2</span>, <span class="number">0x12</span>, <span class="number">0x46</span>, <span class="number">0xE6</span>, <span class="number">0x47</span>, <span class="number">0x05</span>, <span class="number">0x9D</span>, <span class="number">0xC2</span>, <span class="number">0xC6</span>, <span class="number">0x75</span>, <span class="number">0x1D</span>, <span class="number">0xD4</span>, <span class="number">0x06</span>, <span class="number">0x70</span>, <span class="number">0xFC</span>, <span class="number">0x51</span>, <span class="number">0x54</span>, <span class="number">0x09</span>, <span class="number">0x16</span>, <span class="number">0xCD</span>, <span class="number">0x5F</span>, <span class="number">0xDE</span>, <span class="number">0x0C</span>, <span class="number">0x2F</span>, <span class="number">0x4D</span>]</span><br><span class="line">ciphertext = <span class="string">''</span>.join([chr(c) <span class="keyword">for</span> c <span class="keyword">in</span> ciphertext])</span><br><span class="line"></span><br><span class="line">T = Twofish(<span class="string">'I have a male fish and a female '</span>)</span><br><span class="line"></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">48</span>, <span class="number">16</span>):</span><br><span class="line">    flag += T.decrypt(ciphertext[i:i+<span class="number">16</span>])</span><br><span class="line"><span class="keyword">print</span> flag</span><br><span class="line"><span class="comment"># qwb&#123;TH3y_Io&lt;e_EACh_OTh3r_FOrEUER&#125;</span></span><br></pre></td></tr></table></figure>
<h1 id="你是谁"><a href="#你是谁" class="headerlink" title="你是谁"></a>你是谁</h1><p>TODO:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span> <span class="attr">android:versionCode</span>=<span class="string">"1"</span> <span class="attr">android:versionName</span>=<span class="string">"1.0"</span> <span class="attr">package</span>=<span class="string">"xyz.konso.testsrtp"</span> <span class="attr">platformBuildVersionCode</span>=<span class="string">"23"</span> <span class="attr">platformBuildVersionName</span>=<span class="string">"6.0-2166767"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-sdk</span> <span class="attr">android:minSdkVersion</span>=<span class="string">"15"</span> <span class="attr">android:targetSdkVersion</span>=<span class="string">"23"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.RECORD_AUDIO"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.INTERNET"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.ACCESS_NETWORK_STATE"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.ACCESS_WIFI_STATE"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.CHANGE_NETWORK_STATE"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.READ_PHONE_STATE"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.ACCESS_FINE_LOCATION"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.READ_CONTACTS"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.WRITE_EXTERNAL_STORAGE"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.CALL_PHONE"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.BROADCAST_STICKY"</span> /&gt;</span></span><br><span class="line">    注：部分手机如无此权限会报错</span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.BLUETOOTH"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.MODIFY_AUDIO_SETTINGS"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span> <span class="attr">android:theme</span>=<span class="string">"@style/AppTheme"</span> <span class="attr">android:label</span>=<span class="string">"@string/app_name"</span> <span class="attr">android:icon</span>=<span class="string">"@mipmap/icon"</span> <span class="attr">android:debuggable</span>=<span class="string">"true"</span> <span class="attr">android:allowBackup</span>=<span class="string">"true"</span> <span class="attr">android:supportsRtl</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">"xyz.konso.testsrtp.MainActivity"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.view"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.LAUNCHER"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">"xyz.konso.testsrtp.SplashActivity"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.MAIN"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.LAUNCHER"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.konso.testsrtp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.content.pm.PackageManager.NameNotFoundException;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.os.Handler;</span><br><span class="line"><span class="keyword">import</span> android.support.v4.view.accessibility.AccessibilityNodeInfoCompat;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SplashActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        getWindow().setFlags(AccessibilityNodeInfoCompat.ACTION_NEXT_HTML_ELEMENT, AccessibilityNodeInfoCompat.ACTION_NEXT_HTML_ELEMENT);</span><br><span class="line">        setContentView(R.layout.activity_splash);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ((TextView) findViewById(R.id.versionNumber)).setText(<span class="string">"Version "</span> + getPackageManager().getPackageInfo(<span class="string">"com.lyt.android"</span>, <span class="number">0</span>).versionName);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NameNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">new</span> Handler().postDelayed(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                SplashActivity.<span class="keyword">this</span>.startActivity(<span class="keyword">new</span> Intent(SplashActivity.<span class="keyword">this</span>, MainActivity.class));</span><br><span class="line">                SplashActivity.<span class="keyword">this</span>.finish();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">2500</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.konso.testsrtp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"><span class="keyword">import</span> android.media.AudioManager;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"><span class="keyword">import</span> com.iflytek.cloud.InitListener;</span><br><span class="line"><span class="keyword">import</span> com.iflytek.cloud.RecognizerListener;</span><br><span class="line"><span class="keyword">import</span> com.iflytek.cloud.RecognizerResult;</span><br><span class="line"><span class="keyword">import</span> com.iflytek.cloud.SpeechConstant;</span><br><span class="line"><span class="keyword">import</span> com.iflytek.cloud.SpeechError;</span><br><span class="line"><span class="keyword">import</span> com.iflytek.cloud.SpeechRecognizer;</span><br><span class="line"><span class="keyword">import</span> com.iflytek.cloud.SpeechSynthesizer;</span><br><span class="line"><span class="keyword">import</span> com.iflytek.cloud.SpeechUtility;</span><br><span class="line"><span class="keyword">import</span> com.iflytek.cloud.SynthesizerListener;</span><br><span class="line"><span class="keyword">import</span> org.json.JSONObject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String TAG = <span class="string">"shitou"</span>;</span><br><span class="line">    <span class="keyword">private</span> Button button1;</span><br><span class="line">    <span class="keyword">private</span> Button button2;</span><br><span class="line">    <span class="keyword">private</span> AudioManager mAudioManager;</span><br><span class="line">    <span class="keyword">private</span> SpeechRecognizer mIat;</span><br><span class="line">    <span class="keyword">private</span> InitListener mInitListener = <span class="keyword">new</span> InitListener() &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onInit</span><span class="params">(<span class="keyword">int</span> code)</span> </span>&#123;</span><br><span class="line">            Log.d(MainActivity.<span class="keyword">this</span>.TAG, <span class="string">"SpeechRecognizer init() code = "</span> + code);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">private</span> SynthesizerListener mSynListener = <span class="keyword">new</span> SynthesizerListener() &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">(SpeechError error)</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBufferProgress</span><span class="params">(<span class="keyword">int</span> percent, <span class="keyword">int</span> beginPos, <span class="keyword">int</span> endPos, String info)</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSpeakBegin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            Log.d(MainActivity.<span class="keyword">this</span>.TAG, <span class="string">"speakcheck"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSpeakPaused</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSpeakProgress</span><span class="params">(<span class="keyword">int</span> percent, <span class="keyword">int</span> beginPos, <span class="keyword">int</span> endPos)</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSpeakResumed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEvent</span><span class="params">(<span class="keyword">int</span> arg0, <span class="keyword">int</span> arg1, <span class="keyword">int</span> arg2, Bundle arg3)</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">private</span> SpeechSynthesizer mTts;</span><br><span class="line">    <span class="keyword">private</span> RecognizerListener recognizerListener = <span class="keyword">new</span> RecognizerListener() &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBeginOfSpeech</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(SpeechError error)</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEndOfSpeech</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResult</span><span class="params">(RecognizerResult results, <span class="keyword">boolean</span> isLast)</span> </span>&#123;</span><br><span class="line">            Log.d(MainActivity.<span class="keyword">this</span>.TAG, results.getResultString());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                MainActivity.<span class="keyword">this</span>.ss = <span class="keyword">new</span> JSONObject(results.getResultString()).getJSONArray(<span class="string">"ws"</span>).getJSONObject(<span class="number">0</span>).getJSONArray(<span class="string">"cw"</span>).getJSONObject(<span class="number">0</span>).getString(<span class="string">"w"</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                Log.d(MainActivity.<span class="keyword">this</span>.TAG, <span class="string">"catch Excepetion"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (MainActivity.<span class="keyword">this</span>.ss.equals(<span class="string">"\u4f60\u597d"</span>)) &#123; <span class="comment">// 你好</span></span><br><span class="line">                MainActivity.<span class="keyword">this</span>.getsna();</span><br><span class="line">            &#125;</span><br><span class="line">            Log.d(MainActivity.<span class="keyword">this</span>.TAG, MainActivity.<span class="keyword">this</span>.ss);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onVolumeChanged</span><span class="params">(<span class="keyword">int</span> volume, <span class="keyword">byte</span>[] var2)</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEvent</span><span class="params">(<span class="keyword">int</span> eventType, <span class="keyword">int</span> arg1, <span class="keyword">int</span> arg2, Bundle obj)</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">private</span> JSONObject res;</span><br><span class="line">    <span class="keyword">private</span> String ss;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(<span class="keyword">new</span> background(<span class="keyword">this</span>));</span><br><span class="line">        <span class="keyword">this</span>.mAudioManager = (AudioManager) getSystemService(<span class="string">"audio"</span>);</span><br><span class="line">        <span class="keyword">this</span>.mAudioManager.setBluetoothScoOn(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">this</span>.mAudioManager.startBluetoothSco();</span><br><span class="line">        SpeechUtility.createUtility(<span class="keyword">this</span>, <span class="string">"appid=561e6833"</span>);</span><br><span class="line">        <span class="keyword">this</span>.mIat = SpeechRecognizer.createRecognizer(<span class="keyword">this</span>, <span class="keyword">this</span>.mInitListener);</span><br><span class="line">        <span class="keyword">this</span>.mTts = SpeechSynthesizer.createSynthesizer(<span class="keyword">this</span>, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setParam</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mIat.setParameter(SpeechConstant.DOMAIN, <span class="string">"iat"</span>);</span><br><span class="line">        <span class="keyword">this</span>.mIat.setParameter(SpeechConstant.LANGUAGE, <span class="string">"zh_cn"</span>);</span><br><span class="line">        <span class="keyword">this</span>.mIat.setParameter(SpeechConstant.ACCENT, <span class="string">"mandarin"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getsna</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Toast.makeText(<span class="keyword">this</span>, <span class="string">"haha"</span>, <span class="number">0</span>).show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        <span class="keyword">this</span>.mAudioManager.setBluetoothScoOn(<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">this</span>.mAudioManager.stopBluetoothSco();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">signed</span> <span class="keyword">int</span> __<span class="function">fastcall <span class="title">JNI_OnLoad</span><span class="params">(_JavaVM *vm)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  jclass v2; <span class="comment">// r4</span></span><br><span class="line">  _JNIEnv *env; <span class="comment">// [sp+4h] [bp-Ch]</span></span><br><span class="line"></span><br><span class="line">  env = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( vm-&gt;functions-&gt;GetEnv(&amp;vm-&gt;functions, (<span class="keyword">void</span> **)&amp;env, <span class="number">65540</span>) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">if</span> ( byte_FF45C )</span><br><span class="line">    _android_log_write(<span class="number">3</span>, <span class="string">"MSC_LOG"</span>, <span class="string">"JNI_OnLoad is called !"</span>);</span><br><span class="line">  v2 = env-&gt;functions-&gt;FindClass(&amp;env-&gt;functions, <span class="string">"java/io/FileDescriptor"</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !v2 &amp;&amp; byte_FF45C )</span><br><span class="line">    _android_log_write(<span class="number">3</span>, <span class="string">"MSC_LOG"</span>, <span class="string">"Unable to find Java class java.io.FileDescriptor"</span>);</span><br><span class="line">  dword_FFC14 = (<span class="keyword">int</span>)env-&gt;functions-&gt;GetFieldID(&amp;env-&gt;functions, v2, <span class="string">"descriptor"</span>, <span class="string">"I"</span>);</span><br><span class="line">  <span class="keyword">if</span> ( dword_FFC14 || !byte_FF45C )             <span class="comment">// get descriptor in FileDescriptor and judge</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">65540</span>;</span><br><span class="line">  _android_log_write(<span class="number">3</span>, <span class="string">"MSC_LOG"</span>, <span class="string">"Unable to find descriptor field in java.io.FileDescriptor"</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">65540</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><p><a href="https://www.jianshu.com/p/a2f826064e29" target="_blank" rel="noopener">https://www.jianshu.com/p/a2f826064e29</a><br><a href="https://blog.csdn.net/jscese/article/details/51005447" target="_blank" rel="noopener">https://blog.csdn.net/jscese/article/details/51005447</a><br><a href="https://blog.csdn.net/zhuzhuzhu22/article/details/80306203" target="_blank" rel="noopener">https://blog.csdn.net/zhuzhuzhu22/article/details/80306203</a><br><a href="https://blog.csdn.net/ldpxxx/article/details/9253369" target="_blank" rel="noopener">https://blog.csdn.net/ldpxxx/article/details/9253369</a><br><a href="https://stackoverflow.com/questions/23624212/how-to-convert-a-float-into-hex" target="_blank" rel="noopener">https://stackoverflow.com/questions/23624212/how-to-convert-a-float-into-hex</a><br><a href="https://www.52pojie.cn/thread-1105062-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-1105062-1-1.html</a><br><a href="https://blog.csdn.net/jason0539/article/details/10049899" target="_blank" rel="noopener">https://blog.csdn.net/jason0539/article/details/10049899</a></p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/re/">re</a></li></ul>

      
        
	<div id="comment">
		<!-- 来必力City版安装代码 -->
		<div id="lv-container" data-id="city" data-uid="MTAyMC8yOTQ4MS82MDQ5">
		<script type="text/javascript">
		   (function(d, s) {
		       var j, e = d.getElementsByTagName(s)[0];

		       if (typeof LivereTower === 'function') { return; }

		       j = d.createElement(s);
		       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
		       j.async = true;

		       e.parentNode.insertBefore(j, e);
		   })(document, 'script');
		</script>
		<noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
		</div>
		<!-- City版安装代码已完成 -->
	</div>



      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/02/29/不同版本Android动态调试前打开调试开关简述/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          不同版本Android动态调试前打开调试开关简述
        
      </div>
    </a>
  
  
    <a href="/2020/02/17/分组密码的工作模式/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">分组密码的工作模式</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">Contents</strong>
    
      <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#app1"><span class="nav-number">1.</span> <span class="nav-text">app1</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#app2"><span class="nav-number">2.</span> <span class="nav-text">app2</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#app3"><span class="nav-number">3.</span> <span class="nav-text">app3</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#easy-apk"><span class="nav-number">4.</span> <span class="nav-text">easy-apk</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#easyjava"><span class="nav-number">5.</span> <span class="nav-text">easyjava</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#easyjni"><span class="nav-number">6.</span> <span class="nav-text">easyjni</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#easy-so"><span class="nav-number">7.</span> <span class="nav-text">easy-so</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Ph0en1x-100"><span class="nav-number">8.</span> <span class="nav-text">Ph0en1x-100</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#RememberOther"><span class="nav-number">9.</span> <span class="nav-text">RememberOther</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#黑客精神"><span class="nav-number">10.</span> <span class="nav-text">黑客精神</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#easy-dex"><span class="nav-number">11.</span> <span class="nav-text">easy-dex</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#你是谁"><span class="nav-number">12.</span> <span class="nav-text">你是谁</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#References"><span class="nav-number">13.</span> <span class="nav-text">References</span></a></li></ol>
    
    </div>
  </aside>

</section>
        
      </div>

    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2020 AssassinQ All Rights Reserved.
        
      </div>
      <div class="site-credit">
        Theme by <a href="https://github.com/iTimeTraveler/hexo-theme-hipaper" target="_blank">hipaper</a>
      </div>
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");

    wrapdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";


    <!-- headerblur min height -->
    
      var headerblur = document.getElementById("header-blur");
      headerblur.style.minHeight = window.getComputedStyle(document.getElementById("allheader"), null).height;
    
    
</script>
    
<div style="display: none;">
  <script src="https://s11.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
</div>

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/bootstrap.js"></script>
<script src="/js/main.js"></script>







  <div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>








  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>
