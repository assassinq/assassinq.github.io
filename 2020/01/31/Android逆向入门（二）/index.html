<!DOCTYPE html>
<html lang="en">





<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#005f6b">
  <meta name="description" content="Software Security Researcher">
  <meta name="author" content>
  <meta name="keywords" content>
  <title>Android逆向入门（二） - B3ale</title>

  <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/5.12.1/css/all.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/mdbootstrap/4.13.0/css/mdb.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/3.0.1/github-markdown.min.css">
<link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">


  <link rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css">

<link rel="stylesheet" href="/css/main.css">


  <link defer rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css">


<!-- 自定义样式保持在最底部 -->


<link rel="alternate" href="/atom.xml" title="B3ale" type="application/atom+xml"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>


<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">&nbsp;<strong>B3ale</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">Home</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">Archives</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">Tags</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about/">About</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/links/">Links</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
                <p class="mt-3 post-meta">
                  <i class="fas fa-calendar-alt" aria-hidden="true"></i>
                  Friday, January 31st 2020, 4:10 pm
                </p>
              

              <p class="mt-1">
                
                  
                  <span class="post-meta">
                    <i class="far fa-chart-bar"></i>
                    4.8k 字
                  </span>
                

                
                  
                  <span class="post-meta">
                      <i class="far fa-clock"></i>
                      21 分钟
                  </span>
                

                
              </p>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5 z-depth-3" id="board">
          <div class="post-content mx-auto" id="post">
            
            <div class="markdown-body">
              <p>Android JNI 编程及 ARM 汇编入门。</p>
<a id="more"></a>
<h1 id="Environment"><a href="#Environment" class="headerlink" title="Environment"></a>Environment</h1><p>Android Studio 3.5.3</p>
<h1 id="JNI"><a href="#JNI" class="headerlink" title="JNI"></a>JNI</h1><p>Android 程序分两层，Java 层和 Native 层。Java 层就是 Java 代码编译为 dex 文件，而 Native 层则是 C++ 代码编译为 so 文件（动态库）。两者使用 JNI（Java Native Interface）来进行链接。相比于 Java，Native 层安全性更加高，隐蔽性更加好，某种情况下效率更加高。Java 是跨平台的语言，而这跨平台的背后都是依靠 Java 虚拟机，虚拟机采用 C/C++ 编写，适配各个系统，通过 JNI 为上层 Java 提供各种服务，保证跨平台性。Java 程序中通过 JVM 加载并调用 JNI 程序来间接地调用目标原生函数。</p>
<p><img src="/pics/Android逆向入门/二/1.png" srcset="/img/loading.gif" alt></p>
<p>如果要进行 JNI 开发，直接在 Android Studio 中新建一个 C++ 项目即可。在调试过程中，可以新建一个 <code>log.h</code> 定义几个在 C++ 文件中进行日志输出的函数：</p>
<pre><code class="cpp">#include &lt;android/log.h&gt;

#ifndef LOG_TAG
#define LOG_TAG &quot;MY_TAG&quot;
#define LOGD(...) __android_log_print(ANDROID_LOG_DEBUG, LOG_TAG, __VA_ARGS__)
#define LOGI(...) __android_log_print(ANDROID_LOG_INFO, LOG_TAG, __VA_ARGS__)
#define LOGW(...) __android_log_print(ANDROID_LOG_WARN, LOG_TAG, __VA_ARGS__)
#define LOGE(...) __android_log_print(ANDROID_LOG_ERROR, LOG_TAG, __VA_ARGS__)
#define LOGF(...) __android_log_print(ANDROID_LOG_FATAL, LOG_TAG, __VA_ARGS__)
#endif
</code></pre>
<p>在 Java 文件中添加日志输出：</p>
<pre><code class="java">public class MainActivity extends AppCompatActivity {
    ...

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        ...
        Log.d(&quot;Debug&quot;, &quot;infomation&quot;);
    }
    ...
}
</code></pre>
<p>在需要调用 JNI 的函数中加载动态库：</p>
<pre><code class="java">public class MainActivity extends AppCompatActivity {

    // Used to load the &#39;native-lib&#39; library on application startup.
    static {
        System.loadLibrary(&quot;native-lib&quot;);
    }
    ...
}
</code></pre>
<h2 id="Native-函数注册"><a href="#Native-函数注册" class="headerlink" title="Native 函数注册"></a>Native 函数注册</h2><h3 id="静态注册"><a href="#静态注册" class="headerlink" title="静态注册"></a>静态注册</h3><p>静态注册的理解和使用方式简单，出错率低。但必须遵循注册规则，当需要更改类名、包名或者方法时，需要按照之前方法重新生成头文件，灵活性不高。</p>
<p>Java 文件中的 Native 声明：</p>
<pre><code class="java">public native String sayHello();
</code></pre>
<p>静态注册在 cpp 文件中通过 JNIEXPORT 和 JNICALL 两个宏定义声明，在虚拟机加载 so 时发现上面两个宏定义的函数时就会链接到对应的 native 方法。so 中的名字为类名 + 函数名的组合，并且自带两个参数，即 <code>JNIEnv* env</code> 和 <code>jclass</code>（static 方法时）/<code>jobject</code>（普通方法时）：</p>
<pre><code class="cpp">#include &lt;jni.h&gt;
#include &lt;string&gt;
#include &quot;log.h&quot;

extern &quot;C&quot; {
JNIEXPORT jstring JNICALL
Java_com_assassinq_easycpp_MainActivity_sayHello(JNIEnv *env, jobject obj) {
    return env-&gt;NewStringUTF(&quot;Hello World&quot;);
}
}
</code></pre>
<p>静态注册有一些缺点：</p>
<ol>
<li>Native 函数名称特别长，不利于书写；</li>
<li>每次新增或删除接口时需要重新生成文件，比较繁琐；</li>
<li>第一次调用时需要根据函数名建立索引，影响效率；</li>
<li>JNI 层的函数名是由 Java 接口名生成，很容易通过 hook 调用动态库中的函数。</li>
</ol>
<h3 id="动态注册"><a href="#动态注册" class="headerlink" title="动态注册"></a>动态注册</h3><p>动态注册在 JNI 层通过重载 <code>JNI_OnLoad()</code> 函数来实现，系统初始化 JNI 在加载时，会调用 <code>JNI_OnLoad()</code>，而卸载时会调用 <code>JNI_UnLoad()</code>。原理是通过自定义方法把 C/C++ 函数映射到 JAVA 定义的方法，不需要通过 JAVA 方法名查找匹配 Native 函数名，也就不需要遵循静态注册的命名规则。</p>
<p>cpp 文件中的函数定义如下：</p>
<pre><code class="cpp">jstring sayHi(JNIEnv *env, jobject obj) {
    return env-&gt;NewStringUTF(&quot;Hi World&quot;);
}
</code></pre>
<p>通过内置函数 <code>RegisterNatives()</code> 实现自定义的注册方法：</p>
<pre><code class="cpp">static int registerNativeMethods(JNIEnv *env, const char *className, JNINativeMethod *gMethods, int numMethods) {
    jclass clazz;
    clazz = env-&gt;FindClass(className);
    if (clazz == NULL) {
        return JNI_FALSE;
    }
    if (env-&gt;RegisterNatives(clazz, gMethods, numMethods) &lt; 0) {
        return JNI_FALSE;
    }
    return JNI_TRUE;
}
</code></pre>
<p>定义 gClassName 和 gMethods 两个变量，分别表示需要查找的类名和需要注册的方法信息：</p>
<pre><code class="cpp">static const char *gClassName = &quot;com/assassinq/easycpp/MainActivity&quot;;
static JNINativeMethod gMethods[] = {
        {&quot;sayHi&quot;, &quot;()Ljava/lang/String;&quot;, (void *) sayHi},
};
</code></pre>
<p>其中方法信息的结构体如下，第一个变量为方法名，第二个变量为方法签名（字符串类型，以 Smali 代码的方式），第三个变量为对应的函数指针：</p>
<pre><code class="cpp">typedef struct {
    const char* name; // native 的方法名
    const char* signature; // 方法签名，例如 ()Ljava/lang/String;
    void*       fnPtr; // 函数指针
} JNINativeMethod;
</code></pre>
<p>最后重写 <code>JNI_OnLoad()</code> 函数：</p>
<pre><code class="cpp">JNIEXPORT jint JNI_OnLoad(JavaVM *vm, void *reserved) {
    JNIEnv *env = NULL;
    if (vm-&gt;GetEnv((void **)&amp;env, JNI_VERSION_1_6) != JNI_OK) {
        LOGE(&quot;This jni version is not supported&quot;);
        return -1;
    }
    if (registerNativeMethods(env, gClassName, gMethods, sizeof(gMethods) / sizeof(gMethods[0])) == JNI_FALSE) {
        LOGE(&quot;Unable to register native methods&quot;);
        return -1;
    }
    LOGE(&quot;Methods loaded successfully&quot;);
    return JNI_VERSION_1_6;
}
</code></pre>
<h2 id="so-动态链接库"><a href="#so-动态链接库" class="headerlink" title="so 动态链接库"></a>so 动态链接库</h2><p>在编译过程中，可以修改 app 目录下的 build.gradle 中的内容，使用 android.defaultConfig.ndk.abiFilters 来指示 Gradle 要构建和打包的 ABI 版本，生成不同架构下的动态链接库：</p>
<pre><code>android {
    ...
    defaultConfig {
        ...
        ndk {
            abiFilters &quot;armeabi-v7a&quot;, &quot;arm64-v8a&quot;, &quot;x86&quot;, &quot;x86_64&quot;
        }
    }
    ...
}
</code></pre><p>so 文件一般存放在 apk 的 lib 目录下（NDK r17 版本开始已经去掉了 armeabi、mips、mips64 的 ABI 支持）：</p>
<ul>
<li>armeabi-v7a：第 7 代及以上的 ARM 处理器。2011 年 15 月以后的生产的大部分 Android 设备都使用它。</li>
<li>arm64-v8a：第 8 代、64 位 ARM 处理器，很少设备，三星 Galaxy S6 是其中之一。</li>
<li>armabi：第 5 代、第 6 代的 ARM 处理器，早期的手机用的比较多。</li>
<li>x86：Intel x86（平板、模拟器用得比较多）。</li>
<li>x86_64：Intel x64（64 位的平板）。</li>
<li>…</li>
</ul>
<h2 id="IDA-反编译-so-文件"><a href="#IDA-反编译-so-文件" class="headerlink" title="IDA 反编译 so 文件"></a>IDA 反编译 so 文件</h2><p>用 IDA 打开编译后的 apk，可以看到 lib 中存在一个 libnative-lib.so：</p>
<p><img src="/pics/Android逆向入门/二/2.png" srcset="/img/loading.gif" alt></p>
<p>查看静态注册函数的反编译结果：</p>
<pre><code class="cpp">int __fastcall Java_com_assassinq_easycpp_MainActivity_sayHello(_JNIEnv *a1)
{
  return _JNIEnv::NewStringUTF(a1, &quot;Hello World&quot;);
}
</code></pre>
<p>查看动态注册的函数的反编译结果：</p>
<pre><code class="cpp">int __fastcall sayHi(_JNIEnv *a1)
{
  return _JNIEnv::NewStringUTF(a1, &quot;Hi World&quot;);
}
</code></pre>
<h1 id="IDA-动态调试-apk"><a href="#IDA-动态调试-apk" class="headerlink" title="IDA 动态调试 apk"></a>IDA 动态调试 apk</h1><ol>
<li>安装 apk 到手机：<code>adb install example.apk</code></li>
<li>将 IDA 目录下的调试文件 push 到手机上：<code>adb push android_server /data/local/tmp</code></li>
<li>赋给程序可执行权限：<code>chmod 777 android_server</code></li>
<li>启动调试服务端：<code>./android_server</code> （自定义设置端口方式：<code>-p23333</code>）</li>
<li>手机端端口转发至电脑端：<code>adb forward tcp:[pc_port] tcp:[mobile_port]</code></li>
<li>IDA 调试端口设置：Debugger-&gt;Process option</li>
<li>在 Debugger setup 中勾选 Suspend on process entry point、Suspend on thread start/exit 以及 Suspend on library load/unload</li>
<li>启动程序：<code>adb shell am start -D -n packageName/activityName</code></li>
<li>IDA 挂接到 Native 层：Debugger-&gt;Attach to process…</li>
<li>打开 monitor，监听并挂接到 JAVA 层：<code>jdb -connect com.sun.jdi.SocketAttach:hostname=127.0.0.1,port=8700</code></li>
</ol>
<p><img src="/pics/Android逆向入门/二/3.png" srcset="/img/loading.gif" alt></p>
<p>PS：如果在 monitor 中没有找到对应的进程，检查一下调试的程序中 AndroidManifest.xml 中是否设置了 <code>android:debuggable=&quot;true&quot;</code>（若没有则修改后并重新打包）。</p>
<h1 id="动态链接库文件（-so-文件）"><a href="#动态链接库文件（-so-文件）" class="headerlink" title="动态链接库文件（.so 文件）"></a>动态链接库文件（.so 文件）</h1><p>加载顺序：</p>
<pre><code>init_array -&gt; JNI_OnLoad -&gt; ... -&gt; fini_array
</code></pre><h2 id="so-文件查看工具"><a href="#so-文件查看工具" class="headerlink" title="so 文件查看工具"></a>so 文件查看工具</h2><h3 id="readelf"><a href="#readelf" class="headerlink" title="readelf"></a>readelf</h3><table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>-a</code></td>
<td style="text-align:center">显示 so 文件的所有信息</td>
</tr>
<tr>
<td style="text-align:center"><code>-h</code></td>
<td style="text-align:center">显示 ELF 文件头</td>
</tr>
<tr>
<td style="text-align:center"><code>-l</code></td>
<td style="text-align:center">显示 Program Headers，动态加载时需要的信息</td>
</tr>
<tr>
<td style="text-align:center"><code>-S</code></td>
<td style="text-align:center">显示 Section Headers，静态加载分析时需要的信息</td>
</tr>
<tr>
<td style="text-align:center"><code>-e</code></td>
<td style="text-align:center">显示 ELF Header、Section Headers、Program Headers 信息</td>
</tr>
<tr>
<td style="text-align:center"><code>-s</code></td>
<td style="text-align:center">显示符号表（Symbol Table）</td>
</tr>
<tr>
<td style="text-align:center"><code>-d</code></td>
<td style="text-align:center">显示动态节区（Dynamic Section）</td>
</tr>
</tbody>
</table>
<p>显示 ELF 文件头：</p>
<pre><code class="bash">$ readelf -h libnative-lib.so
ELF Header:
  Magic:   7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00
  Class:                             ELF32
  Data:                              2&#39;s complement, little endian
  Version:                           1 (current)
  OS/ABI:                            UNIX - System V
  ABI Version:                       0
  Type:                              DYN (Shared object file)
  Machine:                           ARM
  Version:                           0x1
  Entry point address:               0x0
  Start of program headers:          52 (bytes into file)
  Start of section headers:          12932 (bytes into file)
  Flags:                             0x5000200, Version5 EABI, soft-float ABI
  Size of this header:               52 (bytes)
  Size of program headers:           32 (bytes)
  Number of program headers:         8
  Size of section headers:           40 (bytes)
  Number of section headers:         27
  Section header string table index: 26
</code></pre>
<p>显示 Program headers：</p>
<pre><code class="bash">$ readelf -l libnative-lib.so

Elf file type is DYN (Shared object file)
Entry point 0x0
There are 8 program headers, starting at offset 52

Program Headers:
  Type           Offset   VirtAddr   PhysAddr   FileSiz MemSiz  Flg Align
  PHDR           0x000034 0x00000034 0x00000034 0x00100 0x00100 R   0x4
  LOAD           0x000000 0x00000000 0x00000000 0x02ab6 0x02ab6 R E 0x1000
  LOAD           0x002e3c 0x00003e3c 0x00003e3c 0x001dc 0x001dd RW  0x1000
  DYNAMIC        0x002e8c 0x00003e8c 0x00003e8c 0x00110 0x00110 RW  0x4
  NOTE           0x000134 0x00000134 0x00000134 0x000bc 0x000bc R   0x4
  GNU_STACK      0x000000 0x00000000 0x00000000 0x00000 0x00000 RW  0x10
  EXIDX          0x0021f4 0x000021f4 0x000021f4 0x001b8 0x001b8 R   0x4
  GNU_RELRO      0x002e3c 0x00003e3c 0x00003e3c 0x001c4 0x001c4 RW  0x4

 Section to Segment mapping:
  Segment Sections...
   00
   01     .note.android.ident .note.gnu.build-id .dynsym .dynstr .gnu.hash .hash .gnu.version .gnu.version_d .gnu.version_r .rel.dyn .rel.plt .plt .text .ARM.exidx .ARM.extab .rodata
   02     .fini_array .data.rel.ro .dynamic .got .data .bss
   03     .dynamic
   04     .note.android.ident .note.gnu.build-id
   05
   06     .ARM.exidx
   07     .fini_array .data.rel.ro .dynamic .got
</code></pre>
<p>显示 Section headers：</p>
<pre><code class="bash">$ readelf -S libnative-lib.so
There are 27 section headers, starting at offset 0x3284:

Section Headers:
  [Nr] Name              Type            Addr     Off    Size   ES Flg Lk Inf Al
  [ 0]                   NULL            00000000 000000 000000 00      0   0  0
  [ 1] .note.android.ide NOTE            00000134 000134 000098 00   A  0   0  4
  [ 2] .note.gnu.build-i NOTE            000001cc 0001cc 000024 00   A  0   0  4
  [ 3] .dynsym           DYNSYM          000001f0 0001f0 000190 10   A  4   1  4
  [ 4] .dynstr           STRTAB          00000380 000380 0001d3 00   A  0   0  1
  [ 5] .gnu.hash         GNU_HASH        00000554 000554 00004c 04   A  3   0  4
  [ 6] .hash             HASH            000005a0 0005a0 0000b0 04   A  3   0  4
  [ 7] .gnu.version      VERSYM          00000650 000650 000032 02   A  3   0  2
  [ 8] .gnu.version_d    VERDEF          00000684 000684 00001c 00   A  4   1  4
  [ 9] .gnu.version_r    VERNEED         000006a0 0006a0 000040 00   A  4   2  4
  [10] .rel.dyn          REL             000006e0 0006e0 0000e8 08   A  3   0  4
  [11] .rel.plt          REL             000007c8 0007c8 000088 08  AI  3  20  4
  [12] .plt              PROGBITS        00000850 000850 0000e0 00  AX  0   0  4
  [13] .text             PROGBITS        00000930 000930 0018c4 00  AX  0   0  4
  [14] .ARM.exidx        ARM_EXIDX       000021f4 0021f4 0001b8 08  AL 13   0  4
  [15] .ARM.extab        PROGBITS        000023ac 0023ac 0001a4 00   A  0   0  4
  [16] .rodata           PROGBITS        00002550 002550 000566 01 AMS  0   0  1
  [17] .fini_array       FINI_ARRAY      00003e3c 002e3c 000008 04  WA  0   0  4
  [18] .data.rel.ro      PROGBITS        00003e44 002e44 000048 00  WA  0   0  4
  [19] .dynamic          DYNAMIC         00003e8c 002e8c 000110 08  WA  4   0  4
  [20] .got              PROGBITS        00003f9c 002f9c 000064 00  WA  0   0  4
  [21] .data             PROGBITS        00004000 003000 000018 00  WA  0   0  4
  [22] .bss              NOBITS          00004018 003018 000001 00  WA  0   0  1
  [23] .comment          PROGBITS        00000000 003018 000109 01  MS  0   0  1
  [24] .note.gnu.gold-ve NOTE            00000000 003124 00001c 00      0   0  4
  [25] .ARM.attributes   ARM_ATTRIBUTES  00000000 003140 000034 00      0   0  1
  [26] .shstrtab         STRTAB          00000000 003174 00010f 00      0   0  1
Key to Flags:
  W (write), A (alloc), X (execute), M (merge), S (strings)
  I (info), L (link order), G (group), T (TLS), E (exclude), x (unknown)
  O (extra OS processing required) o (OS specific), p (processor specific)
</code></pre>
<p>显示符号表：</p>
<pre><code class="bash">$ readelf -s libnative-lib.so

Symbol table &#39;.dynsym&#39; contains 25 entries:
   Num:    Value  Size Type    Bind   Vis      Ndx Name
     0: 00000000     0 NOTYPE  LOCAL  DEFAULT  UND
     1: 00000000     0 FUNC    GLOBAL DEFAULT  UND __cxa_atexit@LIBC (2)
     2: 00000000     0 FUNC    GLOBAL DEFAULT  UND __cxa_finalize@LIBC (2)
     3: 00000000     0 OBJECT  GLOBAL DEFAULT  UND __stack_chk_guard@LIBC (2)
     4: 00000000     0 FUNC    GLOBAL DEFAULT  UND __stack_chk_fail@LIBC (2)
     5: 00000000     0 FUNC    GLOBAL DEFAULT  UND __android_log_print
     6: 00000000     0 OBJECT  GLOBAL DEFAULT  UND __sF@LIBC (2)
     7: 00000000     0 FUNC    GLOBAL DEFAULT  UND abort@LIBC (2)
     8: 00000000     0 FUNC    GLOBAL DEFAULT  UND fflush@LIBC (2)
     9: 00000000     0 FUNC    GLOBAL DEFAULT  UND fprintf@LIBC (2)
    10: 00000000     0 FUNC    GLOBAL DEFAULT  UND dladdr@LIBC (3)
    11: 00000000     0 FUNC    GLOBAL DEFAULT  UND __aeabi_memclr8
    12: 00000000     0 FUNC    GLOBAL DEFAULT  UND __aeabi_memcpy
    13: 00000000     0 FUNC    GLOBAL DEFAULT  UND __gnu_Unwind_Find_exidx
    14: 00000000     0 FUNC    GLOBAL DEFAULT  UND snprintf@LIBC (2)
    15: 00004018     0 NOTYPE  GLOBAL DEFAULT  ABS _edata
    16: 00004019     0 NOTYPE  GLOBAL DEFAULT  ABS _end
    17: 00000975    36 FUNC    GLOBAL DEFAULT   13 Java_com_assassinq_easycp
    18: 00000999    44 FUNC    WEAK   DEFAULT   13 _ZN7_JNIEnv12NewStringUTF
    19: 00000b87    72 FUNC    WEAK   DEFAULT   13 _ZN7_JNIEnv15RegisterNati
    20: 00000b5d    42 FUNC    WEAK   DEFAULT   13 _ZN7_JNIEnv9FindClassEPKc
    21: 00004018     0 NOTYPE  GLOBAL DEFAULT  ABS __bss_start
    22: 000009e9   224 FUNC    GLOBAL DEFAULT   13 JNI_OnLoad
    23: 00000ac9    52 FUNC    WEAK   DEFAULT   13 _ZN7_JavaVM6GetEnvEPPvi
    24: 000009c5    36 FUNC    GLOBAL DEFAULT   13 sayHi
</code></pre>
<p>显示 Dynamic Section：</p>
<pre><code class="bash">$ readelf -d libnative-lib.so

Dynamic section at offset 0x2e8c contains 29 entries:
  Tag        Type                         Name/Value
 0x00000003 (PLTGOT)                     0x3fb0
 0x00000002 (PLTRELSZ)                   136 (bytes)
 0x00000017 (JMPREL)                     0x7c8
 0x00000014 (PLTREL)                     REL
 0x00000011 (REL)                        0x6e0
 0x00000012 (RELSZ)                      232 (bytes)
 0x00000013 (RELENT)                     8 (bytes)
 0x6ffffffa (RELCOUNT)                   26
 0x00000006 (SYMTAB)                     0x1f0
 0x0000000b (SYMENT)                     16 (bytes)
 0x00000005 (STRTAB)                     0x380
 0x0000000a (STRSZ)                      467 (bytes)
 0x6ffffef5 (GNU_HASH)                   0x554
 0x00000004 (HASH)                       0x5a0
 0x00000001 (NEEDED)                     Shared library: [liblog.so]
 0x00000001 (NEEDED)                     Shared library: [libm.so]
 0x00000001 (NEEDED)                     Shared library: [libdl.so]
 0x00000001 (NEEDED)                     Shared library: [libc.so]
 0x0000000e (SONAME)                     Library soname: [libnative-lib.so]
 0x0000001a (FINI_ARRAY)                 0x3e3c
 0x0000001c (FINI_ARRAYSZ)               8 (bytes)
 0x0000001e (FLAGS)                      BIND_NOW
 0x6ffffffb (FLAGS_1)                    Flags: NOW
 0x6ffffff0 (VERSYM)                     0x650
 0x6ffffffc (VERDEF)                     0x684
 0x6ffffffd (VERDEFNUM)                  1
 0x6ffffffe (VERNEED)                    0x6a0
 0x6fffffff (VERNEEDNUM)                 2
 0x00000000 (NULL)                       0x0
</code></pre>
<h3 id="SO-Helper"><a href="#SO-Helper" class="headerlink" title="SO Helper"></a>SO Helper</h3><p>无名侠大佬开发的软件。可以用来快速地获取 so 文件的一些基本信息，提供较弱的汇编功能。</p>
<h1 id="ARM-汇编代码"><a href="#ARM-汇编代码" class="headerlink" title="ARM 汇编代码"></a>ARM 汇编代码</h1><p>ARM 是 ARM 公司的 32 位处理器，其汇编指令的机器码就是 32 位。</p>
<ol>
<li>ARM 汇编语言是一门“低级”语言可以和系统的底层相互沟通；</li>
<li>ARM 汇编语言编写的程序运行速度快，占用内存少；</li>
<li>ARM 编写的代码难懂，难以维护；</li>
<li>C 语言能实现的 ARM 汇编语言都能实现；</li>
<li>ARM 具有 31 个通用寄存器，6 个状态寄存器；</li>
<li>ARM 处理器支持 7 种运行模式。<ol>
<li>用户模式：ARM 处理器正常的程序执行状态。</li>
<li>快速中断模式：用于高速数据传输或通道处理。</li>
<li>外部中断模式：用于通用的中断处理。</li>
<li>管理模式：操作系统使用的保护模式。</li>
<li>数据访问终止模式：当数据或指令预取终止时进如该模式，可用于模拟存储及存储保护。</li>
<li>系统模式：运行具有特权的操作系统任务。</li>
<li>未定义指令中止模式：当未定义的指令执行时进入该模式。</li>
</ol>
</li>
</ol>
<blockquote>
<p>ARM 汇编难以分析的原因：IDA 自身的缺陷；函数库与类有时无法识别；自身对 ARM 汇编的熟练度。</p>
</blockquote>
<h2 id="函数参数传递"><a href="#函数参数传递" class="headerlink" title="函数参数传递"></a>函数参数传递</h2><p>遵循 ATPCS 规则，前 4 个参数使用 R0~R3 传递，剩余参数通过堆栈传递。</p>
<h2 id="ARM-和-Thumb"><a href="#ARM-和-Thumb" class="headerlink" title="ARM 和 Thumb"></a>ARM 和 Thumb</h2><p>Thumb 是 16 位的 ARM 汇编。一般地，ARM 每行代码占 4 个字节码，Thumb 每个指令占 2 个字节。两者不能混用，但可以通过 BX、BLX 等指令在跳转的时候实现切换。在动态调试的时候，IDA 对 ARM 和 Thumb 的分析会混淆，可以用 Alt+G 来修改相应的识别。</p>
<h2 id="ARM-寄存器"><a href="#ARM-寄存器" class="headerlink" title="ARM 寄存器"></a>ARM 寄存器</h2><ul>
<li>R0-R7：通用寄存器</li>
<li>R8-R10：不常用的通用寄存器</li>
<li>R11：基质寄存器（FP）</li>
<li>R12：暂时寄存器（IP）</li>
<li>R13：堆栈制作（SP）</li>
<li>R14：链接寄存器（LR）</li>
<li>CPSR：状态寄存器</li>
</ul>
<h2 id="ARM-指令"><a href="#ARM-指令" class="headerlink" title="ARM 指令"></a>ARM 指令</h2><h3 id="寄存器交互指令"><a href="#寄存器交互指令" class="headerlink" title="寄存器交互指令"></a>寄存器交互指令</h3><ul>
<li>LDR：从存储器中加载数据到寄存器。<ul>
<li><code>LDR R1, [R2]</code>：把 R2 指向的位置的数据给 R1</li>
</ul>
</li>
<li>STR：把寄存器的数据存储到存储器<ul>
<li><code>STR R1, [R2]</code>：在 R2 指向的地址，存储 R1</li>
</ul>
</li>
<li>LDM：将存储器的数据加载到一个寄存器列表。<ul>
<li><code>LDM R0, {R1, R2, R3}</code>：把 R0 中的数据一次加载到 R1、R2、R3</li>
</ul>
</li>
<li>SDM：将一个寄存器列表的数据存储到指定的存储器<ul>
<li><code>SDM R0, {R1, R2, R3}</code>：把 R1、R2、R3 加载到 R0 单元</li>
</ul>
</li>
<li>PUSH：入栈</li>
<li>POP：出栈</li>
</ul>
<h3 id="数据传送指令"><a href="#数据传送指令" class="headerlink" title="数据传送指令"></a>数据传送指令</h3><ul>
<li>MOV：将立即数或寄存器的数据传送到目标寄存器</li>
</ul>
<h3 id="数据算数运算指令"><a href="#数据算数运算指令" class="headerlink" title="数据算数运算指令"></a>数据算数运算指令</h3><h4 id="ADD（加法）"><a href="#ADD（加法）" class="headerlink" title="ADD（加法）"></a>ADD（加法）</h4><p>ADD 将把两个操作数加起来，把结果放置到目的寄存器中。操作数 1 是一个寄存器，操作数 2 可以是一个寄存器，被移位的寄存器，或一个立即值。</p>
<pre><code class="arm">ADD R0, R1, R2 @ R0 = R1 + R2
ADD R0, R1, #256 @ R0 = R1 + 256
ADD R0, R2, R3, LSL#1 @ R0 = R2 + (R3 &lt;&lt; 1)
</code></pre>
<p>加法可以在有符号和无符号数上进行。</p>
<ul>
<li>ADC：带进位的加法</li>
</ul>
<h4 id="SUB（减法）"><a href="#SUB（减法）" class="headerlink" title="SUB（减法）"></a>SUB（减法）</h4><p>SUB 用操作数 1 减去操作数 2，把结果放置到目的寄存器中。操作数 1 是一个寄存器，操作数 2 可以是一个寄存器，被移位的寄存器，或一个立即值。</p>
<pre><code class="arm">SUB R0, R1, R2 @ R0 = R1 - R2
SUB R0, R1, #256 @ R0 = R1 - 256
SUB R0, R2, R3, LSL#1 @ R0 = R2 - (R3 &lt;&lt; 1)
</code></pre>
<p>减法可以在有符号和无符号数上进行。</p>
<ul>
<li>SBC：带进位的减法</li>
</ul>
<h4 id="MUL（乘法）和-DIV（除法）"><a href="#MUL（乘法）和-DIV（除法）" class="headerlink" title="MUL（乘法）和 DIV（除法）"></a>MUL（乘法）和 DIV（除法）</h4><ul>
<li>给出的所有操作数、和目的寄存器必须为简单的寄存器。</li>
<li>不能对操作数 2 使用立即值或被移位的寄存器。</li>
<li>目的寄存器和操作数 1 必须是不同的寄存器。</li>
<li>不能指定 R15 为目的寄存器</li>
</ul>
<p>MUL 提供 32 位整数乘法。如果操作数是有符号的，可以假定结果也是有符号的。</p>
<ul>
<li>MLA：带累加的乘法</li>
</ul>
<p>除法指令 DIV 的条件与乘法类似。</p>
<ul>
<li>SDIV：带符号除法</li>
<li>UDIV：不带符号位除法</li>
</ul>
<h3 id="数据逻辑运算指令"><a href="#数据逻辑运算指令" class="headerlink" title="数据逻辑运算指令"></a>数据逻辑运算指令</h3><ul>
<li>AND：与</li>
<li>ORR：或</li>
<li>EOR：异或</li>
<li>LSL：逻辑左移</li>
<li>LSR：逻辑右移</li>
</ul>
<h3 id="比较指令"><a href="#比较指令" class="headerlink" title="比较指令"></a>比较指令</h3><ul>
<li>CMP：比较指令</li>
</ul>
<h3 id="其他指令"><a href="#其他指令" class="headerlink" title="其他指令"></a>其他指令</h3><ul>
<li>SWT：切换用户模式</li>
<li>DCB：伪指令</li>
</ul>
<h3 id="跳转指令"><a href="#跳转指令" class="headerlink" title="跳转指令"></a>跳转指令</h3><ul>
<li>B：无条件跳转</li>
<li>BL：带链接的无条件跳转</li>
<li>BLX：带状态的无条件跳转</li>
<li>BNE：不相等跳转</li>
<li>BEQ：相等跳转</li>
</ul>
<h4 id="偏移地址计算"><a href="#偏移地址计算" class="headerlink" title="偏移地址计算"></a>偏移地址计算</h4><ul>
<li>ARM：低 27 位是偏移位置<ul>
<li>偏移 = (目标地址 - 当前 PC 地址) / 指令长度</li>
<li>正数下跳，负数上跳</li>
</ul>
</li>
<li>Thumb 同理</li>
<li>目标地址 = 偏移 * 指令长度 + 当前偏移地址</li>
</ul>
<h2 id="ARM-代码编写"><a href="#ARM-代码编写" class="headerlink" title="ARM 代码编写"></a>ARM 代码编写</h2><p>处理器架构定义：</p>
<ul>
<li><code>.arch</code> 指定了 ARM 处理器架构。</li>
<li><code>armv5te</code> 表示本程序在 armv5te 架构处理器上运行。</li>
<li><code>.fpu</code> 指定了协处理器的类型。</li>
<li><code>softvfp</code> 表示使用浮点运算库来模拟协处理运算。</li>
<li><code>.ebi_attribute</code> 指定了一些接口属性。</li>
</ul>
<pre><code class="arm">.arch armv5te @处理器架构
.fpu softvfp  @协处理器类型
.ebi_attribute 20, 1 @接口属性
.ebi_attribute 21, 1
.ebi_attribute 23, 1
.ebi_attribute 24, 1
.ebi_attribute 25, 1
.ebi_attribute 26, 1
.ebi_attribute 30, 1
.ebi_attribute 18, 1
</code></pre>
<p>段定义：</p>
<ul>
<li><code>.section</code>：定义只读数据，属性是默认</li>
<li><code>.text</code>：定义了代码段。</li>
</ul>
<p>注释方法：</p>
<ul>
<li><code>/.../</code>：多行注释</li>
<li><code>@</code>：单行注释</li>
</ul>
<p>标号方式（和 8086 类似）：</p>
<pre><code class="arm">loop:
    ...
end loop
</code></pre>
<p>程序中所有以“.”开头的指令都是汇编指令，他们不属于 ARM 指令集：</p>
<ul>
<li>.file：制定了源文件名。</li>
<li>.align：代码对其方式。</li>
<li>.ascii：声明字符串。</li>
<li>.global：声明全局变量。</li>
<li>.type：指定符号的类型。</li>
</ul>
<p>声明函数的方法：</p>
<pre><code class="arm">.global 函数名
.type 函数名, %function
函数名:
    &lt;...函数体...&gt;
声明一个实现两个数相加的函数的代码
.global MyAdd
.type MyAdd, &amp;function
MyAdd:
    ADD R0, R0, R1
    MOV PC, LR
</code></pre>
<h2 id="ARM-处理器寻址方式"><a href="#ARM-处理器寻址方式" class="headerlink" title="ARM 处理器寻址方式"></a>ARM 处理器寻址方式</h2><h3 id="立即寻址"><a href="#立即寻址" class="headerlink" title="立即寻址"></a>立即寻址</h3><pre><code class="arm">@ 井号（#）作为前缀，表示16进制时以“0x”开头
MOV R0，#1234 @ R0=0x1234
</code></pre>
<h3 id="寄存器寻址"><a href="#寄存器寻址" class="headerlink" title="寄存器寻址"></a>寄存器寻址</h3><pre><code class="arm">MOV R0, R1 @ R0=R1
</code></pre>
<h3 id="寄存器移位寻址"><a href="#寄存器移位寻址" class="headerlink" title="寄存器移位寻址"></a>寄存器移位寻址</h3><p>五种移位操作：</p>
<ul>
<li>LSL：逻辑左移，移位后寄存器空出的低位补 0；</li>
<li>LSR：逻辑右移，移位后寄存器空出的高位补 0；</li>
<li>ASR：算数右移，移动过程中符号位不变。如果操作数是整数，则移位后空出的高位补 0，否则补 1；</li>
<li>ROR：循环右移，移位后移出的低位填入移位空出的高位；</li>
<li>RRX：带扩展的循环右移，操作数右移移位，移位空出的高位用 C 标志的值填充。</li>
</ul>
<pre><code class="arm">MOV R0, R1, LSL#2 @ R0=R1*4
</code></pre>
<h3 id="寄存器间接寻址"><a href="#寄存器间接寻址" class="headerlink" title="寄存器间接寻址"></a>寄存器间接寻址</h3><pre><code class="arm">LDR R0，[R1] @ 将R1寄存器中的值作为地址，取出地址中的值赋予R0
</code></pre>
<h3 id="寄存器间接基址偏移寻址"><a href="#寄存器间接基址偏移寻址" class="headerlink" title="寄存器间接基址偏移寻址"></a>寄存器间接基址偏移寻址</h3><pre><code class="arm">LDR R0, [R1, #-4] @ 将R1寄存器的值-0x4的值作为地址，取出地址中的值给R0
</code></pre>
<h3 id="多寄存器寻址"><a href="#多寄存器寻址" class="headerlink" title="多寄存器寻址"></a>多寄存器寻址</h3><pre><code class="arm">@ LDM 是数据加载命令，指令的后缀IA表示每次执行完成加载操作后R0寄存器的值自增1
LDMIA R0, {R1, R2, R3, R4}
@ R1=[R0]
@ R2=[R0+#4]
@ R3=[R0+#8]
@ R4=[R0+#12]
@ ARM中，字表示的是一个32位。这里+#4的原因是因为32位占4个字节
</code></pre>
<h3 id="堆栈寻址"><a href="#堆栈寻址" class="headerlink" title="堆栈寻址"></a>堆栈寻址</h3><pre><code class="arm">STMFD SP!, {R1-R7, LR} @ 入栈，多用于保存子程序堆栈
LDMFD SP!, {R1-R7, LR} @ 出栈，多用于恢复子程序堆栈
</code></pre>
<h3 id="块拷贝寻址"><a href="#块拷贝寻址" class="headerlink" title="块拷贝寻址"></a>块拷贝寻址</h3><p>块拷贝可实现连续地址数据从存储器的某一位置拷贝到另一位置。</p>
<pre><code class="arm">LDMIA R0!, {R1-R3} @ 从寄存器指向的存储单元中读取3个字到R1-R3寄存器。
</code></pre>
<h3 id="相对寻址"><a href="#相对寻址" class="headerlink" title="相对寻址"></a>相对寻址</h3><p>相对寻址一程序计数器 PC 的当前值为基地址，指令中的地址标号作为偏移量，将两者相加之后得到的操作数的有效地址。</p>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><p><a href="https://www.bilibili.com/video/av45424886" target="_blank" rel="noopener">https://www.bilibili.com/video/av45424886</a><br><a href="https://blog.csdn.net/miao_007/article/details/87632758" target="_blank" rel="noopener">https://blog.csdn.net/miao_007/article/details/87632758</a><br><a href="https://stackoverflow.com/questions/4629308/any-simple-way-to-log-in-android-ndk-code" target="_blank" rel="noopener">https://stackoverflow.com/questions/4629308/any-simple-way-to-log-in-android-ndk-code</a><br><a href="https://www.jianshu.com/p/acbf724fdcc9" target="_blank" rel="noopener">https://www.jianshu.com/p/acbf724fdcc9</a><br><a href="https://blog.csdn.net/afei__/article/details/81031965" target="_blank" rel="noopener">https://blog.csdn.net/afei__/article/details/81031965</a><br><a href="https://www.luoxudong.com/360.html" target="_blank" rel="noopener">https://www.luoxudong.com/360.html</a><br><a href="https://www.jianshu.com/p/23af9151837e" target="_blank" rel="noopener">https://www.jianshu.com/p/23af9151837e</a><br><a href="https://juejin.im/post/5afe28446fb9a07aa0483d0a" target="_blank" rel="noopener">https://juejin.im/post/5afe28446fb9a07aa0483d0a</a><br><a href="https://www.52pojie.cn/thread-699268-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-699268-1-1.html</a><br><a href="https://www.52pojie.cn/thread-673175-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-673175-1-1.html</a></p>

            </div>
            <hr>
            <div>
              <p>
                
                
                  <span>
                <i class="iconfont icon-tag"></i>
                    
                      <a class="hover-with-bg" href="/tags/re/">re</a>
                    
                      <a class="hover-with-bg" href="/tags/android/">android</a>
                    
                  </span>
                
              </p>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" rel="nofollow noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-12 col-md-6">
                    
                      <a href="/2020/02/05/Nexus5刷机、Root并安装Xposed框架/">
                        <i class="fa fa-chevron-left"></i>
                        <span>Nexus5刷机、Root并安装Xposed框架</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-12 col-md-6">
                    
                      <a href="/2020/01/24/2019-CISCN-strange-int/">
                        <span>2019-CISCN-strange_int</span>
                        <i class="fa fa-chevron-right"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

              
          </div>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc-start"></div>
<div id="toc">
  <p class="h5"><i class="far fa-list-alt"></i>&nbsp;TOC</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a class="z-depth-1" id="scroll-top-button" href="#" role="button">
      <i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="http://blog.b3ale.cn" target="_blank" rel="nofollow noopener"><b>Hard Work Pays Off.</b></a>
    </div>
    
  <div>
    
      <!-- 不蒜子统计PV -->
      
      <span id="busuanzi_container_site_pv" style="display: none">
      总访问量 <span id="busuanzi_value_site_pv"></span> 次
    </span>
    
    
      <!-- 不蒜子统计UV -->
      
      <span id="busuanzi_container_site_uv" style="display: none">
      总访客数 <span id="busuanzi_value_site_uv"></span> 人
    </span>
    
  </div>


    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.staticfile.org/popper.js/1.16.1/umd/popper.min.js"></script>
<script src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script>
<script src="https://cdn.staticfile.org/mdbootstrap/4.13.0/js/mdb.min.js"></script>
<script src="/js/main.js"></script>


  <script src="/js/lazyload.js"></script>



  
  <script src="https://cdn.staticfile.org/tocbot/4.10.0/tocbot.min.js"></script>
  <script>
    $(document).ready(function () {
      var navHeight = $('#navbar').height();
      var toc = $('#toc');
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;
      var tocLimMax = 2 * boardTop + boardCtn.height();

      $(window).scroll(function () {
        var tocLimMin = $('#toc-start').offset().top - navHeight;
        var scroH = document.body.scrollTop + document.documentElement.scrollTop;

        if (tocLimMin <= scroH && scroH <= tocLimMax) {
          toc.css({
            'display': 'block',
            'position': 'fixed',
            'top': navHeight,
          });
        } else if (scroH <= tocLimMin) {
          toc.css({
            'position': '',
            'top': '',
          });
        } else if (scroH > tocLimMax) {
          toc.css('display', 'none');
        }
      });
      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '.post-content',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc > p').css('visibility', 'visible');
      }
      var offset = boardCtn.css('margin-right')
      $('#toc-ctn').css({
        'right': offset
      })
    });
  </script>







  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<!-- Plugins -->



  <script src="https://cdn.staticfile.org/prettify/188.0.0/prettify.min.js"></script>
  <script>
    $(document).ready(function () {
      $('pre').addClass('prettyprint  linenums');
      prettyPrint();
    })
  </script>



  <script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "Android逆向入门（二）&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js"></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script src="/js/local-search.js"></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script defer src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script>
  <script>
    $("#post img:not(.no-zoom img, img[no-zoom])").each(
      function () {
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "images");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      }
    );
  </script>



  

  
    <!-- MathJax -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
          tex2jax: {
              inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
              processEscapes: true,
              skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
          }
      });

      MathJax.Hub.Queue(function() {
          var all = MathJax.Hub.getAllJax(), i;
          for(i=0; i < all.length; i += 1) {
              all[i].SourceElement().parentNode.className += ' has-jax';
          }
      });

    </script>

    <script src="https://cdn.staticfile.org/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->

  










</body>
</html>
