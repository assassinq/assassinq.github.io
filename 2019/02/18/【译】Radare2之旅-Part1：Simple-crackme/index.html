<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>【译】Radare2之旅-Part1：Simple crackme | AssassinQ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="retranslation">
  
  
  
  
  <meta name="description" content="翻译自Megabeets。">
<meta name="keywords" content="re,translation">
<meta property="og:type" content="article">
<meta property="og:title" content="【译】Radare2之旅-Part1：Simple crackme">
<meta property="og:url" content="blog.b3ale.cn/2019/02/18/【译】Radare2之旅-Part1：Simple-crackme/index.html">
<meta property="og:site_name" content="AssassinQ">
<meta property="og:description" content="翻译自Megabeets。">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://www.megabeets.net/uploads/r2_part1_1.png">
<meta property="og:image" content="https://www.megabeets.net/uploads/r2_learning_curve.png">
<meta property="og:image" content="https://www.megabeets.net/uploads/visualMode_1.png">
<meta property="og:image" content="https://www.megabeets.net/uploads/visualGraph_1.png">
<meta property="og:image" content="https://www.megabeets.net/uploads/visualGraph_beet1.png">
<meta property="og:image" content="https://www.megabeets.net/uploads/visualGraph_beet2.png">
<meta property="og:updated_time" content="2019-08-26T01:13:50.215Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="【译】Radare2之旅-Part1：Simple crackme">
<meta name="twitter:description" content="翻译自Megabeets。">
<meta name="twitter:image" content="https://www.megabeets.net/uploads/r2_part1_1.png">
  
    <link rel="alternate" href="/atom.xml" title="AssassinQ" type="application/atom+xml">
  
  <link rel="icon" href="/css/images/favicon.ico">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">

  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Oswald%3A300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css">
  <link rel="stylesheet" href="/css/fashion.css">
  <link rel="stylesheet" href="/css/glyphs.css"><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>
</html>


  <body data-spy="scroll" data-target="#toc" data-offset="50">


  
  
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="site-header-image">
    <img id="originBg" width="100%" alt="Hike News" src>
  </div>

  <div id="header-blur" class="site-header-image blur" style="position: absolute; top:0; height: 207px; min-height: 207px; min-width: 100%;">
    <img id="blurBg" width="100%" style="top: 96%" alt="Hike News" src>
  </div>

  <script>
        var imgUrls = "css/images/pose01.jpg".split(",");
        var random = Math.floor((Math.random() * imgUrls.length ));
        if (imgUrls[random].startsWith('http') || imgUrls[random].indexOf('://') >= 0) {
          document.getElementById("originBg").src=imgUrls[random];
          document.getElementById("blurBg").src=imgUrls[random];
        } else {
          document.getElementById("originBg").src='/' + imgUrls[random];
          document.getElementById("blurBg").src='/' + imgUrls[random];
        }
    </script>




<header id="allheader" class="site-header" role="banner" style="width: 100%; position: absolute; top:0; background: rgba(255,255,255,.8);">
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/" title="AssassinQ" rel="home"> AssassinQ </a>
            
          </h1>
          
          
            <div class="site-description">ZJGSU-IS-17</div>
          
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>

            <div class="clearfix sf-menu">
              <ul id="main-nav" class="menu sf-js-enabled sf-arrows" style="touch-action: pan-y;">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class href="/">Home</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class href="/archives">Archives</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class href="/tags">Tags</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class href="/about">About</a> </li>
                    
              </ul>
            </div>
          </nav>

      </div>
  </div>
</header>


  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-【译】Radare2之旅-Part1：Simple-crackme" style="width: 66%; float:left;" class="article article-type-post" itemscope itemprop="blogPost">
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      【译】Radare2之旅-Part1：Simple crackme
    </h1>
  

      </header>
    
    <div class="article-meta">
      	<a href="/2019/02/18/【译】Radare2之旅-Part1：Simple-crackme/" class="article-date">
	  <time datetime="2019-02-18T04:17:27.000Z" itemprop="datePublished">February 18, 2019</time>
	</a>

       
      

	  |
	  5.6k words
	  |
	  23 minute(s) to read
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>翻译自<a href="https://www.megabeets.net/a-journey-into-radare-2-part-1/" target="_blank" rel="noopener">Megabeets</a>。</p>
<a id="more"></a>
<h1 id="序言"><a href="#序言" class="headerlink" title="序言"></a>序言</h1><p>过去一年里的 CTF 比赛中，不论是逆向工程（RE）还是漏洞挖掘（PWN），我一直在用<code>radare2</code>。我发现<code>radare2</code>对于很多 CTF 的题目来说都很有用，极大地缩短了我的做题时间。遗憾的是熟悉 radare2 的人太少了。可能大家都习惯了使用<code>IDA Pro</code>、<code>OllyDBG</code>还有<code>gdb</code>，或者没有听说过它。不管怎么样，我都认为<code>radare2</code>应该成为你工具箱中的一部分。</p>
<p>因为我真的特别喜欢这个项目，而且我希望能有越来越多的人开始熟悉它、使用它，能对项目做出一些贡献。我计划写一系列的文章以及使用<code>r2</code>的例子。因为那些文章都涉及<code>radare2</code>的特点和功能，我会解释的更加详细。</p>
<p><img src="https://www.megabeets.net/uploads/r2_part1_1.png" alt="Welcome to IDA 10.0. （在 radare2/doc/fortunes.fun 查看更多）"></p>
<h1 id="radare2"><a href="#radare2" class="headerlink" title="radare2"></a><code>radare2</code></h1><p><code>radare2</code>是一个逆向工程和二进制分析的开源框架，它有很多命令行接口，包括反汇编、分析数据、打补丁、比较数据、查找、替换、可视化等等功能。同时它可以在几乎所有的主要操作系统（<code>GNU/Linux</code>、<code>.Windows</code>、<code>*BSD</code>、<code>iOS</code>、<code>OSX</code>、<code>Solaris</code>等等）上运行，并且支持许多 CPU 架构和文件格式。他所有的特点可以展现出一个思想——<code>radare2</code>是绝对自由的。</p>
<p>该框架是一个工具的集合，既可以在<code>r2</code>给出的 shell 下使用，又可以独立使用——比如我们将要了解的<code>rahash2</code>、<code>rabin2</code>、<code>ragg2</code>三个组件。所有的组件赋予了<code>radare2</code>强大的静态或动态分析、十六进制编辑以及漏洞挖掘能力（在接下来的文章中我会更深入地讲述）。</p>
<p>我们必须意识到学习<code>r2</code>是一个十分艰难的过程——虽然<code>r2</code>有 GUI 和 WebUI。在我看来，IDA 的 GUI 和方便性确实更佳。但是它的命令行接口，包括其可视化模式，仍然是<code>radare2</code>的核心以及魅力所在。因为它的复杂性，我会尽力讲得浅显易懂。</p>
<p><img src="https://www.megabeets.net/uploads/r2_learning_curve.png" alt="这差不多是r2的学习曲线"></p>
<p>在开始之前，你可以看一看<a href="https://www.radare.org/r/cmp.html" target="_blank" rel="noopener">“r2、IDA Pro 和 Hopper 等工具间的比较”</a>来了解它。</p>
<h1 id="获取radare2"><a href="#获取radare2" class="headerlink" title="获取radare2"></a>获取<code>radare2</code></h1><h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p><code>radare2</code>的环境配置非常快——我们每天都会更新，所以更推荐你去使用 git 的版本，而不是稳定版本。有时候稳定版本可能没有 git 版本更稳定。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> https://github.com/radare/radare2.git</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> radare2</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./sys/install.sh</span></span><br></pre></td></tr></table></figure>
<p>如果你不想下载 git 版本或者你想要不同操作系统（<code>Windows</code>、<code>OS X</code>、<code>iOS</code>等等）上的可执行文件，可以在<a href="https://www.radare.org/r/down.html" target="_blank" rel="noopener">radare2 官网下载界面</a>查看。</p>
<h2 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h2><p>正如我之前所说的，更推荐大家使用 git 仓库里最新版的<code>r2</code>。从 git 更新<code>r2</code>只需要执行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./sys/install.sh</span></span><br></pre></td></tr></table></figure>
<p>然后你就能从 git 获得最新的版本。我通常每天早上会更新一下<code>radare2</code>，在这期间可以看看一会儿视频消遣。</p>
<h2 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h2><p>我实在想不出什么理由会让你在看这篇文章时想要卸载<code>radare2</code>。如果要卸载的话只需要执行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> make uninstall</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make purge</span></span><br></pre></td></tr></table></figure>
<h1 id="开始学习"><a href="#开始学习" class="headerlink" title="开始学习"></a>开始学习</h1><p>你可以在<a href="https://github.com/ITAYC0HEN/A-journey-into-Radare2/blob/master/Part%201%20-%20Simple%20crackme/megabeets_0x1" target="_blank" rel="noopener">这里</a>下载 Crackme。</p>
<p>现在你已经在自己的系统上下载了<code>radare2</code>和文件，我们可以开始探索<code>radare2</code>的基础使用。我会在<a href="https://remnux.org/" target="_blank" rel="noopener">REMunx</a>上调试，大部分的命令和说明跟<code>Windows</code>或者其他系统上是一样的。</p>
<h2 id="命令行参数"><a href="#命令行参数" class="headerlink" title="命令行参数"></a>命令行参数</h2><p>和大部分命令行工具一样，查看可选参数的方式是执行<code>-h</code>参数：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> r2 -h</span></span><br></pre></td></tr></table></figure>
<p>我不把完整的输出放上来，而是放一些我日常工作中常用的参数：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Usage: r2 [-ACdfLMnNqStuvwz] [-P patch] [-p prj] [-a arch] [-b bits] [-i file]</span><br><span class="line">          [-s addr] [-B baddr] [-M maddr] [-c cmd] [-e k=v] file|pid|-|--|=</span><br><span class="line"></span><br><span class="line">-d: Debug the executable 'file' or running process 'pid'</span><br><span class="line">-A: Analyze executable at load time (xrefs, etc)</span><br><span class="line">-q: Quiet mode, exit after processing commands</span><br><span class="line">-w: Write mode enabled</span><br><span class="line">-L: List of supported IO plugins</span><br><span class="line">-i [file]: Interprets a r2 script</span><br><span class="line">-n: Bare load. Do not load executable info as the entrypoint</span><br><span class="line">-c 'command; command; ...': Run r2 and execute commands (eg: r2 's main; px 60')</span><br><span class="line">-p [prj]: Creates a project for the file being analyzed</span><br><span class="line">-: Opens r2 with the malloc plugin that gives a 512 bytes memory area to play with</span><br></pre></td></tr></table></figure>
<h2 id="二进制信息"><a href="#二进制信息" class="headerlink" title="二进制信息"></a>二进制信息</h2><p>面对一个新的文件时，我第一件想做的事就是获取文件的信息。我们可以使用<code>r2</code>框架中最强大的工具之一——<code>rabin2</code>来获取信息。</p>
<blockquote>
<ul>
<li><p><code>rabin2</code>可以从二进制文件中获取信息，包括区段、文件头、导入导出表、字符串、入口点等等。同时具有不同的格式的输出。<code>rabin2</code>支持<code>ELF</code>、<code>PE</code>、<code>Mach-O</code>、<code>Java CLASS</code>等文件。</p>
</li>
<li><p>使用<code>man rabin2</code>查看更多的信息。</p>
</li>
</ul>
</blockquote>
<p>我们执行<code>rabin2</code>并使用参数<code>-I</code>输出二进制信息，例如操作系统、语言、字节序、框架以及保护技术（比如<code>Canary</code>、<code>PIC</code>、<code>NX</code>）等等。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> rabin2 -I megabeets_0x1</span></span><br><span class="line">havecode true</span><br><span class="line">pic      false</span><br><span class="line">canary   false</span><br><span class="line">nx       false</span><br><span class="line">crypto   false</span><br><span class="line">va       true</span><br><span class="line">intrp    /lib/ld-linux.so.2</span><br><span class="line">bintype  elf</span><br><span class="line">class    ELF32</span><br><span class="line">lang     c</span><br><span class="line">arch     x86</span><br><span class="line">bits     32</span><br><span class="line">machine  Intel 80386</span><br><span class="line">os       linux</span><br><span class="line">minopsz  1</span><br><span class="line">maxopsz  16</span><br><span class="line">pcalign  0</span><br><span class="line">subsys   linux</span><br><span class="line">endian   little</span><br><span class="line">stripped false</span><br><span class="line">static   false</span><br><span class="line">linenum  true</span><br><span class="line">lsyms    true</span><br><span class="line">relocs   true</span><br><span class="line">rpath    NONE</span><br><span class="line">binsz    6220</span><br></pre></td></tr></table></figure>
<p>你可以清楚地看到，这是一个 32 位 elf 文件，没有符号表并且是动态链接。它没有任何漏洞利用技术——下一篇文章我们讲学习使用<code>radare2</code>来对漏洞进行利用。<br>让我们跑一下程序，看看它做了什么。</p>
<blockquote>
<ul>
<li>注意：虽然我可以向你保证这个程序是安全的，但是逆向一个未知的程序时，务必在一个虚拟环境下运行。</li>
<li>不过你可以相信我，因为程序确实是安全的。😛</li>
</ul>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./megabeets_0x1</span></span><br><span class="line"></span><br><span class="line">  .:: Megabeets ::.</span><br><span class="line">Think you can make it?</span><br><span class="line">Nop, Wrong argument.</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./megabeets_0x1 abcdef</span></span><br><span class="line"></span><br><span class="line">  .:: Megabeets ::.</span><br><span class="line">Think you can make it?</span><br><span class="line">Nop, Wrong argument.</span><br></pre></td></tr></table></figure>
<p>第一次跑的时候，输出了<code>Nop, Wrong argument</code>。假设我们需要提供一个参数，第二次输入<code>abcdef</code>作为参数，依旧失败了。显然需要特定的字符串才能绕过。</p>
<p>让我们用<code>radare2</code>来测试程序：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> r2 ./megabeets_0x1</span></span><br><span class="line"> — Thank you for using radare2. Have a nice night!</span><br><span class="line"><span class="meta">[0x08048370]&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<p>我们生成了一个<code>radare2</code>的 shell，还有一个欢迎界面。我们可以执行<code>fo</code>来输出一个新的句子，有些很搞笑同时有些也很有趣。现在<code>r2</code>的 shell 正在等着我们输入命令，并且展示给我们此刻所在的地址（0x08048370）。默认情况下我们自动在入口点处。让我们看看是否正确：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x08048370]&gt;</span><span class="bash"> ie</span></span><br><span class="line">[Entrypoints]</span><br><span class="line">vaddr=0x08048370 paddr=0x00000370 baddr=0x08048000 laddr=0x00000000 haddr=0x00000018 type=program1 entrypoints</span><br></pre></td></tr></table></figure>
<p>我们使用<code>ie</code>命令输出了文件的入口点地址。<code>r2</code>命令有一系列有意义的字母。在这个例子里，<code>ie</code>代表了<code>info &gt;&gt; entrypoint</code>。因此在你熟悉了<code>radare2</code>的能力之后，命令都是比较好记的。但是你不需要记住所有的命令——你可以仅仅需要在（几乎）每个字母后面加上<code>?</code>来获得命令的信息以及它的子命令。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x08048370]&gt;</span><span class="bash"> i?</span></span><br><span class="line">|Usage: i Get info from opened file (see rabin2’s manpage)</span><br><span class="line">| Output mode:</span><br><span class="line">| ‘*’                Output in radare commands</span><br><span class="line">| ‘j’                Output in json</span><br><span class="line">| ‘q’                Simple quiet output</span><br><span class="line">| Actions:</span><br><span class="line">| i|ij               Show info of current file (in JSON)</span><br><span class="line">| iA                 List archs</span><br><span class="line">| ia                 Show all info (imports, exports, sections..)</span><br><span class="line">| ib                 Reload the current buffer for setting of the bin (use once only)</span><br><span class="line">| ic                 List classes, methods and fields</span><br><span class="line">| iC                 Show signature info (entitlements, …)</span><br><span class="line">| id                 Debug information (source lines)</span><br><span class="line">| iD lang sym        demangle symbolname for given language</span><br><span class="line">| ie                 Entrypoint</span><br><span class="line">| iE                 Exports (global symbols)</span><br><span class="line">| ih                 Headers (alias for iH)</span><br><span class="line">| iHH                Verbose Headers in raw text</span><br><span class="line">| ii                 Imports</span><br><span class="line">| iI                 Binary info</span><br><span class="line">| ik [query]         Key-value database from RBinObject</span><br><span class="line">| il                 Libraries</span><br><span class="line">| iL                 List all RBin plugins loaded</span><br><span class="line">| im                 Show info about predefined memory allocation</span><br><span class="line">| iM                 Show main address</span><br><span class="line">| io [file]          Load info from file (or last opened) use bin.baddr</span><br><span class="line">| ir|iR              Relocs</span><br><span class="line">| is                 Symbols</span><br><span class="line">| iS [entropy,sha1]  Sections (choose which hash algorithm to use)</span><br><span class="line">| iV                 Display file version info</span><br><span class="line">| iz                 Strings in data sections</span><br><span class="line">| izz                Search for Strings in the whole binary</span><br><span class="line">| iZ                 Guess size of binary program</span><br></pre></td></tr></table></figure>
<p><code>i</code>命令目的是从打开的文件中获取信息，它就是集成到<code>radare2</code>的 shell 里的<code>rabin2</code>（之前提到的）。</p>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>默认情况下<code>radare2</code>不会自动分析文件，因为分析文件是一个复杂的过程，尤其是比较大的文件。了解更多关于分析的内容，你可以看一看在<code>radare2</code>博客上的<a href="http://radare.today/posts/analysis-by-default/" target="_blank" rel="noopener">这篇文章</a>。</p>
<p>显然分析仍然是可能的，<code>r2</code>提供了许多种类的分析方式。正如我之前提到的，我们可以通过对<code>a</code>命令后面添加<code>?</code>来查找分析选项。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">[0x08048370]&gt;</span><span class="bash"> a?</span></span><br><span class="line">|Usage: a[abdefFghoprxstc] […]</span><br><span class="line">| ab [hexpairs]    analyze bytes</span><br><span class="line">| abb [len]        analyze N basic blocks in [len] (section.size by default)</span><br><span class="line">| aa[?]            analyze all (fcns + bbs) (aa0 to avoid sub renaming)</span><br><span class="line">| ac[?] [cycles]   analyze which op could be executed in [cycles]</span><br><span class="line">| ad[?]            analyze data trampoline (wip)</span><br><span class="line">| ad [from] [to]   analyze data pointers to (from-to)</span><br><span class="line">| ae[?] [expr]     analyze opcode eval expression (see ao)</span><br><span class="line">| af[?]            analyze Functions</span><br><span class="line">| aF               same as above, but using anal.depth=1</span><br><span class="line">| ag[?] [options]  output Graphviz code</span><br><span class="line">| ah[?]            analysis hints (force opcode size, …)</span><br><span class="line">| ai [addr]        address information (show perms, stack, heap, …)</span><br><span class="line">| ao[?] [len]      analyze Opcodes (or emulate it)</span><br><span class="line">| aO               Analyze N instructions in M bytes</span><br><span class="line">| ar[?]            like ‘dr’ but for the esil vm. (registers)</span><br><span class="line">| ap               find prelude for current offset</span><br><span class="line">| ax[?]            manage refs/xrefs (see also afx?)</span><br><span class="line">| as[?] [num]      analyze syscall using dbg.reg</span><br><span class="line">| at[?] [.]        analyze execution traces</span><br><span class="line">Examples:</span><br><span class="line">f ts @ S*~text:0[3]; f t @ section..text</span><br><span class="line">f ds @ S*~data:0[3]; f d @ section..data</span><br><span class="line">.ad t t+ts @ d:ds</span><br></pre></td></tr></table></figure>
<p>我通常开始分析时会执行<code>aa</code>（<code>analyse all</code>）。这个名称有一点容易误解，因为除此之外还有很多可以分析的（执行<code>aa?</code>可以看到更多的用法），但对于这个程序来说已经足够了。这次我们直接执行<code>aaa</code>，更简单些。你也可以执行<code>radare2</code>用<code>-A</code>参数来分析文件，直接在开始就执行<code>aaa</code>（例如<code>r2 -A megabeets_0x1</code>）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x08048370]&gt;</span><span class="bash"> aaa</span></span><br><span class="line">[x] Analyze all flags starting with sym. and entry0 (aa)</span><br><span class="line">[x] Analyze len bytes of instructions for references (aar)</span><br><span class="line">[x] Analyze function calls (aac)</span><br><span class="line">[*] Use -AA or aaaa to perform additional experimental analysis.</span><br><span class="line">[x] Constructing a function name for fcn.* and sym.func.* functions (aan)</span><br></pre></td></tr></table></figure>
<h2 id="标志"><a href="#标志" class="headerlink" title="标志"></a>标志</h2><p>在分析之后，<code>radare2</code>把一些特定的名字和偏移联系在一起，例如区段、函数、符号表、字符串等等。他们被称作为标志。标志被整合进标志空间，一个标志空间是所有类似特征的标志的集合。执行<code>fs</code>以查看所有的标志：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x08048370]&gt;</span><span class="bash"> fs</span></span><br><span class="line">0    4 . strings</span><br><span class="line">1   35 . symbols</span><br><span class="line">2   82 . sections</span><br><span class="line">3    5 . relocs</span><br><span class="line">4    5 . imports</span><br><span class="line">5    1 . functions</span><br></pre></td></tr></table></figure>
<p>我们可以使用<code>fs &lt;flagspace&gt;</code>来查看某个特定的标志空间，然后用<code>f</code>输出所有的标志。我们使用分号将一行中的多个命令分开（比如<code>命令一; 命令二; 命令三;...</code>）。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x08048370]&gt;</span><span class="bash"> fs imports; f</span></span><br><span class="line">0x08048320 6 sym.imp.strcmp</span><br><span class="line">0x08048330 6 sym.imp.strcpy</span><br><span class="line">0x08048340 6 sym.imp.puts</span><br><span class="line">0xffffffff 16 loc.imp.__gmon_start__</span><br><span class="line">0x08048350 6 sym.imp.__libc_start_main</span><br></pre></td></tr></table></figure>
<p>正如我们所看到的，<code>radare2</code>将所有程序所使用的导入表输出——可以看到我们所熟悉的<code>strcmp</code>、<code>strcpy</code>、<code>puts</code>等，包括相关的地址。我们也可以列出字符串的标志空间。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x08048370]&gt;</span><span class="bash"> fs strings; f</span></span><br><span class="line">0x08048700 21 str._n__.::_Megabeets_::.</span><br><span class="line">0x08048715 23 str.Think_you_can_make_it_</span><br><span class="line">0x0804872c 10 str.Success__n</span><br><span class="line">0x08048736 22 str.Nop__Wrong_argument._n</span><br></pre></td></tr></table></figure>
<h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><p>我们看到<code>r2</code>列出了一些字符串的偏移，还有一些变量名。让我们主要来看看字符串。有很多可以列出程序中字符串的方式，你可以选择你最需要的一种。<br><code>iz</code> – 列出在数据短的字符串<br><code>izz</code> – 在整个程序中查找字符串</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x08048370]&gt;</span><span class="bash"> iz</span></span><br><span class="line">vaddr=0x08048700 paddr=0x00000700 ordinal=000 sz=21 len=20 section=.rodata type=ascii string=\n .:: Megabeets ::.</span><br><span class="line">vaddr=0x08048715 paddr=0x00000715 ordinal=001 sz=23 len=22 section=.rodata type=ascii string=Think you can make it?</span><br><span class="line">vaddr=0x0804872c paddr=0x0000072c ordinal=002 sz=10 len=9 section=.rodata type=ascii string=Success!\n</span><br><span class="line">vaddr=0x08048736 paddr=0x00000736 ordinal=003 sz=22 len=21 section=.rodata type=ascii string=Nop, Wrong argument.\n</span><br></pre></td></tr></table></figure>
<p>我们已经熟悉了大部分字符串——还记得我们一开始运行程序时的那几行字符串吧。但是我们没有看到<code>Success</code>，这应该是我们输入正确字符串后的提示。既然我们已经得到了字符串，让我们看看它们在程序的什么地方被使用了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x08048370]&gt;</span><span class="bash"> axt @@ str.*</span></span><br><span class="line">data 0x8048609 push str._n__.::_Megabeets_::. in main</span><br><span class="line">data 0x8048619 push str.Think_you_can_make_it_ in main</span><br><span class="line">data 0x8048646 push str._n_tSuccess__n in main</span><br><span class="line">data 0x8048658 push str._n_tNop__Wrong_argument._n in main</span><br></pre></td></tr></table></figure>
<p>这个命令展示给我们<code>radare2</code>更多的特点。<code>axt</code>命令用来在数据段或程序段交叉查找某个地址（试试<code>ax?</code>）。<code>@@</code>是一个迭代器标志，用来在一段偏移上重复某个命令（试试<code>@@?</code>）。<code>str.*</code>是一个对所有开头为<code>str.</code>的标志的通配。这条命令能帮助我列出字符串标志以及对应所在的函数名。在这之前要确保选择了字符串的标志空间（默认时是<code>fs *</code>）。</p>
<h2 id="定位"><a href="#定位" class="headerlink" title="定位"></a>定位</h2><p>正如我之前所说的，之前我们一直在程序的入口点，现在应该去其他地方看看了。我们刚列出来的字符串都是在<code>main</code>函数中的。为了定位到字符串，我们需要使用<code>seek</code>命令，用<code>s</code>替代。正如大家所知道的，在（几乎）每个命令后加上<code>?</code>会解决你所有的问题。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x08048370]&gt;</span><span class="bash"> s?</span></span><br><span class="line">|Usage: s  # Seek commands</span><br><span class="line">| s                 Print current address</span><br><span class="line">| s addr            Seek to address</span><br><span class="line">| s-                Undo seek</span><br><span class="line">| s- n              Seek n bytes backward</span><br><span class="line">| s–                Seek blocksize bytes backward</span><br><span class="line">| s+                Redo seek</span><br><span class="line">| s+ n              Seek n bytes forward</span><br><span class="line">| s++               Seek blocksize bytes forward</span><br><span class="line">| s[j*=]            List undo seek history (JSON, =list, *r2)</span><br><span class="line">| s/ DATA           Search for next occurrence of ‘DATA’</span><br><span class="line">| s/x 9091          Search for next occurrence of \x90\x91</span><br><span class="line">| s.hexoff          Seek honoring a base from core-&gt;offset</span><br><span class="line">| sa [[+-]a] [asz]  Seek asz (or bsize) aligned to addr</span><br><span class="line">| sb                Seek aligned to bb start</span><br><span class="line">| sC[?] string      Seek to comment matching given string</span><br><span class="line">| sf                Seek to next function (f-&gt;addr+f-&gt;size)</span><br><span class="line">| sf function       Seek to address of specified function</span><br><span class="line">| sg/sG             Seek begin (sg) or end (sG) of section or file</span><br><span class="line">| sl[?] [+-]line    Seek to line</span><br><span class="line">| sn/sp             Seek next/prev scr.nkey</span><br><span class="line">| so [N]            Seek to N next opcode(s)</span><br><span class="line">| sr pc             Seek to register</span><br></pre></td></tr></table></figure>
<p><code>seek</code>命令是接收一个地址或是一个数学表达式作为参数。这个表达式可以是数学运算、标志或者内存访问操作。我们可以执行<code>s main</code>来定位到 main 函数。让我们先通过<code>afl</code>命令（Analyze Functions List）来查看<code>radare2</code>为我们列出了哪些函数。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x08048370]&gt;</span><span class="bash"> afl</span></span><br><span class="line">0x080482ec    3 35           sym._init</span><br><span class="line">0x08048320    1 6            sym.imp.strcmp</span><br><span class="line">0x08048330    1 6            sym.imp.strcpy</span><br><span class="line">0x08048340    1 6            sym.imp.puts</span><br><span class="line">0x08048350    1 6            sym.imp.__libc_start_main</span><br><span class="line">0x08048360    1 6            sub.__gmon_start___252_360</span><br><span class="line">0x08048370    1 33           entry0</span><br><span class="line">0x080483a0    1 4            sym.__x86.get_pc_thunk.bx</span><br><span class="line">0x080483b0    4 43           sym.deregister_tm_clones</span><br><span class="line">0x080483e0    4 53           sym.register_tm_clones</span><br><span class="line">0x08048420    3 30           sym.__do_global_dtors_aux</span><br><span class="line">0x08048440    4 43   -&gt; 40   sym.frame_dummy</span><br><span class="line">0x0804846b   19 282          sym.rot13</span><br><span class="line">0x08048585    1 112          sym.beet</span><br><span class="line">0x080485f5    5 127          main</span><br><span class="line">0x08048680    4 93           sym.__libc_csu_init</span><br><span class="line">0x080486e0    1 2            sym.__libc_csu_fini</span><br><span class="line">0x080486e4    1 20           sym._fini</span><br></pre></td></tr></table></figure>
<p>这些导入函数正是我们之前所看到的，包括入口点、libc、main 函数和两个引人注意的函数分别叫做<code>sym.beet</code>和<code>sym.rot13</code>。</p>
<h1 id="反汇编"><a href="#反汇编" class="headerlink" title="反汇编"></a>反汇编</h1><h2 id="main-函数"><a href="#main-函数" class="headerlink" title="main 函数"></a>main 函数</h2><p>是时候去看看汇编代码了。首先我们用<code>s main</code>来定位到 main 函数，然后用<code>pdf</code>命令（Print Disassemble Function）来反汇编。注意地址是怎么准确地变成 main 函数的地址的。</p>
<blockquote>
<ul>
<li>注意：正如我之前所说的，这篇文章的目的是教大家学习和了解<code>radare2</code>，而不是教汇编语言的。因此我不会彻底地解释代码。实际上，这个程序也很简单，你只要有一点点基础的逆向工程知识就能掌握。</li>
</ul>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x08048370]&gt;</span><span class="bash"> s main</span></span><br><span class="line"><span class="meta">[0x080485f5]&gt;</span><span class="bash"> pdf</span></span><br><span class="line">          ;– main:</span><br><span class="line">/ (fcn) main 127</span><br><span class="line">|   main ();</span><br><span class="line">|           ; var int local_8h @ ebp-0x8</span><br><span class="line">|           ; var int local_4h @ esp+0x4</span><br><span class="line">|              ; DATA XREF from 0x08048387 (entry0)</span><br><span class="line">|           0x080485f5      8d4c2404       lea ecx, [esp + local_4h]   ; 0x4</span><br><span class="line">|           0x080485f9      83e4f0         and esp, 0xfffffff0</span><br><span class="line">|           0x080485fc      ff71fc         push dword [ecx – 4]</span><br><span class="line">|           0x080485ff      55             push ebp</span><br><span class="line">|           0x08048600      89e5           mov ebp, esp</span><br><span class="line">|           0x08048602      53             push ebx</span><br><span class="line">|           0x08048603      51             push ecx</span><br><span class="line">|           0x08048604      89cb           mov ebx, ecx</span><br><span class="line">|           0x08048606      83ec0c         sub esp, 0xc</span><br><span class="line">|           0x08048609      6800870408     push str._n__.::_Megabeets_::. ; str._n__.::_Megabeets_::.</span><br><span class="line">|           0x0804860e      e82dfdffff     call sym.imp.puts          ; int puts(const char *s)</span><br><span class="line">|           0x08048613      83c410         add esp, 0x10</span><br><span class="line">|           0x08048616      83ec0c         sub esp, 0xc</span><br><span class="line">|           0x08048619      6815870408     push str.Think_you_can_make_it_ ; “Think you can make it?” @ 0x8048715</span><br><span class="line">|           0x0804861e      e81dfdffff     call sym.imp.puts          ; int puts(const char *s)</span><br><span class="line">|           0x08048623      83c410         add esp, 0x10</span><br><span class="line">|           0x08048626      833b01         cmp dword [ebx], 1          ; [0x1:4]=0x1464c45</span><br><span class="line">|       ,=&lt; 0x08048629      7e2a           jle 0x8048655</span><br><span class="line">|       |   0x0804862b      8b4304         mov eax, dword [ebx + 4]    ; [0x4:4]=0x10101</span><br><span class="line">|       |   0x0804862e      83c004         add eax, 4</span><br><span class="line">|       |   0x08048631      8b00           mov eax, dword [eax]</span><br><span class="line">|       |   0x08048633      83ec0c         sub esp, 0xc</span><br><span class="line">|       |   0x08048636      50             push eax</span><br><span class="line">|       |   0x08048637      e849ffffff     call sym.beet</span><br><span class="line">|       |   0x0804863c      83c410         add esp, 0x10</span><br><span class="line">|       |   0x0804863f      85c0           test eax, eax</span><br><span class="line">|      ,==&lt; 0x08048641      7412           je 0x8048655</span><br><span class="line">|      ||   0x08048643      83ec0c         sub esp, 0xc</span><br><span class="line">|      ||   0x08048646      682c870408     push str.Success__n ; “Success!.” @ 0x804872c</span><br><span class="line">|      ||   0x0804864b      e8f0fcffff     call sym.imp.puts          ; int puts(const char *s)</span><br><span class="line">|      ||   0x08048650      83c410         add esp, 0x10</span><br><span class="line">|     ,===&lt; 0x08048653      eb10           jmp 0x8048665</span><br><span class="line">|     |||      ; JMP XREF from 0x08048629 (main)</span><br><span class="line">|     |||      ; JMP XREF from 0x08048641 (main)</span><br><span class="line">|     |-&gt; 0x08048655      83ec0c         sub esp, 0xc</span><br><span class="line">|     |     0x08048658      6836870408     push str.Nop__Wrong_argument._n ; “Nop, Wrong argument..” @ 0x8048736</span><br><span class="line">|     |     0x0804865d      e8defcffff     call sym.imp.puts          ; int puts(const char *s)</span><br><span class="line">|     |     0x08048662      83c410         add esp, 0x10</span><br><span class="line">|     |        ; JMP XREF from 0x08048653 (main)</span><br><span class="line">|     `—&gt; 0x08048665      b800000000     mov eax, 0</span><br><span class="line">|           0x0804866a      8d65f8         lea esp, [ebp – local_8h]</span><br><span class="line">|           0x0804866d      59             pop ecx</span><br><span class="line">|           0x0804866e      5b             pop ebx</span><br><span class="line">|           0x0804866f      5d             pop ebp</span><br><span class="line">|           0x08048670      8d61fc         lea esp, [ecx – 4]</span><br><span class="line">\           0x08048673      c3             ret</span><br></pre></td></tr></table></figure>
<p>看过汇编代码后，我们可以写出一段简单的伪代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (argc &gt; <span class="number">1</span> &amp;&amp; beet(argv[<span class="number">1</span>]) == <span class="literal">true</span>)</span><br><span class="line"><span class="meta"># i.e - <span class="meta-keyword">if</span> any argument passed to the program AND the result of beet, given the passed argument, is true</span></span><br><span class="line"><span class="meta"># argc is the number of arguments passed to the program</span></span><br><span class="line"><span class="meta"># argc will be at least 1 becuase the first argument is the program name</span></span><br><span class="line"><span class="meta"># argv is the array of parameters passed to the program</span></span><br><span class="line">&#123;</span><br><span class="line">    print <span class="string">"success"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">     print <span class="string">"fail"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure>
<h2 id="可视化模式和图形模式"><a href="#可视化模式和图形模式" class="headerlink" title="可视化模式和图形模式"></a>可视化模式和图形模式</h2><p><code>radare2</code>有着一个非常强大、效率极高的可视化模式。可视化模式对用户非常友好并且将使用<code>r2</code>的逆向过程带到了一个新的高度。按下<code>V</code>键开启可视化模式。按下<code>p</code>/<code>P</code>键用来切换模式。在屏幕的最上方可以看到你输入的命令。这里按<code>p</code>可以切换回原来的反汇编模式。</p>
<p><img src="https://www.megabeets.net/uploads/visualMode_1.png" alt></p>
<h3 id="可视化模式基本命令"><a href="#可视化模式基本命令" class="headerlink" title="可视化模式基本命令"></a>可视化模式基本命令</h3><h4 id="移动"><a href="#移动" class="headerlink" title="移动"></a>移动</h4><p>你可以通过<code>k</code>向上移动，通过<code>j</code>向下移动。回车键可以<code>jmp</code>或者<code>call</code>到目标地址。同时在每个<code>jmp</code>或<code>call</code>右侧注释的方括号中有数字，直接按相应的数字可跳转到对应地址。</p>
<h4 id="帮助"><a href="#帮助" class="headerlink" title="帮助"></a>帮助</h4><p>正如之前命令行下的<code>radare2</code>，按下<code>?</code>可以为你展现帮助窗口，你可以学习可视化模式下的各个命令。</p>
<h4 id="交叉引用"><a href="#交叉引用" class="headerlink" title="交叉引用"></a>交叉引用</h4><p>用<code>x</code>/<code>X</code>分别来列出当前函数的引用和调用的情况。按下对应数字来跳转。</p>
<h4 id="radare2命令"><a href="#radare2命令" class="headerlink" title="radare2命令"></a><code>radare2</code>命令</h4><p>使用：在可视化模式下输入<code>:command</code>来执行<code>r2</code>命令</p>
<h4 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h4><p>你可以通过<code>;[-]comment</code>来添加或删去注释。</p>
<h4 id="标记"><a href="#标记" class="headerlink" title="标记"></a>标记</h4><p><code>m&lt;key&gt;</code>可以用来标记特定的偏移地址。<code>&#39;&lt;key&gt;</code>来跳到指定地址。</p>
<h4 id="退出"><a href="#退出" class="headerlink" title="退出"></a>退出</h4><p>按下<code>q</code>键返回到<code>r2</code>的 shell。</p>
<h3 id="可视化图形模式"><a href="#可视化图形模式" class="headerlink" title="可视化图形模式"></a>可视化图形模式</h3><p>和其他的一些反汇编器一样，<code>radare2</code>也有图形视图。你可以输入<code>VV</code>从 shell 进入图形视图，通过<code>k</code>/<code>j</code>/<code>h</code>/<code>l</code>向上/下/左/右移动，按<code>g</code>键跳转到目标函数（例如<code>gd</code>）。</p>
<p><img src="https://www.megabeets.net/uploads/visualGraph_1.png" alt></p>
<p>按<code>?</code>来列出所有的命令，其中<code>R</code>命令值得一学。</p>
<h2 id="反汇编beet函数"><a href="#反汇编beet函数" class="headerlink" title="反汇编beet函数"></a>反汇编<code>beet</code>函数</h2><p>接下来回到反汇编函数上，看看<code>beet</code>函数。正如我们之前所看到的，我们的程序检查了<code>beet</code>的返回结果，也就是我们输入的参数。我们可以通过一些方式输出<code>beet</code>的返回值，这里列出几种：</p>
<ol>
<li>在<code>r2</code>的 shell 中定位到<code>beet</code>函数，然后通过<code>s sym.beet</code>（<code>sym.beet</code>是<code>beet</code>函数的一个标志。你可以通过<code>f sym.&lt;tab&gt;</code>输出出<code>sym</code>的标志）输出函数，然后执行<code>pdf</code>（Print Disassemble Function）；</li>
<li>在<code>r2</code>的 shell 下，通过<code>pdf @ sym.beet</code>输出<code>beet</code>函数。<code>@</code>是临时的定位（输出<code>sym.beet</code>地址处的函数）；</li>
<li>可视化模式下在 main 函数下跳到<code>beet</code>函数；</li>
<li>可视化图形界面下在 main 函数中使用<code>gd</code>（<code>d</code>是<code>call</code>边上的字母）</li>
</ol>
<p>这是<code>beet</code>函数在图形视图下的样子：</p>
<p><img src="https://www.megabeets.net/uploads/visualGraph_beet1.png" alt></p>
<p>我们可以看到输入的参数被复制给了一个缓冲空间。缓存区的位置在<code>ebp - local_88h</code>。<code>local_88h</code>其实是 0x88，也就是十进制的 136。在可视化模式下，我们可以用<code>:</code>执行<code>r2</code>的命令<code>? 0x88</code>查看。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:&gt; ? 0x88</span><br><span class="line">136 0x88 0210 136 0000:0088 136 “\x88” 10001000 136.0 136.000000f 136.000000</span><br></pre></td></tr></table></figure>
<p>由于 4 个字节保存了前一个栈帧的 ebp 值，接下来的 4 个字节则是返回地址，因此在栈上的缓冲区大小为 128 个字节，总共为 136 个字节。</p>
<p>在缓冲区之后是我们输入的参数，它和函数<code>sym.rot13</code>的结果进行比较。<a href="https://en.wikipedia.org/wiki/ROT13" target="_blank" rel="noopener">Rot-13</a>是一个著名的置换加密，经常在 CTF 以及 Crackme 中使用。这个函数接收了 9 个十六进制数，看起来<code>radare2</code>没有把它们识别成一个字符串。我们可以在其地址上执行<code>ahi s</code>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:&gt; ahi s @@=0x080485a3 0x080485ad 0x080485b7</span><br></pre></td></tr></table></figure>
<p><code>ahi s</code>用来将将具体地址转换成字符串（试试<code>ahi?</code>）。<code>@@</code>是一个迭代器（试试<code>@@</code>），然后这些地址则是<code>sym.beet</code>函数中没被<code>radare2</code>识别成字符串的部分。执行完这条命令后，图形视图会自动刷新（如果没有自动刷新，执行<code>r</code>）成这样：</p>
<p><img src="https://www.megabeets.net/uploads/visualGraph_beet2.png" alt></p>
<p>看起来没被识别出来的字符串是<code>Megabeets</code>（根据<a href="https://en.wikipedia.org/wiki/Endianness" target="_blank" rel="noopener">字节序</a>反向压栈得到）。</p>
<p>该程序通过<code>strcmp</code>将经过 rot13 处理后的<code>Megabeets</code>与我们输入的参数进行比较。幸运的是我们不需要辛苦地分析 rot13 的具体算法，因为<code>r2</code>框架中的<code>rahash2</code>工具已经包含了 rot13 加密。</p>
<p><code>rahash2</code>通过不同的算法计算文件或是字符串的校验值。</p>
<p>使用<code>man rahash2</code>查看更多的用法。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:&gt; !rahash2 -E rot -S s:13 -s ‘Megabeets\n’</span><br><span class="line">Zrtnorrgf</span><br></pre></td></tr></table></figure>
<p><code>rahash2</code>执行了<code>rot13(“Megabeets”)</code>后得到了字符串<code>Zrtnorrgf</code>。输入<code>!</code>可以在<code>r2</code>的 shell 下执行系统命令。我们假设<code>Zrtnorrgf</code>就是要和我们的输入进行比较的字符串。让我们在调试模式下打开程序，使用<code>ood</code>（试试<code>ood?</code>）并将<code>Zrtnorrgf</code>作为参数，看看我们会得到什么。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0xf7749be9]&gt;</span><span class="bash"> ood?</span></span><br><span class="line">| ood [args]    reopen in debugger mode (with args)</span><br><span class="line"><span class="meta">[0xf7749be9]&gt;</span><span class="bash"> ood Zrtnorrgf</span></span><br><span class="line">Wait event received by different pid 7415</span><br><span class="line">Wait event received by different pid 7444</span><br><span class="line">Process with PID 7575 started…</span><br><span class="line">File dbg:///home/remnux/Desktop/tutorials/megabeets_0x1 Zrtnorrgf reopened in read-write mode</span><br><span class="line">= attach 7575 7575</span><br><span class="line">Assuming filepath /home/remnux/Desktop/tutorials/megabeets_0x1</span><br><span class="line"><span class="meta">[0xf7749be9]&gt;</span><span class="bash"> dc</span></span><br><span class="line">Selecting and continuing: 7575.:: Megabeets ::.</span><br><span class="line">Think you can make it?</span><br><span class="line">Success!PTRACE_EVENT_EXIT pid=7575, status=0x0</span><br></pre></td></tr></table></figure>
<p>我们收到了成功的提示，破解了这个 Crackme。在成功破解之后，我们终于可以说这个程序就是将我们输入的第一个参数与<code>rot13(“Megabeets”)</code>进行了比较，也就是<code>Zrtnorrgf</code>。</p>
<p>你可以在<a href="https://github.com/ITAYC0HEN/A-journey-into-Radare2/blob/master/Part%201%20-%20Simple%20crackme/megabeets_0x1.c" target="_blank" rel="noopener">这里</a>查看 Crackme 的完整源码。</p>
<h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p><code>Radare2</code>之旅第一部分就告一段落了。我们只接触了<code>radare2</code>的表皮，仅仅了解了它最最基础的一些功能。在下一部分中，我们将会学习更多的关于<code>radare2</code>的功能，包括脚本处理、恶意软件分析和漏洞利用。我知道对于很多人来说一开始是很难的，不管是能否感受到<code>radare2</code>的强大之处，亦或是将你的以前的习惯放到一边而熟悉使用<code>radare2</code>。不管你是一个逆向工程师、一个 CTF 比赛选手或者只是一个安全爱好者，我敢保证将<code>radare2</code>收入你的工具箱绝对一个是明智的选择。</p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/re/">re</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/translation/">translation</a></li></ul>

      
        
	<div id="comment">
		<!-- 来必力City版安装代码 -->
		<div id="lv-container" data-id="city" data-uid="MTAyMC8yOTQ4MS82MDQ5">
		<script type="text/javascript">
		   (function(d, s) {
		       var j, e = d.getElementsByTagName(s)[0];

		       if (typeof LivereTower === 'function') { return; }

		       j = d.createElement(s);
		       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
		       j.async = true;

		       e.parentNode.insertBefore(j, e);
		   })(document, 'script');
		</script>
		<noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
		</div>
		<!-- City版安装代码已完成 -->
	</div>



      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/02/20/【转】Installing-Minimal-Ubuntu-for-REMnux/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          【转】Installing Minimal Ubuntu for REMnux
        
      </div>
    </a>
  
  
    <a href="/2019/02/15/绕过ELF的安全防护机制Canary/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">绕过ELF的安全防护机制Canary</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">Contents</strong>
    
      <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#序言"><span class="nav-number">1.</span> <span class="nav-text">序言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#radare2"><span class="nav-number">2.</span> <span class="nav-text">radare2</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#获取radare2"><span class="nav-number">3.</span> <span class="nav-text">获取radare2</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#下载"><span class="nav-number">3.1.</span> <span class="nav-text">下载</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#更新"><span class="nav-number">3.2.</span> <span class="nav-text">更新</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#卸载"><span class="nav-number">3.3.</span> <span class="nav-text">卸载</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#开始学习"><span class="nav-number">4.</span> <span class="nav-text">开始学习</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#命令行参数"><span class="nav-number">4.1.</span> <span class="nav-text">命令行参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二进制信息"><span class="nav-number">4.2.</span> <span class="nav-text">二进制信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#分析"><span class="nav-number">4.3.</span> <span class="nav-text">分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#标志"><span class="nav-number">4.4.</span> <span class="nav-text">标志</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#字符串"><span class="nav-number">4.5.</span> <span class="nav-text">字符串</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#定位"><span class="nav-number">4.6.</span> <span class="nav-text">定位</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#反汇编"><span class="nav-number">5.</span> <span class="nav-text">反汇编</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#main-函数"><span class="nav-number">5.1.</span> <span class="nav-text">main 函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#可视化模式和图形模式"><span class="nav-number">5.2.</span> <span class="nav-text">可视化模式和图形模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#可视化模式基本命令"><span class="nav-number">5.2.1.</span> <span class="nav-text">可视化模式基本命令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#移动"><span class="nav-number">5.2.1.1.</span> <span class="nav-text">移动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#帮助"><span class="nav-number">5.2.1.2.</span> <span class="nav-text">帮助</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#交叉引用"><span class="nav-number">5.2.1.3.</span> <span class="nav-text">交叉引用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#radare2命令"><span class="nav-number">5.2.1.4.</span> <span class="nav-text">radare2命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#注释"><span class="nav-number">5.2.1.5.</span> <span class="nav-text">注释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#标记"><span class="nav-number">5.2.1.6.</span> <span class="nav-text">标记</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#退出"><span class="nav-number">5.2.1.7.</span> <span class="nav-text">退出</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#可视化图形模式"><span class="nav-number">5.2.2.</span> <span class="nav-text">可视化图形模式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#反汇编beet函数"><span class="nav-number">5.3.</span> <span class="nav-text">反汇编beet函数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#后记"><span class="nav-number">6.</span> <span class="nav-text">后记</span></a></li></ol>
    
    </div>
  </aside>

</section>
        
      </div>

    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2020 AssassinQ All Rights Reserved.
        
      </div>
      <div class="site-credit">
        Theme by <a href="https://github.com/iTimeTraveler/hexo-theme-hipaper" target="_blank">hipaper</a>
      </div>
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");

    wrapdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";


    <!-- headerblur min height -->
    
      var headerblur = document.getElementById("header-blur");
      headerblur.style.minHeight = window.getComputedStyle(document.getElementById("allheader"), null).height;
    
    
</script>
    
<div style="display: none;">
  <script src="https://s11.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
</div>

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/bootstrap.js"></script>
<script src="/js/main.js"></script>







  <div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>








  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>
